{"ast":null,"code":"import _defineProperty from \"/var/www/crm_template/packages/oobook/crm-base/vue/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport \"core-js/modules/es.parse-float.js\";\nimport { computed, onBeforeUnmount, onMounted, ref, watch } from 'vue';\nimport { convertToUnit } from \"../../util/index.mjs\";\nexport function useSticky(_ref) {\n  var rootEl = _ref.rootEl,\n    isSticky = _ref.isSticky,\n    layoutItemStyles = _ref.layoutItemStyles;\n  var isStuck = ref(false);\n  var stuckPosition = ref(0);\n  var stickyStyles = computed(function () {\n    var side = typeof isStuck.value === 'boolean' ? 'top' : isStuck.value;\n    return [isSticky.value ? {\n      top: 'auto',\n      bottom: 'auto',\n      height: undefined\n    } : undefined, isStuck.value ? _defineProperty({}, side, convertToUnit(stuckPosition.value)) : {\n      top: layoutItemStyles.value.top\n    }];\n  });\n  onMounted(function () {\n    watch(isSticky, function (val) {\n      if (val) {\n        window.addEventListener('scroll', onScroll, {\n          passive: true\n        });\n      } else {\n        window.removeEventListener('scroll', onScroll);\n      }\n    }, {\n      immediate: true\n    });\n  });\n  onBeforeUnmount(function () {\n    document.removeEventListener('scroll', onScroll);\n  });\n  var lastScrollTop = 0;\n  function onScroll() {\n    var _layoutItemStyles$val;\n    var direction = lastScrollTop > window.scrollY ? 'up' : 'down';\n    var rect = rootEl.value.getBoundingClientRect();\n    var layoutTop = parseFloat((_layoutItemStyles$val = layoutItemStyles.value.top) !== null && _layoutItemStyles$val !== void 0 ? _layoutItemStyles$val : 0);\n    var top = window.scrollY - Math.max(0, stuckPosition.value - layoutTop);\n    var bottom = rect.height + Math.max(stuckPosition.value, layoutTop) - window.scrollY - window.innerHeight;\n    if (rect.height < window.innerHeight - layoutTop) {\n      isStuck.value = 'top';\n      stuckPosition.value = layoutTop;\n    } else if (direction === 'up' && isStuck.value === 'bottom' || direction === 'down' && isStuck.value === 'top') {\n      stuckPosition.value = window.scrollY + rect.top;\n      isStuck.value = true;\n    } else if (direction === 'down' && bottom <= 0) {\n      stuckPosition.value = 0;\n      isStuck.value = 'bottom';\n    } else if (direction === 'up' && top <= 0) {\n      stuckPosition.value = rect.top + top;\n      isStuck.value = 'top';\n    }\n    lastScrollTop = window.scrollY;\n  }\n  return {\n    isStuck: isStuck,\n    stickyStyles: stickyStyles\n  };\n}","map":{"version":3,"names":["computed","onBeforeUnmount","onMounted","ref","watch","convertToUnit","useSticky","_ref","rootEl","isSticky","layoutItemStyles","isStuck","stuckPosition","stickyStyles","side","value","top","bottom","height","undefined","_defineProperty","val","window","addEventListener","onScroll","passive","removeEventListener","immediate","document","lastScrollTop","_layoutItemStyles$val","direction","scrollY","rect","getBoundingClientRect","layoutTop","parseFloat","Math","max","innerHeight"],"sources":["../../../src/components/VNavigationDrawer/sticky.ts"],"sourcesContent":["import type { CSSProperties, Ref } from 'vue'\nimport { computed, onBeforeUnmount, onMounted, ref, watch } from 'vue'\nimport { convertToUnit } from '@/util'\n\ninterface StickyProps {\n  rootEl: Ref<HTMLElement | undefined>\n  isSticky: Ref<boolean>\n  layoutItemStyles: Ref<CSSProperties>\n}\n\nexport function useSticky ({ rootEl, isSticky, layoutItemStyles }: StickyProps) {\n  const isStuck = ref<boolean | 'top' | 'bottom'>(false)\n  const stuckPosition = ref(0)\n\n  const stickyStyles = computed(() => {\n    const side = typeof isStuck.value === 'boolean' ? 'top' : isStuck.value\n    return [\n      isSticky.value ? { top: 'auto', bottom: 'auto', height: undefined } : undefined,\n      isStuck.value\n        ? { [side]: convertToUnit(stuckPosition.value) }\n        : { top: layoutItemStyles.value.top },\n    ]\n  })\n\n  onMounted(() => {\n    watch(isSticky, val => {\n      if (val) {\n        window.addEventListener('scroll', onScroll, { passive: true })\n      } else {\n        window.removeEventListener('scroll', onScroll)\n      }\n    }, { immediate: true })\n  })\n\n  onBeforeUnmount(() => {\n    document.removeEventListener('scroll', onScroll)\n  })\n\n  let lastScrollTop = 0\n  function onScroll () {\n    const direction = lastScrollTop > window.scrollY ? 'up' : 'down'\n    const rect = rootEl.value!.getBoundingClientRect()\n    const layoutTop = parseFloat(layoutItemStyles.value.top ?? 0)\n    const top = window.scrollY - Math.max(0, stuckPosition.value - layoutTop)\n    const bottom =\n      rect.height +\n      Math.max(stuckPosition.value, layoutTop) -\n      window.scrollY -\n      window.innerHeight\n\n    if (rect.height < window.innerHeight - layoutTop) {\n      isStuck.value = 'top'\n      stuckPosition.value = layoutTop\n    } else if (\n      (direction === 'up' && isStuck.value === 'bottom') ||\n      (direction === 'down' && isStuck.value === 'top')\n    ) {\n      stuckPosition.value = window.scrollY + rect.top\n      isStuck.value = true\n    } else if (direction === 'down' && bottom <= 0) {\n      stuckPosition.value = 0\n      isStuck.value = 'bottom'\n    } else if (direction === 'up' && top <= 0) {\n      stuckPosition.value = rect.top + top\n      isStuck.value = 'top'\n    }\n\n    lastScrollTop = window.scrollY\n  }\n\n  return { isStuck, stickyStyles }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}