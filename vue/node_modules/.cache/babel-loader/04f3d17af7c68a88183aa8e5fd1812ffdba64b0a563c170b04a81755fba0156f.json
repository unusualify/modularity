{"ast":null,"code":"import _defineProperty from \"/var/www/crm_template/packages/oobook/crm-base/vue/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport _objectSpread from \"/var/www/crm_template/packages/oobook/crm-base/vue/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nvar _methods;\nimport \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.array.some.js\";\nimport \"core-js/modules/es.array.find-index.js\";\nimport \"core-js/modules/es.array.unshift.js\";\nimport \"core-js/modules/es.array.for-each.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.array.slice.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array.splice.js\";\nimport \"core-js/modules/es.array.is-array.js\";\nimport { getCurrentInstance } from 'vue';\nimport { mapState } from 'vuex';\nimport { MEDIA_LIBRARY } from '@/store/mutations';\nimport api from '../../store/api/media-library';\nimport ACTIONS from '@/store/actions';\nimport UEModal from './Modal.vue';\nimport scrollToY from '@/utils/scrollToY.js';\nimport FormDataAsObj from '@/utils/formDataAsObj.js';\nimport { ModalMixin } from '@/mixins';\nexport default {\n  mixins: [ModalMixin],\n  components: {\n    'ue-modal': UEModal\n  },\n  setup: function setup(props, _ref) {\n    var attrs = _ref.attrs,\n      slots = _ref.slots,\n      emit = _ref.emit;\n  } // __log(props, attrs, slots, emit)\n  ,\n\n  props: {\n    modalTitlePrefix: {\n      type: String,\n      \"default\": function _default(props) {\n        return getCurrentInstance().appContext.config.globalProperties.$trans('media-library.title', 'Media Library');\n      }\n    },\n    btnLabelSingle: {\n      type: String,\n      \"default\": function _default() {\n        return getCurrentInstance().appContext.config.globalProperties.$trans('media-library.insert', 'Insert');\n      }\n    },\n    btnLabelUpdate: {\n      type: String,\n      \"default\": function _default() {\n        return getCurrentInstance().appContext.config.globalProperties.$trans('media-library.update', 'Update');\n      }\n    },\n    btnLabelMulti: {\n      type: String,\n      \"default\": function _default() {\n        return getCurrentInstance().appContext.config.globalProperties.$trans('media-library.insert', 'Insert');\n      }\n    },\n    initialPage: {\n      type: Number,\n      \"default\": 1\n    },\n    authorized: {\n      type: Boolean,\n      \"default\": true\n    },\n    showInsert: {\n      type: Boolean,\n      \"default\": true\n    },\n    extraMetadatas: {\n      type: Array,\n      \"default\": function _default() {\n        return [];\n      }\n    },\n    translatableMetadatas: {\n      type: Array,\n      \"default\": function _default() {\n        return [];\n      }\n    }\n  },\n  data: function data() {\n    return {\n      loading: false,\n      maxPage: 20,\n      mediaItems: [],\n      selectedMedias: [],\n      gridHeight: 0,\n      page: this.initialPage,\n      tags: [],\n      lastScrollTop: 0,\n      gridLoaded: false,\n      full: true\n      //   show: false\n    };\n  },\n\n  computed: _objectSpread({\n    renderedMediaItems: function renderedMediaItems() {\n      var _this = this;\n      return this.mediaItems.map(function (item) {\n        item.disabled = _this.filesizeMax > 0 && item.filesizeInMb > _this.filesizeMax || _this.widthMin > 0 && item.width < _this.widthMin || _this.heightMin > 0 && item.height < _this.heightMin;\n        return item;\n      });\n    },\n    currentTypeObject: function currentTypeObject() {\n      var _this2 = this;\n      return this.types.find(function (type) {\n        return type.value === _this2.type;\n      });\n    },\n    endpoint: function endpoint() {\n      return this.currentTypeObject.endpoint;\n    },\n    modalTitle: function modalTitle() {\n      if (this.connector) {\n        if (this.indexToReplace > -1) return this.modalTitlePrefix + ' – ' + this.btnLabelUpdate;\n        return this.selectedMedias.length > 1 ? this.modalTitlePrefix + ' – ' + this.btnLabelMulti : this.modalTitlePrefix + ' – ' + this.btnLabelSingle;\n      }\n      return this.modalTitlePrefix;\n    },\n    btnLabel: function btnLabel() {\n      var type = getCurrentInstance().appContext.config.globalProperties.$trans('media-library.types.single.' + this.type, this.type);\n      if (this.indexToReplace > -1) {\n        return this.btnLabelUpdate + ' ' + type;\n      } else {\n        if (this.selectedMedias.length > 1) {\n          type = getCurrentInstance().appContext.config.globalProperties.$trans('media-library.types.multiple.' + this.type, this.type);\n        }\n        return this.btnLabelSingle + ' ' + type;\n      }\n    },\n    usedMedias: function usedMedias() {\n      return this.selected[this.connector] || [];\n    },\n    selectedType: function selectedType() {\n      var self = this;\n      var navItem = self.types.filter(function (t) {\n        return t.value === self.type;\n      });\n      return navItem[0];\n    },\n    canInsert: function canInsert() {\n      var _this3 = this;\n      return !this.selectedMedias.some(function (sMedia) {\n        return !!_this3.usedMedias.find(function (uMedia) {\n          return uMedia.id === sMedia.id;\n        });\n      });\n    }\n  }, mapState({\n    connector: function connector(state) {\n      return state.mediaLibrary.connector;\n    },\n    max: function max(state) {\n      return state.mediaLibrary.max;\n    },\n    filesizeMax: function filesizeMax(state) {\n      return state.mediaLibrary.filesizeMax;\n    },\n    widthMin: function widthMin(state) {\n      return state.mediaLibrary.widthMin;\n    },\n    heightMin: function heightMin(state) {\n      return state.mediaLibrary.heightMin;\n    },\n    type: function type(state) {\n      return state.mediaLibrary.type;\n    },\n    // image, video, file\n    types: function types(state) {\n      return state.mediaLibrary.types;\n    },\n    strict: function strict(state) {\n      return state.mediaLibrary.strict;\n    },\n    selected: function selected(state) {\n      return state.mediaLibrary.selected;\n    },\n    indexToReplace: function indexToReplace(state) {\n      return state.mediaLibrary.indexToReplace;\n    }\n\n    // showModal: state => state.mediaLibrary.showModal,\n\n    // show: state => state.mediaLibrary.showModal,\n  })),\n\n  watch: {\n    type: function type() {\n      this.clearMediaItems();\n      this.gridLoaded = false;\n    }\n  },\n  methods: (_methods = {\n    // for ue-uploader\n    addMedia: function addMedia(media) {\n      var _this4 = this;\n      var index = this.mediaItems.findIndex(function (item) {\n        return item.id === media.id;\n      });\n\n      // Check of the media item exists i.e replacement\n      if (index > -1) {\n        var _loop = function _loop(mediaRole) {\n          _this4.selected[mediaRole].forEach(function (mediaCrop, index) {\n            if (media.id === mediaCrop.id) {\n              var crops = [];\n              for (var crop in mediaCrop.crops) {\n                crops[crop] = {\n                  height: media.height === mediaCrop.height ? mediaCrop.crops[crop].height : media.height,\n                  name: crop,\n                  width: media.width === mediaCrop.width ? mediaCrop.crops[crop].width : media.width,\n                  x: media.width === mediaCrop.width ? mediaCrop.crops[crop].x : 0,\n                  y: media.height === mediaCrop.height ? mediaCrop.crops[crop].y : 0\n                };\n              }\n              _this4.$store.commit(MEDIA_LIBRARY.UPDATE_MEDIAS, {\n                index: index,\n                media: _objectSpread(_objectSpread({}, media), {}, {\n                  width: media.width === mediaCrop.width ? mediaCrop.width : media.width,\n                  height: media.height === mediaCrop.height ? mediaCrop.height : media.height,\n                  crops: crops\n                }),\n                mediaRole: mediaRole\n              });\n            }\n          });\n        };\n        for (var mediaRole in this.selected) {\n          _loop(mediaRole);\n        }\n        this.$set(this.mediaItems, index, media);\n        this.selectedMedias.unshift(media);\n      } else {\n        // add media in first position of the available media\n        this.mediaItems.unshift(media);\n        this.$store.commit(MEDIA_LIBRARY.INCREMENT_MEDIA_TYPE_TOTAL, this.type);\n        // select it\n        this.updateSelectedMedias(media.id);\n      }\n    },\n    updateSelectedMedias: function updateSelectedMedias(item) {\n      var _this5 = this;\n      var shift = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      var id = item.id;\n      var alreadySelectedMedia = this.selectedMedias.filter(function (media) {\n        return media.id === id;\n      });\n\n      // not already selected\n      if (alreadySelectedMedia.length === 0) {\n        if (this.max === 1) this.clearSelectedMedias();\n        if (this.selectedMedias.length >= this.max && this.max > 0) return;\n        if (shift && this.selectedMedias.length > 0) {\n          var lastSelectedMedia = this.selectedMedias[this.selectedMedias.length - 1];\n          var lastSelectedMediaIndex = this.mediaItems.findIndex(function (media) {\n            return media.id === lastSelectedMedia.id;\n          });\n          var selectedMediaIndex = this.mediaItems.findIndex(function (media) {\n            return media.id === id;\n          });\n          if (selectedMediaIndex === -1 && lastSelectedMediaIndex === -1) return;\n          var start = null;\n          var end = null;\n          if (lastSelectedMediaIndex < selectedMediaIndex) {\n            start = lastSelectedMediaIndex + 1;\n            end = selectedMediaIndex + 1;\n          } else {\n            start = selectedMediaIndex;\n            end = lastSelectedMediaIndex;\n          }\n          var selectedMedias = this.mediaItems.slice(start, end);\n          selectedMedias.forEach(function (media) {\n            if (_this5.selectedMedias.length >= _this5.max && _this5.max > 0) return;\n            var index = _this5.selectedMedias.findIndex(function (m) {\n              return m.id === media.id;\n            });\n            if (index === -1) {\n              _this5.selectedMedias.push(media);\n            }\n          });\n        } else {\n          var mediaToSelect = this.mediaItems.filter(function (media) {\n            return media.id === id;\n          });\n\n          // Add one media to the selected media\n          if (mediaToSelect.length) this.selectedMedias.push(mediaToSelect[0]);\n        }\n      } else {\n        // Remove one item from the selected media\n        this.selectedMedias = this.selectedMedias.filter(function (media) {\n          return media.id !== id;\n        });\n      }\n    },\n    clearSelectedMedias: function clearSelectedMedias() {\n      this.selectedMedias.splice(0);\n    },\n    // for ue-filter\n    clearFilters: function clearFilters() {\n      var self = this;\n      // reset tags\n      if (this.$refs.filter) this.$refs.filter.value = null;\n      // reset unused field\n      if (this.$refs.unused) {\n        var input = this.$refs.unused.$el.querySelector('input');\n        input && input.checked && input.click();\n      }\n      this.$nextTick(function () {\n        self.submitFilter();\n      });\n    },\n    submitFilter: function submitFilter(formData) {\n      var self = this;\n      var el = this.$refs.list;\n      // when changing filters, reset the page to 1\n      this.page = 1;\n      this.clearMediaItems();\n      this.clearSelectedMedias();\n      if (el.scrollTop === 0) {\n        self.reloadGrid();\n        return;\n      }\n      scrollToY({\n        el: el,\n        offset: 0,\n        easing: 'easeOut',\n        onComplete: function onComplete() {\n          self.reloadGrid();\n        }\n      });\n    },\n    clearMediaItems: function clearMediaItems() {\n      this.mediaItems.splice(0);\n    }\n  }, _defineProperty(_methods, \"clearSelectedMedias\", function clearSelectedMedias() {\n    this.selectedMedias.splice(0);\n  }), _defineProperty(_methods, \"reloadGrid\", function reloadGrid() {\n    var _this6 = this;\n    this.loading = true;\n    var form = this.$refs.form;\n    var formdata = this.getFormData(form);\n\n    // if (this.selected[this.connector]) {\n    //   formdata.except = this.selected[this.connector].map((media) => {\n    //     return media.id\n    //   })\n    //   console.log(formdata.except)\n    // }\n\n    // see api/media-library for actual ajax\n    api.get(this.endpoint, formdata, function (resp) {\n      // add medias here\n      resp.data.items.forEach(function (item) {\n        if (!_this6.mediaItems.find(function (media) {\n          return media.id === item.id;\n        })) {\n          _this6.mediaItems.push(item);\n        }\n      });\n      _this6.maxPage = resp.data.maxPage || 1;\n      _this6.tags = resp.data.tags || [];\n      _this6.$store.commit(MEDIA_LIBRARY.UPDATE_MEDIA_TYPE_TOTAL, {\n        type: _this6.type,\n        total: resp.data.total\n      });\n      _this6.loading = false;\n      _this6.listenScrollPosition();\n      _this6.gridLoaded = true;\n    }, function (error) {\n      // this.$store.commit(NOTIFICATION.SET_NOTIF, {\n      //   message: error.data.message,\n      //   variant: 'error'\n      // })\n    });\n  }), _defineProperty(_methods, \"updateType\", function updateType(newType) {\n    if (this.loading) return;\n    if (this.strict) return;\n    if (this.type === newType) return;\n    this.$store.commit(MEDIA_LIBRARY.UPDATE_MEDIA_TYPE, newType);\n    this.submitFilter();\n  }), _defineProperty(_methods, \"getFormData\", function getFormData(form) {\n    var data = FormDataAsObj(form);\n    if (data) data.page = this.page;else data = {\n      page: this.page\n    };\n    data.type = this.type;\n    if (Array.isArray(data.unused) && data.unused.length) {\n      data.unused = data.unused[0];\n    }\n    return data;\n  }), _methods),\n  created: function created() {}\n};","map":{"version":3,"names":["getCurrentInstance","mapState","MEDIA_LIBRARY","api","ACTIONS","UEModal","scrollToY","FormDataAsObj","ModalMixin","mixins","components","setup","props","_ref","attrs","slots","emit","modalTitlePrefix","type","String","_default","appContext","config","globalProperties","$trans","btnLabelSingle","btnLabelUpdate","btnLabelMulti","initialPage","Number","authorized","Boolean","showInsert","extraMetadatas","Array","translatableMetadatas","data","loading","maxPage","mediaItems","selectedMedias","gridHeight","page","tags","lastScrollTop","gridLoaded","full","computed","_objectSpread","renderedMediaItems","_this","map","item","disabled","filesizeMax","filesizeInMb","widthMin","width","heightMin","height","currentTypeObject","_this2","types","find","value","endpoint","modalTitle","connector","indexToReplace","length","btnLabel","usedMedias","selected","selectedType","self","navItem","filter","t","canInsert","_this3","some","sMedia","uMedia","id","state","mediaLibrary","max","strict","watch","clearMediaItems","methods","_methods","addMedia","media","_this4","index","findIndex","_loop","mediaRole","forEach","mediaCrop","crops","crop","name","x","y","$store","commit","UPDATE_MEDIAS","$set","unshift","INCREMENT_MEDIA_TYPE_TOTAL","updateSelectedMedias","_this5","shift","arguments","undefined","alreadySelectedMedia","clearSelectedMedias","lastSelectedMedia","lastSelectedMediaIndex","selectedMediaIndex","start","end","slice","m","push","mediaToSelect","splice","clearFilters","$refs","unused","input","$el","querySelector","checked","click","$nextTick","submitFilter","formData","el","list","scrollTop","reloadGrid","offset","easing","onComplete","_defineProperty","_this6","form","formdata","getFormData","get","resp","items","UPDATE_MEDIA_TYPE_TOTAL","total","listenScrollPosition","error","updateType","newType","UPDATE_MEDIA_TYPE","isArray","created"],"sources":["/var/www/crm_template/packages/oobook/crm-base/vue/src/js/components/modals/ModalMedia.vue"],"sourcesContent":["<template>\n  <ue-modal\n    v-model=\"show\"\n    id=\"modalMedia\"\n    ref=\"modalMedia\"\n\n    fullscreen\n    content-class=\"bg-primary\"\n\n    >\n    <template v-slot:activator=\"{props}\">\n      <slot\n          name=\"activator\"\n          :props=\"{...props}\"\n          >\n      </slot>\n    </template>\n    <template\n        v-slot:body=\"{props}\"\n        v-bind=\"props\"\n        >\n\n        <div class=\"medialibrary\">\n          <div class=\"medialibrary__frame\">\n\n            <v-toolbar\n              dark\n              color=\"primary\"\n            >\n              <v-toolbar-title>{{ modalTitle }}</v-toolbar-title>\n              <v-spacer></v-spacer>\n              <v-toolbar-items>\n                <v-btn\n                  icon\n                  dark\n                  @click=\"closeModal\"\n                >\n                  <v-icon>mdi-close</v-icon>\n                </v-btn>\n              </v-toolbar-items>\n            </v-toolbar>\n            <div class=\"medialibrary__header\" ref=\"form\">\n              <ue-filter @submit=\"submitFilter\" :clearOption=\"true\" @clear=\"clearFilters\">\n                <ul class=\"secondarynav secondarynav--desktop py\" slot=\"navigation\" v-if=\"types.length\">\n\n                  <v-chip\n\n                    v-for=\"navType in types\"\n                    :key=\"navType.value\"\n                    class=\"ma-2\"\n                    @click.prevent=\"updateType(navType.value)\"\n                    >\n                      {{  navType.text }}\n                      <span\n                        v-if=\"navType.total > 0\" class=\"secondarynav__number\"\n                        >\n                        ({{ navType.total }})\n                      </span>\n                  </v-chip>\n                  <!-- <li\n                    class=\"secondarynav__item\"\n                    v-for=\"navType in types\"\n                    :key=\"navType.value\"\n                    :class=\"{ 's--on': type === navType.value, 's--disabled' : type !== navType.value && strict }\"\n                    >\n                    <a href=\"#\" @click.prevent=\"updateType(navType.value)\">\n                      <span class=\"secondarynav__link\">{{ navType.text }}</span>\n                      <span\n                        v-if=\"navType.total > 0\" class=\"secondarynav__number\"\n                        >\n                        ({{ navType.total }})\n                      </span>\n                    </a>\n                  </li> -->\n                </ul>\n\n                <!-- <div class=\"secondarynav secondarynav--mobile secondarynav--dropdown\" slot=\"navigation\">\n                  <a17-dropdown ref=\"secondaryNavDropdown\" position=\"bottom-left\" width=\"full\" :offset=\"0\">\n                    <a17-button class=\"secondarynav__button\" variant=\"dropdown-transparent\" size=\"small\"\n                                @click=\"$refs.secondaryNavDropdown.toggle()\" v-if=\"selectedType\">\n                      <span class=\"secondarynav__link\">{{ selectedType.text }}</span><span class=\"secondarynav__number\">{{ selectedType.total }}</span>\n                    </a17-button>\n                    <div slot=\"dropdown__content\">\n                      <ul>\n                        <li v-for=\"navType in types\" :key=\"navType.value\" class=\"secondarynav__item\">\n                          <a href=\"#\" v-on:click.prevent=\"updateType(navType.value)\"><span class=\"secondarynav__link\">{{ navType.text }}</span><span\n                            class=\"secondarynav__number\">{{ navType.total }}</span></a>\n                        </li>\n                      </ul>\n                    </div>\n                  </a17-dropdown>\n                </div> -->\n\n                <div slot=\"hidden-filters\">\n                  <!-- <a17-vselect class=\"medialibrary__filter-item\" ref=\"filter\" name=\"tag\" :options=\"tags\"\n                              :placeholder=\"$trans('media-library.filter-select-label', 'Filter by tag')\" :searchable=\"true\" maxHeight=\"175px\"/>\n                  <a17-checkbox class=\"medialibrary__filter-item\" ref=\"unused\" name=\"unused\" :initial-value=\"0\" :value=\"1\" :label=\"$trans('media-library.unused-filter-label', 'Show unused only')\"/> -->\n                </div>\n              </ue-filter>\n            </div>\n\n            <div class=\"medialibrary__inner\">\n              <div class=\"medialibrary__grid\">\n                <aside class=\"medialibrary__sidebar\">\n                  Side\n                </aside>\n                <footer class=\"medialibrary__footer\" v-if=\"selectedMedias.length && showInsert && connector\">\n                  <!-- <a17-button v-if=\"canInsert\" variant=\"action\" @click=\"saveAndClose\">{{ btnLabel }}</a17-button>\n                  <a17-button v-else variant=\"action\" :disabled=\"true\">{{ btnLabel }}</a17-button> -->\n                  <ue-btn\n                      v-if=\"canInsert\" @click=\"saveAndClose\"\n                      >\n                      {{ btnLabel }}\n                  </ue-btn>\n                  <ue-btn\n                      v-else\n                      :disabled=\"true\"\n                      >\n                      {{ btnLabel }}\n                  </ue-btn>\n                </footer>\n\n                <div class=\"medialibrary__list\" ref=\"list\">\n                  <ue-uploader\n                    ref=\"uploader\"\n                    v-if=\"authorized\"\n                    @loaded=\"addMedia\"\n                    @clear=\"clearSelectedMedias\"\n                    :type=\"currentTypeObject\"\n                    />\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n    </template>\n  </ue-modal>\n</template>\n\n<script>\nimport { getCurrentInstance } from 'vue'\nimport { mapState } from 'vuex'\nimport { MEDIA_LIBRARY } from '@/store/mutations'\n\nimport api from '../../store/api/media-library'\n\nimport ACTIONS from '@/store/actions'\n\nimport UEModal from './Modal.vue'\n\nimport scrollToY from '@/utils/scrollToY.js'\n\nimport FormDataAsObj from '@/utils/formDataAsObj.js'\n\nimport { ModalMixin } from '@/mixins'\n\nexport default {\n  mixins: [ModalMixin],\n  components: {\n    'ue-modal': UEModal\n  },\n  setup (props, { attrs, slots, emit }) {\n    // __log(props, attrs, slots, emit)\n  },\n  props: {\n    modalTitlePrefix: {\n      type: String,\n      default: function (props) {\n        return getCurrentInstance().appContext.config.globalProperties.$trans('media-library.title', 'Media Library')\n      }\n    },\n    btnLabelSingle: {\n      type: String,\n      default: function () {\n        return getCurrentInstance().appContext.config.globalProperties.$trans('media-library.insert', 'Insert')\n      }\n    },\n    btnLabelUpdate: {\n      type: String,\n      default: function () {\n        return getCurrentInstance().appContext.config.globalProperties.$trans('media-library.update', 'Update')\n      }\n    },\n    btnLabelMulti: {\n      type: String,\n      default: function () {\n        return getCurrentInstance().appContext.config.globalProperties.$trans('media-library.insert', 'Insert')\n      }\n    },\n    initialPage: {\n      type: Number,\n      default: 1\n    },\n    authorized: {\n      type: Boolean,\n      default: true\n    },\n    showInsert: {\n      type: Boolean,\n      default: true\n    },\n    extraMetadatas: {\n      type: Array,\n      default () {\n        return []\n      }\n    },\n    translatableMetadatas: {\n      type: Array,\n      default () {\n        return []\n      }\n    }\n  },\n  data: function () {\n    return {\n      loading: false,\n      maxPage: 20,\n      mediaItems: [],\n      selectedMedias: [],\n      gridHeight: 0,\n      page: this.initialPage,\n      tags: [],\n      lastScrollTop: 0,\n      gridLoaded: false,\n\n      full: true\n    //   show: false\n    }\n  },\n  computed: {\n    renderedMediaItems: function () {\n      return this.mediaItems.map((item) => {\n        item.disabled = (this.filesizeMax > 0 && item.filesizeInMb > this.filesizeMax) ||\n            (this.widthMin > 0 && item.width < this.widthMin) ||\n            (this.heightMin > 0 && item.height < this.heightMin)\n        return item\n      })\n    },\n    currentTypeObject: function () {\n      return this.types.find((type) => {\n        return type.value === this.type\n      })\n    },\n    endpoint: function () {\n      return this.currentTypeObject.endpoint\n    },\n    modalTitle: function () {\n      if (this.connector) {\n        if (this.indexToReplace > -1) return this.modalTitlePrefix + ' – ' + this.btnLabelUpdate\n        return this.selectedMedias.length > 1 ? this.modalTitlePrefix + ' – ' + this.btnLabelMulti : this.modalTitlePrefix + ' – ' + this.btnLabelSingle\n      }\n      return this.modalTitlePrefix\n    },\n    btnLabel: function () {\n      let type = getCurrentInstance().appContext.config.globalProperties.$trans('media-library.types.single.' + this.type, this.type)\n\n      if (this.indexToReplace > -1) {\n        return this.btnLabelUpdate + ' ' + type\n      } else {\n        if (this.selectedMedias.length > 1) {\n          type = getCurrentInstance().appContext.config.globalProperties.$trans('media-library.types.multiple.' + this.type, this.type)\n        }\n\n        return this.btnLabelSingle + ' ' + type\n      }\n    },\n    usedMedias: function () {\n      return this.selected[this.connector] || []\n    },\n    selectedType: function () {\n      const self = this\n      const navItem = self.types.filter(function (t) {\n        return t.value === self.type\n      })\n      return navItem[0]\n    },\n    canInsert: function () {\n      return !this.selectedMedias.some(sMedia => !!this.usedMedias.find(uMedia => uMedia.id === sMedia.id))\n    },\n    ...mapState({\n      connector: state => state.mediaLibrary.connector,\n      max: state => state.mediaLibrary.max,\n      filesizeMax: state => state.mediaLibrary.filesizeMax,\n      widthMin: state => state.mediaLibrary.widthMin,\n      heightMin: state => state.mediaLibrary.heightMin,\n      type: state => state.mediaLibrary.type, // image, video, file\n      types: state => state.mediaLibrary.types,\n      strict: state => state.mediaLibrary.strict,\n      selected: state => state.mediaLibrary.selected,\n      indexToReplace: state => state.mediaLibrary.indexToReplace\n\n      // showModal: state => state.mediaLibrary.showModal,\n\n      // show: state => state.mediaLibrary.showModal,\n    })\n\n    // show: {\n    //     get () {\n    //         return this.$store.state.mediaLibrary.showModal;\n    //     },\n    //     set (value) {\n    //         // this.$store.dispatch(ACTIONS.TOGGLE_MEDIA_MODAL, value)\n    //     }\n    // },\n  },\n  watch: {\n    type: function () {\n      this.clearMediaItems()\n      this.gridLoaded = false\n    }\n  },\n  methods: {\n\n    // for ue-uploader\n    addMedia: function (media) {\n      const index = this.mediaItems.findIndex(function (item) {\n        return item.id === media.id\n      })\n\n      // Check of the media item exists i.e replacement\n      if (index > -1) {\n        for (const mediaRole in this.selected) {\n          this.selected[mediaRole].forEach((mediaCrop, index) => {\n            if (media.id === mediaCrop.id) {\n              const crops = []\n\n              for (const crop in mediaCrop.crops) {\n                crops[crop] = {\n                  height: media.height === mediaCrop.height ? mediaCrop.crops[crop].height : media.height,\n                  name: crop,\n                  width: media.width === mediaCrop.width ? mediaCrop.crops[crop].width : media.width,\n                  x: media.width === mediaCrop.width ? mediaCrop.crops[crop].x : 0,\n                  y: media.height === mediaCrop.height ? mediaCrop.crops[crop].y : 0\n                }\n              }\n\n              this.$store.commit(MEDIA_LIBRARY.UPDATE_MEDIAS, {\n                index,\n                media: {\n                  ...media,\n                  width: media.width === mediaCrop.width ? mediaCrop.width : media.width,\n                  height: media.height === mediaCrop.height ? mediaCrop.height : media.height,\n                  crops\n                },\n                mediaRole\n              })\n            }\n          })\n        }\n\n        this.$set(this.mediaItems, index, media)\n        this.selectedMedias.unshift(media)\n      } else {\n        // add media in first position of the available media\n        this.mediaItems.unshift(media)\n        this.$store.commit(MEDIA_LIBRARY.INCREMENT_MEDIA_TYPE_TOTAL, this.type)\n        // select it\n        this.updateSelectedMedias(media.id)\n      }\n    },\n    updateSelectedMedias: function (item, shift = false) {\n      const id = item.id\n      const alreadySelectedMedia = this.selectedMedias.filter(function (media) {\n        return media.id === id\n      })\n\n      // not already selected\n      if (alreadySelectedMedia.length === 0) {\n        if (this.max === 1) this.clearSelectedMedias()\n        if (this.selectedMedias.length >= this.max && this.max > 0) return\n\n        if (shift && this.selectedMedias.length > 0) {\n          const lastSelectedMedia = this.selectedMedias[this.selectedMedias.length - 1]\n          const lastSelectedMediaIndex = this.mediaItems.findIndex((media) => media.id === lastSelectedMedia.id)\n          const selectedMediaIndex = this.mediaItems.findIndex((media) => media.id === id)\n          if (selectedMediaIndex === -1 && lastSelectedMediaIndex === -1) return\n\n          let start = null\n          let end = null\n          if (lastSelectedMediaIndex < selectedMediaIndex) {\n            start = lastSelectedMediaIndex + 1\n            end = selectedMediaIndex + 1\n          } else {\n            start = selectedMediaIndex\n            end = lastSelectedMediaIndex\n          }\n\n          const selectedMedias = this.mediaItems.slice(start, end)\n\n          selectedMedias.forEach((media) => {\n            if (this.selectedMedias.length >= this.max && this.max > 0) return\n            const index = this.selectedMedias.findIndex((m) => m.id === media.id)\n            if (index === -1) {\n              this.selectedMedias.push(media)\n            }\n          })\n        } else {\n          const mediaToSelect = this.mediaItems.filter(function (media) {\n            return media.id === id\n          })\n\n          // Add one media to the selected media\n          if (mediaToSelect.length) this.selectedMedias.push(mediaToSelect[0])\n        }\n      } else {\n        // Remove one item from the selected media\n        this.selectedMedias = this.selectedMedias.filter(function (media) {\n          return media.id !== id\n        })\n      }\n    },\n    clearSelectedMedias: function () {\n      this.selectedMedias.splice(0)\n    },\n\n    // for ue-filter\n    clearFilters: function () {\n      const self = this\n      // reset tags\n      if (this.$refs.filter) this.$refs.filter.value = null\n      // reset unused field\n      if (this.$refs.unused) {\n        const input = this.$refs.unused.$el.querySelector('input')\n        input && input.checked && input.click()\n      }\n\n      this.$nextTick(function () {\n        self.submitFilter()\n      })\n    },\n    submitFilter: function (formData) {\n      const self = this\n      const el = this.$refs.list\n      // when changing filters, reset the page to 1\n      this.page = 1\n\n      this.clearMediaItems()\n      this.clearSelectedMedias()\n\n      if (el.scrollTop === 0) {\n        self.reloadGrid()\n        return\n      }\n\n      scrollToY({\n        el,\n        offset: 0,\n        easing: 'easeOut',\n        onComplete: function () {\n          self.reloadGrid()\n        }\n      })\n    },\n    clearMediaItems: function () {\n      this.mediaItems.splice(0)\n    },\n    clearSelectedMedias: function () {\n      this.selectedMedias.splice(0)\n    },\n    reloadGrid: function () {\n      this.loading = true\n\n      const form = this.$refs.form\n      const formdata = this.getFormData(form)\n\n      // if (this.selected[this.connector]) {\n      //   formdata.except = this.selected[this.connector].map((media) => {\n      //     return media.id\n      //   })\n      //   console.log(formdata.except)\n      // }\n\n      // see api/media-library for actual ajax\n      api.get(this.endpoint, formdata, (resp) => {\n        // add medias here\n        resp.data.items.forEach(item => {\n          if (!this.mediaItems.find(media => media.id === item.id)) {\n            this.mediaItems.push(item)\n          }\n        })\n        this.maxPage = resp.data.maxPage || 1\n        this.tags = resp.data.tags || []\n        this.$store.commit(MEDIA_LIBRARY.UPDATE_MEDIA_TYPE_TOTAL, { type: this.type, total: resp.data.total })\n        this.loading = false\n        this.listenScrollPosition()\n        this.gridLoaded = true\n      }, (error) => {\n        // this.$store.commit(NOTIFICATION.SET_NOTIF, {\n        //   message: error.data.message,\n        //   variant: 'error'\n        // })\n      })\n    },\n    updateType: function (newType) {\n      if (this.loading) return\n      if (this.strict) return\n      if (this.type === newType) return\n\n      this.$store.commit(MEDIA_LIBRARY.UPDATE_MEDIA_TYPE, newType)\n      this.submitFilter()\n    },\n\n    getFormData: function (form) {\n      let data = FormDataAsObj(form)\n\n      if (data) data.page = this.page\n      else data = { page: this.page }\n\n      data.type = this.type\n\n      if (Array.isArray(data.unused) && data.unused.length) {\n        data.unused = data.unused[0]\n      }\n\n      return data\n    }\n\n  },\n\n  created () {\n\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n\n  $width_sidebar: (default: 290px, small: 250px, xsmall: 200px);\n\n  .medialibrary {\n    display: block;\n    width: 100%;\n    min-height: 100%;\n    padding: 0;\n    position: relative;\n  }\n\n  .medialibrary__header {\n    background: $color__border--light;\n    border-bottom: 1px solid $color__border;\n    padding: 0 20px;\n\n    @include breakpoint(small-) {\n      .secondarynav {\n        padding-bottom: 10px;\n      }\n    }\n  }\n\n  .medialibrary__frame {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    display: flex;\n    flex-flow: column nowrap;\n  }\n\n  .medialibrary__inner {\n    position: relative;\n    width: 100%;\n    overflow: hidden;\n    flex-grow: 1;\n  }\n\n  .medialibrary__footer {\n    position: absolute;\n    right: 0;\n    z-index: 76;\n    bottom: 0;\n    width: map-get($width_sidebar, default); // fixed arbitrary width\n    color: $color__text--light;\n    padding: 10px;\n    overflow: hidden;\n    background: $color__border--light;\n    border-top: 1px solid $color__border;\n\n    > button {\n      display: block;\n      width: 100%;\n    }\n\n    @include breakpoint(small) {\n      width: map-get($width_sidebar, small);\n    }\n\n    @include breakpoint(xsmall) {\n      width: map-get($width_sidebar, xsmall);\n    }\n\n    @media screen and (max-width: 550px) {\n      width: 100%;\n    }\n  }\n\n  .medialibrary__sidebar {\n    position: absolute;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    width: map-get($width_sidebar, default); // fixed arbitrary width\n    padding: 0 0 80px 0; // 80px so we have some room to display the tags dropdown menu under the field\n    z-index: 75;\n    background: $color__border--light;\n    overflow: auto;\n\n    @include breakpoint(small) {\n      width: map-get($width_sidebar, small);\n    }\n\n    @include breakpoint(xsmall) {\n      width: map-get($width_sidebar, xsmall);\n    }\n\n    @media screen and (max-width: 550px) {\n      display: none;\n    }\n  }\n\n  .medialibrary__list {\n    margin: 0;\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    overflow: auto;\n    padding: 10px;\n  }\n\n  .medialibrary__list-items {\n    position: relative;\n    display: block;\n    width: 100%;\n    min-height: 100%;\n  }\n\n  /* with a sidebar visible */\n  .medialibrary__list {\n    right: map-get($width_sidebar, default);\n\n    @include breakpoint(small) {\n      right: map-get($width_sidebar, small);\n    }\n\n    @include breakpoint(xsmall) {\n      right: map-get($width_sidebar, xsmall);\n    }\n\n    @media screen and (max-width: 550px) {\n      right: 0;\n    }\n  }\n</style>\n\n<style lang=\"scss\">\n\n  .medialibrary__filter-item {\n    .vselect {\n      min-width: 200px;\n    }\n  }\n\n  .medialibrary__filter-item.checkbox {\n    margin-top: 8px;\n    margin-right: 45px !important;\n  }\n\n  .medialibrary__header {\n    @include breakpoint(small-) {\n      .filter__inner {\n        flex-direction: column;\n      }\n\n      .filter__search, .filter__navigation {\n        padding-top: 10px;\n        display: flex;\n      }\n\n      .filter__search input {\n        flex-grow: 1;\n      }\n    }\n  }\n</style>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}