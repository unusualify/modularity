{"version":3,"file":"VDataTableVirtual.mjs","names":["VTable","VDataTableHeaders","VDataTableRows","createHeaders","makeDataTableHeaderProps","makeDataTableItemProps","useDataTableItems","makeDataTableExpandProps","provideExpanded","createSort","makeDataTableSortProps","provideSort","useSortedItems","createGroupBy","makeDataTableGroupProps","provideGroupBy","useGroupedItems","makeDataTableSelectProps","provideSelection","makeDataTableVirtualProps","useVirtual","useOptions","makeFilterProps","useFilter","provideDefaults","computed","ref","toRef","convertToUnit","genericComponent","useRender","makeVDataTableProps","VDataTableVirtual","name","props","search","String","emits","value","click:row","event","setup","_ref","emit","slots","groupBy","sortBy","multiSort","mustSort","columns","showSelect","showExpand","items","filterKeys","map","c","key","filteredItems","sortByWithGroups","opened","extractRows","sortedItems","flatItems","allRows","containerRef","paddingTop","paddingBottom","startIndex","stopIndex","itemHeight","handleScroll","visibleItems","slice","page","itemsPerPage","hideNoData","noDataText","_createVNode","height","fixedHeader","top","wrapper","border","length","onClick:row","bottom"],"sources":["../../../src/labs/VDataTable/VDataTableVirtual.tsx"],"sourcesContent":["// Components\nimport { VTable } from '@/components/VTable'\nimport { VDataTableHeaders } from './VDataTableHeaders'\nimport { VDataTableRows } from './VDataTableRows'\n\n// Composables\nimport { createHeaders, makeDataTableHeaderProps } from './composables/headers'\nimport { makeDataTableItemProps, useDataTableItems } from './composables/items'\nimport { makeDataTableExpandProps, provideExpanded } from './composables/expand'\nimport { createSort, makeDataTableSortProps, provideSort, useSortedItems } from './composables/sort'\nimport { createGroupBy, makeDataTableGroupProps, provideGroupBy, useGroupedItems } from './composables/group'\nimport { makeDataTableSelectProps, provideSelection } from './composables/select'\nimport { makeDataTableVirtualProps, useVirtual } from './composables/virtual'\nimport { useOptions } from './composables/options'\nimport { makeFilterProps, useFilter } from '@/composables/filter'\nimport { provideDefaults } from '@/composables/defaults'\n\n// Utlities\nimport { computed, ref, toRef } from 'vue'\nimport { convertToUnit, genericComponent, useRender } from '@/util'\nimport { makeVDataTableProps } from './VDataTable'\n\n// Types\nimport type { DataTableItem } from './types'\nimport type { VDataTableRowsSlots } from './VDataTableRows'\n\nexport type VDataTableVirtualSlots = VDataTableRowsSlots & {\n  top: []\n  headers: []\n  bottom: []\n}\n\nexport const VDataTableVirtual = genericComponent<VDataTableVirtualSlots>()({\n  name: 'VDataTableVirtual',\n\n  props: {\n    search: String,\n\n    ...makeVDataTableProps(),\n    ...makeVDataTableProps(),\n    ...makeDataTableGroupProps(),\n    ...makeDataTableExpandProps(),\n    ...makeDataTableHeaderProps(),\n    ...makeDataTableItemProps(),\n    ...makeDataTableSelectProps(),\n    ...makeDataTableSortProps(),\n    ...makeDataTableVirtualProps(),\n    ...makeFilterProps(),\n  },\n\n  emits: {\n    'update:modelValue': (value: any[]) => true,\n    'update:sortBy': (value: any) => true,\n    'update:options': (value: any) => true,\n    'update:groupBy': (value: any) => true,\n    'update:expanded': (value: any) => true,\n    'click:row': (event: Event, value: { item: DataTableItem }) => true,\n  },\n\n  setup (props, { emit, slots }) {\n    const { groupBy } = createGroupBy(props)\n    const { sortBy, multiSort, mustSort } = createSort(props)\n\n    const { columns } = createHeaders(props, {\n      groupBy,\n      showSelect: toRef(props, 'showSelect'),\n      showExpand: toRef(props, 'showExpand'),\n    })\n    const { items } = useDataTableItems(props, columns)\n\n    const filterKeys = computed(() => columns.value.map(c => 'columns.' + c.key))\n    const search = toRef(props, 'search')\n    const { filteredItems } = useFilter<DataTableItem>(props, items, search, { filterKeys })\n\n    provideSort({ sortBy, multiSort, mustSort })\n    const { sortByWithGroups, opened, extractRows } = provideGroupBy({ groupBy, sortBy })\n\n    const { sortedItems } = useSortedItems(filteredItems, sortByWithGroups, columns)\n    const { flatItems } = useGroupedItems(sortedItems, groupBy, opened)\n\n    const allRows = computed(() => extractRows(flatItems.value))\n\n    provideSelection(props, allRows)\n    provideExpanded(props)\n\n    const {\n      containerRef,\n      paddingTop,\n      paddingBottom,\n      startIndex,\n      stopIndex,\n      itemHeight,\n      handleScroll,\n    } = useVirtual(props, flatItems)\n\n    const visibleItems = computed(() => {\n      return flatItems.value.slice(startIndex.value, stopIndex.value)\n    })\n\n    useOptions({\n      sortBy,\n      page: ref(1),\n      itemsPerPage: ref(-1),\n      groupBy,\n      search,\n    })\n\n    provideDefaults({\n      VDataTableRows: {\n        hideNoData: toRef(props, 'hideNoData'),\n        noDataText: toRef(props, 'noDataText'),\n      },\n    })\n\n    useRender(() => (\n      <VTable\n        class=\"v-data-table\"\n        style={{\n          '--v-table-row-height': convertToUnit(itemHeight.value),\n        }}\n        height={ props.height }\n        fixedHeader={ props.fixedHeader }\n      >\n        {{\n          top: slots.top,\n          wrapper: () => (\n            <div\n              ref={ containerRef }\n              onScroll={ handleScroll }\n              class=\"v-table__wrapper\"\n              style={{\n                height: convertToUnit(props.height),\n              }}\n            >\n              <table>\n                <thead>\n                  <VDataTableHeaders\n                    sticky={ props.fixedHeader }\n                    multiSort={ props.multiSort }\n                    v-slots={ slots }\n                  />\n                </thead>\n                <tbody>\n                  <tr style={{ height: convertToUnit(paddingTop.value), border: 0 }}>\n                    <td colspan={ columns.value.length } style={{ height: convertToUnit(paddingTop.value), border: 0 }}></td>\n                  </tr>\n\n                  <VDataTableRows\n                    items={ visibleItems.value }\n                    onClick:row={ (event, value) => emit('click:row', event, value) }\n                    v-slots={ slots }\n                  />\n\n                  <tr style={{ height: convertToUnit(paddingBottom.value), border: 0 }}>\n                    <td colspan={ columns.value.length } style={{ height: convertToUnit(paddingBottom.value), border: 0 }}></td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n          ),\n          bottom: slots.bottom,\n        }}\n      </VTable>\n    ))\n  },\n})\n\nexport type VDataTableVirtual = InstanceType<typeof VDataTableVirtual>\n"],"mappings":"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"}