import{g as getDefaultExportFromCjs}from"./awesome-phonenumber.C8KclVch.js";var dnd$1={exports:{}};(function(module){(function(global){var qq=function(e){return{hide:function(){return e.style.display="none",this},attach:function(t,n){return e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n),function(){qq(e).detach(t,n)}},detach:function(t,n){return e.removeEventListener?e.removeEventListener(t,n,!1):e.attachEvent&&e.detachEvent("on"+t,n),this},contains:function(t){return t?e===t?!0:e.contains?e.contains(t):!!(t.compareDocumentPosition(e)&8):!1},insertBefore:function(t){return t.parentNode.insertBefore(e,t),this},remove:function(){return e.parentNode.removeChild(e),this},css:function(t){if(e.style==null)throw new qq.Error("Can't apply style to node as it is not on the HTMLElement prototype chain!");return t.opacity!=null&&typeof e.style.opacity!="string"&&typeof e.filters<"u"&&(t.filter="alpha(opacity="+Math.round(100*t.opacity)+")"),qq.extend(e.style,t),this},hasClass:function(t,n){var r=new RegExp("(^| )"+t+"( |$)");return r.test(e.className)||!!(n&&r.test(e.parentNode.className))},addClass:function(t){return qq(e).hasClass(t)||(e.className+=" "+t),this},removeClass:function(t){var n=new RegExp("(^| )"+t+"( |$)");return e.className=e.className.replace(n," ").replace(/^\s+|\s+$/g,""),this},getByClass:function(t,n){var r,s=[];return n&&e.querySelector?e.querySelector("."+t):e.querySelectorAll?e.querySelectorAll("."+t):(r=e.getElementsByTagName("*"),qq.each(r,function(i,l){qq(l).hasClass(t)&&s.push(l)}),n?s[0]:s)},getFirstByClass:function(t){return qq(e).getByClass(t,!0)},children:function(){for(var t=[],n=e.firstChild;n;)n.nodeType===1&&t.push(n),n=n.nextSibling;return t},setText:function(t){return e.innerText=t,e.textContent=t,this},clearText:function(){return qq(e).setText("")},hasAttribute:function(t){var n;return e.hasAttribute?e.hasAttribute(t)?/^false$/i.exec(e.getAttribute(t))==null:!1:(n=e[t],n===void 0?!1:/^false$/i.exec(n)==null)}}};(function(){qq.canvasToBlob=function(e,t,n){return qq.dataUriToBlob(e.toDataURL(t,n))},qq.dataUriToBlob=function(e){var t,n,r=function(l,a){var c=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,d=c&&new c;return d?(d.append(l),d.getBlob(a)):new Blob([l],{type:a})},s,i;return e.split(",")[0].indexOf("base64")>=0?n=atob(e.split(",")[1]):n=decodeURI(e.split(",")[1]),i=e.split(",")[0].split(":")[1].split(";")[0],t=new ArrayBuffer(n.length),s=new Uint8Array(t),qq.each(n,function(l,a){s[l]=a.charCodeAt(0)}),r(t,i)},qq.log=function(e,t){window.console&&(!t||t==="info"?window.console.log(e):window.console[t]?window.console[t](e):window.console.log("<"+t+"> "+e))},qq.isObject=function(e){return e&&!e.nodeType&&Object.prototype.toString.call(e)==="[object Object]"},qq.isFunction=function(e){return typeof e=="function"},qq.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"||e&&window.ArrayBuffer&&e.buffer&&e.buffer.constructor===ArrayBuffer},qq.isItemList=function(e){return Object.prototype.toString.call(e)==="[object DataTransferItemList]"},qq.isNodeList=function(e){return Object.prototype.toString.call(e)==="[object NodeList]"||e.item&&e.namedItem},qq.isString=function(e){return Object.prototype.toString.call(e)==="[object String]"},qq.trimStr=function(e){return String.prototype.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},qq.format=function(e){var t=Array.prototype.slice.call(arguments,1),n=e,r=n.indexOf("{}");return qq.each(t,function(s,i){var l=n.substring(0,r),a=n.substring(r+2);if(n=l+i+a,r=n.indexOf("{}",r+i.length),r<0)return!1}),n},qq.isFile=function(e){return window.File&&Object.prototype.toString.call(e)==="[object File]"},qq.isFileList=function(e){return window.FileList&&Object.prototype.toString.call(e)==="[object FileList]"},qq.isFileOrInput=function(e){return qq.isFile(e)||qq.isInput(e)},qq.isInput=function(e,t){var n=function(r){var s=r.toLowerCase();return t?s!=="file":s==="file"};return!!(window.HTMLInputElement&&Object.prototype.toString.call(e)==="[object HTMLInputElement]"&&e.type&&n(e.type)||e.tagName&&e.tagName.toLowerCase()==="input"&&e.type&&n(e.type))},qq.isBlob=function(e){if(window.Blob&&Object.prototype.toString.call(e)==="[object Blob]")return!0},qq.isXhrUploadSupported=function(){var e=document.createElement("input");return e.type="file",e.multiple!==void 0&&typeof File<"u"&&typeof FormData<"u"&&typeof qq.createXhrInstance().upload<"u"},qq.createXhrInstance=function(){if(window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch{return qq.log("Neither XHR or ActiveX are supported!","error"),null}},qq.isFolderDropSupported=function(e){return e.items&&e.items.length>0&&e.items[0].webkitGetAsEntry},qq.isFileChunkingSupported=function(){return!qq.androidStock()&&qq.isXhrUploadSupported()&&(File.prototype.slice!==void 0||File.prototype.webkitSlice!==void 0||File.prototype.mozSlice!==void 0)},qq.sliceBlob=function(e,t,n){var r=e.slice||e.mozSlice||e.webkitSlice;return r.call(e,t,n)},qq.arrayBufferToHex=function(e){var t="",n=new Uint8Array(e);return qq.each(n,function(r,s){var i=s.toString(16);i.length<2&&(i="0"+i),t+=i}),t},qq.readBlobToHex=function(e,t,n){var r=qq.sliceBlob(e,t,t+n),s=new FileReader,i=new qq.Promise;return s.onload=function(){i.success(qq.arrayBufferToHex(s.result))},s.onerror=i.failure,s.readAsArrayBuffer(r),i},qq.extend=function(e,t,n){return qq.each(t,function(r,s){n&&qq.isObject(s)?(e[r]===void 0&&(e[r]={}),qq.extend(e[r],s,!0)):e[r]=s}),e},qq.override=function(e,t){var n={},r=t(n);return qq.each(r,function(s,i){e[s]!==void 0&&(n[s]=e[s]),e[s]=i}),e},qq.indexOf=function(e,t,n){if(e.indexOf)return e.indexOf(t,n);n=n||0;var r=e.length;for(n<0&&(n+=r);n<r;n+=1)if(e.hasOwnProperty(n)&&e[n]===t)return n;return-1},qq.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)})},qq.ie=function(){return navigator.userAgent.indexOf("MSIE")!==-1||navigator.userAgent.indexOf("Trident")!==-1},qq.ie7=function(){return navigator.userAgent.indexOf("MSIE 7")!==-1},qq.ie8=function(){return navigator.userAgent.indexOf("MSIE 8")!==-1},qq.ie10=function(){return navigator.userAgent.indexOf("MSIE 10")!==-1},qq.ie11=function(){return qq.ie()&&navigator.userAgent.indexOf("rv:11")!==-1},qq.edge=function(){return navigator.userAgent.indexOf("Edge")>=0},qq.safari=function(){return navigator.vendor!==void 0&&navigator.vendor.indexOf("Apple")!==-1},qq.chrome=function(){return navigator.vendor!==void 0&&navigator.vendor.indexOf("Google")!==-1},qq.opera=function(){return navigator.vendor!==void 0&&navigator.vendor.indexOf("Opera")!==-1},qq.firefox=function(){return!qq.edge()&&!qq.ie11()&&navigator.userAgent.indexOf("Mozilla")!==-1&&navigator.vendor!==void 0&&navigator.vendor===""},qq.windows=function(){return navigator.platform==="Win32"},qq.android=function(){return navigator.userAgent.toLowerCase().indexOf("android")!==-1},qq.androidStock=function(){return qq.android()&&navigator.userAgent.toLowerCase().indexOf("chrome")<0},qq.ios6=function(){return qq.ios()&&navigator.userAgent.indexOf(" OS 6_")!==-1},qq.ios7=function(){return qq.ios()&&navigator.userAgent.indexOf(" OS 7_")!==-1},qq.ios8=function(){return qq.ios()&&navigator.userAgent.indexOf(" OS 8_")!==-1},qq.ios800=function(){return qq.ios()&&navigator.userAgent.indexOf(" OS 8_0 ")!==-1},qq.ios=function(){return navigator.userAgent.indexOf("iPad")!==-1||navigator.userAgent.indexOf("iPod")!==-1||navigator.userAgent.indexOf("iPhone")!==-1},qq.iosChrome=function(){return qq.ios()&&navigator.userAgent.indexOf("CriOS")!==-1},qq.iosSafari=function(){return qq.ios()&&!qq.iosChrome()&&navigator.userAgent.indexOf("Safari")!==-1},qq.iosSafariWebView=function(){return qq.ios()&&!qq.iosChrome()&&!qq.iosSafari()},qq.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},qq.toElement=function(){var e=document.createElement("div");return function(t){e.innerHTML=t;var n=e.firstChild;return e.removeChild(n),n}}(),qq.each=function(e,t){var n,r;if(e){if(window.Storage&&e.constructor===window.Storage)for(n=0;n<e.length&&(r=t(e.key(n),e.getItem(e.key(n))),r!==!1);n++);else if(qq.isArray(e)||qq.isItemList(e)||qq.isNodeList(e))for(n=0;n<e.length&&(r=t(n,e[n]),r!==!1);n++);else if(qq.isString(e))for(n=0;n<e.length&&(r=t(n,e.charAt(n)),r!==!1);n++);else for(n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&(r=t(n,e[n]),r===!1))break}},qq.bind=function(e,t){if(qq.isFunction(e)){var n=Array.prototype.slice.call(arguments,2);return function(){var r=qq.extend([],n);return arguments.length&&(r=r.concat(Array.prototype.slice.call(arguments))),e.apply(t,r)}}throw new Error("first parameter must be a function!")},qq.obj2url=function(e,t,n){var r=[],s="&",i=function(l,a){var c=t?/\[\]$/.test(t)?t:t+"["+a+"]":a;c!=="undefined"&&a!=="undefined"&&r.push(typeof l=="object"?qq.obj2url(l,c,!0):Object.prototype.toString.call(l)==="[object Function]"?encodeURIComponent(c)+"="+encodeURIComponent(l()):encodeURIComponent(c)+"="+encodeURIComponent(l))};return!n&&t?(s=/\?/.test(t)?/\?$/.test(t)?"":"&":"?",r.push(t),r.push(qq.obj2url(e))):Object.prototype.toString.call(e)==="[object Array]"&&typeof e<"u"?qq.each(e,function(l,a){i(a,l)}):typeof e<"u"&&e!==null&&typeof e=="object"?qq.each(e,function(l,a){i(a,l)}):r.push(encodeURIComponent(t)+"="+encodeURIComponent(e)),t?r.join(s):r.join(s).replace(/^&/,"").replace(/%20/g,"+")},qq.obj2FormData=function(e,t,n){return t||(t=new FormData),qq.each(e,function(r,s){r=n?n+"["+r+"]":r,qq.isObject(s)?qq.obj2FormData(s,t,r):qq.isFunction(s)?t.append(r,s()):t.append(r,s)}),t},qq.obj2Inputs=function(e,t){var n;return t||(t=document.createElement("form")),qq.obj2FormData(e,{append:function(r,s){n=document.createElement("input"),n.setAttribute("name",r),n.setAttribute("value",s),t.appendChild(n)}}),t},qq.parseJson=function(json){return window.JSON&&qq.isFunction(JSON.parse)?JSON.parse(json):eval("("+json+")")},qq.getExtension=function(e){var t=e.lastIndexOf(".")+1;if(t>0)return e.substr(t,e.length-t)},qq.getFilename=function(e){return qq.isInput(e)?e.value.replace(/.*(\/|\\)/,""):qq.isFile(e)&&e.fileName!==null&&e.fileName!==void 0?e.fileName:e.name},qq.DisposeSupport=function(){var e=[];return{dispose:function(){var t;do t=e.shift(),t&&t();while(t)},attach:function(){var t=arguments;this.addDisposer(qq(t[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(t){e.push(t)}}}})(),function(){module.exports?module.exports=qq:global.qq=qq}(),qq.version="5.16.2",qq.supportedFeatures=function(){var e,t,n,r,s,i,l,a,c,d,p,S,q,o,u;function h(){var b=!0,x;try{x=document.createElement("input"),x.type="file",qq(x).hide(),x.disabled&&(b=!1)}catch{b=!1}return b}function _(){return(qq.chrome()||qq.opera())&&navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/)!==void 0}function m(){if(window.XMLHttpRequest){var b=qq.createXhrInstance();return b.withCredentials!==void 0}return!1}function v(){return window.XDomainRequest!==void 0}function f(){return m()?!0:v()}function g(){return document.createElement("input").webkitdirectory!==void 0}function y(){try{return!!window.localStorage&&qq.isFunction(window.localStorage.setItem)}catch{return!1}}function C(){var b=document.createElement("span");return("draggable"in b||"ondragstart"in b&&"ondrop"in b)&&!qq.android()&&!qq.ios()}return e=h(),r=e&&qq.isXhrUploadSupported(),t=r&&!qq.androidStock(),n=r&&C(),s=n&&function(){var b=document.createElement("input");return b.type="file","webkitdirectory"in(b||document.querySelectorAll("input[type=file]")[0])}(),i=r&&qq.isFileChunkingSupported(),l=r&&i&&y(),a=r&&_(),c=e&&(window.postMessage!==void 0||r),p=m(),d=v(),S=f(),q=g(),o=r&&window.FileReader!==void 0,u=function(){return r?!qq.androidStock()&&!qq.iosChrome():!1}(),{ajaxUploading:r,blobUploading:t,canDetermineSize:r,chunking:i,deleteFileCors:S,deleteFileCorsXdr:d,deleteFileCorsXhr:p,dialogElement:!!window.HTMLDialogElement,fileDrop:n,folderDrop:s,folderSelection:q,imagePreviews:o,imageValidation:o,itemSizeValidation:r,pause:i,progressBar:u,resume:l,scaling:o&&t,tiffPreviews:qq.safari(),unlimitedScaledImageSize:!qq.ios(),uploading:e,uploadCors:c,uploadCustomHeaders:r,uploadNonMultipart:r,uploadViaPaste:a}}(),qq.isGenericPromise=function(e){return!!(e&&e.then&&qq.isFunction(e.then))},qq.Promise=function(){var e,t,n=[],r=[],s=[],i=0;qq.extend(this,{then:function(l,a){return i===0?(l&&n.push(l),a&&r.push(a)):i===-1?a&&a.apply(null,t):l&&l.apply(null,e),this},done:function(l){return i===0?s.push(l):l.apply(null,t===void 0?e:t),this},success:function(){return i=1,e=arguments,n.length&&qq.each(n,function(l,a){a.apply(null,e)}),s.length&&qq.each(s,function(l,a){a.apply(null,e)}),this},failure:function(){return i=-1,t=arguments,r.length&&qq.each(r,function(l,a){a.apply(null,t)}),s.length&&qq.each(s,function(l,a){a.apply(null,t)}),this}})},qq.DragAndDrop=function(e){var t,n="qq-hidezones",r="qq-hide-dropzone",s=[],i=[],l=new qq.DisposeSupport;t={dropZoneElements:[],allowMultipleItems:!0,classes:{dropActive:null},callbacks:new qq.DragAndDrop.callbacks},qq.extend(t,e,!0);function a(_,m){var v=Array.prototype.slice.call(_);t.callbacks.dropLog("Grabbed "+_.length+" dropped files."),m.dropDisabled(!1),t.callbacks.processingDroppedFilesComplete(v,m.getElement())}function c(_){var m=new qq.Promise;return _.isFile?_.file(function(v){v.qqPath=d(_),i.push(v),m.success()},function(v){t.callbacks.dropLog("Problem parsing '"+_.fullPath+"'.  FileError code "+v.code+".","error"),m.failure()}):_.isDirectory&&p(_).then(function(f){var g=f.length;qq.each(f,function(y,C){c(C).done(function(){g-=1,g===0&&m.success()})}),f.length||m.success()},function(f){t.callbacks.dropLog("Problem parsing '"+_.fullPath+"'.  FileError code "+f.code+".","error"),m.failure()}),m}function d(_){var m=_.name,v=_.fullPath,f=v.lastIndexOf(m);return v=v.substr(0,f),v.charAt(0)==="/"&&(v=v.substr(1)),v}function p(_,m,v,f){var g=f||new qq.Promise,y=m||_.createReader();return y.readEntries(function(b){var x=v?v.concat(b):b;b.length?setTimeout(function(){p(_,y,x,g)},0):g.success(x)},g.failure),g}function S(_,m){var v=[],f=new qq.Promise;return t.callbacks.processingDroppedFiles(),m.dropDisabled(!0),_.files.length>1&&!t.allowMultipleItems?(t.callbacks.processingDroppedFilesComplete([]),t.callbacks.dropError("tooManyFilesError",""),m.dropDisabled(!1),f.failure()):(i=[],qq.isFolderDropSupported(_)?qq.each(_.items,function(g,y){var C=y.webkitGetAsEntry();C&&(C.isFile?i.push(y.getAsFile()):v.push(c(C).done(function(){v.pop(),v.length===0&&f.success()})))}):i=_.files,v.length===0&&f.success()),f}function q(_){var m=new qq.UploadDropZone({HIDE_ZONES_EVENT_NAME:n,element:_,onEnter:function(v){qq(_).addClass(t.classes.dropActive),v.stopPropagation()},onLeaveNotDescendants:function(v){qq(_).removeClass(t.classes.dropActive)},onDrop:function(v){S(v.dataTransfer,m).then(function(){a(i,m)},function(){t.callbacks.dropLog("Drop event DataTransfer parsing failed.  No files will be uploaded.","error")})}});return l.addDisposer(function(){m.dispose()}),qq(_).hasAttribute(r)&&qq(_).hide(),s.push(m),m}function o(_){var m;return qq.each(_.dataTransfer.types,function(v,f){if(f==="Files")return m=!0,!1}),m}function u(_){return qq.safari()?_.x<0||_.y<0:_.x===0&&_.y===0}function h(){var _=t.dropZoneElements,m=function(){setTimeout(function(){qq.each(_,function(v,f){qq(f).hasAttribute(r)&&qq(f).hide(),qq(f).removeClass(t.classes.dropActive)})},10)};qq.each(_,function(v,f){var g=q(f);_.length&&qq.supportedFeatures.fileDrop&&l.attach(document,"dragenter",function(y){!g.dropDisabled()&&o(y)&&qq.each(_,function(C,b){b instanceof HTMLElement&&qq(b).hasAttribute(r)&&qq(b).css({display:"block"})})})}),l.attach(document,"dragleave",function(v){u(v)&&m()}),l.attach(qq(document).children()[0],"mouseenter",function(v){m()}),l.attach(document,"drop",function(v){o(v)&&(v.preventDefault(),m())}),l.attach(document,n,m)}h(),qq.extend(this,{setupExtraDropzone:function(_){t.dropZoneElements.push(_),q(_)},removeDropzone:function(_){var m,v=t.dropZoneElements;for(m in v)if(v[m]===_)return v.splice(m,1)},dispose:function(){l.dispose(),qq.each(s,function(_,m){m.dispose()})}}),this._testing={},this._testing.extractDirectoryPath=d},qq.DragAndDrop.callbacks=function(){return{processingDroppedFiles:function(){},processingDroppedFilesComplete:function(e,t){},dropError:function(e,t){qq.log("Drag & drop error code '"+e+" with these specifics: '"+t+"'","error")},dropLog:function(e,t){qq.log(e,t)}}},qq.UploadDropZone=function(e){var t=new qq.DisposeSupport,n,r,s,i;n={element:null,onEnter:function(q){},onLeave:function(q){},onLeaveNotDescendants:function(q){},onDrop:function(q){}},qq.extend(n,e),r=n.element;function l(){return qq.safari()||qq.firefox()&&qq.windows()}function a(q){i||(l?t.attach(document,"dragover",function(o){o.preventDefault()}):t.attach(document,"dragover",function(o){o.dataTransfer&&(o.dataTransfer.dropEffect="none",o.preventDefault())}),i=!0)}function c(q){if(!qq.supportedFeatures.fileDrop)return!1;var o,u=q.dataTransfer,h=qq.safari();return o=qq.ie()&&qq.supportedFeatures.fileDrop?!0:u.effectAllowed!=="none",u&&o&&(u.files&&u.files.length||!h&&u.types.contains&&u.types.contains("Files")||u.types.includes&&u.types.includes("Files"))}function d(q){return q!==void 0&&(s=q),s}function p(){var q;function o(){q=document.createEvent("Event"),q.initEvent(n.HIDE_ZONES_EVENT_NAME,!0,!0)}if(window.CustomEvent)try{q=new CustomEvent(n.HIDE_ZONES_EVENT_NAME)}catch{o()}else o();document.dispatchEvent(q)}function S(){t.attach(r,"dragover",function(q){if(c(q)){var o=qq.ie()&&qq.supportedFeatures.fileDrop?null:q.dataTransfer.effectAllowed;o==="move"||o==="linkMove"?q.dataTransfer.dropEffect="move":q.dataTransfer.dropEffect="copy",q.stopPropagation(),q.preventDefault()}}),t.attach(r,"dragenter",function(q){if(!d()){if(!c(q))return;n.onEnter(q)}}),t.attach(r,"dragleave",function(q){if(c(q)){n.onLeave(q);var o=document.elementFromPoint(q.clientX,q.clientY);qq(this).contains(o)||n.onLeaveNotDescendants(q)}}),t.attach(r,"drop",function(q){if(!d()){if(!c(q))return;q.preventDefault(),q.stopPropagation(),n.onDrop(q),p()}})}a(),S(),qq.extend(this,{dropDisabled:function(q){return d(q)},dispose:function(){t.dispose()},getElement:function(){return r}}),this._testing={},this._testing.isValidFileDrag=c}})(window)})(dnd$1);var dndExports=dnd$1.exports,dnd=dndExports;const qq=getDefaultExportFromCjs(dnd);var s3_fineUploader_core={exports:{}};(function(module){(function(global){var qq=function(e){return{hide:function(){return e.style.display="none",this},attach:function(t,n){return e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n),function(){qq(e).detach(t,n)}},detach:function(t,n){return e.removeEventListener?e.removeEventListener(t,n,!1):e.attachEvent&&e.detachEvent("on"+t,n),this},contains:function(t){return t?e===t?!0:e.contains?e.contains(t):!!(t.compareDocumentPosition(e)&8):!1},insertBefore:function(t){return t.parentNode.insertBefore(e,t),this},remove:function(){return e.parentNode.removeChild(e),this},css:function(t){if(e.style==null)throw new qq.Error("Can't apply style to node as it is not on the HTMLElement prototype chain!");return t.opacity!=null&&typeof e.style.opacity!="string"&&typeof e.filters<"u"&&(t.filter="alpha(opacity="+Math.round(100*t.opacity)+")"),qq.extend(e.style,t),this},hasClass:function(t,n){var r=new RegExp("(^| )"+t+"( |$)");return r.test(e.className)||!!(n&&r.test(e.parentNode.className))},addClass:function(t){return qq(e).hasClass(t)||(e.className+=" "+t),this},removeClass:function(t){var n=new RegExp("(^| )"+t+"( |$)");return e.className=e.className.replace(n," ").replace(/^\s+|\s+$/g,""),this},getByClass:function(t,n){var r,s=[];return n&&e.querySelector?e.querySelector("."+t):e.querySelectorAll?e.querySelectorAll("."+t):(r=e.getElementsByTagName("*"),qq.each(r,function(i,l){qq(l).hasClass(t)&&s.push(l)}),n?s[0]:s)},getFirstByClass:function(t){return qq(e).getByClass(t,!0)},children:function(){for(var t=[],n=e.firstChild;n;)n.nodeType===1&&t.push(n),n=n.nextSibling;return t},setText:function(t){return e.innerText=t,e.textContent=t,this},clearText:function(){return qq(e).setText("")},hasAttribute:function(t){var n;return e.hasAttribute?e.hasAttribute(t)?/^false$/i.exec(e.getAttribute(t))==null:!1:(n=e[t],n===void 0?!1:/^false$/i.exec(n)==null)}}};(function(){qq.canvasToBlob=function(e,t,n){return qq.dataUriToBlob(e.toDataURL(t,n))},qq.dataUriToBlob=function(e){var t,n,r=function(l,a){var c=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,d=c&&new c;return d?(d.append(l),d.getBlob(a)):new Blob([l],{type:a})},s,i;return e.split(",")[0].indexOf("base64")>=0?n=atob(e.split(",")[1]):n=decodeURI(e.split(",")[1]),i=e.split(",")[0].split(":")[1].split(";")[0],t=new ArrayBuffer(n.length),s=new Uint8Array(t),qq.each(n,function(l,a){s[l]=a.charCodeAt(0)}),r(t,i)},qq.log=function(e,t){window.console&&(!t||t==="info"?window.console.log(e):window.console[t]?window.console[t](e):window.console.log("<"+t+"> "+e))},qq.isObject=function(e){return e&&!e.nodeType&&Object.prototype.toString.call(e)==="[object Object]"},qq.isFunction=function(e){return typeof e=="function"},qq.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"||e&&window.ArrayBuffer&&e.buffer&&e.buffer.constructor===ArrayBuffer},qq.isItemList=function(e){return Object.prototype.toString.call(e)==="[object DataTransferItemList]"},qq.isNodeList=function(e){return Object.prototype.toString.call(e)==="[object NodeList]"||e.item&&e.namedItem},qq.isString=function(e){return Object.prototype.toString.call(e)==="[object String]"},qq.trimStr=function(e){return String.prototype.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},qq.format=function(e){var t=Array.prototype.slice.call(arguments,1),n=e,r=n.indexOf("{}");return qq.each(t,function(s,i){var l=n.substring(0,r),a=n.substring(r+2);if(n=l+i+a,r=n.indexOf("{}",r+i.length),r<0)return!1}),n},qq.isFile=function(e){return window.File&&Object.prototype.toString.call(e)==="[object File]"},qq.isFileList=function(e){return window.FileList&&Object.prototype.toString.call(e)==="[object FileList]"},qq.isFileOrInput=function(e){return qq.isFile(e)||qq.isInput(e)},qq.isInput=function(e,t){var n=function(r){var s=r.toLowerCase();return t?s!=="file":s==="file"};return!!(window.HTMLInputElement&&Object.prototype.toString.call(e)==="[object HTMLInputElement]"&&e.type&&n(e.type)||e.tagName&&e.tagName.toLowerCase()==="input"&&e.type&&n(e.type))},qq.isBlob=function(e){if(window.Blob&&Object.prototype.toString.call(e)==="[object Blob]")return!0},qq.isXhrUploadSupported=function(){var e=document.createElement("input");return e.type="file",e.multiple!==void 0&&typeof File<"u"&&typeof FormData<"u"&&typeof qq.createXhrInstance().upload<"u"},qq.createXhrInstance=function(){if(window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch{return qq.log("Neither XHR or ActiveX are supported!","error"),null}},qq.isFolderDropSupported=function(e){return e.items&&e.items.length>0&&e.items[0].webkitGetAsEntry},qq.isFileChunkingSupported=function(){return!qq.androidStock()&&qq.isXhrUploadSupported()&&(File.prototype.slice!==void 0||File.prototype.webkitSlice!==void 0||File.prototype.mozSlice!==void 0)},qq.sliceBlob=function(e,t,n){var r=e.slice||e.mozSlice||e.webkitSlice;return r.call(e,t,n)},qq.arrayBufferToHex=function(e){var t="",n=new Uint8Array(e);return qq.each(n,function(r,s){var i=s.toString(16);i.length<2&&(i="0"+i),t+=i}),t},qq.readBlobToHex=function(e,t,n){var r=qq.sliceBlob(e,t,t+n),s=new FileReader,i=new qq.Promise;return s.onload=function(){i.success(qq.arrayBufferToHex(s.result))},s.onerror=i.failure,s.readAsArrayBuffer(r),i},qq.extend=function(e,t,n){return qq.each(t,function(r,s){n&&qq.isObject(s)?(e[r]===void 0&&(e[r]={}),qq.extend(e[r],s,!0)):e[r]=s}),e},qq.override=function(e,t){var n={},r=t(n);return qq.each(r,function(s,i){e[s]!==void 0&&(n[s]=e[s]),e[s]=i}),e},qq.indexOf=function(e,t,n){if(e.indexOf)return e.indexOf(t,n);n=n||0;var r=e.length;for(n<0&&(n+=r);n<r;n+=1)if(e.hasOwnProperty(n)&&e[n]===t)return n;return-1},qq.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)})},qq.ie=function(){return navigator.userAgent.indexOf("MSIE")!==-1||navigator.userAgent.indexOf("Trident")!==-1},qq.ie7=function(){return navigator.userAgent.indexOf("MSIE 7")!==-1},qq.ie8=function(){return navigator.userAgent.indexOf("MSIE 8")!==-1},qq.ie10=function(){return navigator.userAgent.indexOf("MSIE 10")!==-1},qq.ie11=function(){return qq.ie()&&navigator.userAgent.indexOf("rv:11")!==-1},qq.edge=function(){return navigator.userAgent.indexOf("Edge")>=0},qq.safari=function(){return navigator.vendor!==void 0&&navigator.vendor.indexOf("Apple")!==-1},qq.chrome=function(){return navigator.vendor!==void 0&&navigator.vendor.indexOf("Google")!==-1},qq.opera=function(){return navigator.vendor!==void 0&&navigator.vendor.indexOf("Opera")!==-1},qq.firefox=function(){return!qq.edge()&&!qq.ie11()&&navigator.userAgent.indexOf("Mozilla")!==-1&&navigator.vendor!==void 0&&navigator.vendor===""},qq.windows=function(){return navigator.platform==="Win32"},qq.android=function(){return navigator.userAgent.toLowerCase().indexOf("android")!==-1},qq.androidStock=function(){return qq.android()&&navigator.userAgent.toLowerCase().indexOf("chrome")<0},qq.ios6=function(){return qq.ios()&&navigator.userAgent.indexOf(" OS 6_")!==-1},qq.ios7=function(){return qq.ios()&&navigator.userAgent.indexOf(" OS 7_")!==-1},qq.ios8=function(){return qq.ios()&&navigator.userAgent.indexOf(" OS 8_")!==-1},qq.ios800=function(){return qq.ios()&&navigator.userAgent.indexOf(" OS 8_0 ")!==-1},qq.ios=function(){return navigator.userAgent.indexOf("iPad")!==-1||navigator.userAgent.indexOf("iPod")!==-1||navigator.userAgent.indexOf("iPhone")!==-1},qq.iosChrome=function(){return qq.ios()&&navigator.userAgent.indexOf("CriOS")!==-1},qq.iosSafari=function(){return qq.ios()&&!qq.iosChrome()&&navigator.userAgent.indexOf("Safari")!==-1},qq.iosSafariWebView=function(){return qq.ios()&&!qq.iosChrome()&&!qq.iosSafari()},qq.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},qq.toElement=function(){var e=document.createElement("div");return function(t){e.innerHTML=t;var n=e.firstChild;return e.removeChild(n),n}}(),qq.each=function(e,t){var n,r;if(e){if(window.Storage&&e.constructor===window.Storage)for(n=0;n<e.length&&(r=t(e.key(n),e.getItem(e.key(n))),r!==!1);n++);else if(qq.isArray(e)||qq.isItemList(e)||qq.isNodeList(e))for(n=0;n<e.length&&(r=t(n,e[n]),r!==!1);n++);else if(qq.isString(e))for(n=0;n<e.length&&(r=t(n,e.charAt(n)),r!==!1);n++);else for(n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&(r=t(n,e[n]),r===!1))break}},qq.bind=function(e,t){if(qq.isFunction(e)){var n=Array.prototype.slice.call(arguments,2);return function(){var r=qq.extend([],n);return arguments.length&&(r=r.concat(Array.prototype.slice.call(arguments))),e.apply(t,r)}}throw new Error("first parameter must be a function!")},qq.obj2url=function(e,t,n){var r=[],s="&",i=function(l,a){var c=t?/\[\]$/.test(t)?t:t+"["+a+"]":a;c!=="undefined"&&a!=="undefined"&&r.push(typeof l=="object"?qq.obj2url(l,c,!0):Object.prototype.toString.call(l)==="[object Function]"?encodeURIComponent(c)+"="+encodeURIComponent(l()):encodeURIComponent(c)+"="+encodeURIComponent(l))};return!n&&t?(s=/\?/.test(t)?/\?$/.test(t)?"":"&":"?",r.push(t),r.push(qq.obj2url(e))):Object.prototype.toString.call(e)==="[object Array]"&&typeof e<"u"?qq.each(e,function(l,a){i(a,l)}):typeof e<"u"&&e!==null&&typeof e=="object"?qq.each(e,function(l,a){i(a,l)}):r.push(encodeURIComponent(t)+"="+encodeURIComponent(e)),t?r.join(s):r.join(s).replace(/^&/,"").replace(/%20/g,"+")},qq.obj2FormData=function(e,t,n){return t||(t=new FormData),qq.each(e,function(r,s){r=n?n+"["+r+"]":r,qq.isObject(s)?qq.obj2FormData(s,t,r):qq.isFunction(s)?t.append(r,s()):t.append(r,s)}),t},qq.obj2Inputs=function(e,t){var n;return t||(t=document.createElement("form")),qq.obj2FormData(e,{append:function(r,s){n=document.createElement("input"),n.setAttribute("name",r),n.setAttribute("value",s),t.appendChild(n)}}),t},qq.parseJson=function(json){return window.JSON&&qq.isFunction(JSON.parse)?JSON.parse(json):eval("("+json+")")},qq.getExtension=function(e){var t=e.lastIndexOf(".")+1;if(t>0)return e.substr(t,e.length-t)},qq.getFilename=function(e){return qq.isInput(e)?e.value.replace(/.*(\/|\\)/,""):qq.isFile(e)&&e.fileName!==null&&e.fileName!==void 0?e.fileName:e.name},qq.DisposeSupport=function(){var e=[];return{dispose:function(){var t;do t=e.shift(),t&&t();while(t)},attach:function(){var t=arguments;this.addDisposer(qq(t[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(t){e.push(t)}}}})(),function(){module.exports?module.exports=qq:global.qq=qq}(),function(){qq.Error=function(e){this.message="[Fine Uploader "+qq.version+"] "+e},qq.Error.prototype=new Error}(),qq.version="5.16.2",qq.supportedFeatures=function(){var e,t,n,r,s,i,l,a,c,d,p,S,q,o,u;function h(){var b=!0,x;try{x=document.createElement("input"),x.type="file",qq(x).hide(),x.disabled&&(b=!1)}catch{b=!1}return b}function _(){return(qq.chrome()||qq.opera())&&navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/)!==void 0}function m(){if(window.XMLHttpRequest){var b=qq.createXhrInstance();return b.withCredentials!==void 0}return!1}function v(){return window.XDomainRequest!==void 0}function f(){return m()?!0:v()}function g(){return document.createElement("input").webkitdirectory!==void 0}function y(){try{return!!window.localStorage&&qq.isFunction(window.localStorage.setItem)}catch{return!1}}function C(){var b=document.createElement("span");return("draggable"in b||"ondragstart"in b&&"ondrop"in b)&&!qq.android()&&!qq.ios()}return e=h(),r=e&&qq.isXhrUploadSupported(),t=r&&!qq.androidStock(),n=r&&C(),s=n&&function(){var b=document.createElement("input");return b.type="file","webkitdirectory"in(b||document.querySelectorAll("input[type=file]")[0])}(),i=r&&qq.isFileChunkingSupported(),l=r&&i&&y(),a=r&&_(),c=e&&(window.postMessage!==void 0||r),p=m(),d=v(),S=f(),q=g(),o=r&&window.FileReader!==void 0,u=function(){return r?!qq.androidStock()&&!qq.iosChrome():!1}(),{ajaxUploading:r,blobUploading:t,canDetermineSize:r,chunking:i,deleteFileCors:S,deleteFileCorsXdr:d,deleteFileCorsXhr:p,dialogElement:!!window.HTMLDialogElement,fileDrop:n,folderDrop:s,folderSelection:q,imagePreviews:o,imageValidation:o,itemSizeValidation:r,pause:i,progressBar:u,resume:l,scaling:o&&t,tiffPreviews:qq.safari(),unlimitedScaledImageSize:!qq.ios(),uploading:e,uploadCors:c,uploadCustomHeaders:r,uploadNonMultipart:r,uploadViaPaste:a}}(),qq.isGenericPromise=function(e){return!!(e&&e.then&&qq.isFunction(e.then))},qq.Promise=function(){var e,t,n=[],r=[],s=[],i=0;qq.extend(this,{then:function(l,a){return i===0?(l&&n.push(l),a&&r.push(a)):i===-1?a&&a.apply(null,t):l&&l.apply(null,e),this},done:function(l){return i===0?s.push(l):l.apply(null,t===void 0?e:t),this},success:function(){return i=1,e=arguments,n.length&&qq.each(n,function(l,a){a.apply(null,e)}),s.length&&qq.each(s,function(l,a){a.apply(null,e)}),this},failure:function(){return i=-1,t=arguments,r.length&&qq.each(r,function(l,a){a.apply(null,t)}),s.length&&qq.each(s,function(l,a){a.apply(null,t)}),this}})},qq.BlobProxy=function(e,t){qq.extend(this,{referenceBlob:e,create:function(){return t(e)}})},qq.UploadButton=function(e){var t=this,n=new qq.DisposeSupport,r={acceptFiles:null,element:null,focusClass:"qq-upload-button-focus",folders:!1,hoverClass:"qq-upload-button-hover",ios8BrowserCrashWorkaround:!1,multiple:!1,name:"qqfile",onChange:function(a){},title:null},s,i;qq.extend(r,e),i=qq.getUniqueId();function l(){var a=document.createElement("input");return a.setAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME,i),a.setAttribute("title",r.title),t.setMultiple(r.multiple,a),r.folders&&qq.supportedFeatures.folderSelection&&a.setAttribute("webkitdirectory",""),r.acceptFiles&&a.setAttribute("accept",r.acceptFiles),a.setAttribute("type","file"),a.setAttribute("name",r.name),qq(a).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:qq.ie()&&!qq.ie8()?"3500px":"118px",margin:0,padding:0,cursor:"pointer",opacity:0}),!qq.ie7()&&qq(a).css({height:"100%"}),r.element.appendChild(a),n.attach(a,"change",function(){r.onChange(a)}),n.attach(a,"mouseover",function(){qq(r.element).addClass(r.hoverClass)}),n.attach(a,"mouseout",function(){qq(r.element).removeClass(r.hoverClass)}),n.attach(a,"focus",function(){qq(r.element).addClass(r.focusClass)}),n.attach(a,"blur",function(){qq(r.element).removeClass(r.focusClass)}),a}qq(r.element).css({position:"relative",overflow:"hidden",direction:"ltr"}),qq.extend(this,{getInput:function(){return s},getButtonId:function(){return i},setMultiple:function(a,c){var d=c||this.getInput();r.ios8BrowserCrashWorkaround&&qq.ios8()&&(qq.iosChrome()||qq.iosSafariWebView())||a?d.setAttribute("multiple",""):d.removeAttribute("multiple")},setAcceptFiles:function(a){a!==r.acceptFiles&&s.setAttribute("accept",a)},reset:function(){s.parentNode&&qq(s).remove(),qq(r.element).removeClass(r.focusClass),s=null,s=l()}}),s=l()},qq.UploadButton.BUTTON_ID_ATTR_NAME="qq-button-id",qq.UploadData=function(e){var t=[],n={},r={},s={},i={};function l(d){if(qq.isArray(d)){var p=[];return qq.each(d,function(S,q){p.push(t[q])}),p}return t[d]}function a(d){if(qq.isArray(d)){var p=[];return qq.each(d,function(S,q){p.push(t[n[q]])}),p}return t[n[d]]}function c(d){var p=[],S=[].concat(d);return qq.each(S,function(q,o){var u=r[o];u!==void 0&&qq.each(u,function(h,_){p.push(t[_])})}),p}qq.extend(this,{addFile:function(d){var p=d.status||qq.status.SUBMITTING,S=t.push({name:d.name,originalName:d.name,uuid:d.uuid,size:d.size==null?-1:d.size,status:p,file:d.file})-1;return d.batchId&&(t[S].batchId=d.batchId,i[d.batchId]===void 0&&(i[d.batchId]=[]),i[d.batchId].push(S)),d.proxyGroupId&&(t[S].proxyGroupId=d.proxyGroupId,s[d.proxyGroupId]===void 0&&(s[d.proxyGroupId]=[]),s[d.proxyGroupId].push(S)),t[S].id=S,n[d.uuid]=S,r[p]===void 0&&(r[p]=[]),r[p].push(S),d.onBeforeStatusChange&&d.onBeforeStatusChange(S),e.onStatusChange(S,null,p),S},retrieve:function(d){if(qq.isObject(d)&&t.length){if(d.id!==void 0)return l(d.id);if(d.uuid!==void 0)return a(d.uuid);if(d.status)return c(d.status)}else return qq.extend([],t,!0)},removeFileRef:function(d){var p=l(d);p&&delete p.file},reset:function(){t=[],n={},r={},i={}},setStatus:function(d,p){var S=t[d].status,q=qq.indexOf(r[S],d);r[S].splice(q,1),t[d].status=p,r[p]===void 0&&(r[p]=[]),r[p].push(d),e.onStatusChange(d,S,p)},uuidChanged:function(d,p){var S=t[d].uuid;t[d].uuid=p,n[p]=d,delete n[S]},updateName:function(d,p){t[d].name=p},updateSize:function(d,p){t[d].size=p},setParentId:function(d,p){t[d].parentId=p},getIdsInProxyGroup:function(d){var p=t[d].proxyGroupId;return p?s[p]:[]},getIdsInBatch:function(d){var p=t[d].batchId;return i[p]}})},qq.status={SUBMITTING:"submitting",SUBMITTED:"submitted",REJECTED:"rejected",QUEUED:"queued",CANCELED:"canceled",PAUSED:"paused",UPLOADING:"uploading",UPLOAD_FINALIZING:"upload finalizing",UPLOAD_RETRYING:"retrying upload",UPLOAD_SUCCESSFUL:"upload successful",UPLOAD_FAILED:"upload failed",DELETE_FAILED:"delete failed",DELETING:"deleting",DELETED:"deleted"},function(){qq.basePublicApi={addBlobs:function(e,t,n){this.addFiles(e,t,n)},addInitialFiles:function(e){var t=this;qq.each(e,function(n,r){t._addCannedFile(r)})},addFiles:function(e,t,n){this._maybeHandleIos8SafariWorkaround();var r=this._storedIds.length===0?qq.getUniqueId():this._currentBatchId,s=qq.bind(function(q){this._handleNewFile({blob:q,name:this._options.blobs.defaultName},r,S)},this),i=qq.bind(function(q){this._handleNewFile(q,r,S)},this),l=qq.bind(function(q){var o=qq.canvasToBlob(q);this._handleNewFile({blob:o,name:this._options.blobs.defaultName+".png"},r,S)},this),a=qq.bind(function(q){var o=q.quality&&q.quality/100,u=qq.canvasToBlob(q.canvas,q.type,o);this._handleNewFile({blob:u,name:q.name},r,S)},this),c=qq.bind(function(q){if(qq.isInput(q)&&qq.supportedFeatures.ajaxUploading){var o=Array.prototype.slice.call(q.files),u=this;qq.each(o,function(h,_){u._handleNewFile(_,r,S)})}else this._handleNewFile(q,r,S)},this),d=function(){qq.isFileList(e)&&(e=Array.prototype.slice.call(e)),e=[].concat(e)},p=this,S=[];this._currentBatchId=r,e&&(d(),qq.each(e,function(q,o){qq.isFileOrInput(o)?c(o):qq.isBlob(o)?s(o):qq.isObject(o)?o.blob&&o.name?i(o):o.canvas&&o.name&&a(o):o.tagName&&o.tagName.toLowerCase()==="canvas"?l(o):p.log(o+" is not a valid file container!  Ignoring!","warn")}),this.log("Received "+S.length+" files."),this._prepareItemsForUpload(S,t,n))},cancel:function(e){var t=this._uploadData.retrieve({id:e});t&&t.status===qq.status.UPLOAD_FINALIZING?this.log(qq.format("Ignoring cancel for file ID {} ({}).  Finalizing upload.",e,this.getName(e)),"error"):this._handler.cancel(e)},cancelAll:function(){var e=[],t=this;qq.extend(e,this._storedIds),qq.each(e,function(n,r){t.cancel(r)}),this._handler.cancelAll()},clearStoredFiles:function(){this._storedIds=[]},continueUpload:function(e){var t=this._uploadData.retrieve({id:e});return!qq.supportedFeatures.pause||!this._options.chunking.enabled?!1:t.status===qq.status.PAUSED?(this.log(qq.format("Paused file ID {} ({}) will be continued.  Not paused.",e,this.getName(e))),this._uploadFile(e),!0):(this.log(qq.format("Ignoring continue for file ID {} ({}).  Not paused.",e,this.getName(e)),"error"),!1)},deleteFile:function(e){return this._onSubmitDelete(e)},doesExist:function(e){return this._handler.isValid(e)},drawThumbnail:function(e,t,n,r,s){var i=new qq.Promise,l,a;return this._imageGenerator?(l=this._thumbnailUrls[e],a={customResizeFunction:s,maxSize:n>0?n:null,scale:n>0},!r&&qq.supportedFeatures.imagePreviews&&(l=this.getFile(e)),l==null?i.failure({container:t,error:"File or URL not found."}):this._imageGenerator.generate(l,t,a).then(function(d){i.success(d)},function(d,p){i.failure({container:d,error:p||"Problem generating thumbnail"})})):i.failure({container:t,error:"Missing image generator module"}),i},getButton:function(e){return this._getButton(this._buttonIdsForFileIds[e])},getEndpoint:function(e){return this._endpointStore.get(e)},getFile:function(e){var t=this._handler.getFile(e),n;return t||(n=this._uploadData.retrieve({id:e}),n&&(t=n.file)),t||null},getInProgress:function(){return this._uploadData.retrieve({status:[qq.status.UPLOADING,qq.status.UPLOAD_RETRYING,qq.status.QUEUED]}).length},getName:function(e){return this._uploadData.retrieve({id:e}).name},getParentId:function(e){var t=this.getUploads({id:e}),n=null;return t&&t.parentId!==void 0&&(n=t.parentId),n},getResumableFilesData:function(){return this._handler.getResumableFilesData()},getSize:function(e){return this._uploadData.retrieve({id:e}).size},getNetUploads:function(){return this._netUploaded},getRemainingAllowedItems:function(){var e=this._currentItemLimit;return e>0?e-this._netUploadedOrQueued:null},getUploads:function(e){return this._uploadData.retrieve(e)},getUuid:function(e){return this._uploadData.retrieve({id:e}).uuid},isResumable:function(e){return this._handler.hasResumeRecord(e)},log:function(e,t){this._options.debug&&(!t||t==="info")?qq.log("[Fine Uploader "+qq.version+"] "+e):t&&t!=="info"&&qq.log("[Fine Uploader "+qq.version+"] "+e,t)},pauseUpload:function(e){var t=this._uploadData.retrieve({id:e});if(!qq.supportedFeatures.pause||!this._options.chunking.enabled)return!1;if(qq.indexOf([qq.status.UPLOADING,qq.status.UPLOAD_RETRYING],t.status)>=0){if(this._handler.pause(e))return this._uploadData.setStatus(e,qq.status.PAUSED),!0;this.log(qq.format("Unable to pause file ID {} ({}).",e,this.getName(e)),"error")}else this.log(qq.format("Ignoring pause for file ID {} ({}).  Not in progress.",e,this.getName(e)),"error");return!1},removeFileRef:function(e){this._handler.expunge(e),this._uploadData.removeFileRef(e)},reset:function(){this.log("Resetting uploader..."),this._handler.reset(),this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._thumbnailUrls=[],qq.each(this._buttons,function(e,t){t.reset()}),this._paramsStore.reset(),this._endpointStore.reset(),this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData.reset(),this._buttonIdsForFileIds=[],this._pasteHandler&&this._pasteHandler.reset(),this._options.session.refreshOnReset&&this._refreshSessionData(),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[],this._totalProgress&&this._totalProgress.reset(),this._customResumeDataStore.reset()},retry:function(e){return this._manualRetry(e)},scaleImage:function(e,t){var n=this;return qq.Scaler.prototype.scaleImage(e,t,{log:qq.bind(n.log,n),getFile:qq.bind(n.getFile,n),uploadData:n._uploadData})},setCustomHeaders:function(e,t){this._customHeadersStore.set(e,t)},setCustomResumeData:function(e,t){this._customResumeDataStore.set(t,e)},setDeleteFileCustomHeaders:function(e,t){this._deleteFileCustomHeadersStore.set(e,t)},setDeleteFileEndpoint:function(e,t){this._deleteFileEndpointStore.set(e,t)},setDeleteFileParams:function(e,t){this._deleteFileParamsStore.set(e,t)},setEndpoint:function(e,t){this._endpointStore.set(e,t)},setForm:function(e){this._updateFormSupportAndParams(e)},setItemLimit:function(e){this._currentItemLimit=e},setName:function(e,t){this._uploadData.updateName(e,t)},setParams:function(e,t){this._paramsStore.set(e,t)},setUuid:function(e,t){return this._uploadData.uuidChanged(e,t)},setStatus:function(e,t){var n=this.getUploads({id:e});if(!n)throw new qq.Error(e+" is not a valid file ID.");switch(t){case qq.status.DELETED:this._onDeleteComplete(e,null,!1);break;case qq.status.DELETE_FAILED:this._onDeleteComplete(e,null,!0);break;default:var r="Method setStatus called on '"+name+"' not implemented yet for "+t;throw this.log(r),new qq.Error(r)}},uploadStoredFiles:function(){this._storedIds.length===0?this._itemError("noFilesError"):this._uploadStoredFiles()}},qq.basePrivateApi={_addCannedFile:function(e){var t=this;return this._uploadData.addFile({uuid:e.uuid,name:e.name,size:e.size,status:qq.status.UPLOAD_SUCCESSFUL,onBeforeStatusChange:function(n){e.deleteFileEndpoint&&t.setDeleteFileEndpoint(e.deleteFileEndpoint,n),e.deleteFileParams&&t.setDeleteFileParams(e.deleteFileParams,n),e.thumbnailUrl&&(t._thumbnailUrls[n]=e.thumbnailUrl),t._netUploaded++,t._netUploadedOrQueued++}})},_annotateWithButtonId:function(e,t){qq.isFile(e)&&(e.qqButtonId=this._getButtonId(t))},_batchError:function(e){this._options.callbacks.onError(null,null,e,void 0)},_createDeleteHandler:function(){var e=this;return new qq.DeleteFileAjaxRequester({method:this._options.deleteFile.method.toUpperCase(),maxConnections:this._options.maxConnections,uuidParamName:this._options.request.uuidName,customHeaders:this._deleteFileCustomHeadersStore,paramsStore:this._deleteFileParamsStore,endpointStore:this._deleteFileEndpointStore,cors:this._options.cors,log:qq.bind(e.log,e),onDelete:function(t){e._onDelete(t),e._options.callbacks.onDelete(t)},onDeleteComplete:function(t,n,r){e._onDeleteComplete(t,n,r),e._options.callbacks.onDeleteComplete(t,n,r)}})},_createPasteHandler:function(){var e=this;return new qq.PasteSupport({targetElement:this._options.paste.targetElement,callbacks:{log:qq.bind(e.log,e),pasteReceived:function(t){e._handleCheckedCallback({name:"onPasteReceived",callback:qq.bind(e._options.callbacks.onPasteReceived,e,t),onSuccess:qq.bind(e._handlePasteSuccess,e,t),identifier:"pasted image"})}}})},_createStore:function(e,t){var n={},r=e,s={},i=t,l=function(d){return qq.isObject(d)?qq.extend({},d):d},a=function(){return qq.isFunction(i)?i():i},c=function(d,p){i&&qq.isObject(p)&&qq.extend(p,a()),s[d]&&qq.extend(p,s[d])};return{set:function(d,p){p==null?(n={},r=l(d)):n[p]=l(d)},get:function(d){var p;return d!=null&&n[d]?p=n[d]:p=l(r),c(d,p),l(p)},addReadOnly:function(d,p){qq.isObject(n)&&(d===null?qq.isFunction(p)?i=p:(i=i||{},qq.extend(i,p)):(s[d]=s[d]||{},qq.extend(s[d],p)))},remove:function(d){return delete n[d]},reset:function(){n={},s={},r=e}}},_createUploadDataTracker:function(){var e=this;return new qq.UploadData({getName:function(t){return e.getName(t)},getUuid:function(t){return e.getUuid(t)},getSize:function(t){return e.getSize(t)},onStatusChange:function(t,n,r){e._onUploadStatusChange(t,n,r),e._options.callbacks.onStatusChange(t,n,r),e._maybeAllComplete(t,r),e._totalProgress&&setTimeout(function(){e._totalProgress.onStatusChange(t,n,r)},0)}})},_createUploadButton:function(e){var t=this,n=e.accept||this._options.validation.acceptFiles,r=e.allowedExtensions||this._options.validation.allowedExtensions,s;function i(){return qq.supportedFeatures.ajaxUploading?t._options.workarounds.iosEmptyVideos&&qq.ios()&&!qq.ios6()&&t._isAllowedExtension(r,".mov")?!1:e.multiple===void 0?t._options.multiple:e.multiple:!1}return s=new qq.UploadButton({acceptFiles:n,element:e.element,focusClass:this._options.classes.buttonFocus,folders:e.folders,hoverClass:this._options.classes.buttonHover,ios8BrowserCrashWorkaround:this._options.workarounds.ios8BrowserCrash,multiple:i(),name:this._options.request.inputName,onChange:function(l){t._onInputChange(l)},title:e.title==null?this._options.text.fileInputTitle:e.title}),this._disposeSupport.addDisposer(function(){s.dispose()}),t._buttons.push(s),s},_createUploadHandler:function(e,t){var n=this,r={},s={debug:this._options.debug,maxConnections:this._options.maxConnections,cors:this._options.cors,paramsStore:this._paramsStore,endpointStore:this._endpointStore,chunking:this._options.chunking,resume:this._options.resume,blobs:this._options.blobs,log:qq.bind(n.log,n),preventRetryParam:this._options.retry.preventRetryResponseProperty,onProgress:function(i,l,a,c){a<0||c<0||(r[i]?(r[i].loaded!==a||r[i].total!==c)&&(n._onProgress(i,l,a,c),n._options.callbacks.onProgress(i,l,a,c)):(n._onProgress(i,l,a,c),n._options.callbacks.onProgress(i,l,a,c)),r[i]={loaded:a,total:c})},onComplete:function(i,l,a,c){delete r[i];var d=n.getUploads({id:i}).status,p;d===qq.status.UPLOAD_SUCCESSFUL||d===qq.status.UPLOAD_FAILED||(p=n._onComplete(i,l,a,c),p instanceof qq.Promise?p.done(function(){n._options.callbacks.onComplete(i,l,a,c)}):n._options.callbacks.onComplete(i,l,a,c))},onCancel:function(i,l,a){var c=new qq.Promise;return n._handleCheckedCallback({name:"onCancel",callback:qq.bind(n._options.callbacks.onCancel,n,i,l),onFailure:c.failure,onSuccess:function(){a.then(function(){n._onCancel(i,l)}),c.success()},identifier:i}),c},onUploadPrep:qq.bind(this._onUploadPrep,this),onUpload:function(i,l){n._onUpload(i,l);var a=n._options.callbacks.onUpload(i,l);return qq.isGenericPromise(a)?(n.log(qq.format("onUpload for {} returned a Promise - waiting for resolution.",i)),a):new qq.Promise().success()},onUploadChunk:function(i,l,a){n._onUploadChunk(i,a);var c=n._options.callbacks.onUploadChunk(i,l,a);return qq.isGenericPromise(c)?(n.log(qq.format("onUploadChunk for {}.{} returned a Promise - waiting for resolution.",i,a.partIndex)),c):new qq.Promise().success()},onUploadChunkSuccess:function(i,l,a,c){n._onUploadChunkSuccess(i,l),n._options.callbacks.onUploadChunkSuccess.apply(n,arguments)},onResume:function(i,l,a,c){return n._options.callbacks.onResume(i,l,a,c)},onAutoRetry:function(i,l,a,c){return n._onAutoRetry.apply(n,arguments)},onUuidChanged:function(i,l){n.log("Server requested UUID change from '"+n.getUuid(i)+"' to '"+l+"'"),n.setUuid(i,l)},getName:qq.bind(n.getName,n),getUuid:qq.bind(n.getUuid,n),getSize:qq.bind(n.getSize,n),setSize:qq.bind(n._setSize,n),getDataByUuid:function(i){return n.getUploads({uuid:i})},isQueued:function(i){var l=n.getUploads({id:i}).status;return l===qq.status.QUEUED||l===qq.status.SUBMITTED||l===qq.status.UPLOAD_RETRYING||l===qq.status.PAUSED},getIdsInProxyGroup:n._uploadData.getIdsInProxyGroup,getIdsInBatch:n._uploadData.getIdsInBatch,isInProgress:function(i){return n.getUploads({id:i}).status===qq.status.UPLOADING},getCustomResumeData:qq.bind(n._getCustomResumeData,n),setStatus:function(i,l){n._uploadData.setStatus(i,l)}};return qq.each(this._options.request,function(i,l){s[i]=l}),s.customHeaders=this._customHeadersStore,e&&qq.each(e,function(i,l){s[i]=l}),new qq.UploadHandlerController(s,t)},_fileOrBlobRejected:function(e){this._netUploadedOrQueued--,this._uploadData.setStatus(e,qq.status.REJECTED)},_formatSize:function(e){if(e===0)return e+this._options.text.sizeSymbols[0];var t=-1;do e=e/1e3,t++;while(e>999);return Math.max(e,.1).toFixed(1)+this._options.text.sizeSymbols[t]},_generateExtraButtonSpecs:function(){var e=this;this._extraButtonSpecs={},qq.each(this._options.extraButtons,function(t,n){var r=n.multiple,s=qq.extend({},e._options.validation,!0),i=qq.extend({},n);r===void 0&&(r=e._options.multiple),i.validation&&qq.extend(s,n.validation,!0),qq.extend(i,{multiple:r,validation:s},!0),e._initExtraButton(i)})},_getButton:function(e){var t=this._extraButtonSpecs[e];if(t)return t.element;if(e===this._defaultButtonId)return this._options.button},_getButtonId:function(e){var t,n,r=e;if(r instanceof qq.BlobProxy&&(r=r.referenceBlob),r&&!qq.isBlob(r)){if(qq.isFile(r))return r.qqButtonId;if(r.tagName.toLowerCase()==="input"&&r.type.toLowerCase()==="file")return r.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME);if(t=r.getElementsByTagName("input"),qq.each(t,function(s,i){if(i.getAttribute("type")==="file")return n=i,!1}),n)return n.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME)}},_getCustomResumeData:function(e){return this._customResumeDataStore.get(e)},_getNotFinished:function(){return this._uploadData.retrieve({status:[qq.status.UPLOADING,qq.status.UPLOAD_RETRYING,qq.status.QUEUED,qq.status.SUBMITTING,qq.status.SUBMITTED,qq.status.PAUSED]}).length},_getValidationBase:function(e){var t=this._extraButtonSpecs[e];return t?t.validation:this._options.validation},_getValidationDescriptor:function(e){return e.file instanceof qq.BlobProxy?{name:qq.getFilename(e.file.referenceBlob),size:e.file.referenceBlob.size}:{name:this.getUploads({id:e.id}).name,size:this.getUploads({id:e.id}).size}},_getValidationDescriptors:function(e){var t=this,n=[];return qq.each(e,function(r,s){n.push(t._getValidationDescriptor(s))}),n},_handleCameraAccess:function(){if(this._options.camera.ios&&qq.ios()){var e="image/*;capture=camera",t=this._options.camera.button,n=t?this._getButtonId(t):this._defaultButtonId,r=this._options;n&&n!==this._defaultButtonId&&(r=this._extraButtonSpecs[n]),r.multiple=!1,r.validation.acceptFiles===null?r.validation.acceptFiles=e:r.validation.acceptFiles+=","+e,qq.each(this._buttons,function(s,i){if(i.getButtonId()===n)return i.setMultiple(r.multiple),i.setAcceptFiles(r.acceptFiles),!1})}},_handleCheckedCallback:function(e){var t=this,n=e.callback();return qq.isGenericPromise(n)?(this.log(e.name+" - waiting for "+e.name+" promise to be fulfilled for "+e.identifier),n.then(function(r){t.log(e.name+" promise success for "+e.identifier),e.onSuccess(r)},function(){e.onFailure?(t.log(e.name+" promise failure for "+e.identifier),e.onFailure()):t.log(e.name+" promise failure for "+e.identifier)})):(n!==!1?e.onSuccess(n):e.onFailure?(this.log(e.name+" - return value was 'false' for "+e.identifier+".  Invoking failure callback."),e.onFailure()):this.log(e.name+" - return value was 'false' for "+e.identifier+".  Will not proceed."),n)},_handleNewFile:function(e,t,n){var r=this,s=qq.getUniqueId(),i=-1,l=qq.getFilename(e),a=e.blob||e,c=this._customNewFileHandler?this._customNewFileHandler:qq.bind(r._handleNewFileGeneric,r);!qq.isInput(a)&&a.size>=0&&(i=a.size),c(a,l,s,i,n,t,this._options.request.uuidName,{uploadData:r._uploadData,paramsStore:r._paramsStore,addFileToHandler:function(d,p){r._handler.add(d,p),r._netUploadedOrQueued++,r._trackButton(d)}})},_handleNewFileGeneric:function(e,t,n,r,s,i){var l=this._uploadData.addFile({uuid:n,name:t,size:r,batchId:i,file:e});this._handler.add(l,e),this._trackButton(l),this._netUploadedOrQueued++,s.push({id:l,file:e})},_handlePasteSuccess:function(e,t){var n=e.type.split("/")[1],r=t;r==null&&(r=this._options.paste.defaultName),r+="."+n,this.addFiles({name:r,blob:e})},_handleDeleteSuccess:function(e){if(this.getUploads({id:e}).status!==qq.status.DELETED){var t=this.getName(e);this._netUploadedOrQueued--,this._netUploaded--,this._handler.expunge(e),this._uploadData.setStatus(e,qq.status.DELETED),this.log("Delete request for '"+t+"' has succeeded.")}},_handleDeleteFailed:function(e,t){var n=this.getName(e);this._uploadData.setStatus(e,qq.status.DELETE_FAILED),this.log("Delete request for '"+n+"' has failed.","error"),!t||t.withCredentials===void 0?this._options.callbacks.onError(e,n,"Delete request failed",t):this._options.callbacks.onError(e,n,"Delete request failed with response code "+t.status,t)},_initExtraButton:function(e){var t=this._createUploadButton({accept:e.validation.acceptFiles,allowedExtensions:e.validation.allowedExtensions,element:e.element,folders:e.folders,multiple:e.multiple,title:e.fileInputTitle});this._extraButtonSpecs[t.getButtonId()]=e},_initFormSupportAndParams:function(){this._formSupport=qq.FormSupport&&new qq.FormSupport(this._options.form,qq.bind(this.uploadStoredFiles,this),qq.bind(this.log,this)),this._formSupport&&this._formSupport.attachedToForm?(this._paramsStore=this._createStore(this._options.request.params,this._formSupport.getFormInputsAsObject),this._options.autoUpload=this._formSupport.newAutoUpload,this._formSupport.newEndpoint&&(this._options.request.endpoint=this._formSupport.newEndpoint)):this._paramsStore=this._createStore(this._options.request.params)},_isDeletePossible:function(){return!qq.DeleteFileAjaxRequester||!this._options.deleteFile.enabled?!1:this._options.cors.expected?!!(qq.supportedFeatures.deleteFileCorsXhr||qq.supportedFeatures.deleteFileCorsXdr&&this._options.cors.allowXdr):!0},_isAllowedExtension:function(e,t){var n=!1;return e.length?(qq.each(e,function(r,s){if(qq.isString(s)){var i=new RegExp("\\."+s+"$","i");if(t.match(i)!=null)return n=!0,!1}}),n):!0},_itemError:function(e,t,n){var r=this._options.messages[e],s=[],i=[].concat(t),l=i[0],a=this._getButtonId(n),c=this._getValidationBase(a),d,p;function S(q,o){r=r.replace(q,o)}return qq.each(c.allowedExtensions,function(q,o){qq.isString(o)&&s.push(o)}),d=s.join(", ").toLowerCase(),S("{file}",this._options.formatFileName(l)),S("{extensions}",d),S("{sizeLimit}",this._formatSize(c.sizeLimit)),S("{minSizeLimit}",this._formatSize(c.minSizeLimit)),p=r.match(/(\{\w+\})/g),p!==null&&qq.each(p,function(q,o){S(o,i[q])}),this._options.callbacks.onError(null,l,r,void 0),r},_manualRetry:function(e,t){if(this._onBeforeManualRetry(e))return this._netUploadedOrQueued++,this._uploadData.setStatus(e,qq.status.UPLOAD_RETRYING),t?t(e):this._handler.retry(e),!0},_maybeAllComplete:function(e,t){var n=this,r=this._getNotFinished();t===qq.status.UPLOAD_SUCCESSFUL?this._succeededSinceLastAllComplete.push(e):t===qq.status.UPLOAD_FAILED&&this._failedSinceLastAllComplete.push(e),r===0&&(this._succeededSinceLastAllComplete.length||this._failedSinceLastAllComplete.length)&&setTimeout(function(){n._onAllComplete(n._succeededSinceLastAllComplete,n._failedSinceLastAllComplete)},0)},_maybeHandleIos8SafariWorkaround:function(){var e=this;if(this._options.workarounds.ios8SafariUploads&&qq.ios800()&&qq.iosSafari())throw setTimeout(function(){window.alert(e._options.messages.unsupportedBrowserIos8Safari)},0),new qq.Error(this._options.messages.unsupportedBrowserIos8Safari)},_maybeParseAndSendUploadError:function(e,t,n,r){if(!n.success)if(r&&r.status!==200&&!n.error)this._options.callbacks.onError(e,t,"XHR returned response code "+r.status,r);else{var s=n.error?n.error:this._options.text.defaultResponseError;this._options.callbacks.onError(e,t,s,r)}},_maybeProcessNextItemAfterOnValidateCallback:function(e,t,n,r,s){var i=this;if(t.length>n){if(e||!this._options.validation.stopOnFirstInvalidFile)setTimeout(function(){var l=i._getValidationDescriptor(t[n]),a=i._getButtonId(t[n].file),c=i._getButton(a);i._handleCheckedCallback({name:"onValidate",callback:qq.bind(i._options.callbacks.onValidate,i,l,c),onSuccess:qq.bind(i._onValidateCallbackSuccess,i,t,n,r,s),onFailure:qq.bind(i._onValidateCallbackFailure,i,t,n,r,s),identifier:"Item '"+l.name+"', size: "+l.size})},0);else if(!e)for(;n<t.length;n++)i._fileOrBlobRejected(t[n].id)}},_onAllComplete:function(e,t){this._totalProgress&&this._totalProgress.onAllComplete(e,t,this._preventRetries),this._options.callbacks.onAllComplete(qq.extend([],e),qq.extend([],t)),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[]},_onAutoRetry:function(e,t,n,r,s){var i=this;if(i._preventRetries[e]=n[i._options.retry.preventRetryResponseProperty],i._shouldAutoRetry(e)){var l=i._options.retry.autoAttemptDelay*1e3;return i._maybeParseAndSendUploadError.apply(i,arguments),i._options.callbacks.onAutoRetry(e,t,i._autoRetries[e]),i._onBeforeAutoRetry(e,t),i._uploadData.setStatus(e,qq.status.UPLOAD_RETRYING),i._retryTimeouts[e]=setTimeout(function(){i.log("Starting retry for "+t+"..."),s?s(e):i._handler.retry(e)},l),!0}},_onBeforeAutoRetry:function(e,t){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+t+"...")},_onBeforeManualRetry:function(e){var t=this._currentItemLimit,n;return this._preventRetries[e]?(this.log("Retries are forbidden for id "+e,"warn"),!1):this._handler.isValid(e)?(n=this.getName(e),this._options.callbacks.onManualRetry(e,n)===!1?!1:t>0&&this._netUploadedOrQueued+1>t?(this._itemError("retryFailTooManyItems"),!1):(this.log("Retrying upload for '"+n+"' (id: "+e+")..."),!0)):(this.log("'"+e+"' is not a valid file ID","error"),!1)},_onCancel:function(e,t){this._netUploadedOrQueued--,clearTimeout(this._retryTimeouts[e]);var n=qq.indexOf(this._storedIds,e);!this._options.autoUpload&&n>=0&&this._storedIds.splice(n,1),this._uploadData.setStatus(e,qq.status.CANCELED)},_onComplete:function(e,t,n,r){return n.success?(n.thumbnailUrl&&(this._thumbnailUrls[e]=n.thumbnailUrl),this._netUploaded++,this._uploadData.setStatus(e,qq.status.UPLOAD_SUCCESSFUL)):(this._netUploadedOrQueued--,this._uploadData.setStatus(e,qq.status.UPLOAD_FAILED),n[this._options.retry.preventRetryResponseProperty]===!0&&(this._preventRetries[e]=!0)),this._maybeParseAndSendUploadError(e,t,n,r),!!n.success},_onDelete:function(e){this._uploadData.setStatus(e,qq.status.DELETING)},_onDeleteComplete:function(e,t,n){this.getName(e),n?this._handleDeleteFailed(e,t):this._handleDeleteSuccess(e)},_onInputChange:function(e){var t;if(qq.supportedFeatures.ajaxUploading){for(t=0;t<e.files.length;t++)this._annotateWithButtonId(e.files[t],e);this.addFiles(e.files)}else e.value.length>0&&this.addFiles(e);qq.each(this._buttons,function(n,r){r.reset()})},_onProgress:function(e,t,n,r){this._totalProgress&&this._totalProgress.onIndividualProgress(e,n,r)},_onSubmit:function(e,t){},_onSubmitCallbackSuccess:function(e,t){this._onSubmit.apply(this,arguments),this._uploadData.setStatus(e,qq.status.SUBMITTED),this._onSubmitted.apply(this,arguments),this._options.autoUpload?(this._options.callbacks.onSubmitted.apply(this,arguments),this._uploadFile(e)):(this._storeForLater(e),this._options.callbacks.onSubmitted.apply(this,arguments))},_onSubmitDelete:function(e,t,n){var r=this.getUuid(e),s;return t&&(s=qq.bind(t,this,e,r,n)),this._isDeletePossible()?(this._handleCheckedCallback({name:"onSubmitDelete",callback:qq.bind(this._options.callbacks.onSubmitDelete,this,e),onSuccess:s||qq.bind(this._deleteHandler.sendDelete,this,e,r,n),identifier:e}),!0):(this.log("Delete request ignored for ID "+e+", delete feature is disabled or request not possible due to CORS on a user agent that does not support pre-flighting.","warn"),!1)},_onSubmitted:function(e){},_onTotalProgress:function(e,t){this._options.callbacks.onTotalProgress(e,t)},_onUploadPrep:function(e){},_onUpload:function(e,t){this._uploadData.setStatus(e,qq.status.UPLOADING)},_onUploadChunk:function(e,t){},_onUploadChunkSuccess:function(e,t){!this._preventRetries[e]&&this._options.retry.enableAuto&&(this._autoRetries[e]=0)},_onUploadStatusChange:function(e,t,n){n===qq.status.PAUSED&&clearTimeout(this._retryTimeouts[e])},_onValidateBatchCallbackFailure:function(e){var t=this;qq.each(e,function(n,r){t._fileOrBlobRejected(r.id)})},_onValidateBatchCallbackSuccess:function(e,t,n,r,s){var i,l=this._currentItemLimit,a=this._netUploadedOrQueued;l===0||a<=l?t.length>0?this._handleCheckedCallback({name:"onValidate",callback:qq.bind(this._options.callbacks.onValidate,this,e[0],s),onSuccess:qq.bind(this._onValidateCallbackSuccess,this,t,0,n,r),onFailure:qq.bind(this._onValidateCallbackFailure,this,t,0,n,r),identifier:"Item '"+t[0].file.name+"', size: "+t[0].file.size}):this._itemError("noFilesError"):(this._onValidateBatchCallbackFailure(t),i=this._options.messages.tooManyItemsError.replace(/\{netItems\}/g,a).replace(/\{itemLimit\}/g,l),this._batchError(i))},_onValidateCallbackFailure:function(e,t,n,r){var s=t+1;this._fileOrBlobRejected(e[t].id,e[t].file.name),this._maybeProcessNextItemAfterOnValidateCallback(!1,e,s,n,r)},_onValidateCallbackSuccess:function(e,t,n,r){var s=this,i=t+1,l=this._getValidationDescriptor(e[t]);this._validateFileOrBlobData(e[t],l).then(function(){s._upload(e[t].id,n,r),s._maybeProcessNextItemAfterOnValidateCallback(!0,e,i,n,r)},function(){s._maybeProcessNextItemAfterOnValidateCallback(!1,e,i,n,r)})},_prepareItemsForUpload:function(e,t,n){if(e.length===0){this._itemError("noFilesError");return}var r=this._getValidationDescriptors(e),s=this._getButtonId(e[0].file),i=this._getButton(s);this._handleCheckedCallback({name:"onValidateBatch",callback:qq.bind(this._options.callbacks.onValidateBatch,this,r,i),onSuccess:qq.bind(this._onValidateBatchCallbackSuccess,this,r,e,t,n,i),onFailure:qq.bind(this._onValidateBatchCallbackFailure,this,e),identifier:"batch validation"})},_preventLeaveInProgress:function(){var e=this;this._disposeSupport.attach(window,"beforeunload",function(t){if(e.getInProgress())return t=t||window.event,t.returnValue=e._options.messages.onLeave,e._options.messages.onLeave})},_refreshSessionData:function(){var e=this,t=this._options.session;qq.Session&&this._options.session.endpoint!=null&&(this._session||(qq.extend(t,{cors:this._options.cors}),t.log=qq.bind(this.log,this),t.addFileRecord=qq.bind(this._addCannedFile,this),this._session=new qq.Session(t)),setTimeout(function(){e._session.refresh().then(function(n,r){e._sessionRequestComplete(),e._options.callbacks.onSessionRequestComplete(n,!0,r)},function(n,r){e._options.callbacks.onSessionRequestComplete(n,!1,r)})},0))},_sessionRequestComplete:function(){},_setSize:function(e,t){this._uploadData.updateSize(e,t),this._totalProgress&&this._totalProgress.onNewSize(e)},_shouldAutoRetry:function(e){var t=this._uploadData.retrieve({id:e});return!this._preventRetries[e]&&this._options.retry.enableAuto&&t.status!==qq.status.PAUSED&&(this._autoRetries[e]===void 0&&(this._autoRetries[e]=0),this._autoRetries[e]<this._options.retry.maxAutoAttempts)?(this._autoRetries[e]+=1,!0):!1},_storeForLater:function(e){this._storedIds.push(e)},_trackButton:function(e){var t;qq.supportedFeatures.ajaxUploading?t=this._handler.getFile(e).qqButtonId:t=this._getButtonId(this._handler.getInput(e)),t&&(this._buttonIdsForFileIds[e]=t)},_updateFormSupportAndParams:function(e){this._options.form.element=e,this._formSupport=qq.FormSupport&&new qq.FormSupport(this._options.form,qq.bind(this.uploadStoredFiles,this),qq.bind(this.log,this)),this._formSupport&&this._formSupport.attachedToForm&&(this._paramsStore.addReadOnly(null,this._formSupport.getFormInputsAsObject),this._options.autoUpload=this._formSupport.newAutoUpload,this._formSupport.newEndpoint&&this.setEndpoint(this._formSupport.newEndpoint))},_upload:function(e,t,n){var r=this.getName(e);t&&this.setParams(t,e),n&&this.setEndpoint(n,e),this._handleCheckedCallback({name:"onSubmit",callback:qq.bind(this._options.callbacks.onSubmit,this,e,r),onSuccess:qq.bind(this._onSubmitCallbackSuccess,this,e,r),onFailure:qq.bind(this._fileOrBlobRejected,this,e,r),identifier:e})},_uploadFile:function(e){this._handler.upload(e)||this._uploadData.setStatus(e,qq.status.QUEUED)},_uploadStoredFiles:function(){for(var e,t,n=this;this._storedIds.length;)e=this._storedIds.shift(),this._uploadFile(e);t=this.getUploads({status:qq.status.SUBMITTING}).length,t&&(qq.log("Still waiting for "+t+" files to clear submit queue. Will re-parse stored IDs array shortly."),setTimeout(function(){n._uploadStoredFiles()},1e3))},_validateFileOrBlobData:function(e,t){var n=this,r=function(){return e.file instanceof qq.BlobProxy?e.file.referenceBlob:e.file}(),s=t.name,i=t.size,l=this._getButtonId(e.file),a=this._getValidationBase(l),c=new qq.Promise;return c.then(function(){},function(){n._fileOrBlobRejected(e.id,s)}),qq.isFileOrInput(r)&&!this._isAllowedExtension(a.allowedExtensions,s)?(this._itemError("typeError",s,r),c.failure()):!this._options.validation.allowEmpty&&i===0?(this._itemError("emptyError",s,r),c.failure()):i>0&&a.sizeLimit&&i>a.sizeLimit?(this._itemError("sizeError",s,r),c.failure()):i>0&&i<a.minSizeLimit?(this._itemError("minSizeError",s,r),c.failure()):(qq.ImageValidation&&qq.supportedFeatures.imagePreviews&&qq.isFile(r)?new qq.ImageValidation(r,qq.bind(n.log,n)).validate(a.image).then(c.success,function(d){n._itemError(d+"ImageError",s,r),c.failure()}):c.success(),c)},_wrapCallbacks:function(){var e,t,n;e=this,t=function(r,s,i){var l;try{return s.apply(e,i)}catch(a){l=a.message||a.toString(),e.log("Caught exception in '"+r+"' callback - "+l,"error")}};for(n in this._options.callbacks)(function(){var r,s;r=n,s=e._options.callbacks[r],e._options.callbacks[r]=function(){return t(r,s,arguments)}})()}}}(),function(){qq.FineUploaderBasic=function(e){var t=this;this._options={debug:!1,button:null,multiple:!0,maxConnections:3,disableCancelForFormUploads:!1,autoUpload:!0,warnBeforeUnload:!0,request:{customHeaders:{},endpoint:"/server/upload",filenameParam:"qqfilename",forceMultipart:!0,inputName:"qqfile",method:"POST",omitDefaultParams:!1,params:{},paramsInBody:!0,requireSuccessJson:!0,totalFileSizeName:"qqtotalfilesize",uuidName:"qquuid"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,itemLimit:0,stopOnFirstInvalidFile:!0,acceptFiles:null,image:{maxHeight:0,maxWidth:0,minHeight:0,minWidth:0},allowEmpty:!1},callbacks:{onSubmit:function(n,r){},onSubmitted:function(n,r){},onComplete:function(n,r,s,i){},onAllComplete:function(n,r){},onCancel:function(n,r){},onUpload:function(n,r){},onUploadChunk:function(n,r,s){},onUploadChunkSuccess:function(n,r,s,i){},onResume:function(n,r,s,i){},onProgress:function(n,r,s,i){},onTotalProgress:function(n,r){},onError:function(n,r,s,i){},onAutoRetry:function(n,r,s){},onManualRetry:function(n,r){},onValidateBatch:function(n){},onValidate:function(n){},onSubmitDelete:function(n){},onDelete:function(n){},onDeleteComplete:function(n,r,s){},onPasteReceived:function(n){},onStatusChange:function(n,r,s){},onSessionRequestComplete:function(n,r,s){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",tooManyItemsError:"Too many items ({netItems}) would be uploaded.  Item limit is {itemLimit}.",maxHeightImageError:"Image is too tall.",maxWidthImageError:"Image is too wide.",minHeightImageError:"Image is not tall enough.",minWidthImageError:"Image is not wide enough.",retryFailTooManyItems:"Retry failed - you have reached your file limit.",onLeave:"The files are being uploaded, if you leave now the upload will be canceled.",unsupportedBrowserIos8Safari:"Unrecoverable error - this browser does not permit file uploading of any kind due to serious bugs in iOS8 Safari.  Please use iOS8 Chrome until Apple fixes these issues."},retry:{enableAuto:!1,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"},classes:{buttonHover:"qq-upload-button-hover",buttonFocus:"qq-upload-button-focus"},chunking:{enabled:!1,concurrent:{enabled:!1},mandatory:!1,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalFileSize:"qqtotalfilesize",totalParts:"qqtotalparts"},partSize:function(n){return 2e6},success:{endpoint:null,headers:function(n){return null},jsonPayload:!1,method:"POST",params:function(n){return null},resetOnStatus:[]}},resume:{enabled:!1,recordsExpireIn:7,paramNames:{resuming:"qqresume"},customKeys:function(n){return[]}},formatFileName:function(n){return n},text:{defaultResponseError:"Upload failure reason unknown",fileInputTitle:"file input",sizeSymbols:["kB","MB","GB","TB","PB","EB"]},deleteFile:{enabled:!1,method:"DELETE",endpoint:"/server/upload",customHeaders:{},params:{}},cors:{expected:!1,sendCredentials:!1,allowXdr:!1},blobs:{defaultName:"misc_data"},paste:{targetElement:null,defaultName:"pasted_image"},camera:{ios:!1,button:null},extraButtons:[],session:{endpoint:null,params:{},customHeaders:{},refreshOnReset:!0},form:{element:"qq-form",autoUpload:!1,interceptSubmit:!0},scaling:{customResizer:null,sendOriginal:!0,orient:!0,defaultType:null,defaultQuality:80,failureText:"Failed to scale",includeExif:!1,sizes:[]},workarounds:{iosEmptyVideos:!0,ios8SafariUploads:!0,ios8BrowserCrash:!1}},qq.extend(this._options,e,!0),this._buttons=[],this._extraButtonSpecs={},this._buttonIdsForFileIds=[],this._wrapCallbacks(),this._disposeSupport=new qq.DisposeSupport,this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._thumbnailUrls=[],this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData=this._createUploadDataTracker(),this._initFormSupportAndParams(),this._customHeadersStore=this._createStore(this._options.request.customHeaders),this._deleteFileCustomHeadersStore=this._createStore(this._options.deleteFile.customHeaders),this._deleteFileParamsStore=this._createStore(this._options.deleteFile.params),this._endpointStore=this._createStore(this._options.request.endpoint),this._deleteFileEndpointStore=this._createStore(this._options.deleteFile.endpoint),this._handler=this._createUploadHandler(),this._deleteHandler=qq.DeleteFileAjaxRequester&&this._createDeleteHandler(),this._options.button&&(this._defaultButtonId=this._createUploadButton({element:this._options.button,title:this._options.text.fileInputTitle}).getButtonId()),this._generateExtraButtonSpecs(),this._handleCameraAccess(),this._options.paste.targetElement&&(qq.PasteSupport?this._pasteHandler=this._createPasteHandler():this.log("Paste support module not found","error")),this._options.warnBeforeUnload&&this._preventLeaveInProgress(),this._imageGenerator=qq.ImageGenerator&&new qq.ImageGenerator(qq.bind(this.log,this)),this._refreshSessionData(),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[],this._scaler=qq.Scaler&&new qq.Scaler(this._options.scaling,qq.bind(this.log,this))||{},this._scaler.enabled&&(this._customNewFileHandler=qq.bind(this._scaler.handleNewFile,this._scaler)),qq.TotalProgress&&qq.supportedFeatures.progressBar&&(this._totalProgress=new qq.TotalProgress(qq.bind(this._onTotalProgress,this),function(n){var r=t._uploadData.retrieve({id:n});return r&&r.size||0})),this._currentItemLimit=this._options.validation.itemLimit,this._customResumeDataStore=this._createStore()},qq.FineUploaderBasic.prototype=qq.basePublicApi,qq.extend(qq.FineUploaderBasic.prototype,qq.basePrivateApi)}(),qq.AjaxRequester=function(e){var t,n,r=[],s={},i={acceptHeader:null,validMethods:["PATCH","POST","PUT"],method:"POST",contentType:"application/x-www-form-urlencoded",maxConnections:3,customHeaders:{},endpointStore:{},paramsStore:{},mandatedParams:{},allowXRequestedWithAndCacheControl:!0,successfulResponseCodes:{DELETE:[200,202,204],PATCH:[200,201,202,203,204],POST:[200,201,202,203,204],PUT:[200,201,202,203,204],GET:[200]},cors:{expected:!1,sendCredentials:!1},log:function(b,x){},onSend:function(b){},onComplete:function(b,x,w){},onProgress:null};if(qq.extend(i,e),t=i.log,qq.indexOf(i.validMethods,i.method)<0)throw new Error("'"+i.method+"' is not a supported method for this type of request!");function l(){return qq.indexOf(["GET","POST","HEAD"],i.method)>=0}function a(b){var x=!1;return qq.each(x,function(w,E){if(qq.indexOf(["Accept","Accept-Language","Content-Language","Content-Type"],E)<0)return x=!0,!1}),x}function c(b){return i.cors.expected&&b.withCredentials===void 0}function d(){var b;return(window.XMLHttpRequest||window.ActiveXObject)&&(b=qq.createXhrInstance(),b.withCredentials===void 0&&(b=new XDomainRequest,b.onload=function(){},b.onerror=function(){},b.ontimeout=function(){},b.onprogress=function(){})),b}function p(b,x){var w=s[b]&&s[b].xhr;return w||(x?w=x:i.cors.expected?w=d():w=qq.createXhrInstance(),s[b].xhr=w),w}function S(b){var x=qq.indexOf(r,b),w=i.maxConnections,E;delete s[b],r.splice(x,1),r.length>=w&&x<w&&(E=r[w-1],u(E))}function q(b,x){var w=p(b),E=i.method,F=x===!0;S(b),F?t(E+" request for "+b+" has failed","error"):!c(w)&&!y(w.status)&&(F=!0,t(E+" request for "+b+" has failed - response code "+w.status,"error")),i.onComplete(b,w,F)}function o(b){var x=s[b].additionalParams,w=i.mandatedParams,E;return i.paramsStore.get&&(E=i.paramsStore.get(b)),x&&qq.each(x,function(F,P){E=E||{},E[F]=P}),w&&qq.each(w,function(F,P){E=E||{},E[F]=P}),E}function u(b,x){var w=p(b,x),E=i.method,F=o(b),P=s[b].payload,R;return i.onSend(b),R=h(b,F,s[b].additionalQueryParams),c(w)?(w.onload=v(b),w.onerror=f(b)):w.onreadystatechange=_(b),m(b),w.open(E,R,!0),i.cors.expected&&i.cors.sendCredentials&&!c(w)&&(w.withCredentials=!0),g(b),t("Sending "+E+" request for "+b),P?w.send(P):n||!F?w.send():F&&i.contentType&&i.contentType.toLowerCase().indexOf("application/x-www-form-urlencoded")>=0?w.send(qq.obj2url(F,"")):F&&i.contentType&&i.contentType.toLowerCase().indexOf("application/json")>=0?w.send(JSON.stringify(F)):w.send(F),w}function h(b,x,w){var E=i.endpointStore.get(b),F=s[b].addToPath;return F!=null&&(E+="/"+F),n&&x&&(E=qq.obj2url(x,E)),w&&(E=qq.obj2url(w,E)),E}function _(b){return function(){p(b).readyState===4&&q(b)}}function m(b){var x=i.onProgress;x&&(p(b).upload.onprogress=function(w){w.lengthComputable&&x(b,w.loaded,w.total)})}function v(b){return function(){q(b)}}function f(b){return function(){q(b,!0)}}function g(b){var x=p(b),w=i.customHeaders,E=s[b].additionalHeaders||{},F=i.method,P={};c(x)||(i.acceptHeader&&x.setRequestHeader("Accept",i.acceptHeader),i.allowXRequestedWithAndCacheControl&&(!i.cors.expected||!l()||a())&&(x.setRequestHeader("X-Requested-With","XMLHttpRequest"),x.setRequestHeader("Cache-Control","no-cache")),i.contentType&&(F==="POST"||F==="PUT")&&x.setRequestHeader("Content-Type",i.contentType),qq.extend(P,qq.isFunction(w)?w(b):w),qq.extend(P,E),qq.each(P,function(R,I){x.setRequestHeader(R,I)}))}function y(b){return qq.indexOf(i.successfulResponseCodes[i.method],b)>=0}function C(b,x,w,E,F,P,R){s[b]={addToPath:w,additionalParams:E,additionalQueryParams:F,additionalHeaders:P,payload:R};var I=r.push(b);if(I<=i.maxConnections)return u(b,x)}n=i.method==="GET"||i.method==="DELETE",qq.extend(this,{initTransport:function(b){var x,w,E,F,P,R;return{withPath:function(I){return x=I,this},withParams:function(I){return w=I,this},withQueryParams:function(I){return R=I,this},withHeaders:function(I){return E=I,this},withPayload:function(I){return F=I,this},withCacheBuster:function(){return P=!0,this},send:function(I){return P&&qq.indexOf(["GET","DELETE"],i.method)>=0&&(w.qqtimestamp=new Date().getTime()),C(b,I,x,w,R,E,F)}}},canceled:function(b){S(b)}})},qq.UploadHandler=function(e){var t=e.proxy,n={},r=t.onCancel,s=t.getName;qq.extend(this,{add:function(i,l){n[i]=l,n[i].temp={}},cancel:function(i){var l=this,a=new qq.Promise,c=r(i,s(i),a);c.then(function(){l.isValid(i)&&(n[i].canceled=!0,l.expunge(i)),a.success()})},expunge:function(i){delete n[i]},getThirdPartyFileId:function(i){return n[i].key},isValid:function(i){return n[i]!==void 0},reset:function(){n={}},_getFileState:function(i){return n[i]},_setThirdPartyFileId:function(i,l){n[i].key=l},_wasCanceled:function(i){return!!n[i].canceled}})},qq.UploadHandlerController=function(e,t){var n=this,r=!1,s=!1,i,l,a,c={paramsStore:{},maxConnections:3,chunking:{enabled:!1,multiple:{enabled:!1}},log:function(o,u){},onProgress:function(o,u,h,_){},onComplete:function(o,u,h,_){},onCancel:function(o,u){},onUploadPrep:function(o){},onUpload:function(o,u){},onUploadChunk:function(o,u,h){},onUploadChunkSuccess:function(o,u,h,_){},onAutoRetry:function(o,u,h,_){},onResume:function(o,u,h,_){},onUuidChanged:function(o,u){},getName:function(o){},setSize:function(o,u){},isQueued:function(o){},getIdsInProxyGroup:function(o){},getIdsInBatch:function(o){},isInProgress:function(o){}},d={done:function(o,u,h,_){var m=a._getChunkData(o,u);a._getFileState(o).attemptingResume=!1,delete a._getFileState(o).temp.chunkProgress[u],a._getFileState(o).loaded+=m.size,c.onUploadChunkSuccess(o,a._getChunkDataForCallback(m),h,_)},finalize:function(o){var u=c.getSize(o),h=c.getName(o);l("All chunks have been uploaded for "+o+" - finalizing...."),a.finalizeChunks(o).then(function(_,m){l("Finalize successful for "+o);var v=q.normalizeResponse(_,!0);c.onProgress(o,h,u,u),a._maybeDeletePersistedChunkData(o),q.cleanup(o,v,m)},function(_,m){var v=q.normalizeResponse(_,!1);l("Problem finalizing chunks for file ID "+o+" - "+v.error,"error"),(v.reset||m&&c.chunking.success.resetOnStatus.indexOf(m.status)>=0)&&d.reset(o),c.onAutoRetry(o,h,v,m)||q.cleanup(o,v,m)})},handleFailure:function(o,u,h,_){var m=c.getName(u);l("Chunked upload request failed for "+u+", chunk "+o),a.clearCachedChunk(u,o);var v=q.normalizeResponse(h,!1),f;if(v.reset)d.reset(u);else{var g=a._getFileState(u).chunking.inProgress;f=g?qq.indexOf(g,o):-1,f>=0&&(a._getFileState(u).chunking.inProgress.splice(f,1),a._getFileState(u).chunking.remaining.unshift(o))}a._getFileState(u).temp.ignoreFailure||(s&&(a._getFileState(u).temp.ignoreFailure=!0,l(qq.format("Going to attempt to abort these chunks: {}. These are currently in-progress: {}.",JSON.stringify(Object.keys(a._getXhrs(u))),JSON.stringify(a._getFileState(u).chunking.inProgress))),qq.each(a._getXhrs(u),function(y,C){l(qq.format("Attempting to abort file {}.{}. XHR readyState {}. ",u,y,C.readyState)),C.abort(),C._cancelled=!0}),a.moveInProgressToRemaining(u),p.free(u,!0)),c.onAutoRetry(u,m,v,_)||q.cleanup(u,v,_))},hasMoreParts:function(o){return!!a._getFileState(o).chunking.remaining.length},nextPart:function(o){var u=a._getFileState(o).chunking.remaining.shift();return u>=a._getTotalChunks(o)&&(u=null),u},reset:function(o){l("Server or callback has ordered chunking effort to be restarted on next attempt for item ID "+o,"error"),a._maybeDeletePersistedChunkData(o),a.reevaluateChunking(o),a._getFileState(o).loaded=0,a._getFileState(o).attemptingResume=!1},sendNext:function(o){var u=c.getSize(o),h=c.getName(o),_=d.nextPart(o),m=a._getChunkData(o,_),v=a._getFileState(o),f=v.attemptingResume,g=v.chunking.inProgress||[];if(v.loaded==null&&(v.loaded=0),f&&c.onResume(o,h,m,v.customResumeData)===!1&&(d.reset(o),_=d.nextPart(o),m=a._getChunkData(o,_),f=!1),_==null&&g.length===0)d.finalize(o);else{g.push(_),a._getFileState(o).chunking.inProgress=g,s&&p.open(o,_),s&&p.available()&&a._getFileState(o).chunking.remaining.length&&d.sendNext(o),m.blob.size===0&&(l(qq.format("Chunk {} for file {} will not be uploaded, zero sized chunk.",_,o),"error"),d.handleFailure(_,o,"File is no longer available",null));var y=c.onUploadChunk(o,h,a._getChunkDataForCallback(m));y.then(function(C){if(!c.isInProgress(o))l(qq.format("Not sending chunked upload request for item {}.{} - no longer in progress.",o,_));else{l(qq.format("Sending chunked upload request for item {}.{}, bytes {}-{} of {}.",o,_,m.start+1,m.end,u));var b={chunkIdx:_,id:o,overrides:C,resuming:f};a.uploadChunk(b).then(function(w,E){l("Chunked upload request succeeded for "+o+", chunk "+_),a.clearCachedChunk(o,_);var F=a._getFileState(o).chunking.inProgress||[],P=q.normalizeResponse(w,!0),R=qq.indexOf(F,_);l(qq.format("Chunk {} for file {} uploaded successfully.",_,o)),d.done(o,_,P,E),R>=0&&F.splice(R,1),a._maybePersistChunkedState(o),!d.hasMoreParts(o)&&F.length===0?d.finalize(o):d.hasMoreParts(o)?d.sendNext(o):l(qq.format("File ID {} has no more chunks to send and these chunk indexes are still marked as in-progress: {}",o,JSON.stringify(F)))},function(w,E){d.handleFailure(_,o,w,E)}).done(function(){a.clearXhr(o,_)})}},function(C){d.handleFailure(_,o,C,null)})}}},p={_open:[],_openChunks:{},_waiting:[],available:function(){var o=c.maxConnections,u=0,h=0;return qq.each(p._openChunks,function(_,m){u++,h+=m.length}),o-(p._open.length-u+h)},free:function(o,u){var h=!u,_=qq.indexOf(p._waiting,o),m=qq.indexOf(p._open,o),v;delete p._openChunks[o],q.getProxyOrBlob(o)instanceof qq.BlobProxy&&(l("Generated blob upload has ended for "+o+", disposing generated blob."),delete a._getFileState(o).file),_>=0?p._waiting.splice(_,1):h&&m>=0&&(p._open.splice(m,1),v=p._waiting.shift(),v>=0&&(p._open.push(v),q.start(v)))},getWaitingOrConnected:function(){var o=[];return qq.each(p._openChunks,function(u,h){h&&h.length&&o.push(parseInt(u))}),qq.each(p._open,function(u,h){p._openChunks[h]||o.push(parseInt(h))}),o=o.concat(p._waiting),o},isUsingConnection:function(o){return qq.indexOf(p._open,o)>=0},open:function(o,u){return u==null&&p._waiting.push(o),p.available()?(u==null?(p._waiting.pop(),p._open.push(o)):function(){var h=p._openChunks[o]||[];h.push(u),p._openChunks[o]=h}(),!0):!1},reset:function(){p._waiting=[],p._open=[]}},S={send:function(o,u){var h=a._getFileState(o);if(!h){l("Ignoring send request as this upload may have been cancelled, File ID "+o,"warn");return}h.loaded=0,l("Sending simple upload request for "+o),a.uploadFile(o).then(function(_,m){l("Simple upload request succeeded for "+o);var v=q.normalizeResponse(_,!0),f=c.getSize(o);c.onProgress(o,u,f,f),q.maybeNewUuid(o,v),q.cleanup(o,v,m)},function(_,m){l("Simple upload request failed for "+o);var v=q.normalizeResponse(_,!1);c.onAutoRetry(o,u,v,m)||q.cleanup(o,v,m)})}},q={cancel:function(o){l("Cancelling "+o),c.paramsStore.remove(o),p.free(o)},cleanup:function(o,u,h){var _=c.getName(o);c.onComplete(o,_,u,h),a._getFileState(o)&&a._clearXhrs&&a._clearXhrs(o),p.free(o)},getProxyOrBlob:function(o){return a.getProxy&&a.getProxy(o)||a.getFile&&a.getFile(o)},initHandler:function(){var o=t?qq[t]:qq.traditional,u=qq.supportedFeatures.ajaxUploading?"Xhr":"Form";a=new o[u+"UploadHandler"](c,{getCustomResumeData:c.getCustomResumeData,getDataByUuid:c.getDataByUuid,getName:c.getName,getSize:c.getSize,getUuid:c.getUuid,log:l,onCancel:c.onCancel,onProgress:c.onProgress,onUuidChanged:c.onUuidChanged,onFinalizing:function(h){c.setStatus(h,qq.status.UPLOAD_FINALIZING)}}),a._removeExpiredChunkingRecords&&a._removeExpiredChunkingRecords()},isDeferredEligibleForUpload:function(o){return c.isQueued(o)},maybeDefer:function(o,u){if(u&&!a.getFile(o)&&u instanceof qq.BlobProxy)c.onUploadPrep(o),l("Attempting to generate a blob on-demand for "+o),u.create().then(function(h){l("Generated an on-demand blob for "+o),a.updateBlob(o,h),c.setSize(o,h.size),a.reevaluateChunking(o),q.maybeSendDeferredFiles(o)},function(h){var _={};h&&(_.error=h),l(qq.format("Failed to generate blob for ID {}.  Error message: {}.",o,h),"error"),c.onComplete(o,c.getName(o),qq.extend(_,i),null),q.maybeSendDeferredFiles(o),p.free(o)});else return q.maybeSendDeferredFiles(o);return!1},maybeSendDeferredFiles:function(o){var u=c.getIdsInProxyGroup(o),h=!1;return u&&u.length?(l("Maybe ready to upload proxy group file "+o),qq.each(u,function(_,m){if(q.isDeferredEligibleForUpload(m)&&a.getFile(m))h=m===o,q.now(m);else if(q.isDeferredEligibleForUpload(m))return!1})):(h=!0,q.now(o)),h},maybeNewUuid:function(o,u){u.newUuid!==void 0&&c.onUuidChanged(o,u.newUuid)},normalizeResponse:function(o,u){var h=o;return qq.isObject(o)||(h={},qq.isString(o)&&!u&&(h.error=o)),h.success=u,h},now:function(o){var u=c.getName(o);if(!n.isValid(o))throw new qq.Error(o+" is not a valid file ID to upload!");c.onUpload(o,u).then(function(h){h&&h.pause?(c.setStatus(o,qq.status.PAUSED),a.pause(o),p.free(o)):r&&a._shouldChunkThisFile(o)?d.sendNext(o):S.send(o,u)},function(h){if(h=h||{},l(o+" upload start aborted due to rejected onUpload Promise - details: "+h,"error"),!c.onAutoRetry(o,u,h.responseJSON||{})){var _=q.normalizeResponse(h.responseJSON,!1);q.cleanup(o,_)}})},start:function(o){var u=q.getProxyOrBlob(o);return u?q.maybeDefer(o,u):(q.now(o),!0)}};qq.extend(this,{add:function(o,u){a.add.apply(this,arguments)},upload:function(o){return p.open(o)?q.start(o):!1},retry:function(o){return s&&(a._getFileState(o).temp.ignoreFailure=!1),p.isUsingConnection(o)?q.start(o):n.upload(o)},cancel:function(o){var u=a.cancel(o);qq.isGenericPromise(u)?u.then(function(){q.cancel(o)}):u!==!1&&q.cancel(o)},cancelAll:function(){var o=p.getWaitingOrConnected(),u;if(o.length)for(u=o.length-1;u>=0;u--)n.cancel(o[u]);p.reset()},getFile:function(o){return a.getProxy&&a.getProxy(o)?a.getProxy(o).referenceBlob:a.getFile&&a.getFile(o)},isProxied:function(o){return!!(a.getProxy&&a.getProxy(o))},getInput:function(o){if(a.getInput)return a.getInput(o)},reset:function(){l("Resetting upload handler"),n.cancelAll(),p.reset(),a.reset()},expunge:function(o){if(n.isValid(o))return a.expunge(o)},isValid:function(o){return a.isValid(o)},hasResumeRecord:function(o){var u=a.isValid(o)&&a._getLocalStorageId&&a._getLocalStorageId(o);return u?!!localStorage.getItem(u):!1},getResumableFilesData:function(){return a.getResumableFilesData?a.getResumableFilesData():[]},getThirdPartyFileId:function(o){if(n.isValid(o))return a.getThirdPartyFileId(o)},pause:function(o){return n.isResumable(o)&&a.pause&&n.isValid(o)&&a.pause(o)?(p.free(o),a.moveInProgressToRemaining(o),!0):!1},isAttemptingResume:function(o){return!!a.isAttemptingResume&&a.isAttemptingResume(o)},isResumable:function(o){return!!a.isResumable&&a.isResumable(o)}}),qq.extend(c,e),l=c.log,r=c.chunking.enabled&&qq.supportedFeatures.chunking,s=r&&c.chunking.concurrent.enabled,i=function(){var o={};return o[c.preventRetryParam]=!0,o}(),q.initHandler()},qq.WindowReceiveMessage=function(e){var t={log:function(r,s){}},n={};qq.extend(t,e),qq.extend(this,{receiveMessage:function(r,s){var i=function(l){s(l.data)};window.postMessage?n[r]=qq(window).attach("message",i):log("iframe message passing not supported in this browser!","error")},stopReceivingMessages:function(r){if(window.postMessage){var s=n[r];s&&s()}}})},qq.FormUploadHandler=function(e){var t=e.options,n=this,r=e.proxy,s=qq.getUniqueId(),i={},l={},a={},c=t.isCors,d=t.inputName,p=r.getUuid,S=r.log,q=new qq.WindowReceiveMessage({log:S});function o(m){delete l[m],c&&(clearTimeout(a[m]),delete a[m],q.stopReceivingMessages(m));var v=document.getElementById(n._getIframeName(m));v&&(v.setAttribute("src","javascript:false;"),qq(v).remove())}function u(m){return m.split("_")[0]}function h(m){var v=qq.toElement("<iframe src='javascript:false;' name='"+m+"' />");return v.setAttribute("id",m),v.style.display="none",document.body.appendChild(v),v}function _(m,v){var f=m.id,g=u(f),y=p(g);i[y]=v,l[g]=qq(m).attach("load",function(){n.getInput(g)&&(S("Received iframe load event for CORS upload request (iframe name "+f+")"),a[f]=setTimeout(function(){var C="No valid message received from loaded iframe for iframe name "+f;S(C,"error"),v({error:C})},1e3))}),q.receiveMessage(f,function(C){S("Received the following window message: '"+C+"'"),u(f);var b=n._parseJsonResponse(C),x=b.uuid,w;x&&i[x]?(S("Handling response for iframe name "+f),clearTimeout(a[f]),delete a[f],n._detachLoadEvent(f),w=i[x],delete i[x],q.stopReceivingMessages(f),w(b)):x||S("'"+C+"' does not contain a UUID - ignoring.")})}qq.extend(this,new qq.UploadHandler(e)),qq.override(this,function(m){return{add:function(v,f){m.add(v,{input:f}),f.setAttribute("name",d),f.parentNode&&qq(f).remove()},expunge:function(v){o(v),m.expunge(v)},isValid:function(v){return m.isValid(v)&&n._getFileState(v).input!==void 0}}}),qq.extend(this,{getInput:function(m){return n._getFileState(m).input},_attachLoadEvent:function(m,v){var f;c?_(m,v):l[m.id]=qq(m).attach("load",function(){if(S("Received response for "+m.id),!!m.parentNode){try{if(m.contentDocument&&m.contentDocument.body&&m.contentDocument.body.innerHTML=="false")return}catch(g){S("Error when attempting to access iframe during handling of upload response ("+g.message+")","error"),f={success:!1}}v(f)}})},_createIframe:function(m){var v=n._getIframeName(m);return h(v)},_detachLoadEvent:function(m){l[m]!==void 0&&(l[m](),delete l[m])},_getIframeName:function(m){return m+"_"+s},_initFormForUpload:function(m){var v=m.method,f=m.endpoint,g=m.params,y=m.paramsInBody,C=m.targetName,b=qq.toElement("<form method='"+v+"' enctype='multipart/form-data'></form>"),x=f;return y?qq.obj2Inputs(g,b):x=qq.obj2url(g,f),b.setAttribute("action",x),b.setAttribute("target",C),b.style.display="none",document.body.appendChild(b),b},_parseJsonResponse:function(m){var v={};try{v=qq.parseJson(m)}catch(f){S("Error when attempting to parse iframe upload response ("+f.message+")","error")}return v}})},qq.XhrUploadHandler=function(e){var t=this,n=e.options.namespace,r=e.proxy,s=e.options.chunking,i=function(f){var g=t._getFileState(f);if(g.chunkSize)return g.chunkSize;var y=s.partSize;return qq.isFunction(y)&&(y=y(f,p(f))),g.chunkSize=y,y},l=e.options.resume,a=s&&e.options.chunking.enabled&&qq.supportedFeatures.chunking,c=l&&e.options.resume.enabled&&a&&qq.supportedFeatures.resume,d=r.getName,p=r.getSize,S=r.getUuid,q=r.getEndpoint,o=r.getDataByUuid,u=r.onUuidChanged,h=r.onProgress,_=r.log,m=r.getCustomResumeData;function v(f){qq.each(t._getXhrs(f),function(g,y){var C=t._getAjaxRequester(f,g);y.onreadystatechange=null,y.upload.onprogress=null,y.abort(),C&&C.canceled&&C.canceled(f)})}qq.extend(this,new qq.UploadHandler(e)),qq.override(this,function(f){return{add:function(g,y){if(qq.isFile(y)||qq.isBlob(y))f.add(g,{file:y});else if(y instanceof qq.BlobProxy)f.add(g,{proxy:y});else throw new Error("Passed obj is not a File, Blob, or proxy");t._initTempState(g),c&&t._maybePrepareForResume(g)},expunge:function(g){v(g),t._maybeDeletePersistedChunkData(g),t._clearXhrs(g),f.expunge(g)}}}),qq.extend(this,{clearCachedChunk:function(f,g){var y=t._getFileState(f);y&&delete y.temp.cachedChunks[g]},clearXhr:function(f,g){var y=t._getFileState(f).temp;y.xhrs&&delete y.xhrs[g],y.ajaxRequesters&&delete y.ajaxRequesters[g]},finalizeChunks:function(f,g){var y=t._getTotalChunks(f)-1,C=t._getXhr(f,y);return g?new qq.Promise().success(g(C),C):new qq.Promise().success({},C)},getFile:function(f){return t.isValid(f)&&t._getFileState(f).file},getProxy:function(f){return t.isValid(f)&&t._getFileState(f).proxy},getResumableFilesData:function(){var f=[];return t._iterateResumeRecords(function(g,y){t.moveInProgressToRemaining(null,y.chunking.inProgress,y.chunking.remaining);var C={name:y.name,remaining:y.chunking.remaining,size:y.size,uuid:y.uuid};y.key&&(C.key=y.key),y.customResumeData&&(C.customResumeData=y.customResumeData),f.push(C)}),f},isAttemptingResume:function(f){return t._getFileState(f).attemptingResume},isResumable:function(f){return!!s&&t.isValid(f)&&!t._getFileState(f).notResumable},moveInProgressToRemaining:function(f,g,y){var C=t._getFileState(f)||{},b=C.chunking||{},x=g||b.inProgress,w=y||b.remaining;x&&(_(qq.format("Moving these chunks from in-progress {}, to remaining.",JSON.stringify(x))),x.reverse(),qq.each(x,function(E,F){w.unshift(F)}),x.length=0)},pause:function(f){if(t.isValid(f))return _(qq.format("Aborting XHR upload for {} '{}' due to pause instruction.",f,d(f))),t._getFileState(f).paused=!0,v(f),!0},reevaluateChunking:function(f){if(s&&t.isValid(f)){var g=t._getFileState(f),y,C;if(delete g.chunking,g.chunking={},y=t._getTotalChunks(f),y>1||s.mandatory){for(g.chunking.enabled=!0,g.chunking.parts=y,g.chunking.remaining=[],C=0;C<y;C++)g.chunking.remaining.push(C);t._initTempState(f)}else g.chunking.enabled=!1}},updateBlob:function(f,g){t.isValid(f)&&(t._getFileState(f).file=g)},_clearXhrs:function(f){var g=t._getFileState(f).temp;qq.each(g.ajaxRequesters,function(y){delete g.ajaxRequesters[y]}),qq.each(g.xhrs,function(y){delete g.xhrs[y]})},_createXhr:function(f,g){return t._registerXhr(f,g,qq.createXhrInstance())},_getAjaxRequester:function(f,g){var y=g??-1;return t._getFileState(f).temp.ajaxRequesters[y]},_getChunkData:function(f,g){var y=i(f),C=p(f),b=t.getFile(f),x=y*g,w=x+y>=C?C:x+y,E=t._getTotalChunks(f),F=this._getFileState(f).temp.cachedChunks,P=F[g]||qq.sliceBlob(b,x,w);return F[g]=P,{part:g,start:x,end:w,count:E,blob:P,size:w-x}},_getChunkDataForCallback:function(f){return{partIndex:f.part,startByte:f.start+1,endByte:f.end,totalParts:f.count}},_getLocalStorageId:function(f){var g="5.0",y=d(f),C=p(f),b=i(f),x=q(f),w=l.customKeys(f),E=qq.format("qq{}resume{}-{}-{}-{}-{}",n,g,y,C,b,x);return w.forEach(function(F){E+="-"+F}),E},_getMimeType:function(f){return t.getFile(f).type},_getPersistableData:function(f){return t._getFileState(f).chunking},_getTotalChunks:function(f){if(s){var g=p(f),y=i(f);return Math.ceil(g/y)}},_getXhr:function(f,g){var y=g??-1;return t._getFileState(f).temp.xhrs[y]},_getXhrs:function(f){return t._getFileState(f).temp.xhrs},_iterateResumeRecords:function(f){c&&qq.each(localStorage,function(g,y){if(g.indexOf(qq.format("qq{}resume",n))===0){var C=JSON.parse(y);f(g,C)}})},_initTempState:function(f){t._getFileState(f).temp={ajaxRequesters:{},chunkProgress:{},xhrs:{},cachedChunks:{}}},_markNotResumable:function(f){t._getFileState(f).notResumable=!0},_maybeDeletePersistedChunkData:function(f){var g;return c&&t.isResumable(f)&&(g=t._getLocalStorageId(f),g&&localStorage.getItem(g))?(localStorage.removeItem(g),!0):!1},_maybePrepareForResume:function(f){var g=t._getFileState(f),y,C;c&&g.key===void 0&&(y=t._getLocalStorageId(f),C=localStorage.getItem(y),C&&(C=JSON.parse(C),o(C.uuid)?t._markNotResumable(f):(_(qq.format("Identified file with ID {} and name of {} as resumable.",f,d(f))),u(f,C.uuid),g.key=C.key,g.chunking=C.chunking,g.loaded=C.loaded,g.customResumeData=C.customResumeData,g.attemptingResume=!0,t.moveInProgressToRemaining(f))))},_maybePersistChunkedState:function(f){var g=t._getFileState(f),y,C;if(c&&t.isResumable(f)){var b=m(f);y=t._getLocalStorageId(f),C={name:d(f),size:p(f),uuid:S(f),key:g.key,chunking:g.chunking,loaded:g.loaded,lastUpdated:Date.now()},b&&(C.customResumeData=b);try{localStorage.setItem(y,JSON.stringify(C))}catch(x){_(qq.format("Unable to save resume data for '{}' due to error: '{}'.",f,x.toString()),"warn")}}},_registerProgressHandler:function(f,g,y){var C=t._getXhr(f,g),b=d(f),x={simple:function(w,E){var F=p(f);w===E?h(f,b,F,F):h(f,b,w>=F?F-1:w,F)},chunked:function(w,E){var F=t._getFileState(f).temp.chunkProgress,P=t._getFileState(f).loaded,R=w,I=E,A=p(f),D=R-(I-y),U=P;F[g]=D,qq.each(F,function(T,k){U+=k}),h(f,b,U,A)}};C.upload.onprogress=function(w){if(w.lengthComputable){var E=y==null?"simple":"chunked";x[E](w.loaded,w.total)}}},_registerXhr:function(f,g,y,C){var b=g??-1,x=t._getFileState(f).temp;return x.xhrs=x.xhrs||{},x.ajaxRequesters=x.ajaxRequesters||{},x.xhrs[b]=y,C&&(x.ajaxRequesters[b]=C),y},_removeExpiredChunkingRecords:function(){var f=l.recordsExpireIn;t._iterateResumeRecords(function(g,y){var C=new Date(y.lastUpdated);C.setDate(C.getDate()+f),C.getTime()<=Date.now()&&(_("Removing expired resume record with key "+g),localStorage.removeItem(g))})},_shouldChunkThisFile:function(f){var g=t._getFileState(f);if(g)return g.chunking||t.reevaluateChunking(f),g.chunking.enabled}})},qq.DeleteFileAjaxRequester=function(e){var t,n={method:"DELETE",uuidParamName:"qquuid",endpointStore:{},maxConnections:3,customHeaders:function(s){return{}},paramsStore:{},cors:{expected:!1,sendCredentials:!1},log:function(s,i){},onDelete:function(s){},onDeleteComplete:function(s,i,l){}};qq.extend(n,e);function r(){return n.method.toUpperCase()==="POST"?{_method:"DELETE"}:{}}t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:["POST","DELETE"],method:n.method,endpointStore:n.endpointStore,paramsStore:n.paramsStore,mandatedParams:r(),maxConnections:n.maxConnections,customHeaders:function(s){return n.customHeaders.get(s)},log:n.log,onSend:n.onDelete,onComplete:n.onDeleteComplete,cors:n.cors})),qq.extend(this,{sendDelete:function(s,i,l){var a=l||{};n.log("Submitting delete file request for "+s),n.method==="DELETE"?t.initTransport(s).withPath(i).withParams(a).send():(a[n.uuidParamName]=i,t.initTransport(s).withParams(a).send())}})},function(){function e(c){var d=c.naturalWidth,p=c.naturalHeight,S=document.createElement("canvas"),q;return d*p>1024*1024?(S.width=S.height=1,q=S.getContext("2d"),q.drawImage(c,-d+1,0),q.getImageData(0,0,1,1).data[3]===0):!1}function t(c,d,p){var S=document.createElement("canvas"),q=0,o=p,u=p,h,_,m,v;for(S.width=1,S.height=p,h=S.getContext("2d"),h.drawImage(c,0,0),_=h.getImageData(0,0,1,p).data;u>q;)m=_[(u-1)*4+3],m===0?o=u:q=u,u=o+q>>1;return v=u/p,v===0?1:v}function n(c,d,p,S){var q=document.createElement("canvas"),o=p.mime||"image/jpeg",u=new qq.Promise;return s(c,d,q,p,S).then(function(){u.success(q.toDataURL(o,p.quality||.8))}),u}function r(c){var d=5241e3;if(!qq.ios())throw new qq.Error("Downsampled dimensions can only be reliably calculated for iOS!");if(c.origHeight*c.origWidth>d)return{newHeight:Math.round(Math.sqrt(d*(c.origHeight/c.origWidth))),newWidth:Math.round(Math.sqrt(d*(c.origWidth/c.origHeight)))}}function s(c,d,p,S,q){var o=c.naturalWidth,u=c.naturalHeight,h=S.width,_=S.height,m=p.getContext("2d"),v=new qq.Promise,f;return m.save(),S.resize?i({blob:d,canvas:p,image:c,imageHeight:u,imageWidth:o,orientation:S.orientation,resize:S.resize,targetHeight:_,targetWidth:h}):(qq.supportedFeatures.unlimitedScaledImageSize||(f=r({origWidth:h,origHeight:_}),f&&(qq.log(qq.format("Had to reduce dimensions due to device limitations from {}w / {}h to {}w / {}h",h,_,f.newWidth,f.newHeight),"warn"),h=f.newWidth,_=f.newHeight)),l(p,h,_,S.orientation),qq.ios()?function(){e(c)&&(o/=2,u/=2);var g=1024,y=document.createElement("canvas"),C=q?t(c,o,u):1,b=Math.ceil(g*h/o),x=Math.ceil(g*_/u/C),w=0,E=0,F,P,R;for(y.width=y.height=g,F=y.getContext("2d");w<u;){for(P=0,R=0;P<o;)F.clearRect(0,0,g,g),F.drawImage(c,-P,-w),m.drawImage(y,0,0,g,g,R,E,b,x),P+=g,R+=b;w+=g,E+=x}m.restore(),y=F=null}():m.drawImage(c,0,0,h,_),p.qqImageRendered&&p.qqImageRendered(),v.success(),v)}function i(c){var d=c.blob,p=c.image,S=c.imageHeight,q=c.imageWidth,o=c.orientation,u=new qq.Promise,h=c.resize,_=document.createElement("canvas"),m=_.getContext("2d"),v=c.canvas,f=c.targetHeight,g=c.targetWidth;return l(_,q,S,o),v.height=f,v.width=g,m.drawImage(p,0,0),h({blob:d,height:f,image:p,sourceCanvas:_,targetCanvas:v,width:g}).then(function(){v.qqImageRendered&&v.qqImageRendered(),u.success()},u.failure),u}function l(c,d,p,S){switch(S){case 5:case 6:case 7:case 8:c.width=p,c.height=d;break;default:c.width=d,c.height=p}var q=c.getContext("2d");switch(S){case 2:q.translate(d,0),q.scale(-1,1);break;case 3:q.translate(d,p),q.rotate(Math.PI);break;case 4:q.translate(0,p),q.scale(1,-1);break;case 5:q.rotate(.5*Math.PI),q.scale(1,-1);break;case 6:q.rotate(.5*Math.PI),q.translate(0,-p);break;case 7:q.rotate(.5*Math.PI),q.translate(d,-p),q.scale(-1,1);break;case 8:q.rotate(-.5*Math.PI),q.translate(-d,0);break}}function a(c,d){var p=this;window.Blob&&c instanceof Blob&&function(){var S=new Image,q=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;if(!q)throw Error("No createObjectURL function found to create blob url");S.src=q.createObjectURL(c),p.blob=c,c=S}(),!c.naturalWidth&&!c.naturalHeight&&(c.onload=function(){var S=p.imageLoadListeners;S&&(p.imageLoadListeners=null,setTimeout(function(){for(var q=0,o=S.length;q<o;q++)S[q]()},0))},c.onerror=d,this.imageLoadListeners=[]),this.srcImage=c}a.prototype.render=function(c,d){d=d||{};var p=this,S=this.srcImage.naturalWidth,q=this.srcImage.naturalHeight,o=d.width,u=d.height,h=d.maxWidth,_=d.maxHeight,m=!this.blob||this.blob.type==="image/jpeg",v=c.tagName.toLowerCase(),f;if(this.imageLoadListeners){this.imageLoadListeners.push(function(){p.render(c,d)});return}o&&!u?u=q*o/S<<0:u&&!o?o=S*u/q<<0:(o=S,u=q),h&&o>h&&(o=h,u=q*o/S<<0),_&&u>_&&(u=_,o=S*u/q<<0),f={width:o,height:u},qq.each(d,function(g,y){f[g]=y}),v==="img"?function(){var g=c.src;n(p.srcImage,p.blob,f,m).then(function(y){c.src=y,g===c.src&&c.onload()})}():v==="canvas"&&s(this.srcImage,this.blob,c,f,m),typeof this.onrender=="function"&&this.onrender(c)},qq.MegaPixImage=a}(),qq.ImageGenerator=function(e){function t(u){return u.tagName.toLowerCase()==="img"}function n(u){return u.tagName.toLowerCase()==="canvas"}function r(){return new Image().crossOrigin!==void 0}function s(){var u=document.createElement("canvas");return u.getContext&&u.getContext("2d")}function i(u){var h=u.split("/"),_=h[h.length-1].split("?")[0],m=qq.getExtension(_);switch(m=m&&m.toLowerCase(),m){case"jpeg":case"jpg":return"image/jpeg";case"png":return"image/png";case"bmp":return"image/bmp";case"gif":return"image/gif";case"tiff":case"tif":return"image/tiff"}}function l(u){var h=document.createElement("a"),_,m,v;return h.href=u,_=h.protocol,v=h.port,m=h.hostname,_.toLowerCase()!==window.location.protocol.toLowerCase()||m.toLowerCase()!==window.location.hostname.toLowerCase()||v!==window.location.port&&!qq.ie()}function a(u,h){u.onload=function(){u.onload=null,u.onerror=null,h.success(u)},u.onerror=function(){u.onload=null,u.onerror=null,e("Problem drawing thumbnail!","error"),h.failure(u,"Problem drawing thumbnail!")}}function c(u,h){u.qqImageRendered=function(){h.success(u)}}function d(u,h){var _=t(u)||n(u);return t(u)?a(u,h):n(u)?c(u,h):(h.failure(u),e(qq.format("Element container of type {} is not supported!",u.tagName),"error")),_}function p(u,h,_){var m=new qq.Promise,v=new qq.Identify(u,e),f=_.maxSize,g=_.orient==null?!0:_.orient,y=function(){h.onerror=null,h.onload=null,e("Could not render preview, file may be too large!","error"),m.failure(h,"Browser cannot render image!")};return v.isPreviewable().then(function(C){var b={parse:function(){return new qq.Promise().success()}},x=g?new qq.Exif(u,e):b,w=new qq.MegaPixImage(u,y);d(h,m)&&x.parse().then(function(E){var F=E&&E.Orientation;w.render(h,{maxWidth:f,maxHeight:f,orientation:F,mime:C,resize:_.customResizeFunction})},function(E){e(qq.format("EXIF data could not be parsed ({}).  Assuming orientation = 1.",E)),w.render(h,{maxWidth:f,maxHeight:f,mime:C,resize:_.customResizeFunction})})},function(){e("Not previewable"),m.failure(h,"Not previewable")}),m}function S(u,h,_,m,v){var f=new Image,g=new qq.Promise;d(f,g),l(u)&&(f.crossOrigin="anonymous"),f.src=u,g.then(function(){d(h,_);var C=new qq.MegaPixImage(f);C.render(h,{maxWidth:m,maxHeight:m,mime:i(u),resize:v})},_.failure)}function q(u,h,_,m){d(h,_),qq(h).css({maxWidth:m+"px",maxHeight:m+"px"}),h.src=u}function o(u,h,_){var m=new qq.Promise,v=_.scale,f=v?_.maxSize:null;return v&&t(h)?s()?l(u)&&!r()?q(u,h,m,f):S(u,h,m,f):q(u,h,m,f):n(h)?S(u,h,m,f):d(h,m)&&(h.src=u),m}qq.extend(this,{generate:function(u,h,_){return qq.isString(u)?(e("Attempting to update thumbnail based on server response."),o(u,h,_||{})):(e("Attempting to draw client-side image preview."),p(u,h,_||{}))}}),this._testing={},this._testing.isImg=t,this._testing.isCanvas=n,this._testing.isCrossOrigin=l,this._testing.determineMimeOfFileName=i},qq.Exif=function(e,t){var n=[274],r={274:{name:"Orientation",bytes:2}};function s(q){for(var o=0,u=0;q.length>0;)o+=parseInt(q.substring(0,2),16)*Math.pow(2,u),q=q.substring(2,q.length),u+=8;return o}function i(q,o){var u=q,h=o;return u===void 0&&(u=2,h=new qq.Promise),qq.readBlobToHex(e,u,4).then(function(_){var m=/^ffe([0-9])/.exec(_),v;m?m[1]!=="1"?(v=parseInt(_.slice(4,8),16),i(u+v+2,h)):h.success(u):h.failure("No EXIF header to be found!")}),h}function l(){var q=new qq.Promise;return qq.readBlobToHex(e,0,6).then(function(o){o.indexOf("ffd8")!==0?q.failure("Not a valid JPEG!"):i().then(function(u){q.success(u)},function(u){q.failure(u)})}),q}function a(q){var o=new qq.Promise;return qq.readBlobToHex(e,q+10,2).then(function(u){o.success(u==="4949")}),o}function c(q,o){var u=new qq.Promise;return qq.readBlobToHex(e,q+18,2).then(function(h){if(o)return u.success(s(h));u.success(parseInt(h,16))}),u}function d(q,o){var u=q+20,h=o*12;return qq.readBlobToHex(e,u,h)}function p(q){for(var o=[],u=0;u+24<=q.length;)o.push(q.slice(u,u+24)),u+=24;return o}function S(q,o){var u=16,h=qq.extend([],n),_={};return qq.each(o,function(m,v){var f=v.slice(0,4),g=q?s(f):parseInt(f,16),y=h.indexOf(g),C,b,x;if(y>=0&&(b=r[g].name,x=r[g].bytes,C=v.slice(u,u+x*2),_[b]=q?s(C):parseInt(C,16),h.splice(y,1)),h.length===0)return!1}),_}qq.extend(this,{parse:function(){var q=new qq.Promise,o=function(u){t(qq.format("EXIF header parse failed: '{}' ",u)),q.failure(u)};return l().then(function(u){t(qq.format("Moving forward with EXIF header parsing for '{}'",e.name===void 0?"blob":e.name)),a(u).then(function(h){t(qq.format("EXIF Byte order is {} endian",h?"little":"big")),c(u,h).then(function(_){t(qq.format("Found {} APP1 directory entries",_)),d(u,_).then(function(m){var v=p(m),f=S(h,v);t("Successfully parsed some EXIF tags"),q.success(f)},o)},o)},o)},o),q}}),this._testing={},this._testing.parseLittleEndian=s},qq.Identify=function(e,t){function n(r,s){var i=!1,l=[].concat(r);return qq.each(l,function(a,c){if(s.indexOf(c)===0)return i=!0,!1}),i}qq.extend(this,{isPreviewable:function(){var r=this,s=new qq.Promise,i=!1,l=e.name===void 0?"blob":e.name;return t(qq.format("Attempting to determine if {} can be rendered in this browser",l)),t("First pass: check type attribute of blob object."),this.isPreviewableSync()?(t("Second pass: check for magic bytes in file header."),qq.readBlobToHex(e,0,4).then(function(a){qq.each(r.PREVIEWABLE_MIME_TYPES,function(c,d){if(n(d,a))return(c!=="image/tiff"||qq.supportedFeatures.tiffPreviews)&&(i=!0,s.success(c)),!1}),t(qq.format("'{}' is {} able to be rendered in this browser",l,i?"":"NOT")),i||s.failure()},function(){t("Error reading file w/ name '"+l+"'.  Not able to be rendered in this browser."),s.failure()})):s.failure(),s},isPreviewableSync:function(){var r=e.type,s=qq.indexOf(Object.keys(this.PREVIEWABLE_MIME_TYPES),r)>=0,i=!1,l=e.name===void 0?"blob":e.name;return s&&(r==="image/tiff"?i=qq.supportedFeatures.tiffPreviews:i=!0),!i&&t(l+" is not previewable in this browser per the blob's type attr"),i}})},qq.Identify.prototype.PREVIEWABLE_MIME_TYPES={"image/jpeg":"ffd8ff","image/gif":"474946","image/png":"89504e","image/bmp":"424d","image/tiff":["49492a00","4d4d002a"]},qq.ImageValidation=function(e,t){function n(i){var l=!1;return qq.each(i,function(a,c){if(c>0)return l=!0,!1}),l}function r(){var i=new qq.Promise;return new qq.Identify(e,t).isPreviewable().then(function(){var l=new Image,a=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;a?(l.onerror=function(){t("Cannot determine dimensions for image.  May be too large.","error"),i.failure()},l.onload=function(){i.success({width:this.width,height:this.height})},l.src=a.createObjectURL(e)):(t("No createObjectURL function available to generate image URL!","error"),i.failure())},i.failure),i}function s(i,l){var a;return qq.each(i,function(c,d){if(d>0){var p=/(max|min)(Width|Height)/.exec(c),S=p[2].charAt(0).toLowerCase()+p[2].slice(1),q=l[S];switch(p[1]){case"min":if(q<d)return a=c,!1;break;case"max":if(q>d)return a=c,!1;break}}}),a}this.validate=function(i){var l=new qq.Promise;return t("Attempting to validate image."),n(i)?r().then(function(a){var c=s(i,a);c?l.failure(c):l.success()},l.success):l.success(),l}},qq.Session=function(e){var t={endpoint:null,params:{},customHeaders:{},cors:{},addFileRecord:function(s){},log:function(s,i){}};qq.extend(t,e,!0);function n(s){if(qq.isArray(s))return!0;t.log("Session response is not an array.","error")}function r(s,i,l,a){var c=!1;i=i&&n(s),i&&qq.each(s,function(d,p){if(p.uuid==null)c=!0,t.log(qq.format("Session response item {} did not include a valid UUID - ignoring.",d),"error");else if(p.name==null)c=!0,t.log(qq.format("Session response item {} did not include a valid name - ignoring.",d),"error");else try{return t.addFileRecord(p),!0}catch(S){c=!0,t.log(S.message,"error")}return!1}),a[i&&!c?"success":"failure"](s,l)}this.refresh=function(){var s=new qq.Promise,i=function(c,d,p){r(c,d,p,s)},l=qq.extend({},t),a=new qq.SessionAjaxRequester(qq.extend(l,{onComplete:i}));return a.queryServer(),s}},qq.SessionAjaxRequester=function(e){var t,n={endpoint:null,customHeaders:{},params:{},cors:{expected:!1,sendCredentials:!1},onComplete:function(s,i,l){},log:function(s,i){}};qq.extend(n,e);function r(s,i,l){var a=null;if(i.responseText!=null)try{a=qq.parseJson(i.responseText)}catch(c){n.log("Problem parsing session response: "+c.message,"error"),l=!0}n.onComplete(a,!l,i)}t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:["GET"],method:"GET",endpointStore:{get:function(){return n.endpoint}},customHeaders:n.customHeaders,log:n.log,onComplete:r,cors:n.cors})),qq.extend(this,{queryServer:function(){var s=qq.extend({},n.params);n.log("Session query request."),t.initTransport("sessionRefresh").withParams(s).withCacheBuster().send()}})},qq.Scaler=function(e,t){var n=e.customResizer,r=e.sendOriginal,s=e.orient,i=e.defaultType,l=e.defaultQuality/100,a=e.failureText,c=e.includeExif,d=this._getSortedSizes(e.sizes);qq.extend(this,{enabled:qq.supportedFeatures.scaling&&d.length>0,getFileRecords:function(p,S,q){var o=this,u=[],h=q.blob?q.blob:q,_=new qq.Identify(h,t);return _.isPreviewableSync()?(qq.each(d,function(m,v){var f=o._determineOutputType({defaultType:i,requestedType:v.type,refType:h.type});u.push({uuid:qq.getUniqueId(),name:o._getName(S,{name:v.name,type:f,refType:h.type}),blob:new qq.BlobProxy(h,qq.bind(o._generateScaledImage,o,{customResizeFunction:n,maxSize:v.maxSize,orient:s,type:f,quality:l,failedText:a,includeExif:c,log:t}))})}),u.push({uuid:p,name:S,size:h.size,blob:r?h:null})):u.push({uuid:p,name:S,size:h.size,blob:h}),u},handleNewFile:function(p,S,q,o,u,h,_,m){var v=this;p.qqButtonId||p.blob&&p.blob.qqButtonId;var f=[],g=null,y=m.addFileToHandler,C=m.uploadData,b=m.paramsStore,x=qq.getUniqueId();qq.each(v.getFileRecords(q,S,p),function(w,E){var F=E.size,P;E.blob instanceof qq.BlobProxy&&(F=-1),P=C.addFile({uuid:E.uuid,name:E.name,size:F,batchId:h,proxyGroupId:x}),E.blob instanceof qq.BlobProxy?f.push(P):g=P,E.blob?(y(P,E.blob),u.push({id:P,file:E.blob})):C.setStatus(P,qq.status.REJECTED)}),g!==null&&(qq.each(f,function(w,E){var F={qqparentuuid:C.retrieve({id:g}).uuid,qqparentsize:C.retrieve({id:g}).size};F[_]=C.retrieve({id:E}).uuid,C.setParentId(E,g),b.addReadOnly(E,F)}),f.length&&function(){var w={};w[_]=C.retrieve({id:g}).uuid,b.addReadOnly(g,w)}())}})},qq.extend(qq.Scaler.prototype,{scaleImage:function(e,t,n){if(!qq.supportedFeatures.scaling)throw new qq.Error("Scaling is not supported in this browser!");var r=new qq.Promise,s=n.log,i=n.getFile(e),l=n.uploadData.retrieve({id:e}),a=l&&l.name,c=l&&l.uuid,d={customResizer:t.customResizer,sendOriginal:!1,orient:t.orient,defaultType:t.type||null,defaultQuality:t.quality,failedToScaleText:"Unable to scale",sizes:[{name:"",maxSize:t.maxSize}]},p=new qq.Scaler(d,s);return!qq.Scaler||!qq.supportedFeatures.imagePreviews||!i?(r.failure(),s("Could not generate requested scaled image for "+e+".  Scaling is either not possible in this browser, or the file could not be located.","error")):qq.bind(function(){var S=p.getFileRecords(c,a,i)[0];S&&S.blob instanceof qq.BlobProxy?S.blob.create().then(r.success,r.failure):(s(e+" is not a scalable image!","error"),r.failure())},this)(),r},_determineOutputType:function(e){var t=e.requestedType,n=e.defaultType,r=e.refType;return!n&&!t?r!=="image/jpeg"?"image/png":r:t&&qq.indexOf(Object.keys(qq.Identify.prototype.PREVIEWABLE_MIME_TYPES),t)>=0?t==="image/tiff"?qq.supportedFeatures.tiffPreviews?t:n:t:n},_getName:function(e,t){var n=e.lastIndexOf("."),r=t.type||"image/png",s=t.refType,i="",l=qq.getExtension(e),a="";return t.name&&t.name.trim().length&&(a=" ("+t.name+")"),n>=0?(i=e.substr(0,n),s!==r&&(l=r.split("/")[1]),i+=a+"."+l):i=e+a,i},_getSortedSizes:function(e){return e=qq.extend([],e),e.sort(function(t,n){return t.maxSize>n.maxSize?1:t.maxSize<n.maxSize?-1:0})},_generateScaledImage:function(e,t){var n=this,r=e.customResizeFunction,s=e.log,i=e.maxSize,l=e.orient,a=e.type,c=e.quality,d=e.failedText,p=e.includeExif&&t.type==="image/jpeg"&&a==="image/jpeg",S=new qq.Promise,q=new qq.ImageGenerator(s),o=document.createElement("canvas");return s("Attempting to generate scaled version for "+t.name),q.generate(t,o,{maxSize:i,orient:l,customResizeFunction:r}).then(function(){var u=o.toDataURL(a,c),h=function(){s("Success generating scaled version for "+t.name);var _=qq.dataUriToBlob(u);S.success(_)};p?n._insertExifHeader(t,u,s).then(function(_){u=_,h()},function(){s("Problem inserting EXIF header into scaled image.  Using scaled image w/out EXIF data.","error"),h()}):h()},function(){s("Failed attempt to generate scaled version for "+t.name,"error"),S.failure(d)}),S},_insertExifHeader:function(e,t,n){var r=new FileReader,s=new qq.Promise,i="";return r.onload=function(){i=r.result,s.success(qq.ExifRestorer.restore(i,t))},r.onerror=function(){n("Problem reading "+e.name+" during attempt to transfer EXIF data to scaled version.","error"),s.failure()},r.readAsDataURL(e),s},_dataUriToBlob:function(e){var t,n,r,s;return e.split(",")[0].indexOf("base64")>=0?t=atob(e.split(",")[1]):t=decodeURI(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(t.length),s=new Uint8Array(r),qq.each(t,function(i,l){s[i]=l.charCodeAt(0)}),this._createBlob(r,n)},_createBlob:function(e,t){var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,r=n&&new n;return r?(r.append(e),r.getBlob(t)):new Blob([e],{type:t})}}),qq.ExifRestorer=function(){var e={};return e.KEY_STR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e.encode64=function(t){var n="",r,s,i="",l,a,c,d="",p=0;do r=t[p++],s=t[p++],i=t[p++],l=r>>2,a=(r&3)<<4|s>>4,c=(s&15)<<2|i>>6,d=i&63,isNaN(s)?c=d=64:isNaN(i)&&(d=64),n=n+this.KEY_STR.charAt(l)+this.KEY_STR.charAt(a)+this.KEY_STR.charAt(c)+this.KEY_STR.charAt(d),r=s=i="",l=a=c=d="";while(p<t.length);return n},e.restore=function(t,n){var r="data:image/jpeg;base64,";if(!t.match(r))return n;var s=this.decode64(t.replace(r,"")),i=this.slice2Segments(s),l=this.exifManipulation(n,i);return r+this.encode64(l)},e.exifManipulation=function(t,n){var r=this.getExifArray(n),s=this.insertExif(t,r),i=new Uint8Array(s);return i},e.getExifArray=function(t){for(var n,r=0;r<t.length;r++)if(n=t[r],n[0]==255&n[1]==225)return n;return[]},e.insertExif=function(t,n){var r=t.replace("data:image/jpeg;base64,",""),s=this.decode64(r),i=s.indexOf(255,3),l=s.slice(0,i),a=s.slice(i),c=l;return c=c.concat(n),c=c.concat(a),c},e.slice2Segments=function(t){for(var n=0,r=[];!(t[n]==255&t[n+1]==218);){if(t[n]==255&t[n+1]==216)n+=2;else{var s=t[n+2]*256+t[n+3],i=n+s+2,l=t.slice(n,i);r.push(l),n=i}if(n>t.length)break}return r},e.decode64=function(t){var n,r,s="",i,l,a,c="",d=0,p=[],S=/[^A-Za-z0-9\+\/\=]/g;if(S.exec(t))throw new Error("There were invalid base64 characters in the input text.  Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='");t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do i=this.KEY_STR.indexOf(t.charAt(d++)),l=this.KEY_STR.indexOf(t.charAt(d++)),a=this.KEY_STR.indexOf(t.charAt(d++)),c=this.KEY_STR.indexOf(t.charAt(d++)),n=i<<2|l>>4,r=(l&15)<<4|a>>2,s=(a&3)<<6|c,p.push(n),a!=64&&p.push(r),c!=64&&p.push(s),n=r=s="",i=l=a=c="";while(d<t.length);return p},e}(),qq.TotalProgress=function(e,t){var n={},r=0,s=0,i=-1,l=-1,a=function(o,u){(o!==i||u!==l)&&e(o,u),i=o,l=u},c=function(o,u){var h=!0;return qq.each(o,function(_,m){if(qq.indexOf(u,m)>=0)return h=!1,!1}),h},d=function(o){q(o,-1,-1),delete n[o]},p=function(o,u,h){(u.length===0||c(u,h))&&(a(s,s),this.reset())},S=function(o){var u=t(o);u>0&&(q(o,0,u),n[o]={loaded:0,total:u})},q=function(o,u,h){var _=n[o]?n[o].loaded:0,m=n[o]?n[o].total:0;u===-1&&h===-1?(r-=_,s-=m):(u&&(r+=u-_),h&&(s+=h-m)),a(r,s)};qq.extend(this,{onAllComplete:p,onStatusChange:function(o,u,h){h===qq.status.CANCELED||h===qq.status.REJECTED?d(o):h===qq.status.SUBMITTING&&S(o)},onIndividualProgress:function(o,u,h){q(o,u,h),n[o]={loaded:u,total:h}},onNewSize:function(o){S(o)},reset:function(){n={},r=0,s=0}})},qq.PasteSupport=function(e){var t,n;t={targetElement:null,callbacks:{log:function(l,a){},pasteReceived:function(l){}}};function r(l){return l.type&&l.type.indexOf("image/")===0}function s(){n=qq(t.targetElement).attach("paste",function(l){var a=l.clipboardData;a&&qq.each(a.items,function(c,d){if(r(d)){var p=d.getAsFile();t.callbacks.pasteReceived(p)}})})}function i(){n&&n()}qq.extend(t,e),s(),qq.extend(this,{reset:function(){i()}})},qq.FormSupport=function(e,t,n){var r=this,s=e.interceptSubmit,i=e.element,l=e.autoUpload;qq.extend(this,{newEndpoint:null,newAutoUpload:l,attachedToForm:!1,getFormInputsAsObject:function(){return i==null?null:r._form2Obj(i)}});function a(S){S.getAttribute("action")&&(r.newEndpoint=S.getAttribute("action"))}function c(S,q){if(S.checkValidity&&!S.checkValidity())n("Form did not pass validation checks - will not upload.","error"),q();else return!0}function d(S){var q=S.submit;qq(S).attach("submit",function(o){o=o||window.event,o.preventDefault?o.preventDefault():o.returnValue=!1,c(S,q)&&t()}),S.submit=function(){c(S,q)&&t()}}function p(S){return S&&(qq.isString(S)&&(S=document.getElementById(S)),S&&(n("Attaching to form element."),a(S),s&&d(S))),S}i=p(i),this.attachedToForm=!!i},qq.extend(qq.FormSupport.prototype,{_form2Obj:function(e){var t={},n=function(l){var a=["button","image","reset","submit"];return qq.indexOf(a,l.toLowerCase())<0},r=function(l){return qq.indexOf(["checkbox","radio"],l.toLowerCase())>=0},s=function(l){return r(l.type)&&!l.checked?!0:l.disabled&&l.type.toLowerCase()!=="hidden"},i=function(l){var a=null;return qq.each(qq(l).children(),function(c,d){if(d.tagName.toLowerCase()==="option"&&d.selected)return a=d.value,!1}),a};return qq.each(e.elements,function(l,a){if((qq.isInput(a,!0)||a.tagName.toLowerCase()==="textarea")&&n(a.type)&&!s(a))t[a.name]=a.value;else if(a.tagName.toLowerCase()==="select"&&!s(a)){var c=i(a);c!==null&&(t[a.name]=c)}}),t}}),qq.CryptoJS=function(e,t){var n={},r=n.lib={},s=r.Base=function(){function q(){}return{extend:function(o){q.prototype=this;var u=new q;return o&&u.mixIn(o),u.hasOwnProperty("init")||(u.init=function(){u.$super.init.apply(this,arguments)}),u.init.prototype=u,u.$super=this,u},create:function(){var o=this.extend();return o.init.apply(o,arguments),o},init:function(){},mixIn:function(o){for(var u in o)o.hasOwnProperty(u)&&(this[u]=o[u]);o.hasOwnProperty("toString")&&(this.toString=o.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),i=r.WordArray=s.extend({init:function(q,o){q=this.words=q||[],o!=t?this.sigBytes=o:this.sigBytes=q.length*4},toString:function(q){return(q||a).stringify(this)},concat:function(q){var o=this.words,u=q.words,h=this.sigBytes,_=q.sigBytes;if(this.clamp(),h%4)for(var m=0;m<_;m++){var v=u[m>>>2]>>>24-m%4*8&255;o[h+m>>>2]|=v<<24-(h+m)%4*8}else if(u.length>65535)for(var m=0;m<_;m+=4)o[h+m>>>2]=u[m>>>2];else o.push.apply(o,u);return this.sigBytes+=_,this},clamp:function(){var q=this.words,o=this.sigBytes;q[o>>>2]&=4294967295<<32-o%4*8,q.length=e.ceil(o/4)},clone:function(){var q=s.clone.call(this);return q.words=this.words.slice(0),q},random:function(q){for(var o=[],u=0;u<q;u+=4)o.push(e.random()*4294967296|0);return new i.init(o,q)}}),l=n.enc={},a=l.Hex={stringify:function(q){for(var o=q.words,u=q.sigBytes,h=[],_=0;_<u;_++){var m=o[_>>>2]>>>24-_%4*8&255;h.push((m>>>4).toString(16)),h.push((m&15).toString(16))}return h.join("")},parse:function(q){for(var o=q.length,u=[],h=0;h<o;h+=2)u[h>>>3]|=parseInt(q.substr(h,2),16)<<24-h%8*4;return new i.init(u,o/2)}},c=l.Latin1={stringify:function(q){for(var o=q.words,u=q.sigBytes,h=[],_=0;_<u;_++){var m=o[_>>>2]>>>24-_%4*8&255;h.push(String.fromCharCode(m))}return h.join("")},parse:function(q){for(var o=q.length,u=[],h=0;h<o;h++)u[h>>>2]|=(q.charCodeAt(h)&255)<<24-h%4*8;return new i.init(u,o)}},d=l.Utf8={stringify:function(q){try{return decodeURIComponent(escape(c.stringify(q)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(q){return c.parse(unescape(encodeURIComponent(q)))}},p=r.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new i.init,this._nDataBytes=0},_append:function(q){typeof q=="string"&&(q=d.parse(q)),this._data.concat(q),this._nDataBytes+=q.sigBytes},_process:function(q){var o=this._data,u=o.words,h=o.sigBytes,_=this.blockSize,m=_*4,v=h/m;q?v=e.ceil(v):v=e.max((v|0)-this._minBufferSize,0);var f=v*_,g=e.min(f*4,h);if(f){for(var y=0;y<f;y+=_)this._doProcessBlock(u,y);var C=u.splice(0,f);o.sigBytes-=g}return new i.init(C,g)},clone:function(){var q=s.clone.call(this);return q._data=this._data.clone(),q},_minBufferSize:0});r.Hasher=p.extend({cfg:s.extend(),init:function(q){this.cfg=this.cfg.extend(q),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(q){return this._append(q),this._process(),this},finalize:function(q){q&&this._append(q);var o=this._doFinalize();return o},blockSize:512/32,_createHelper:function(q){return function(o,u){return new q.init(u).finalize(o)}},_createHmacHelper:function(q){return function(o,u){return new S.HMAC.init(q,u).finalize(o)}}});var S=n.algo={};return n}(Math),function(){var e=qq.CryptoJS,t=e.lib,n=t.WordArray,r=e.enc;r.Base64={stringify:function(s){var i=s.words,l=s.sigBytes,a=this._map;s.clamp();for(var c=[],d=0;d<l;d+=3)for(var p=i[d>>>2]>>>24-d%4*8&255,S=i[d+1>>>2]>>>24-(d+1)%4*8&255,q=i[d+2>>>2]>>>24-(d+2)%4*8&255,o=p<<16|S<<8|q,u=0;u<4&&d+u*.75<l;u++)c.push(a.charAt(o>>>6*(3-u)&63));var h=a.charAt(64);if(h)for(;c.length%4;)c.push(h);return c.join("")},parse:function(s){var i=s.length,l=this._map,a=l.charAt(64);if(a){var c=s.indexOf(a);c!=-1&&(i=c)}for(var d=[],p=0,S=0;S<i;S++)if(S%4){var q=l.indexOf(s.charAt(S-1))<<S%4*2,o=l.indexOf(s.charAt(S))>>>6-S%4*2;d[p>>>2]|=(q|o)<<24-p%4*8,p++}return n.create(d,p)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(){var e=qq.CryptoJS,t=e.lib,n=t.Base,r=e.enc,s=r.Utf8,i=e.algo;i.HMAC=n.extend({init:function(l,a){l=this._hasher=new l.init,typeof a=="string"&&(a=s.parse(a));var c=l.blockSize,d=c*4;a.sigBytes>d&&(a=l.finalize(a)),a.clamp();for(var p=this._oKey=a.clone(),S=this._iKey=a.clone(),q=p.words,o=S.words,u=0;u<c;u++)q[u]^=1549556828,o[u]^=909522486;p.sigBytes=S.sigBytes=d,this.reset()},reset:function(){var l=this._hasher;l.reset(),l.update(this._iKey)},update:function(l){return this._hasher.update(l),this},finalize:function(l){var a=this._hasher,c=a.finalize(l);a.reset();var d=a.finalize(this._oKey.clone().concat(c));return d}})}(),function(){var e=qq.CryptoJS,t=e.lib,n=t.WordArray,r=t.Hasher,s=e.algo,i=[],l=s.SHA1=r.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(a,c){for(var d=this._hash.words,p=d[0],S=d[1],q=d[2],o=d[3],u=d[4],h=0;h<80;h++){if(h<16)i[h]=a[c+h]|0;else{var _=i[h-3]^i[h-8]^i[h-14]^i[h-16];i[h]=_<<1|_>>>31}var m=(p<<5|p>>>27)+u+i[h];h<20?m+=(S&q|~S&o)+1518500249:h<40?m+=(S^q^o)+1859775393:h<60?m+=(S&q|S&o|q&o)-1894007588:m+=(S^q^o)-899497514,u=o,o=q,q=S<<30|S>>>2,S=p,p=m}d[0]=d[0]+p|0,d[1]=d[1]+S|0,d[2]=d[2]+q|0,d[3]=d[3]+o|0,d[4]=d[4]+u|0},_doFinalize:function(){var a=this._data,c=a.words,d=this._nDataBytes*8,p=a.sigBytes*8;return c[p>>>5]|=128<<24-p%32,c[(p+64>>>9<<4)+14]=Math.floor(d/4294967296),c[(p+64>>>9<<4)+15]=d,a.sigBytes=c.length*4,this._process(),this._hash},clone:function(){var a=r.clone.call(this);return a._hash=this._hash.clone(),a}});e.SHA1=r._createHelper(l),e.HmacSHA1=r._createHmacHelper(l)}(),function(e){var t=qq.CryptoJS,n=t.lib,r=n.WordArray,s=n.Hasher,i=t.algo,l=[],a=[];(function(){function p(u){for(var h=e.sqrt(u),_=2;_<=h;_++)if(!(u%_))return!1;return!0}function S(u){return(u-(u|0))*4294967296|0}for(var q=2,o=0;o<64;)p(q)&&(o<8&&(l[o]=S(e.pow(q,1/2))),a[o]=S(e.pow(q,1/3)),o++),q++})();var c=[],d=i.SHA256=s.extend({_doReset:function(){this._hash=new r.init(l.slice(0))},_doProcessBlock:function(p,S){for(var q=this._hash.words,o=q[0],u=q[1],h=q[2],_=q[3],m=q[4],v=q[5],f=q[6],g=q[7],y=0;y<64;y++){if(y<16)c[y]=p[S+y]|0;else{var C=c[y-15],b=(C<<25|C>>>7)^(C<<14|C>>>18)^C>>>3,x=c[y-2],w=(x<<15|x>>>17)^(x<<13|x>>>19)^x>>>10;c[y]=b+c[y-7]+w+c[y-16]}var E=m&v^~m&f,F=o&u^o&h^u&h,P=(o<<30|o>>>2)^(o<<19|o>>>13)^(o<<10|o>>>22),R=(m<<26|m>>>6)^(m<<21|m>>>11)^(m<<7|m>>>25),I=g+R+E+a[y]+c[y],A=P+F;g=f,f=v,v=m,m=_+I|0,_=h,h=u,u=o,o=I+A|0}q[0]=q[0]+o|0,q[1]=q[1]+u|0,q[2]=q[2]+h|0,q[3]=q[3]+_|0,q[4]=q[4]+m|0,q[5]=q[5]+v|0,q[6]=q[6]+f|0,q[7]=q[7]+g|0},_doFinalize:function(){var p=this._data,S=p.words,q=this._nDataBytes*8,o=p.sigBytes*8;return S[o>>>5]|=128<<24-o%32,S[(o+64>>>9<<4)+14]=e.floor(q/4294967296),S[(o+64>>>9<<4)+15]=q,p.sigBytes=S.length*4,this._process(),this._hash},clone:function(){var p=s.clone.call(this);return p._hash=this._hash.clone(),p}});t.SHA256=s._createHelper(d),t.HmacSHA256=s._createHmacHelper(d)}(Math),function(){if(typeof ArrayBuffer=="function"){var e=qq.CryptoJS,t=e.lib,n=t.WordArray,r=n.init,s=n.init=function(i){if(i instanceof ArrayBuffer&&(i=new Uint8Array(i)),(i instanceof Int8Array||i instanceof Uint8ClampedArray||i instanceof Int16Array||i instanceof Uint16Array||i instanceof Int32Array||i instanceof Uint32Array||i instanceof Float32Array||i instanceof Float64Array)&&(i=new Uint8Array(i.buffer,i.byteOffset,i.byteLength)),i instanceof Uint8Array){for(var l=i.byteLength,a=[],c=0;c<l;c++)a[c>>>2]|=i[c]<<24-c%4*8;r.call(this,a,l)}else r.apply(this,arguments)};s.prototype=n}}(),qq.s3=qq.s3||{},qq.s3.util=qq.s3.util||function(){return{ALGORITHM_PARAM_NAME:"x-amz-algorithm",AWS_PARAM_PREFIX:"x-amz-meta-",CREDENTIAL_PARAM_NAME:"x-amz-credential",DATE_PARAM_NAME:"x-amz-date",REDUCED_REDUNDANCY_PARAM_NAME:"x-amz-storage-class",REDUCED_REDUNDANCY_PARAM_VALUE:"REDUCED_REDUNDANCY",SERVER_SIDE_ENCRYPTION_PARAM_NAME:"x-amz-server-side-encryption",SERVER_SIDE_ENCRYPTION_PARAM_VALUE:"AES256",SESSION_TOKEN_PARAM_NAME:"x-amz-security-token",V4_ALGORITHM_PARAM_VALUE:"AWS4-HMAC-SHA256",V4_SIGNATURE_PARAM_NAME:"x-amz-signature",CASE_SENSITIVE_PARAM_NAMES:["Cache-Control","Content-Disposition","Content-Encoding","Content-MD5"],UNSIGNABLE_REST_HEADER_NAMES:["Cache-Control","Content-Disposition","Content-Encoding","Content-MD5"],UNPREFIXED_PARAM_NAMES:["Cache-Control","Content-Disposition","Content-Encoding","Content-MD5","x-amz-server-side-encryption","x-amz-server-side-encryption-aws-kms-key-id","x-amz-server-side-encryption-customer-algorithm","x-amz-server-side-encryption-customer-key","x-amz-server-side-encryption-customer-key-MD5"],getBucket:function(e){var t=[/^(?:https?:\/\/)?([a-z0-9.\-_]+)\.s3(?:-[a-z0-9\-]+)?\.amazonaws\.com/i,/^(?:https?:\/\/)?s3(?:-[a-z0-9\-]+)?\.amazonaws\.com\/([a-z0-9.\-_]+)/i,/^(?:https?:\/\/)?([a-z0-9.\-_]+)/i],n;return qq.each(t,function(r,s){var i=s.exec(e);if(i)return n=i[1],!1}),n},_getPrefixedParamName:function(e){return qq.indexOf(qq.s3.util.UNPREFIXED_PARAM_NAMES,e)>=0?e:qq.s3.util.AWS_PARAM_PREFIX+e},getPolicy:function(e){var t={},n=[],r=e.bucket,s=e.date,i=e.clockDrift,l=e.key,a=e.accessKey,c=e.acl,d=e.type,p=e.expectedStatus,S=e.sessionToken,q=e.params,o=qq.s3.util.getSuccessRedirectAbsoluteUrl(e.successRedirectUrl),u=e.minFileSize,h=e.maxFileSize,_=e.reducedRedundancy,m=e.region,v=e.serverSideEncryption,f=e.signatureVersion;return t.expiration=qq.s3.util.getPolicyExpirationDate(s,i),n.push({acl:c}),n.push({bucket:r}),d&&n.push({"Content-Type":d}),p&&n.push({success_action_status:p.toString()}),o&&n.push({success_action_redirect:o}),_&&(n.push({}),n[n.length-1][qq.s3.util.REDUCED_REDUNDANCY_PARAM_NAME]=qq.s3.util.REDUCED_REDUNDANCY_PARAM_VALUE),S&&(n.push({}),n[n.length-1][qq.s3.util.SESSION_TOKEN_PARAM_NAME]=S),v&&(n.push({}),n[n.length-1][qq.s3.util.SERVER_SIDE_ENCRYPTION_PARAM_NAME]=qq.s3.util.SERVER_SIDE_ENCRYPTION_PARAM_VALUE),f===2?n.push({key:l}):f===4&&(n.push({}),n[n.length-1][qq.s3.util.ALGORITHM_PARAM_NAME]=qq.s3.util.V4_ALGORITHM_PARAM_VALUE,n.push({}),n[n.length-1].key=l,n.push({}),n[n.length-1][qq.s3.util.CREDENTIAL_PARAM_NAME]=qq.s3.util.getV4CredentialsString({date:s,key:a,region:m}),n.push({}),n[n.length-1][qq.s3.util.DATE_PARAM_NAME]=qq.s3.util.getV4PolicyDate(s,i)),qq.each(q,function(g,y){var C=qq.s3.util._getPrefixedParamName(g),b={};qq.indexOf(qq.s3.util.UNPREFIXED_PARAM_NAMES,C)>=0?b[C]=y:b[C]=encodeURIComponent(y),n.push(b)}),t.conditions=n,qq.s3.util.enforceSizeLimits(t,u,h),t},refreshPolicyCredentials:function(e,t){var n=!1;qq.each(e.conditions,function(r,s){qq.each(s,function(i,l){i===qq.s3.util.SESSION_TOKEN_PARAM_NAME&&(s[i]=t,n=!0)})}),n||(e.conditions.push({}),e.conditions[e.conditions.length-1][qq.s3.util.SESSION_TOKEN_PARAM_NAME]=t)},generateAwsParams:function(e,t){var n={},r=e.params,s=new qq.Promise,i=e.sessionToken,l=e.clockDrift,a=e.type,c=e.key,d=e.accessKey,p=e.acl,S=e.expectedStatus,q=qq.s3.util.getSuccessRedirectAbsoluteUrl(e.successRedirectUrl),o=e.reducedRedundancy,u=e.region,h=e.serverSideEncryption,_=e.signatureVersion,m=new Date,v=e.log,f;return e.date=m,f=qq.s3.util.getPolicy(e),n.key=c,a&&(n["Content-Type"]=a),S&&(n.success_action_status=S),q&&(n.success_action_redirect=q),o&&(n[qq.s3.util.REDUCED_REDUNDANCY_PARAM_NAME]=qq.s3.util.REDUCED_REDUNDANCY_PARAM_VALUE),h&&(n[qq.s3.util.SERVER_SIDE_ENCRYPTION_PARAM_NAME]=qq.s3.util.SERVER_SIDE_ENCRYPTION_PARAM_VALUE),i&&(n[qq.s3.util.SESSION_TOKEN_PARAM_NAME]=i),n.acl=p,qq.each(r,function(g,y){var C=qq.s3.util._getPrefixedParamName(g);qq.indexOf(qq.s3.util.UNPREFIXED_PARAM_NAMES,C)>=0?n[C]=y:n[C]=encodeURIComponent(y)}),_===2?n.AWSAccessKeyId=d:_===4&&(n[qq.s3.util.ALGORITHM_PARAM_NAME]=qq.s3.util.V4_ALGORITHM_PARAM_VALUE,n[qq.s3.util.CREDENTIAL_PARAM_NAME]=qq.s3.util.getV4CredentialsString({date:m,key:d,region:u}),n[qq.s3.util.DATE_PARAM_NAME]=qq.s3.util.getV4PolicyDate(m,l)),t(f).then(function(g,y,C){n.policy=g.policy,e.signatureVersion===2?(n.signature=g.signature,y&&(n.AWSAccessKeyId=y)):e.signatureVersion===4&&(n[qq.s3.util.V4_SIGNATURE_PARAM_NAME]=g.signature),C&&(n[qq.s3.util.SESSION_TOKEN_PARAM_NAME]=C),s.success(n)},function(g){g=g||"Can't continue further with request to S3 as we did not receive a valid signature and policy from the server.",v("Policy signing failed.  "+g,"error"),s.failure(g)}),s},enforceSizeLimits:function(e,t,n){var r=t<0?0:t,s=n<=0?9007199254740992:n;(t>0||n>0)&&e.conditions.push(["content-length-range",r.toString(),s.toString()])},getPolicyExpirationDate:function(e,t){var n=new Date(e.getTime()+t);return qq.s3.util.getPolicyDate(n,5)},getCredentialsDate:function(e){return e.getUTCFullYear()+""+("0"+(e.getUTCMonth()+1)).slice(-2)+("0"+e.getUTCDate()).slice(-2)},getPolicyDate:function(e,t){var n=t||0,r,s;return e.setMinutes(e.getMinutes()+(n||0)),Date.prototype.toISOString?e.toISOString():(r=function(i){return s=String(i),s.length===1&&(s="0"+s),s},e.getUTCFullYear()+"-"+r(e.getUTCMonth()+1)+"-"+r(e.getUTCDate())+"T"+r(e.getUTCHours())+":"+r(e.getUTCMinutes())+":"+r(e.getUTCSeconds())+"."+String((e.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z")},parseIframeResponse:function(e){var t=e.contentDocument||e.contentWindow.document,n=t.location.search,r=/bucket=(.+)&key=(.+)&etag=(.+)/.exec(n);if(r)return{bucket:r[1],key:r[2],etag:r[3].replace(/%22/g,"")}},getSuccessRedirectAbsoluteUrl:function(e){if(e){var t=document.createElement("div"),n;return qq.ie7()?(t.innerHTML="<a href='"+e+"'></a>",n=t.firstChild,n.href):(n=document.createElement("a"),n.href=e,n.href=n.href,n.href)}},getV4CredentialsString:function(e){return e.key+"/"+qq.s3.util.getCredentialsDate(e.date)+"/"+e.region+"/s3/aws4_request"},getV4PolicyDate:function(e,t){var n=new Date(e.getTime()+t);return qq.s3.util.getCredentialsDate(n)+"T"+("0"+n.getUTCHours()).slice(-2)+("0"+n.getUTCMinutes()).slice(-2)+("0"+n.getUTCSeconds()).slice(-2)+"Z"},encodeQueryStringParam:function(e){var t=encodeURIComponent(e);return t=t.replace(/[!'()]/g,escape),t=t.replace(/\*/g,"%2A"),t.replace(/%20/g,"+")},uriEscape:function(e){var t=encodeURIComponent(e);return t=t.replace(/[^A-Za-z0-9_.~\-%]+/g,escape),t=t.replace(/[*]/g,function(n){return"%"+n.charCodeAt(0).toString(16).toUpperCase()}),t},uriEscapePath:function(e){var t=[];return qq.each(e.split("/"),function(n,r){t.push(qq.s3.util.uriEscape(r))}),t.join("/")}}}(),function(){qq.nonTraditionalBasePublicApi={setUploadSuccessParams:function(e,t){this._uploadSuccessParamsStore.set(e,t)},setUploadSuccessEndpoint:function(e,t){this._uploadSuccessEndpointStore.set(e,t)}},qq.nonTraditionalBasePrivateApi={_onComplete:function(e,t,n,r){var s=!!n.success,i=this,l=arguments,a=this._uploadSuccessEndpointStore.get(e),c=this._options.uploadSuccess.customHeaders,d=this._options.uploadSuccess.method,p=this._options.cors,S=new qq.Promise,q=this._uploadSuccessParamsStore.get(e),o=this._paramsStore.get(e),u=function(v){delete i._failedSuccessRequestCallbacks[e],qq.extend(n,v),qq.FineUploaderBasic.prototype._onComplete.apply(i,l),S.success(v)},h=function(v){var f=_;qq.extend(n,v),n&&n.reset&&(f=null),f?i._failedSuccessRequestCallbacks[e]=f:delete i._failedSuccessRequestCallbacks[e],i._onAutoRetry(e,t,n,r,f)||(qq.FineUploaderBasic.prototype._onComplete.apply(i,l),S.failure(v))},_,m;return s&&a?(m=new qq.UploadSuccessAjaxRequester({endpoint:a,method:d,customHeaders:c,cors:p,log:qq.bind(this.log,this)}),qq.extend(q,i._getEndpointSpecificParams(e,n,r),!0),o&&qq.extend(q,o,!0),_=qq.bind(function(){m.sendSuccessRequest(e,q).then(u,h)},i),_(),S):qq.FineUploaderBasic.prototype._onComplete.apply(this,arguments)},_manualRetry:function(e){var t=this._failedSuccessRequestCallbacks[e];return qq.FineUploaderBasic.prototype._manualRetry.call(this,e,t)}}}(),function(){qq.s3.FineUploaderBasic=function(e){var t={request:{accessKey:null,clockDrift:0},objectProperties:{acl:"private",bucket:qq.bind(function(n){return qq.s3.util.getBucket(this.getEndpoint(n))},this),host:qq.bind(function(n){return/(?:http|https):\/\/(.+)(?:\/.+)?/.exec(this._endpointStore.get(n))[1]},this),key:"uuid",reducedRedundancy:!1,region:"us-east-1",serverSideEncryption:!1},credentials:{accessKey:null,secretKey:null,expiration:null,sessionToken:null},signature:{customHeaders:{},endpoint:null,version:2},uploadSuccess:{endpoint:null,method:"POST",params:{},customHeaders:{}},iframeSupport:{localBlankPagePath:null},chunking:{partSize:5242880},cors:{allowXdr:!0},callbacks:{onCredentialsExpired:function(){}}};qq.extend(t,e,!0),this.setCredentials(t.credentials,!0)||(this._currentCredentials.accessKey=t.request.accessKey),this._aclStore=this._createStore(t.objectProperties.acl),qq.FineUploaderBasic.call(this,t),this._uploadSuccessParamsStore=this._createStore(this._options.uploadSuccess.params),this._uploadSuccessEndpointStore=this._createStore(this._options.uploadSuccess.endpoint),this._failedSuccessRequestCallbacks={},this._cannedKeys={},this._cannedBuckets={},this._buckets={},this._hosts={}},qq.extend(qq.s3.FineUploaderBasic.prototype,qq.basePublicApi),qq.extend(qq.s3.FineUploaderBasic.prototype,qq.basePrivateApi),qq.extend(qq.s3.FineUploaderBasic.prototype,qq.nonTraditionalBasePublicApi),qq.extend(qq.s3.FineUploaderBasic.prototype,qq.nonTraditionalBasePrivateApi),qq.extend(qq.s3.FineUploaderBasic.prototype,{getBucket:function(e){return this._cannedBuckets[e]==null?this._buckets[e]:this._cannedBuckets[e]},getKey:function(e){return this._cannedKeys[e]==null?this._handler.getThirdPartyFileId(e):this._cannedKeys[e]},reset:function(){qq.FineUploaderBasic.prototype.reset.call(this),this._failedSuccessRequestCallbacks=[],this._buckets={},this._hosts={}},setCredentials:function(e,t){if(e&&e.secretKey){if(e.accessKey)if(e.expiration)this._currentCredentials=qq.extend({},e),qq.isString(e.expiration)&&(this._currentCredentials.expiration=new Date(e.expiration));else throw new qq.Error("Invalid credentials: no expiration");else throw new qq.Error("Invalid credentials: no accessKey");return!0}else if(t)this._currentCredentials={};else throw new qq.Error("Invalid credentials parameter!")},setAcl:function(e,t){this._aclStore.set(e,t)},_createUploadHandler:function(){var e=this,t={aclStore:this._aclStore,getBucket:qq.bind(this._determineBucket,this),getHost:qq.bind(this._determineHost,this),getKeyName:qq.bind(this._determineKeyName,this),iframeSupport:this._options.iframeSupport,objectProperties:this._options.objectProperties,signature:this._options.signature,clockDrift:this._options.request.clockDrift,validation:{minSizeLimit:this._options.validation.minSizeLimit,maxSizeLimit:this._options.validation.sizeLimit}};return qq.override(this._endpointStore,function(n){return{get:function(r){var s=n.get(r);return s.indexOf("http")<0?"http://"+s:s}}}),qq.override(this._paramsStore,function(n){return{get:function(r){var s=n.get(r),i={};return qq.each(s,function(l,a){var c=l;qq.indexOf(qq.s3.util.CASE_SENSITIVE_PARAM_NAMES,c)<0&&(c=c.toLowerCase()),i[c]=qq.isFunction(a)?a():a}),i}}}),t.signature.credentialsProvider={get:function(){return e._currentCredentials},onExpired:function(){var n=new qq.Promise,r=e._options.callbacks.onCredentialsExpired();return qq.isGenericPromise(r)?r.then(function(s){try{e.setCredentials(s),n.success()}catch(i){e.log("Invalid credentials returned from onCredentialsExpired callback! ("+i.message+")","error"),n.failure("onCredentialsExpired did not return valid credentials.")}},function(s){e.log("onCredentialsExpired callback indicated failure! ("+s+")","error"),n.failure("onCredentialsExpired callback failed.")}):(e.log("onCredentialsExpired callback did not return a promise!","error"),n.failure("Unexpected return value for onCredentialsExpired.")),n}},qq.FineUploaderBasic.prototype._createUploadHandler.call(this,t,"s3")},_determineObjectPropertyValue:function(e,t){var n=this._options.objectProperties[t],r=new qq.Promise,s=this;return qq.isFunction(n)?(n=n(e),qq.isGenericPromise(n)?r=n:r.success(n)):qq.isString(n)&&r.success(n),r.then(function(l){s["_"+t+"s"][e]=l},function(l){qq.log("Problem determining "+t+" for ID "+e+" ("+l+")","error")}),r},_determineBucket:function(e){return this._determineObjectPropertyValue(e,"bucket")},_determineHost:function(e){return this._determineObjectPropertyValue(e,"host")},_determineKeyName:function(e,t){var n=new qq.Promise,r=this._options.objectProperties.key,s=qq.getExtension(t),i=n.failure,l=function(a,c){var d=a;c!==void 0&&(d+="."+c),n.success(d)};switch(r){case"uuid":l(this.getUuid(e),s);break;case"filename":l(t);break;default:qq.isFunction(r)?this._handleKeynameFunction(r,e,l,i):(this.log(r+" is not a valid value for the s3.keyname option!","error"),i())}return n},_handleKeynameFunction:function(e,t,n,r){var s=this,i=function(c){n(c)},l=function(c){s.log(qq.format("Failed to retrieve key name for {}.  Reason: {}",t,c||"null"),"error"),r(c)},a=e.call(this,t);qq.isGenericPromise(a)?a.then(i,l):a==null?l():i(a)},_getEndpointSpecificParams:function(e,t,n){var r={key:this.getKey(e),uuid:this.getUuid(e),name:this.getName(e),bucket:this.getBucket(e)};return n&&n.getResponseHeader("ETag")?r.etag=n.getResponseHeader("ETag"):t.etag&&(r.etag=t.etag),r},_onSubmitDelete:function(e,t){var n={key:this.getKey(e),bucket:this.getBucket(e)};return qq.FineUploaderBasic.prototype._onSubmitDelete.call(this,e,t,n)},_addCannedFile:function(e){var t;if(e.s3Key==null)throw new qq.Error("Did not find s3Key property in server session response.  This is required!");return t=qq.FineUploaderBasic.prototype._addCannedFile.apply(this,arguments),this._cannedKeys[t]=e.s3Key,this._cannedBuckets[t]=e.s3Bucket,t}})}(),window.Uint8ClampedArray||(window.Uint8ClampedArray=function(){}),qq.s3.RequestSigner=function(e){var t,n=this,r={},s={expectingPolicy:!1,method:"POST",signatureSpec:{drift:0,credentialsProvider:{},endpoint:null,customHeaders:{},version:2},maxConnections:3,endpointStore:{},paramsStore:{},cors:{expected:!1,sendCredentials:!1},log:function(u,h){}},i,l=function(u,h,_){var m=u.getHeaders();s.signatureSpec.version===4?m.Authorization=qq.s3.util.V4_ALGORITHM_PARAM_VALUE+" Credential="+s.signatureSpec.credentialsProvider.get().accessKey+"/"+qq.s3.util.getCredentialsDate(u.getRequestDate())+"/"+s.signatureSpec.region+"/s3/aws4_request,SignedHeaders="+u.getSignedHeaders()+",Signature="+h:m.Authorization="AWS "+s.signatureSpec.credentialsProvider.get().accessKey+":"+h,_.success(m,u.getEndOfUrl())},a={getStringToSign:function(u){return qq.format(`{}
{}
{}

{}/{}/{}`,u.method,u.contentMd5||"",u.contentType||"",u.headersStr||`
`,u.bucket,u.endOfUrl)},signApiRequest:function(u,h,_){var m=qq.CryptoJS.enc.Utf8.parse(h),v=qq.CryptoJS.HmacSHA1(m,i.get().secretKey),f=qq.CryptoJS.enc.Base64.stringify(v);l(u,f,_)},signPolicy:function(u,h,_,m){var v=JSON.stringify(u),f=qq.CryptoJS.enc.Utf8.parse(v),g=qq.CryptoJS.enc.Base64.stringify(f),y=qq.CryptoJS.HmacSHA1(g,i.get().secretKey),C=qq.CryptoJS.enc.Base64.stringify(y);h.success({policy:g,signature:C},_,m)}},c={getCanonicalQueryString:function(u){var h=u.indexOf("?"),_="",m,v,f;return h>=0&&(m={},f=u.substr(h+1).split("&"),qq.each(f,function(g,y){var C=y.split("="),b=C[1];b==null&&(b=""),m[encodeURIComponent(C[0])]=encodeURIComponent(b)}),v=Object.keys(m).sort(),v.forEach(function(g,y){_+=g+"="+m[g],y<v.length-1&&(_+="&")})),_},getCanonicalRequest:function(u){return qq.format(`{}
{}
{}
{}
{}
{}`,u.method,c.getCanonicalUri(u.endOfUrl),c.getCanonicalQueryString(u.endOfUrl),u.headersStr||`
`,c.getSignedHeaders(u.headerNames),u.hashedContent)},getCanonicalUri:function(u){var h=u,_=u.indexOf("?");return _>0&&(h=u.substr(0,_)),"/"+h},getEncodedHashedPayload:function(u){var h=new qq.Promise,_;return qq.isBlob(u)?(_=new FileReader,_.onloadend=function(m){if(m.target.readyState===FileReader.DONE)if(m.target.error)h.failure(m.target.error);else{var v=qq.CryptoJS.lib.WordArray.create(m.target.result);h.success(qq.CryptoJS.SHA256(v).toString())}},_.readAsArrayBuffer(u)):(u=u||"",h.success(qq.CryptoJS.SHA256(u).toString())),h},getScope:function(u,h){return qq.s3.util.getCredentialsDate(u)+"/"+h+"/s3/aws4_request"},getStringToSign:function(u){var h=c.getCanonicalRequest(u),_=qq.s3.util.getV4PolicyDate(u.date,u.drift),m=qq.CryptoJS.SHA256(h).toString(),v=c.getScope(u.date,s.signatureSpec.region),f=`AWS4-HMAC-SHA256
{}
{}
{}`;return{hashed:qq.format(f,_,v,m),raw:qq.format(f,_,v,h)}},getSignedHeaders:function(u){var h="";return u.forEach(function(_,m){h+=_.toLowerCase(),m<u.length-1&&(h+=";")}),h},signApiRequest:function(u,h,_){var m=i.get().secretKey,v=/.+\n.+\n(\d+)\/(.+)\/s3\/.+\n(.+)/,f=v.exec(h),g,y,C,b;g=qq.CryptoJS.HmacSHA256(f[1],"AWS4"+m),y=qq.CryptoJS.HmacSHA256(f[2],g),C=qq.CryptoJS.HmacSHA256("s3",y),b=qq.CryptoJS.HmacSHA256("aws4_request",C),l(u,qq.CryptoJS.HmacSHA256(h,b),_)},signPolicy:function(u,h,_,m){var v=JSON.stringify(u),f=qq.CryptoJS.enc.Utf8.parse(v),g=qq.CryptoJS.enc.Base64.stringify(f),y=i.get().secretKey,C=/.+\/(.+)\/(.+)\/s3\/aws4_request/,b=function(){var R=null;return qq.each(u.conditions,function(I,A){var D=A["x-amz-credential"];if(D)return R=D,!1}),R}(),x,w,E,F,P;x=C.exec(b),w=qq.CryptoJS.HmacSHA256(x[1],"AWS4"+y),E=qq.CryptoJS.HmacSHA256(x[2],w),F=qq.CryptoJS.HmacSHA256("s3",E),P=qq.CryptoJS.HmacSHA256("aws4_request",F),h.success({policy:g,signature:qq.CryptoJS.HmacSHA256(g,P).toString()},_,m)}};qq.extend(s,e,!0),i=s.signatureSpec.credentialsProvider;function d(u,h,_){var m=h.responseText,v=r[u],f=v.promise,g=v.signatureConstructor,y,C;if(delete r[u],m)try{C=qq.parseJson(m)}catch(b){s.log("Error attempting to parse signature response: "+b,"error")}C&&C.error?(_=!0,y=C.error):C&&C.invalid?(_=!0,y="Invalid policy document or request headers!"):C?s.expectingPolicy&&!C.policy?(_=!0,y="Response does not include the base64 encoded policy!"):C.signature||(_=!0,y="Response does not include the signature!"):(_=!0,y="Received an empty or invalid response from the server!"),_?(y&&s.log(y,"error"),f.failure(y)):g?l(g,C.signature,f):f.success(C)}function p(u,h,_){var m=new qq.Promise,v="POST",f=[],g="",y=new Date,C,b,x,w=function(E){var F,P=[];return qq.each(E.headers,function(R){f.push(R)}),f.sort(),qq.each(f,function(R,I){qq.indexOf(qq.s3.util.UNSIGNABLE_REST_HEADER_NAMES,I)<0?g+=I.toLowerCase()+":"+E.headers[I].trim()+`
`:I==="Content-MD5"?F=E.headers[I]:P.unshift(R)}),qq.each(P,function(R,I){f.splice(I,1)}),b={bucket:E.bucket,contentMd5:F,contentType:E.contentType,date:y,drift:s.signatureSpec.drift,endOfUrl:C,hashedContent:E.hashedContent,headerNames:f,headersStr:g,method:v},x=h===2?a.getStringToSign(b):c.getStringToSign(b),{date:y,endOfUrl:C,signedHeaders:h===4?c.getSignedHeaders(b.headerNames):null,toSign:h===4?x.hashed:x,toSignRaw:h===4?x.raw:x}};switch(_.type){case n.REQUEST_TYPE.MULTIPART_ABORT:v="DELETE",C=qq.format("uploadId={}",_.uploadId);break;case n.REQUEST_TYPE.MULTIPART_INITIATE:C="uploads";break;case n.REQUEST_TYPE.MULTIPART_COMPLETE:C=qq.format("uploadId={}",_.uploadId);break;case n.REQUEST_TYPE.MULTIPART_UPLOAD:v="PUT",C=qq.format("partNumber={}&uploadId={}",_.partNum,_.uploadId);break}return C=_.key+"?"+C,h===4?c.getEncodedHashedPayload(_.content).then(function(E){_.headers["x-amz-content-sha256"]=E,_.headers.Host=_.host,_.headers["x-amz-date"]=qq.s3.util.getV4PolicyDate(y,s.signatureSpec.drift),_.hashedContent=E,m.success(w(_))},function(E){m.failure(E)}):m.success(w(_)),m}function S(u,h,_,m,v){var f;h.signatureConstructor?(v&&(f=h.signatureConstructor.getHeaders(),f[qq.s3.util.SESSION_TOKEN_PARAM_NAME]=v,h.signatureConstructor.withHeaders(f)),h.signatureConstructor.getToSign(u).then(function(g){o(h.signatureConstructor,g.stringToSign,_)},function(g){_.failure(g)})):(v&&qq.s3.util.refreshPolicyCredentials(h,v),q(h,_,m,v))}function q(u,h,_,m){s.signatureSpec.version===4?c.signPolicy(u,h,_,m):a.signPolicy(u,h,_,m)}function o(u,h,_){s.signatureSpec.version===4?c.signApiRequest(u,h,_):a.signApiRequest(u,h,_)}t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",method:s.method,contentType:"application/json; charset=utf-8",endpointStore:{get:function(){return s.signatureSpec.endpoint}},paramsStore:s.paramsStore,maxConnections:s.maxConnections,customHeaders:s.signatureSpec.customHeaders,log:s.log,onComplete:d,cors:s.cors})),qq.extend(this,{getSignature:function(u,h){var _=h,m=h.signatureConstructor,v=new qq.Promise,f;return s.signatureSpec.version===4&&(f={v4:!0}),i.get().secretKey&&qq.CryptoJS?i.get().expiration.getTime()>Date.now()?S(u,h,v):i.onExpired().then(function(){S(u,h,v,i.get().accessKey,i.get().sessionToken)},function(g){s.log("Attempt to update expired credentials apparently failed! Unable to sign request.  ","error"),v.failure("Unable to sign request - expired credentials.")}):(s.log("Submitting S3 signature request for "+u),m?m.getToSign(u).then(function(g){_={headers:g.stringToSignRaw},t.initTransport(u).withParams(_).withQueryParams(f).send()},function(g){s.log("Failed to construct signature. ","error"),v.failure("Failed to construct signature.")}):t.initTransport(u).withParams(_).withQueryParams(f).send(),r[u]={promise:v,signatureConstructor:m}),v},constructStringToSign:function(u,h,_,m){var v={},f,g,y,C,b;return{withHeaders:function(x){return v=x,this},withUploadId:function(x){return f=x,this},withContent:function(x){return g=x,this},withContentType:function(x){return y=x,this},withPartNum:function(x){return C=x,this},getToSign:function(x){var w=i.get().sessionToken,E=new qq.Promise,F=new Date(Date.now()+s.signatureSpec.drift);return v["x-amz-date"]=F.toUTCString(),w&&(v[qq.s3.util.SESSION_TOKEN_PARAM_NAME]=w),p(x,s.signatureSpec.version,{bucket:h,content:g,contentType:y,headers:v,host:_,key:m,partNum:C,type:u,uploadId:f}).then(function(P){b=P,E.success({headers:function(){return y&&(v["Content-Type"]=y),delete v.Host,v}(),date:b.date,endOfUrl:b.endOfUrl,signedHeaders:b.signedHeaders,stringToSign:b.toSign,stringToSignRaw:b.toSignRaw})},function(P){E.failure(P)}),E},getHeaders:function(){return qq.extend({},v)},getEndOfUrl:function(){return b&&b.endOfUrl},getRequestDate:function(){return b&&b.date},getSignedHeaders:function(){return b&&b.signedHeaders}}}})},qq.s3.RequestSigner.prototype.REQUEST_TYPE={MULTIPART_INITIATE:"multipart_initiate",MULTIPART_COMPLETE:"multipart_complete",MULTIPART_ABORT:"multipart_abort",MULTIPART_UPLOAD:"multipart_upload"},qq.UploadSuccessAjaxRequester=function(e){var t,n=[],r={method:"POST",endpoint:null,maxConnections:3,customHeaders:{},paramsStore:{},cors:{expected:!1,sendCredentials:!1},log:function(i,l){}};qq.extend(r,e);function s(i,l,a){var c=n[i],d=l.responseText,p={success:!0},S={success:!1},q;delete n[i],r.log(qq.format("Received the following response body to an upload success request for id {}: {}",i,d));try{q=qq.parseJson(d),a||q&&(q.error||q.success===!1)?(r.log("Upload success request was rejected by the server.","error"),c.failure(qq.extend(q,S))):(r.log("Upload success was acknowledged by the server."),c.success(qq.extend(q,p)))}catch{a?(r.log(qq.format("Your server indicated failure in its upload success request response for id {}!",i),"error"),c.failure(S)):(r.log("Upload success was acknowledged by the server."),c.success(p))}}t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",method:r.method,endpointStore:{get:function(){return r.endpoint}},paramsStore:r.paramsStore,maxConnections:r.maxConnections,customHeaders:r.customHeaders,log:r.log,onComplete:s,cors:r.cors})),qq.extend(this,{sendSuccessRequest:function(i,l){var a=new qq.Promise;return r.log("Submitting upload success request/notification for "+i),t.initTransport(i).withParams(l).send(),n[i]=a,a}})},qq.s3.InitiateMultipartAjaxRequester=function(e){var t,n={},r={filenameParam:"qqfilename",method:"POST",endpointStore:null,paramsStore:null,signatureSpec:null,aclStore:null,reducedRedundancy:!1,serverSideEncryption:!1,maxConnections:3,getContentType:function(a){},getBucket:function(a){},getHost:function(a){},getKey:function(a){},getName:function(a){},log:function(a,c){}},s;qq.extend(r,e),s=new qq.s3.RequestSigner({endpointStore:r.endpointStore,signatureSpec:r.signatureSpec,cors:r.cors,log:r.log});function i(a){var c=r.getBucket(a),d=r.getHost(a),p={},S=new qq.Promise,q=r.getKey(a),o;return p["x-amz-acl"]=r.aclStore.get(a),r.reducedRedundancy&&(p[qq.s3.util.REDUCED_REDUNDANCY_PARAM_NAME]=qq.s3.util.REDUCED_REDUNDANCY_PARAM_VALUE),r.serverSideEncryption&&(p[qq.s3.util.SERVER_SIDE_ENCRYPTION_PARAM_NAME]=qq.s3.util.SERVER_SIDE_ENCRYPTION_PARAM_VALUE),p[qq.s3.util.AWS_PARAM_PREFIX+r.filenameParam]=encodeURIComponent(r.getName(a)),qq.each(r.paramsStore.get(a),function(u,h){qq.indexOf(qq.s3.util.UNPREFIXED_PARAM_NAMES,u)>=0?p[u]=h:p[qq.s3.util.AWS_PARAM_PREFIX+u]=encodeURIComponent(h)}),o=s.constructStringToSign(s.REQUEST_TYPE.MULTIPART_INITIATE,c,d,q).withContentType(r.getContentType(a)).withHeaders(p),s.getSignature(a,{signatureConstructor:o}).then(S.success,S.failure),S}function l(a,c,d){var p=n[a],S=new DOMParser,q=S.parseFromString(c.responseText,"application/xml"),o,u,h,_,m;delete n[a],d?(m=c.status,u=q.getElementsByTagName("Message"),u.length>0&&(_=u[0].textContent)):(o=q.getElementsByTagName("UploadId"),o.length>0?h=o[0].textContent:_="Upload ID missing from request"),h===void 0?(_?r.log(qq.format("Specific problem detected initiating multipart upload request for {}: '{}'.",a,_),"error"):r.log(qq.format("Unexplained error with initiate multipart upload request for {}.  Status code {}.",a,m),"error"),p.failure("Problem initiating upload request.",c)):(r.log(qq.format("Initiate multipart upload request successful for {}.  Upload ID is {}",a,h)),p.success(h,c))}t=qq.extend(this,new qq.AjaxRequester({method:r.method,contentType:null,endpointStore:r.endpointStore,maxConnections:r.maxConnections,allowXRequestedWithAndCacheControl:!1,log:r.log,onComplete:l,successfulResponseCodes:{POST:[200]}})),qq.extend(this,{send:function(a){var c=new qq.Promise;return i(a).then(function(d,p){r.log("Submitting S3 initiate multipart upload request for "+a),n[a]=c,t.initTransport(a).withPath(p).withHeaders(d).send()},c.failure),c}})},qq.s3.CompleteMultipartAjaxRequester=function(e){var t,n={},r={method:"POST",contentType:"text/xml",endpointStore:null,signatureSpec:null,maxConnections:3,getBucket:function(c){},getHost:function(c){},getKey:function(c){},log:function(c,d){}},s;qq.extend(r,e),s=new qq.s3.RequestSigner({endpointStore:r.endpointStore,signatureSpec:r.signatureSpec,cors:r.cors,log:r.log});function i(c,d,p){var S=new qq.Promise,q=r.getBucket(c),o=r.getHost(c),u=s.constructStringToSign(s.REQUEST_TYPE.MULTIPART_COMPLETE,q,o,r.getKey(c)).withUploadId(d).withContent(p).withContentType("application/xml; charset=UTF-8");return s.getSignature(c,{signatureConstructor:u}).then(S.success,S.failure),S}function l(c,d,p){var S=n[c],q=new DOMParser,o=r.getBucket(c);r.getKey(c);var u=q.parseFromString(d.responseText,"application/xml"),h=u.getElementsByTagName("Bucket"),_=u.getElementsByTagName("Key");delete n[c],r.log(qq.format("Complete response status {}, body = {}",d.status,d.responseText)),p?r.log(qq.format("Complete Multipart Upload request for {} failed with status {}.",c,d.status),"error"):h.length&&_.length?h[0].textContent!==o&&(p=!0,r.log(qq.format("Wrong bucket in response to Complete Multipart Upload request for {}.",c),"error")):(p=!0,r.log(qq.format("Missing bucket and/or key in response to Complete Multipart Upload request for {}.",c),"error")),p?S.failure("Problem combining the file parts!",d):S.success({},d)}function a(c){var d=document.implementation.createDocument(null,"CompleteMultipartUpload",null);return c.sort(function(p,S){return p.part-S.part}),qq.each(c,function(p,S){var q=S.part,o=S.etag,u=d.createElement("Part"),h=d.createElement("PartNumber"),_=d.createTextNode(q),m=d.createTextNode(o),v=d.createElement("ETag");v.appendChild(m),h.appendChild(_),u.appendChild(h),u.appendChild(v),qq(d).children()[0].appendChild(u)}),new XMLSerializer().serializeToString(d)}t=qq.extend(this,new qq.AjaxRequester({method:r.method,contentType:"application/xml; charset=UTF-8",endpointStore:r.endpointStore,maxConnections:r.maxConnections,allowXRequestedWithAndCacheControl:!1,log:r.log,onComplete:l,successfulResponseCodes:{POST:[200]}})),qq.extend(this,{send:function(c,d,p){var S=new qq.Promise,q=a(p);return i(c,d,q).then(function(o,u){r.log("Submitting S3 complete multipart upload request for "+c),n[c]=S,delete o["Content-Type"],t.initTransport(c).withPath(u).withHeaders(o).withPayload(q).send()},S.failure),S}})},qq.s3.AbortMultipartAjaxRequester=function(e){var t,n={method:"DELETE",endpointStore:null,signatureSpec:null,maxConnections:3,getBucket:function(l){},getHost:function(l){},getKey:function(l){},log:function(l,a){}},r;qq.extend(n,e),r=new qq.s3.RequestSigner({endpointStore:n.endpointStore,signatureSpec:n.signatureSpec,cors:n.cors,log:n.log});function s(l,a){var c=new qq.Promise,d=n.getBucket(l),p=n.getHost(l),S=r.constructStringToSign(r.REQUEST_TYPE.MULTIPART_ABORT,d,p,n.getKey(l)).withUploadId(a);return r.getSignature(l,{signatureConstructor:S}).then(c.success,c.failure),c}function i(l,a,c){var d=new DOMParser,p=d.parseFromString(a.responseText,"application/xml"),S=p.getElementsByTagName("Error"),q;n.log(qq.format("Abort response status {}, body = {}",a.status,a.responseText)),c?n.log(qq.format("Abort Multipart Upload request for {} failed with status {}.",l,a.status),"error"):S.length?(c=!0,q=p.getElementsByTagName("Message")[0].textContent,n.log(qq.format("Failed to Abort Multipart Upload request for {}.  Error: {}",l,q),"error")):n.log(qq.format("Abort MPU request succeeded for file ID {}.",l))}t=qq.extend(this,new qq.AjaxRequester({validMethods:["DELETE"],method:n.method,contentType:null,endpointStore:n.endpointStore,maxConnections:n.maxConnections,allowXRequestedWithAndCacheControl:!1,log:n.log,onComplete:i,successfulResponseCodes:{DELETE:[204]}})),qq.extend(this,{send:function(l,a){s(l,a).then(function(c,d){n.log("Submitting S3 Abort multipart upload request for "+l),t.initTransport(l).withPath(d).withHeaders(c).send()})}})},qq.s3.XhrUploadHandler=function(e,t){var n=t.getName,r=t.log,s=e.clockDrift,i=200,l=e.getBucket,a=e.getHost,c=e.getKeyName,d=e.filenameParam,p=e.paramsStore,S=e.endpointStore,q=e.aclStore,o=e.objectProperties.reducedRedundancy,u=e.objectProperties.region,h=e.objectProperties.serverSideEncryption,_=e.validation,m=qq.extend({region:u,drift:s},e.signature),v=this,f=e.signature.credentialsProvider,g={combine:function(x){var w=v._getPersistableData(x).uploadId,E=v._getPersistableData(x).etags,F=new qq.Promise;return y.completeMultipart.send(x,w,E).then(F.success,function(R,I){F.failure(b.done(x,I).response,I)}),F},done:function(x,w,E){var F=b.response.parse(x,w),P;F.success&&(P=w.getResponseHeader("ETag"),v._getPersistableData(x).etags||(v._getPersistableData(x).etags=[]),v._getPersistableData(x).etags.push({part:E+1,etag:P}))},initHeaders:function(x,w,E){var F=b.bucket.getName(x),P=b.host.getName(x),R=b.key.urlSafe(x),I=new qq.Promise,A=y.restSignature.constructStringToSign(y.restSignature.REQUEST_TYPE.MULTIPART_UPLOAD,F,P,R).withPartNum(w+1).withContent(E).withUploadId(v._getPersistableData(x).uploadId);return y.restSignature.getSignature(x+"."+w,{signatureConstructor:A}).then(I.success,I.failure),I},put:function(x,w){var E=v._createXhr(x,w),F=v._getChunkData(x,w),P=e.endpointStore.get(x),R=new qq.Promise;return g.initHeaders(x,w,F.blob).then(function(I,A){if(E._cancelled)r(qq.format("Upload of item {}.{} cancelled. Upload will not start after successful signature request.",x,w)),R.failure({error:"Chunk upload cancelled"});else{var D=P+"/"+A;v._registerProgressHandler(x,w,F.size),b.track(x,E,w).then(R.success,R.failure),E.open("PUT",D,!0);var U=!1;qq.each(I,function(T,k){T==="Content-Type"&&(U=!0),E.setRequestHeader(T,k)}),U||E.setRequestHeader("Content-Type",""),E.send(F.blob)}},function(){R.failure({error:"Problem signing the chunk!"},E)}),R},send:function(x,w){var E=new qq.Promise;return g.setup(x).then(function(){g.put(x,w).then(E.success,E.failure)},function(F,P){E.failure({error:F},P)}),E},setup:function(x){var w=new qq.Promise,E=v._getPersistableData(x).uploadId,F=new qq.Promise;return E?E instanceof qq.Promise?E.then(function(P){w.success(P)}):w.success(E):(v._getPersistableData(x).uploadId=F,y.initiateMultipart.send(x).then(function(P){v._getPersistableData(x).uploadId=P,F.success(P),w.success(P)},function(P,R){v._getPersistableData(x).uploadId=null,w.failure(P,R),F.failure(P,R)})),w}},y={abortMultipart:new qq.s3.AbortMultipartAjaxRequester({endpointStore:S,signatureSpec:m,cors:e.cors,log:r,getBucket:function(x){return b.bucket.getName(x)},getHost:function(x){return b.host.getName(x)},getKey:function(x){return b.key.urlSafe(x)}}),completeMultipart:new qq.s3.CompleteMultipartAjaxRequester({endpointStore:S,signatureSpec:m,cors:e.cors,log:r,getBucket:function(x){return b.bucket.getName(x)},getHost:function(x){return b.host.getName(x)},getKey:function(x){return b.key.urlSafe(x)}}),initiateMultipart:new qq.s3.InitiateMultipartAjaxRequester({filenameParam:d,endpointStore:S,paramsStore:p,signatureSpec:m,aclStore:q,reducedRedundancy:o,serverSideEncryption:h,cors:e.cors,log:r,getContentType:function(x){return v._getMimeType(x)},getBucket:function(x){return b.bucket.getName(x)},getHost:function(x){return b.host.getName(x)},getKey:function(x){return b.key.urlSafe(x)},getName:function(x){return n(x)}}),policySignature:new qq.s3.RequestSigner({expectingPolicy:!0,signatureSpec:m,cors:e.cors,log:r}),restSignature:new qq.s3.RequestSigner({endpointStore:S,signatureSpec:m,cors:e.cors,log:r})},C={initParams:function(x){var w=p.get(x);return w[d]=n(x),qq.s3.util.generateAwsParams({endpoint:S.get(x),clockDrift:s,params:w,type:v._getMimeType(x),bucket:b.bucket.getName(x),key:v.getThirdPartyFileId(x),accessKey:f.get().accessKey,sessionToken:f.get().sessionToken,acl:q.get(x),expectedStatus:i,minFileSize:_.minSizeLimit,maxFileSize:_.maxSizeLimit,reducedRedundancy:o,region:u,serverSideEncryption:h,signatureVersion:m.version,log:r},qq.bind(y.policySignature.getSignature,this,x))},send:function(x){var w=new qq.Promise,E=v._createXhr(x),F=v.getFile(x);return v._registerProgressHandler(x),b.track(x,E).then(w.success,w.failure),C.setup(x,E,F).then(function(P){r("Sending upload request for "+x),E.send(P)},w.failure),w},setup:function(x,w,E){var F=new FormData,P=S.get(x),R=P,I=new qq.Promise;return C.initParams(x).then(function(A){w.open("POST",R,!0),qq.obj2FormData(A,F),F.append("file",E),I.success(F)},function(A){I.failure({error:A})}),I}},b={bucket:{promise:function(x){var w=new qq.Promise,E=v._getFileState(x).bucket;return E?w.success(E):l(x).then(function(F){v._getFileState(x).bucket=F,w.success(F)},w.failure),w},getName:function(x){return v._getFileState(x).bucket}},host:{promise:function(x){var w=new qq.Promise,E=v._getFileState(x).host;return E?w.success(E):a(x).then(function(F){v._getFileState(x).host=F,w.success(F)},w.failure),w},getName:function(x){return v._getFileState(x).host}},done:function(x,w){var E=b.response.parse(x,w),F=E.success!==!0;return F&&b.response.shouldReset(E.code)&&(r("This is an unrecoverable error, we must restart the upload entirely on the next retry attempt.","error"),E.reset=!0),{success:!F,response:E}},key:{promise:function(x){var w=new qq.Promise,E=v.getThirdPartyFileId(x);return E==null?(v._setThirdPartyFileId(x,w),c(x,n(x)).then(function(F){v._setThirdPartyFileId(x,F),w.success(F)},function(F){v._setThirdPartyFileId(x,null),w.failure(F)})):qq.isGenericPromise(E)?E.then(w.success,w.failure):w.success(E),w},urlSafe:function(x){var w=v.getThirdPartyFileId(x);return qq.s3.util.uriEscapePath(w)}},response:{parse:function(x,w){var E={},F;try{r(qq.format("Received response status {} with body: {}",w.status,w.responseText)),w.status===i?E.success=!0:(F=b.response.parseError(w.responseText),F&&(E.error=F.message,E.code=F.code))}catch(P){r("Error when attempting to parse xhr response text ("+P.message+")","error")}return E},parseError:function(x){var w=new DOMParser,E=w.parseFromString(x,"application/xml"),F=E.getElementsByTagName("Error"),P={},R,I;if(F.length)return R=E.getElementsByTagName("Code"),I=E.getElementsByTagName("Message"),I.length&&(P.message=I[0].textContent),R.length&&(P.code=R[0].textContent),P},shouldReset:function(x){return x==="EntityTooSmall"||x==="InvalidPart"||x==="InvalidPartOrder"||x==="NoSuchUpload"}},start:function(x){var w=x.id,E=x.chunkIdx,F=new qq.Promise;return b.key.promise(w).then(function(){b.bucket.promise(w).then(function(){b.host.promise(w).then(function(){E==null?C.send(w).then(F.success,F.failure):g.send(w,E).then(F.success,F.failure)})})},function(P){F.failure({error:P})}),F},track:function(x,w,E){var F=new qq.Promise;return w.onreadystatechange=function(){if(w.readyState===4){var P;E==null?(P=b.done(x,w),F[P.success?"success":"failure"](P.response,w)):(g.done(x,w,E),P=b.done(x,w),F[P.success?"success":"failure"](P.response,w))}},F}};qq.extend(this,{uploadChunk:b.start,uploadFile:function(x){return b.start({id:x})}}),qq.extend(this,new qq.XhrUploadHandler({options:qq.extend({namespace:"s3"},e),proxy:qq.extend({getEndpoint:e.endpointStore.get},t)})),qq.override(this,function(x){return{expunge:function(w){var E=v._getPersistableData(w)&&v._getPersistableData(w).uploadId,F=v._maybeDeletePersistedChunkData(w);E!==void 0&&F&&y.abortMultipart.send(w,E),x.expunge(w)},finalizeChunks:function(w){return g.combine(w)},_getLocalStorageId:function(w){var E=x._getLocalStorageId(w),F=b.bucket.getName(w);return E+"-"+F}}})},qq.s3.FormUploadHandler=function(e,t){var n=this,r=e.clockDrift,s=t.onUuidChanged,i=t.getName,l=t.getUuid,a=t.log,c=e.getBucket,d=e.getKeyName,p=e.filenameParam,S=e.paramsStore,q=e.endpointStore,o=e.aclStore,u=e.objectProperties.reducedRedundancy,h=e.objectProperties.region,_=e.objectProperties.serverSideEncryption,m=e.validation,v=e.signature,f=e.iframeSupport.localBlankPagePath,g=e.signature.credentialsProvider,y=new qq.s3.RequestSigner({signatureSpec:v,cors:e.cors,log:a});if(f===void 0)throw new Error("successRedirectEndpoint MUST be defined if you intend to use browsers that do not support the File API!");function C(F,P){e.endpointStore.get(F);var R=n._getFileState(F).bucket,I,A,D;try{if(I=P.contentDocument||P.contentWindow.document,A=I.body.innerHTML,D=qq.s3.util.parseIframeResponse(P),D.bucket===R&&D.key===qq.s3.util.encodeQueryStringParam(n.getThirdPartyFileId(F)))return!0;a("Response from AWS included an unexpected bucket or key name.","error")}catch(U){a("Error when attempting to parse form upload response ("+U.message+")","error")}return!1}function b(F){var P=S.get(F);return P[p]=i(F),qq.s3.util.generateAwsParams({endpoint:q.get(F),clockDrift:r,params:P,bucket:n._getFileState(F).bucket,key:n.getThirdPartyFileId(F),accessKey:g.get().accessKey,sessionToken:g.get().sessionToken,acl:o.get(F),minFileSize:m.minSizeLimit,maxFileSize:m.maxSizeLimit,successRedirectUrl:f,reducedRedundancy:u,region:h,serverSideEncryption:_,signatureVersion:v.version,log:a},qq.bind(y.getSignature,this,F))}function x(F,P){var R=new qq.Promise,I="POST",A=e.endpointStore.get(F);return i(F),b(F).then(function(D){var U=n._initFormForUpload({method:I,endpoint:A,params:D,paramsInBody:!0,targetName:P.name});R.success(U)},function(D){R.failure(D),E(F,P)}),R}function w(F){var P=n._createIframe(F),R=n.getInput(F),I=new qq.Promise;return x(F,P).then(function(A){A.appendChild(R),n._attachLoadEvent(P,function(D){a("iframe loaded"),D?D.success===!1&&(a("Amazon likely rejected the upload request","error"),I.failure(D)):(D={},D.success=C(F,P),D.success===!1?(a("A success response was received by Amazon, but it was invalid in some way.","error"),I.failure(D)):(qq.extend(D,qq.s3.util.parseIframeResponse(P)),I.success(D))),E(F,P)}),a("Sending upload request for "+F),A.submit(),qq(A).remove()},I.failure),I}function E(F,P){n._detachLoadEvent(F),P&&qq(P).remove()}qq.extend(this,new qq.FormUploadHandler({options:{isCors:!1,inputName:"file"},proxy:{onCancel:e.onCancel,onUuidChanged:s,getName:i,getUuid:l,log:a}})),qq.extend(this,{uploadFile:function(F){var P=i(F),R=new qq.Promise;return n.getThirdPartyFileId(F)?n._getFileState(F).bucket?w(F).then(R.success,R.failure):c(F).then(function(I){n._getFileState(F).bucket=I,w(F).then(R.success,R.failure)}):d(F,P).then(function(I){c(F).then(function(A){n._getFileState(F).bucket=A,n._setThirdPartyFileId(F,I),w(F).then(R.success,R.failure)},function(A){R.failure({error:A})})},function(I){R.failure({error:I})}),R}})}})(window)})(s3_fineUploader_core);var s3_fineUploader_coreExports=s3_fineUploader_core.exports,s3=s3_fineUploader_coreExports,azure_fineUploader_core={exports:{}};(function(module){(function(global){var qq=function(e){return{hide:function(){return e.style.display="none",this},attach:function(t,n){return e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n),function(){qq(e).detach(t,n)}},detach:function(t,n){return e.removeEventListener?e.removeEventListener(t,n,!1):e.attachEvent&&e.detachEvent("on"+t,n),this},contains:function(t){return t?e===t?!0:e.contains?e.contains(t):!!(t.compareDocumentPosition(e)&8):!1},insertBefore:function(t){return t.parentNode.insertBefore(e,t),this},remove:function(){return e.parentNode.removeChild(e),this},css:function(t){if(e.style==null)throw new qq.Error("Can't apply style to node as it is not on the HTMLElement prototype chain!");return t.opacity!=null&&typeof e.style.opacity!="string"&&typeof e.filters<"u"&&(t.filter="alpha(opacity="+Math.round(100*t.opacity)+")"),qq.extend(e.style,t),this},hasClass:function(t,n){var r=new RegExp("(^| )"+t+"( |$)");return r.test(e.className)||!!(n&&r.test(e.parentNode.className))},addClass:function(t){return qq(e).hasClass(t)||(e.className+=" "+t),this},removeClass:function(t){var n=new RegExp("(^| )"+t+"( |$)");return e.className=e.className.replace(n," ").replace(/^\s+|\s+$/g,""),this},getByClass:function(t,n){var r,s=[];return n&&e.querySelector?e.querySelector("."+t):e.querySelectorAll?e.querySelectorAll("."+t):(r=e.getElementsByTagName("*"),qq.each(r,function(i,l){qq(l).hasClass(t)&&s.push(l)}),n?s[0]:s)},getFirstByClass:function(t){return qq(e).getByClass(t,!0)},children:function(){for(var t=[],n=e.firstChild;n;)n.nodeType===1&&t.push(n),n=n.nextSibling;return t},setText:function(t){return e.innerText=t,e.textContent=t,this},clearText:function(){return qq(e).setText("")},hasAttribute:function(t){var n;return e.hasAttribute?e.hasAttribute(t)?/^false$/i.exec(e.getAttribute(t))==null:!1:(n=e[t],n===void 0?!1:/^false$/i.exec(n)==null)}}};(function(){qq.canvasToBlob=function(e,t,n){return qq.dataUriToBlob(e.toDataURL(t,n))},qq.dataUriToBlob=function(e){var t,n,r=function(l,a){var c=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,d=c&&new c;return d?(d.append(l),d.getBlob(a)):new Blob([l],{type:a})},s,i;return e.split(",")[0].indexOf("base64")>=0?n=atob(e.split(",")[1]):n=decodeURI(e.split(",")[1]),i=e.split(",")[0].split(":")[1].split(";")[0],t=new ArrayBuffer(n.length),s=new Uint8Array(t),qq.each(n,function(l,a){s[l]=a.charCodeAt(0)}),r(t,i)},qq.log=function(e,t){window.console&&(!t||t==="info"?window.console.log(e):window.console[t]?window.console[t](e):window.console.log("<"+t+"> "+e))},qq.isObject=function(e){return e&&!e.nodeType&&Object.prototype.toString.call(e)==="[object Object]"},qq.isFunction=function(e){return typeof e=="function"},qq.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"||e&&window.ArrayBuffer&&e.buffer&&e.buffer.constructor===ArrayBuffer},qq.isItemList=function(e){return Object.prototype.toString.call(e)==="[object DataTransferItemList]"},qq.isNodeList=function(e){return Object.prototype.toString.call(e)==="[object NodeList]"||e.item&&e.namedItem},qq.isString=function(e){return Object.prototype.toString.call(e)==="[object String]"},qq.trimStr=function(e){return String.prototype.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},qq.format=function(e){var t=Array.prototype.slice.call(arguments,1),n=e,r=n.indexOf("{}");return qq.each(t,function(s,i){var l=n.substring(0,r),a=n.substring(r+2);if(n=l+i+a,r=n.indexOf("{}",r+i.length),r<0)return!1}),n},qq.isFile=function(e){return window.File&&Object.prototype.toString.call(e)==="[object File]"},qq.isFileList=function(e){return window.FileList&&Object.prototype.toString.call(e)==="[object FileList]"},qq.isFileOrInput=function(e){return qq.isFile(e)||qq.isInput(e)},qq.isInput=function(e,t){var n=function(r){var s=r.toLowerCase();return t?s!=="file":s==="file"};return!!(window.HTMLInputElement&&Object.prototype.toString.call(e)==="[object HTMLInputElement]"&&e.type&&n(e.type)||e.tagName&&e.tagName.toLowerCase()==="input"&&e.type&&n(e.type))},qq.isBlob=function(e){if(window.Blob&&Object.prototype.toString.call(e)==="[object Blob]")return!0},qq.isXhrUploadSupported=function(){var e=document.createElement("input");return e.type="file",e.multiple!==void 0&&typeof File<"u"&&typeof FormData<"u"&&typeof qq.createXhrInstance().upload<"u"},qq.createXhrInstance=function(){if(window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch{return qq.log("Neither XHR or ActiveX are supported!","error"),null}},qq.isFolderDropSupported=function(e){return e.items&&e.items.length>0&&e.items[0].webkitGetAsEntry},qq.isFileChunkingSupported=function(){return!qq.androidStock()&&qq.isXhrUploadSupported()&&(File.prototype.slice!==void 0||File.prototype.webkitSlice!==void 0||File.prototype.mozSlice!==void 0)},qq.sliceBlob=function(e,t,n){var r=e.slice||e.mozSlice||e.webkitSlice;return r.call(e,t,n)},qq.arrayBufferToHex=function(e){var t="",n=new Uint8Array(e);return qq.each(n,function(r,s){var i=s.toString(16);i.length<2&&(i="0"+i),t+=i}),t},qq.readBlobToHex=function(e,t,n){var r=qq.sliceBlob(e,t,t+n),s=new FileReader,i=new qq.Promise;return s.onload=function(){i.success(qq.arrayBufferToHex(s.result))},s.onerror=i.failure,s.readAsArrayBuffer(r),i},qq.extend=function(e,t,n){return qq.each(t,function(r,s){n&&qq.isObject(s)?(e[r]===void 0&&(e[r]={}),qq.extend(e[r],s,!0)):e[r]=s}),e},qq.override=function(e,t){var n={},r=t(n);return qq.each(r,function(s,i){e[s]!==void 0&&(n[s]=e[s]),e[s]=i}),e},qq.indexOf=function(e,t,n){if(e.indexOf)return e.indexOf(t,n);n=n||0;var r=e.length;for(n<0&&(n+=r);n<r;n+=1)if(e.hasOwnProperty(n)&&e[n]===t)return n;return-1},qq.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)})},qq.ie=function(){return navigator.userAgent.indexOf("MSIE")!==-1||navigator.userAgent.indexOf("Trident")!==-1},qq.ie7=function(){return navigator.userAgent.indexOf("MSIE 7")!==-1},qq.ie8=function(){return navigator.userAgent.indexOf("MSIE 8")!==-1},qq.ie10=function(){return navigator.userAgent.indexOf("MSIE 10")!==-1},qq.ie11=function(){return qq.ie()&&navigator.userAgent.indexOf("rv:11")!==-1},qq.edge=function(){return navigator.userAgent.indexOf("Edge")>=0},qq.safari=function(){return navigator.vendor!==void 0&&navigator.vendor.indexOf("Apple")!==-1},qq.chrome=function(){return navigator.vendor!==void 0&&navigator.vendor.indexOf("Google")!==-1},qq.opera=function(){return navigator.vendor!==void 0&&navigator.vendor.indexOf("Opera")!==-1},qq.firefox=function(){return!qq.edge()&&!qq.ie11()&&navigator.userAgent.indexOf("Mozilla")!==-1&&navigator.vendor!==void 0&&navigator.vendor===""},qq.windows=function(){return navigator.platform==="Win32"},qq.android=function(){return navigator.userAgent.toLowerCase().indexOf("android")!==-1},qq.androidStock=function(){return qq.android()&&navigator.userAgent.toLowerCase().indexOf("chrome")<0},qq.ios6=function(){return qq.ios()&&navigator.userAgent.indexOf(" OS 6_")!==-1},qq.ios7=function(){return qq.ios()&&navigator.userAgent.indexOf(" OS 7_")!==-1},qq.ios8=function(){return qq.ios()&&navigator.userAgent.indexOf(" OS 8_")!==-1},qq.ios800=function(){return qq.ios()&&navigator.userAgent.indexOf(" OS 8_0 ")!==-1},qq.ios=function(){return navigator.userAgent.indexOf("iPad")!==-1||navigator.userAgent.indexOf("iPod")!==-1||navigator.userAgent.indexOf("iPhone")!==-1},qq.iosChrome=function(){return qq.ios()&&navigator.userAgent.indexOf("CriOS")!==-1},qq.iosSafari=function(){return qq.ios()&&!qq.iosChrome()&&navigator.userAgent.indexOf("Safari")!==-1},qq.iosSafariWebView=function(){return qq.ios()&&!qq.iosChrome()&&!qq.iosSafari()},qq.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},qq.toElement=function(){var e=document.createElement("div");return function(t){e.innerHTML=t;var n=e.firstChild;return e.removeChild(n),n}}(),qq.each=function(e,t){var n,r;if(e){if(window.Storage&&e.constructor===window.Storage)for(n=0;n<e.length&&(r=t(e.key(n),e.getItem(e.key(n))),r!==!1);n++);else if(qq.isArray(e)||qq.isItemList(e)||qq.isNodeList(e))for(n=0;n<e.length&&(r=t(n,e[n]),r!==!1);n++);else if(qq.isString(e))for(n=0;n<e.length&&(r=t(n,e.charAt(n)),r!==!1);n++);else for(n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&(r=t(n,e[n]),r===!1))break}},qq.bind=function(e,t){if(qq.isFunction(e)){var n=Array.prototype.slice.call(arguments,2);return function(){var r=qq.extend([],n);return arguments.length&&(r=r.concat(Array.prototype.slice.call(arguments))),e.apply(t,r)}}throw new Error("first parameter must be a function!")},qq.obj2url=function(e,t,n){var r=[],s="&",i=function(l,a){var c=t?/\[\]$/.test(t)?t:t+"["+a+"]":a;c!=="undefined"&&a!=="undefined"&&r.push(typeof l=="object"?qq.obj2url(l,c,!0):Object.prototype.toString.call(l)==="[object Function]"?encodeURIComponent(c)+"="+encodeURIComponent(l()):encodeURIComponent(c)+"="+encodeURIComponent(l))};return!n&&t?(s=/\?/.test(t)?/\?$/.test(t)?"":"&":"?",r.push(t),r.push(qq.obj2url(e))):Object.prototype.toString.call(e)==="[object Array]"&&typeof e<"u"?qq.each(e,function(l,a){i(a,l)}):typeof e<"u"&&e!==null&&typeof e=="object"?qq.each(e,function(l,a){i(a,l)}):r.push(encodeURIComponent(t)+"="+encodeURIComponent(e)),t?r.join(s):r.join(s).replace(/^&/,"").replace(/%20/g,"+")},qq.obj2FormData=function(e,t,n){return t||(t=new FormData),qq.each(e,function(r,s){r=n?n+"["+r+"]":r,qq.isObject(s)?qq.obj2FormData(s,t,r):qq.isFunction(s)?t.append(r,s()):t.append(r,s)}),t},qq.obj2Inputs=function(e,t){var n;return t||(t=document.createElement("form")),qq.obj2FormData(e,{append:function(r,s){n=document.createElement("input"),n.setAttribute("name",r),n.setAttribute("value",s),t.appendChild(n)}}),t},qq.parseJson=function(json){return window.JSON&&qq.isFunction(JSON.parse)?JSON.parse(json):eval("("+json+")")},qq.getExtension=function(e){var t=e.lastIndexOf(".")+1;if(t>0)return e.substr(t,e.length-t)},qq.getFilename=function(e){return qq.isInput(e)?e.value.replace(/.*(\/|\\)/,""):qq.isFile(e)&&e.fileName!==null&&e.fileName!==void 0?e.fileName:e.name},qq.DisposeSupport=function(){var e=[];return{dispose:function(){var t;do t=e.shift(),t&&t();while(t)},attach:function(){var t=arguments;this.addDisposer(qq(t[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(t){e.push(t)}}}})(),function(){module.exports?module.exports=qq:global.qq=qq}(),function(){qq.Error=function(e){this.message="[Fine Uploader "+qq.version+"] "+e},qq.Error.prototype=new Error}(),qq.version="5.16.2",qq.supportedFeatures=function(){var e,t,n,r,s,i,l,a,c,d,p,S,q,o,u;function h(){var b=!0,x;try{x=document.createElement("input"),x.type="file",qq(x).hide(),x.disabled&&(b=!1)}catch{b=!1}return b}function _(){return(qq.chrome()||qq.opera())&&navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/)!==void 0}function m(){if(window.XMLHttpRequest){var b=qq.createXhrInstance();return b.withCredentials!==void 0}return!1}function v(){return window.XDomainRequest!==void 0}function f(){return m()?!0:v()}function g(){return document.createElement("input").webkitdirectory!==void 0}function y(){try{return!!window.localStorage&&qq.isFunction(window.localStorage.setItem)}catch{return!1}}function C(){var b=document.createElement("span");return("draggable"in b||"ondragstart"in b&&"ondrop"in b)&&!qq.android()&&!qq.ios()}return e=h(),r=e&&qq.isXhrUploadSupported(),t=r&&!qq.androidStock(),n=r&&C(),s=n&&function(){var b=document.createElement("input");return b.type="file","webkitdirectory"in(b||document.querySelectorAll("input[type=file]")[0])}(),i=r&&qq.isFileChunkingSupported(),l=r&&i&&y(),a=r&&_(),c=e&&(window.postMessage!==void 0||r),p=m(),d=v(),S=f(),q=g(),o=r&&window.FileReader!==void 0,u=function(){return r?!qq.androidStock()&&!qq.iosChrome():!1}(),{ajaxUploading:r,blobUploading:t,canDetermineSize:r,chunking:i,deleteFileCors:S,deleteFileCorsXdr:d,deleteFileCorsXhr:p,dialogElement:!!window.HTMLDialogElement,fileDrop:n,folderDrop:s,folderSelection:q,imagePreviews:o,imageValidation:o,itemSizeValidation:r,pause:i,progressBar:u,resume:l,scaling:o&&t,tiffPreviews:qq.safari(),unlimitedScaledImageSize:!qq.ios(),uploading:e,uploadCors:c,uploadCustomHeaders:r,uploadNonMultipart:r,uploadViaPaste:a}}(),qq.isGenericPromise=function(e){return!!(e&&e.then&&qq.isFunction(e.then))},qq.Promise=function(){var e,t,n=[],r=[],s=[],i=0;qq.extend(this,{then:function(l,a){return i===0?(l&&n.push(l),a&&r.push(a)):i===-1?a&&a.apply(null,t):l&&l.apply(null,e),this},done:function(l){return i===0?s.push(l):l.apply(null,t===void 0?e:t),this},success:function(){return i=1,e=arguments,n.length&&qq.each(n,function(l,a){a.apply(null,e)}),s.length&&qq.each(s,function(l,a){a.apply(null,e)}),this},failure:function(){return i=-1,t=arguments,r.length&&qq.each(r,function(l,a){a.apply(null,t)}),s.length&&qq.each(s,function(l,a){a.apply(null,t)}),this}})},qq.BlobProxy=function(e,t){qq.extend(this,{referenceBlob:e,create:function(){return t(e)}})},qq.UploadButton=function(e){var t=this,n=new qq.DisposeSupport,r={acceptFiles:null,element:null,focusClass:"qq-upload-button-focus",folders:!1,hoverClass:"qq-upload-button-hover",ios8BrowserCrashWorkaround:!1,multiple:!1,name:"qqfile",onChange:function(a){},title:null},s,i;qq.extend(r,e),i=qq.getUniqueId();function l(){var a=document.createElement("input");return a.setAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME,i),a.setAttribute("title",r.title),t.setMultiple(r.multiple,a),r.folders&&qq.supportedFeatures.folderSelection&&a.setAttribute("webkitdirectory",""),r.acceptFiles&&a.setAttribute("accept",r.acceptFiles),a.setAttribute("type","file"),a.setAttribute("name",r.name),qq(a).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:qq.ie()&&!qq.ie8()?"3500px":"118px",margin:0,padding:0,cursor:"pointer",opacity:0}),!qq.ie7()&&qq(a).css({height:"100%"}),r.element.appendChild(a),n.attach(a,"change",function(){r.onChange(a)}),n.attach(a,"mouseover",function(){qq(r.element).addClass(r.hoverClass)}),n.attach(a,"mouseout",function(){qq(r.element).removeClass(r.hoverClass)}),n.attach(a,"focus",function(){qq(r.element).addClass(r.focusClass)}),n.attach(a,"blur",function(){qq(r.element).removeClass(r.focusClass)}),a}qq(r.element).css({position:"relative",overflow:"hidden",direction:"ltr"}),qq.extend(this,{getInput:function(){return s},getButtonId:function(){return i},setMultiple:function(a,c){var d=c||this.getInput();r.ios8BrowserCrashWorkaround&&qq.ios8()&&(qq.iosChrome()||qq.iosSafariWebView())||a?d.setAttribute("multiple",""):d.removeAttribute("multiple")},setAcceptFiles:function(a){a!==r.acceptFiles&&s.setAttribute("accept",a)},reset:function(){s.parentNode&&qq(s).remove(),qq(r.element).removeClass(r.focusClass),s=null,s=l()}}),s=l()},qq.UploadButton.BUTTON_ID_ATTR_NAME="qq-button-id",qq.UploadData=function(e){var t=[],n={},r={},s={},i={};function l(d){if(qq.isArray(d)){var p=[];return qq.each(d,function(S,q){p.push(t[q])}),p}return t[d]}function a(d){if(qq.isArray(d)){var p=[];return qq.each(d,function(S,q){p.push(t[n[q]])}),p}return t[n[d]]}function c(d){var p=[],S=[].concat(d);return qq.each(S,function(q,o){var u=r[o];u!==void 0&&qq.each(u,function(h,_){p.push(t[_])})}),p}qq.extend(this,{addFile:function(d){var p=d.status||qq.status.SUBMITTING,S=t.push({name:d.name,originalName:d.name,uuid:d.uuid,size:d.size==null?-1:d.size,status:p,file:d.file})-1;return d.batchId&&(t[S].batchId=d.batchId,i[d.batchId]===void 0&&(i[d.batchId]=[]),i[d.batchId].push(S)),d.proxyGroupId&&(t[S].proxyGroupId=d.proxyGroupId,s[d.proxyGroupId]===void 0&&(s[d.proxyGroupId]=[]),s[d.proxyGroupId].push(S)),t[S].id=S,n[d.uuid]=S,r[p]===void 0&&(r[p]=[]),r[p].push(S),d.onBeforeStatusChange&&d.onBeforeStatusChange(S),e.onStatusChange(S,null,p),S},retrieve:function(d){if(qq.isObject(d)&&t.length){if(d.id!==void 0)return l(d.id);if(d.uuid!==void 0)return a(d.uuid);if(d.status)return c(d.status)}else return qq.extend([],t,!0)},removeFileRef:function(d){var p=l(d);p&&delete p.file},reset:function(){t=[],n={},r={},i={}},setStatus:function(d,p){var S=t[d].status,q=qq.indexOf(r[S],d);r[S].splice(q,1),t[d].status=p,r[p]===void 0&&(r[p]=[]),r[p].push(d),e.onStatusChange(d,S,p)},uuidChanged:function(d,p){var S=t[d].uuid;t[d].uuid=p,n[p]=d,delete n[S]},updateName:function(d,p){t[d].name=p},updateSize:function(d,p){t[d].size=p},setParentId:function(d,p){t[d].parentId=p},getIdsInProxyGroup:function(d){var p=t[d].proxyGroupId;return p?s[p]:[]},getIdsInBatch:function(d){var p=t[d].batchId;return i[p]}})},qq.status={SUBMITTING:"submitting",SUBMITTED:"submitted",REJECTED:"rejected",QUEUED:"queued",CANCELED:"canceled",PAUSED:"paused",UPLOADING:"uploading",UPLOAD_FINALIZING:"upload finalizing",UPLOAD_RETRYING:"retrying upload",UPLOAD_SUCCESSFUL:"upload successful",UPLOAD_FAILED:"upload failed",DELETE_FAILED:"delete failed",DELETING:"deleting",DELETED:"deleted"},function(){qq.basePublicApi={addBlobs:function(e,t,n){this.addFiles(e,t,n)},addInitialFiles:function(e){var t=this;qq.each(e,function(n,r){t._addCannedFile(r)})},addFiles:function(e,t,n){this._maybeHandleIos8SafariWorkaround();var r=this._storedIds.length===0?qq.getUniqueId():this._currentBatchId,s=qq.bind(function(q){this._handleNewFile({blob:q,name:this._options.blobs.defaultName},r,S)},this),i=qq.bind(function(q){this._handleNewFile(q,r,S)},this),l=qq.bind(function(q){var o=qq.canvasToBlob(q);this._handleNewFile({blob:o,name:this._options.blobs.defaultName+".png"},r,S)},this),a=qq.bind(function(q){var o=q.quality&&q.quality/100,u=qq.canvasToBlob(q.canvas,q.type,o);this._handleNewFile({blob:u,name:q.name},r,S)},this),c=qq.bind(function(q){if(qq.isInput(q)&&qq.supportedFeatures.ajaxUploading){var o=Array.prototype.slice.call(q.files),u=this;qq.each(o,function(h,_){u._handleNewFile(_,r,S)})}else this._handleNewFile(q,r,S)},this),d=function(){qq.isFileList(e)&&(e=Array.prototype.slice.call(e)),e=[].concat(e)},p=this,S=[];this._currentBatchId=r,e&&(d(),qq.each(e,function(q,o){qq.isFileOrInput(o)?c(o):qq.isBlob(o)?s(o):qq.isObject(o)?o.blob&&o.name?i(o):o.canvas&&o.name&&a(o):o.tagName&&o.tagName.toLowerCase()==="canvas"?l(o):p.log(o+" is not a valid file container!  Ignoring!","warn")}),this.log("Received "+S.length+" files."),this._prepareItemsForUpload(S,t,n))},cancel:function(e){var t=this._uploadData.retrieve({id:e});t&&t.status===qq.status.UPLOAD_FINALIZING?this.log(qq.format("Ignoring cancel for file ID {} ({}).  Finalizing upload.",e,this.getName(e)),"error"):this._handler.cancel(e)},cancelAll:function(){var e=[],t=this;qq.extend(e,this._storedIds),qq.each(e,function(n,r){t.cancel(r)}),this._handler.cancelAll()},clearStoredFiles:function(){this._storedIds=[]},continueUpload:function(e){var t=this._uploadData.retrieve({id:e});return!qq.supportedFeatures.pause||!this._options.chunking.enabled?!1:t.status===qq.status.PAUSED?(this.log(qq.format("Paused file ID {} ({}) will be continued.  Not paused.",e,this.getName(e))),this._uploadFile(e),!0):(this.log(qq.format("Ignoring continue for file ID {} ({}).  Not paused.",e,this.getName(e)),"error"),!1)},deleteFile:function(e){return this._onSubmitDelete(e)},doesExist:function(e){return this._handler.isValid(e)},drawThumbnail:function(e,t,n,r,s){var i=new qq.Promise,l,a;return this._imageGenerator?(l=this._thumbnailUrls[e],a={customResizeFunction:s,maxSize:n>0?n:null,scale:n>0},!r&&qq.supportedFeatures.imagePreviews&&(l=this.getFile(e)),l==null?i.failure({container:t,error:"File or URL not found."}):this._imageGenerator.generate(l,t,a).then(function(d){i.success(d)},function(d,p){i.failure({container:d,error:p||"Problem generating thumbnail"})})):i.failure({container:t,error:"Missing image generator module"}),i},getButton:function(e){return this._getButton(this._buttonIdsForFileIds[e])},getEndpoint:function(e){return this._endpointStore.get(e)},getFile:function(e){var t=this._handler.getFile(e),n;return t||(n=this._uploadData.retrieve({id:e}),n&&(t=n.file)),t||null},getInProgress:function(){return this._uploadData.retrieve({status:[qq.status.UPLOADING,qq.status.UPLOAD_RETRYING,qq.status.QUEUED]}).length},getName:function(e){return this._uploadData.retrieve({id:e}).name},getParentId:function(e){var t=this.getUploads({id:e}),n=null;return t&&t.parentId!==void 0&&(n=t.parentId),n},getResumableFilesData:function(){return this._handler.getResumableFilesData()},getSize:function(e){return this._uploadData.retrieve({id:e}).size},getNetUploads:function(){return this._netUploaded},getRemainingAllowedItems:function(){var e=this._currentItemLimit;return e>0?e-this._netUploadedOrQueued:null},getUploads:function(e){return this._uploadData.retrieve(e)},getUuid:function(e){return this._uploadData.retrieve({id:e}).uuid},isResumable:function(e){return this._handler.hasResumeRecord(e)},log:function(e,t){this._options.debug&&(!t||t==="info")?qq.log("[Fine Uploader "+qq.version+"] "+e):t&&t!=="info"&&qq.log("[Fine Uploader "+qq.version+"] "+e,t)},pauseUpload:function(e){var t=this._uploadData.retrieve({id:e});if(!qq.supportedFeatures.pause||!this._options.chunking.enabled)return!1;if(qq.indexOf([qq.status.UPLOADING,qq.status.UPLOAD_RETRYING],t.status)>=0){if(this._handler.pause(e))return this._uploadData.setStatus(e,qq.status.PAUSED),!0;this.log(qq.format("Unable to pause file ID {} ({}).",e,this.getName(e)),"error")}else this.log(qq.format("Ignoring pause for file ID {} ({}).  Not in progress.",e,this.getName(e)),"error");return!1},removeFileRef:function(e){this._handler.expunge(e),this._uploadData.removeFileRef(e)},reset:function(){this.log("Resetting uploader..."),this._handler.reset(),this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._thumbnailUrls=[],qq.each(this._buttons,function(e,t){t.reset()}),this._paramsStore.reset(),this._endpointStore.reset(),this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData.reset(),this._buttonIdsForFileIds=[],this._pasteHandler&&this._pasteHandler.reset(),this._options.session.refreshOnReset&&this._refreshSessionData(),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[],this._totalProgress&&this._totalProgress.reset(),this._customResumeDataStore.reset()},retry:function(e){return this._manualRetry(e)},scaleImage:function(e,t){var n=this;return qq.Scaler.prototype.scaleImage(e,t,{log:qq.bind(n.log,n),getFile:qq.bind(n.getFile,n),uploadData:n._uploadData})},setCustomHeaders:function(e,t){this._customHeadersStore.set(e,t)},setCustomResumeData:function(e,t){this._customResumeDataStore.set(t,e)},setDeleteFileCustomHeaders:function(e,t){this._deleteFileCustomHeadersStore.set(e,t)},setDeleteFileEndpoint:function(e,t){this._deleteFileEndpointStore.set(e,t)},setDeleteFileParams:function(e,t){this._deleteFileParamsStore.set(e,t)},setEndpoint:function(e,t){this._endpointStore.set(e,t)},setForm:function(e){this._updateFormSupportAndParams(e)},setItemLimit:function(e){this._currentItemLimit=e},setName:function(e,t){this._uploadData.updateName(e,t)},setParams:function(e,t){this._paramsStore.set(e,t)},setUuid:function(e,t){return this._uploadData.uuidChanged(e,t)},setStatus:function(e,t){var n=this.getUploads({id:e});if(!n)throw new qq.Error(e+" is not a valid file ID.");switch(t){case qq.status.DELETED:this._onDeleteComplete(e,null,!1);break;case qq.status.DELETE_FAILED:this._onDeleteComplete(e,null,!0);break;default:var r="Method setStatus called on '"+name+"' not implemented yet for "+t;throw this.log(r),new qq.Error(r)}},uploadStoredFiles:function(){this._storedIds.length===0?this._itemError("noFilesError"):this._uploadStoredFiles()}},qq.basePrivateApi={_addCannedFile:function(e){var t=this;return this._uploadData.addFile({uuid:e.uuid,name:e.name,size:e.size,status:qq.status.UPLOAD_SUCCESSFUL,onBeforeStatusChange:function(n){e.deleteFileEndpoint&&t.setDeleteFileEndpoint(e.deleteFileEndpoint,n),e.deleteFileParams&&t.setDeleteFileParams(e.deleteFileParams,n),e.thumbnailUrl&&(t._thumbnailUrls[n]=e.thumbnailUrl),t._netUploaded++,t._netUploadedOrQueued++}})},_annotateWithButtonId:function(e,t){qq.isFile(e)&&(e.qqButtonId=this._getButtonId(t))},_batchError:function(e){this._options.callbacks.onError(null,null,e,void 0)},_createDeleteHandler:function(){var e=this;return new qq.DeleteFileAjaxRequester({method:this._options.deleteFile.method.toUpperCase(),maxConnections:this._options.maxConnections,uuidParamName:this._options.request.uuidName,customHeaders:this._deleteFileCustomHeadersStore,paramsStore:this._deleteFileParamsStore,endpointStore:this._deleteFileEndpointStore,cors:this._options.cors,log:qq.bind(e.log,e),onDelete:function(t){e._onDelete(t),e._options.callbacks.onDelete(t)},onDeleteComplete:function(t,n,r){e._onDeleteComplete(t,n,r),e._options.callbacks.onDeleteComplete(t,n,r)}})},_createPasteHandler:function(){var e=this;return new qq.PasteSupport({targetElement:this._options.paste.targetElement,callbacks:{log:qq.bind(e.log,e),pasteReceived:function(t){e._handleCheckedCallback({name:"onPasteReceived",callback:qq.bind(e._options.callbacks.onPasteReceived,e,t),onSuccess:qq.bind(e._handlePasteSuccess,e,t),identifier:"pasted image"})}}})},_createStore:function(e,t){var n={},r=e,s={},i=t,l=function(d){return qq.isObject(d)?qq.extend({},d):d},a=function(){return qq.isFunction(i)?i():i},c=function(d,p){i&&qq.isObject(p)&&qq.extend(p,a()),s[d]&&qq.extend(p,s[d])};return{set:function(d,p){p==null?(n={},r=l(d)):n[p]=l(d)},get:function(d){var p;return d!=null&&n[d]?p=n[d]:p=l(r),c(d,p),l(p)},addReadOnly:function(d,p){qq.isObject(n)&&(d===null?qq.isFunction(p)?i=p:(i=i||{},qq.extend(i,p)):(s[d]=s[d]||{},qq.extend(s[d],p)))},remove:function(d){return delete n[d]},reset:function(){n={},s={},r=e}}},_createUploadDataTracker:function(){var e=this;return new qq.UploadData({getName:function(t){return e.getName(t)},getUuid:function(t){return e.getUuid(t)},getSize:function(t){return e.getSize(t)},onStatusChange:function(t,n,r){e._onUploadStatusChange(t,n,r),e._options.callbacks.onStatusChange(t,n,r),e._maybeAllComplete(t,r),e._totalProgress&&setTimeout(function(){e._totalProgress.onStatusChange(t,n,r)},0)}})},_createUploadButton:function(e){var t=this,n=e.accept||this._options.validation.acceptFiles,r=e.allowedExtensions||this._options.validation.allowedExtensions,s;function i(){return qq.supportedFeatures.ajaxUploading?t._options.workarounds.iosEmptyVideos&&qq.ios()&&!qq.ios6()&&t._isAllowedExtension(r,".mov")?!1:e.multiple===void 0?t._options.multiple:e.multiple:!1}return s=new qq.UploadButton({acceptFiles:n,element:e.element,focusClass:this._options.classes.buttonFocus,folders:e.folders,hoverClass:this._options.classes.buttonHover,ios8BrowserCrashWorkaround:this._options.workarounds.ios8BrowserCrash,multiple:i(),name:this._options.request.inputName,onChange:function(l){t._onInputChange(l)},title:e.title==null?this._options.text.fileInputTitle:e.title}),this._disposeSupport.addDisposer(function(){s.dispose()}),t._buttons.push(s),s},_createUploadHandler:function(e,t){var n=this,r={},s={debug:this._options.debug,maxConnections:this._options.maxConnections,cors:this._options.cors,paramsStore:this._paramsStore,endpointStore:this._endpointStore,chunking:this._options.chunking,resume:this._options.resume,blobs:this._options.blobs,log:qq.bind(n.log,n),preventRetryParam:this._options.retry.preventRetryResponseProperty,onProgress:function(i,l,a,c){a<0||c<0||(r[i]?(r[i].loaded!==a||r[i].total!==c)&&(n._onProgress(i,l,a,c),n._options.callbacks.onProgress(i,l,a,c)):(n._onProgress(i,l,a,c),n._options.callbacks.onProgress(i,l,a,c)),r[i]={loaded:a,total:c})},onComplete:function(i,l,a,c){delete r[i];var d=n.getUploads({id:i}).status,p;d===qq.status.UPLOAD_SUCCESSFUL||d===qq.status.UPLOAD_FAILED||(p=n._onComplete(i,l,a,c),p instanceof qq.Promise?p.done(function(){n._options.callbacks.onComplete(i,l,a,c)}):n._options.callbacks.onComplete(i,l,a,c))},onCancel:function(i,l,a){var c=new qq.Promise;return n._handleCheckedCallback({name:"onCancel",callback:qq.bind(n._options.callbacks.onCancel,n,i,l),onFailure:c.failure,onSuccess:function(){a.then(function(){n._onCancel(i,l)}),c.success()},identifier:i}),c},onUploadPrep:qq.bind(this._onUploadPrep,this),onUpload:function(i,l){n._onUpload(i,l);var a=n._options.callbacks.onUpload(i,l);return qq.isGenericPromise(a)?(n.log(qq.format("onUpload for {} returned a Promise - waiting for resolution.",i)),a):new qq.Promise().success()},onUploadChunk:function(i,l,a){n._onUploadChunk(i,a);var c=n._options.callbacks.onUploadChunk(i,l,a);return qq.isGenericPromise(c)?(n.log(qq.format("onUploadChunk for {}.{} returned a Promise - waiting for resolution.",i,a.partIndex)),c):new qq.Promise().success()},onUploadChunkSuccess:function(i,l,a,c){n._onUploadChunkSuccess(i,l),n._options.callbacks.onUploadChunkSuccess.apply(n,arguments)},onResume:function(i,l,a,c){return n._options.callbacks.onResume(i,l,a,c)},onAutoRetry:function(i,l,a,c){return n._onAutoRetry.apply(n,arguments)},onUuidChanged:function(i,l){n.log("Server requested UUID change from '"+n.getUuid(i)+"' to '"+l+"'"),n.setUuid(i,l)},getName:qq.bind(n.getName,n),getUuid:qq.bind(n.getUuid,n),getSize:qq.bind(n.getSize,n),setSize:qq.bind(n._setSize,n),getDataByUuid:function(i){return n.getUploads({uuid:i})},isQueued:function(i){var l=n.getUploads({id:i}).status;return l===qq.status.QUEUED||l===qq.status.SUBMITTED||l===qq.status.UPLOAD_RETRYING||l===qq.status.PAUSED},getIdsInProxyGroup:n._uploadData.getIdsInProxyGroup,getIdsInBatch:n._uploadData.getIdsInBatch,isInProgress:function(i){return n.getUploads({id:i}).status===qq.status.UPLOADING},getCustomResumeData:qq.bind(n._getCustomResumeData,n),setStatus:function(i,l){n._uploadData.setStatus(i,l)}};return qq.each(this._options.request,function(i,l){s[i]=l}),s.customHeaders=this._customHeadersStore,e&&qq.each(e,function(i,l){s[i]=l}),new qq.UploadHandlerController(s,t)},_fileOrBlobRejected:function(e){this._netUploadedOrQueued--,this._uploadData.setStatus(e,qq.status.REJECTED)},_formatSize:function(e){if(e===0)return e+this._options.text.sizeSymbols[0];var t=-1;do e=e/1e3,t++;while(e>999);return Math.max(e,.1).toFixed(1)+this._options.text.sizeSymbols[t]},_generateExtraButtonSpecs:function(){var e=this;this._extraButtonSpecs={},qq.each(this._options.extraButtons,function(t,n){var r=n.multiple,s=qq.extend({},e._options.validation,!0),i=qq.extend({},n);r===void 0&&(r=e._options.multiple),i.validation&&qq.extend(s,n.validation,!0),qq.extend(i,{multiple:r,validation:s},!0),e._initExtraButton(i)})},_getButton:function(e){var t=this._extraButtonSpecs[e];if(t)return t.element;if(e===this._defaultButtonId)return this._options.button},_getButtonId:function(e){var t,n,r=e;if(r instanceof qq.BlobProxy&&(r=r.referenceBlob),r&&!qq.isBlob(r)){if(qq.isFile(r))return r.qqButtonId;if(r.tagName.toLowerCase()==="input"&&r.type.toLowerCase()==="file")return r.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME);if(t=r.getElementsByTagName("input"),qq.each(t,function(s,i){if(i.getAttribute("type")==="file")return n=i,!1}),n)return n.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME)}},_getCustomResumeData:function(e){return this._customResumeDataStore.get(e)},_getNotFinished:function(){return this._uploadData.retrieve({status:[qq.status.UPLOADING,qq.status.UPLOAD_RETRYING,qq.status.QUEUED,qq.status.SUBMITTING,qq.status.SUBMITTED,qq.status.PAUSED]}).length},_getValidationBase:function(e){var t=this._extraButtonSpecs[e];return t?t.validation:this._options.validation},_getValidationDescriptor:function(e){return e.file instanceof qq.BlobProxy?{name:qq.getFilename(e.file.referenceBlob),size:e.file.referenceBlob.size}:{name:this.getUploads({id:e.id}).name,size:this.getUploads({id:e.id}).size}},_getValidationDescriptors:function(e){var t=this,n=[];return qq.each(e,function(r,s){n.push(t._getValidationDescriptor(s))}),n},_handleCameraAccess:function(){if(this._options.camera.ios&&qq.ios()){var e="image/*;capture=camera",t=this._options.camera.button,n=t?this._getButtonId(t):this._defaultButtonId,r=this._options;n&&n!==this._defaultButtonId&&(r=this._extraButtonSpecs[n]),r.multiple=!1,r.validation.acceptFiles===null?r.validation.acceptFiles=e:r.validation.acceptFiles+=","+e,qq.each(this._buttons,function(s,i){if(i.getButtonId()===n)return i.setMultiple(r.multiple),i.setAcceptFiles(r.acceptFiles),!1})}},_handleCheckedCallback:function(e){var t=this,n=e.callback();return qq.isGenericPromise(n)?(this.log(e.name+" - waiting for "+e.name+" promise to be fulfilled for "+e.identifier),n.then(function(r){t.log(e.name+" promise success for "+e.identifier),e.onSuccess(r)},function(){e.onFailure?(t.log(e.name+" promise failure for "+e.identifier),e.onFailure()):t.log(e.name+" promise failure for "+e.identifier)})):(n!==!1?e.onSuccess(n):e.onFailure?(this.log(e.name+" - return value was 'false' for "+e.identifier+".  Invoking failure callback."),e.onFailure()):this.log(e.name+" - return value was 'false' for "+e.identifier+".  Will not proceed."),n)},_handleNewFile:function(e,t,n){var r=this,s=qq.getUniqueId(),i=-1,l=qq.getFilename(e),a=e.blob||e,c=this._customNewFileHandler?this._customNewFileHandler:qq.bind(r._handleNewFileGeneric,r);!qq.isInput(a)&&a.size>=0&&(i=a.size),c(a,l,s,i,n,t,this._options.request.uuidName,{uploadData:r._uploadData,paramsStore:r._paramsStore,addFileToHandler:function(d,p){r._handler.add(d,p),r._netUploadedOrQueued++,r._trackButton(d)}})},_handleNewFileGeneric:function(e,t,n,r,s,i){var l=this._uploadData.addFile({uuid:n,name:t,size:r,batchId:i,file:e});this._handler.add(l,e),this._trackButton(l),this._netUploadedOrQueued++,s.push({id:l,file:e})},_handlePasteSuccess:function(e,t){var n=e.type.split("/")[1],r=t;r==null&&(r=this._options.paste.defaultName),r+="."+n,this.addFiles({name:r,blob:e})},_handleDeleteSuccess:function(e){if(this.getUploads({id:e}).status!==qq.status.DELETED){var t=this.getName(e);this._netUploadedOrQueued--,this._netUploaded--,this._handler.expunge(e),this._uploadData.setStatus(e,qq.status.DELETED),this.log("Delete request for '"+t+"' has succeeded.")}},_handleDeleteFailed:function(e,t){var n=this.getName(e);this._uploadData.setStatus(e,qq.status.DELETE_FAILED),this.log("Delete request for '"+n+"' has failed.","error"),!t||t.withCredentials===void 0?this._options.callbacks.onError(e,n,"Delete request failed",t):this._options.callbacks.onError(e,n,"Delete request failed with response code "+t.status,t)},_initExtraButton:function(e){var t=this._createUploadButton({accept:e.validation.acceptFiles,allowedExtensions:e.validation.allowedExtensions,element:e.element,folders:e.folders,multiple:e.multiple,title:e.fileInputTitle});this._extraButtonSpecs[t.getButtonId()]=e},_initFormSupportAndParams:function(){this._formSupport=qq.FormSupport&&new qq.FormSupport(this._options.form,qq.bind(this.uploadStoredFiles,this),qq.bind(this.log,this)),this._formSupport&&this._formSupport.attachedToForm?(this._paramsStore=this._createStore(this._options.request.params,this._formSupport.getFormInputsAsObject),this._options.autoUpload=this._formSupport.newAutoUpload,this._formSupport.newEndpoint&&(this._options.request.endpoint=this._formSupport.newEndpoint)):this._paramsStore=this._createStore(this._options.request.params)},_isDeletePossible:function(){return!qq.DeleteFileAjaxRequester||!this._options.deleteFile.enabled?!1:this._options.cors.expected?!!(qq.supportedFeatures.deleteFileCorsXhr||qq.supportedFeatures.deleteFileCorsXdr&&this._options.cors.allowXdr):!0},_isAllowedExtension:function(e,t){var n=!1;return e.length?(qq.each(e,function(r,s){if(qq.isString(s)){var i=new RegExp("\\."+s+"$","i");if(t.match(i)!=null)return n=!0,!1}}),n):!0},_itemError:function(e,t,n){var r=this._options.messages[e],s=[],i=[].concat(t),l=i[0],a=this._getButtonId(n),c=this._getValidationBase(a),d,p;function S(q,o){r=r.replace(q,o)}return qq.each(c.allowedExtensions,function(q,o){qq.isString(o)&&s.push(o)}),d=s.join(", ").toLowerCase(),S("{file}",this._options.formatFileName(l)),S("{extensions}",d),S("{sizeLimit}",this._formatSize(c.sizeLimit)),S("{minSizeLimit}",this._formatSize(c.minSizeLimit)),p=r.match(/(\{\w+\})/g),p!==null&&qq.each(p,function(q,o){S(o,i[q])}),this._options.callbacks.onError(null,l,r,void 0),r},_manualRetry:function(e,t){if(this._onBeforeManualRetry(e))return this._netUploadedOrQueued++,this._uploadData.setStatus(e,qq.status.UPLOAD_RETRYING),t?t(e):this._handler.retry(e),!0},_maybeAllComplete:function(e,t){var n=this,r=this._getNotFinished();t===qq.status.UPLOAD_SUCCESSFUL?this._succeededSinceLastAllComplete.push(e):t===qq.status.UPLOAD_FAILED&&this._failedSinceLastAllComplete.push(e),r===0&&(this._succeededSinceLastAllComplete.length||this._failedSinceLastAllComplete.length)&&setTimeout(function(){n._onAllComplete(n._succeededSinceLastAllComplete,n._failedSinceLastAllComplete)},0)},_maybeHandleIos8SafariWorkaround:function(){var e=this;if(this._options.workarounds.ios8SafariUploads&&qq.ios800()&&qq.iosSafari())throw setTimeout(function(){window.alert(e._options.messages.unsupportedBrowserIos8Safari)},0),new qq.Error(this._options.messages.unsupportedBrowserIos8Safari)},_maybeParseAndSendUploadError:function(e,t,n,r){if(!n.success)if(r&&r.status!==200&&!n.error)this._options.callbacks.onError(e,t,"XHR returned response code "+r.status,r);else{var s=n.error?n.error:this._options.text.defaultResponseError;this._options.callbacks.onError(e,t,s,r)}},_maybeProcessNextItemAfterOnValidateCallback:function(e,t,n,r,s){var i=this;if(t.length>n){if(e||!this._options.validation.stopOnFirstInvalidFile)setTimeout(function(){var l=i._getValidationDescriptor(t[n]),a=i._getButtonId(t[n].file),c=i._getButton(a);i._handleCheckedCallback({name:"onValidate",callback:qq.bind(i._options.callbacks.onValidate,i,l,c),onSuccess:qq.bind(i._onValidateCallbackSuccess,i,t,n,r,s),onFailure:qq.bind(i._onValidateCallbackFailure,i,t,n,r,s),identifier:"Item '"+l.name+"', size: "+l.size})},0);else if(!e)for(;n<t.length;n++)i._fileOrBlobRejected(t[n].id)}},_onAllComplete:function(e,t){this._totalProgress&&this._totalProgress.onAllComplete(e,t,this._preventRetries),this._options.callbacks.onAllComplete(qq.extend([],e),qq.extend([],t)),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[]},_onAutoRetry:function(e,t,n,r,s){var i=this;if(i._preventRetries[e]=n[i._options.retry.preventRetryResponseProperty],i._shouldAutoRetry(e)){var l=i._options.retry.autoAttemptDelay*1e3;return i._maybeParseAndSendUploadError.apply(i,arguments),i._options.callbacks.onAutoRetry(e,t,i._autoRetries[e]),i._onBeforeAutoRetry(e,t),i._uploadData.setStatus(e,qq.status.UPLOAD_RETRYING),i._retryTimeouts[e]=setTimeout(function(){i.log("Starting retry for "+t+"..."),s?s(e):i._handler.retry(e)},l),!0}},_onBeforeAutoRetry:function(e,t){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+t+"...")},_onBeforeManualRetry:function(e){var t=this._currentItemLimit,n;return this._preventRetries[e]?(this.log("Retries are forbidden for id "+e,"warn"),!1):this._handler.isValid(e)?(n=this.getName(e),this._options.callbacks.onManualRetry(e,n)===!1?!1:t>0&&this._netUploadedOrQueued+1>t?(this._itemError("retryFailTooManyItems"),!1):(this.log("Retrying upload for '"+n+"' (id: "+e+")..."),!0)):(this.log("'"+e+"' is not a valid file ID","error"),!1)},_onCancel:function(e,t){this._netUploadedOrQueued--,clearTimeout(this._retryTimeouts[e]);var n=qq.indexOf(this._storedIds,e);!this._options.autoUpload&&n>=0&&this._storedIds.splice(n,1),this._uploadData.setStatus(e,qq.status.CANCELED)},_onComplete:function(e,t,n,r){return n.success?(n.thumbnailUrl&&(this._thumbnailUrls[e]=n.thumbnailUrl),this._netUploaded++,this._uploadData.setStatus(e,qq.status.UPLOAD_SUCCESSFUL)):(this._netUploadedOrQueued--,this._uploadData.setStatus(e,qq.status.UPLOAD_FAILED),n[this._options.retry.preventRetryResponseProperty]===!0&&(this._preventRetries[e]=!0)),this._maybeParseAndSendUploadError(e,t,n,r),!!n.success},_onDelete:function(e){this._uploadData.setStatus(e,qq.status.DELETING)},_onDeleteComplete:function(e,t,n){this.getName(e),n?this._handleDeleteFailed(e,t):this._handleDeleteSuccess(e)},_onInputChange:function(e){var t;if(qq.supportedFeatures.ajaxUploading){for(t=0;t<e.files.length;t++)this._annotateWithButtonId(e.files[t],e);this.addFiles(e.files)}else e.value.length>0&&this.addFiles(e);qq.each(this._buttons,function(n,r){r.reset()})},_onProgress:function(e,t,n,r){this._totalProgress&&this._totalProgress.onIndividualProgress(e,n,r)},_onSubmit:function(e,t){},_onSubmitCallbackSuccess:function(e,t){this._onSubmit.apply(this,arguments),this._uploadData.setStatus(e,qq.status.SUBMITTED),this._onSubmitted.apply(this,arguments),this._options.autoUpload?(this._options.callbacks.onSubmitted.apply(this,arguments),this._uploadFile(e)):(this._storeForLater(e),this._options.callbacks.onSubmitted.apply(this,arguments))},_onSubmitDelete:function(e,t,n){var r=this.getUuid(e),s;return t&&(s=qq.bind(t,this,e,r,n)),this._isDeletePossible()?(this._handleCheckedCallback({name:"onSubmitDelete",callback:qq.bind(this._options.callbacks.onSubmitDelete,this,e),onSuccess:s||qq.bind(this._deleteHandler.sendDelete,this,e,r,n),identifier:e}),!0):(this.log("Delete request ignored for ID "+e+", delete feature is disabled or request not possible due to CORS on a user agent that does not support pre-flighting.","warn"),!1)},_onSubmitted:function(e){},_onTotalProgress:function(e,t){this._options.callbacks.onTotalProgress(e,t)},_onUploadPrep:function(e){},_onUpload:function(e,t){this._uploadData.setStatus(e,qq.status.UPLOADING)},_onUploadChunk:function(e,t){},_onUploadChunkSuccess:function(e,t){!this._preventRetries[e]&&this._options.retry.enableAuto&&(this._autoRetries[e]=0)},_onUploadStatusChange:function(e,t,n){n===qq.status.PAUSED&&clearTimeout(this._retryTimeouts[e])},_onValidateBatchCallbackFailure:function(e){var t=this;qq.each(e,function(n,r){t._fileOrBlobRejected(r.id)})},_onValidateBatchCallbackSuccess:function(e,t,n,r,s){var i,l=this._currentItemLimit,a=this._netUploadedOrQueued;l===0||a<=l?t.length>0?this._handleCheckedCallback({name:"onValidate",callback:qq.bind(this._options.callbacks.onValidate,this,e[0],s),onSuccess:qq.bind(this._onValidateCallbackSuccess,this,t,0,n,r),onFailure:qq.bind(this._onValidateCallbackFailure,this,t,0,n,r),identifier:"Item '"+t[0].file.name+"', size: "+t[0].file.size}):this._itemError("noFilesError"):(this._onValidateBatchCallbackFailure(t),i=this._options.messages.tooManyItemsError.replace(/\{netItems\}/g,a).replace(/\{itemLimit\}/g,l),this._batchError(i))},_onValidateCallbackFailure:function(e,t,n,r){var s=t+1;this._fileOrBlobRejected(e[t].id,e[t].file.name),this._maybeProcessNextItemAfterOnValidateCallback(!1,e,s,n,r)},_onValidateCallbackSuccess:function(e,t,n,r){var s=this,i=t+1,l=this._getValidationDescriptor(e[t]);this._validateFileOrBlobData(e[t],l).then(function(){s._upload(e[t].id,n,r),s._maybeProcessNextItemAfterOnValidateCallback(!0,e,i,n,r)},function(){s._maybeProcessNextItemAfterOnValidateCallback(!1,e,i,n,r)})},_prepareItemsForUpload:function(e,t,n){if(e.length===0){this._itemError("noFilesError");return}var r=this._getValidationDescriptors(e),s=this._getButtonId(e[0].file),i=this._getButton(s);this._handleCheckedCallback({name:"onValidateBatch",callback:qq.bind(this._options.callbacks.onValidateBatch,this,r,i),onSuccess:qq.bind(this._onValidateBatchCallbackSuccess,this,r,e,t,n,i),onFailure:qq.bind(this._onValidateBatchCallbackFailure,this,e),identifier:"batch validation"})},_preventLeaveInProgress:function(){var e=this;this._disposeSupport.attach(window,"beforeunload",function(t){if(e.getInProgress())return t=t||window.event,t.returnValue=e._options.messages.onLeave,e._options.messages.onLeave})},_refreshSessionData:function(){var e=this,t=this._options.session;qq.Session&&this._options.session.endpoint!=null&&(this._session||(qq.extend(t,{cors:this._options.cors}),t.log=qq.bind(this.log,this),t.addFileRecord=qq.bind(this._addCannedFile,this),this._session=new qq.Session(t)),setTimeout(function(){e._session.refresh().then(function(n,r){e._sessionRequestComplete(),e._options.callbacks.onSessionRequestComplete(n,!0,r)},function(n,r){e._options.callbacks.onSessionRequestComplete(n,!1,r)})},0))},_sessionRequestComplete:function(){},_setSize:function(e,t){this._uploadData.updateSize(e,t),this._totalProgress&&this._totalProgress.onNewSize(e)},_shouldAutoRetry:function(e){var t=this._uploadData.retrieve({id:e});return!this._preventRetries[e]&&this._options.retry.enableAuto&&t.status!==qq.status.PAUSED&&(this._autoRetries[e]===void 0&&(this._autoRetries[e]=0),this._autoRetries[e]<this._options.retry.maxAutoAttempts)?(this._autoRetries[e]+=1,!0):!1},_storeForLater:function(e){this._storedIds.push(e)},_trackButton:function(e){var t;qq.supportedFeatures.ajaxUploading?t=this._handler.getFile(e).qqButtonId:t=this._getButtonId(this._handler.getInput(e)),t&&(this._buttonIdsForFileIds[e]=t)},_updateFormSupportAndParams:function(e){this._options.form.element=e,this._formSupport=qq.FormSupport&&new qq.FormSupport(this._options.form,qq.bind(this.uploadStoredFiles,this),qq.bind(this.log,this)),this._formSupport&&this._formSupport.attachedToForm&&(this._paramsStore.addReadOnly(null,this._formSupport.getFormInputsAsObject),this._options.autoUpload=this._formSupport.newAutoUpload,this._formSupport.newEndpoint&&this.setEndpoint(this._formSupport.newEndpoint))},_upload:function(e,t,n){var r=this.getName(e);t&&this.setParams(t,e),n&&this.setEndpoint(n,e),this._handleCheckedCallback({name:"onSubmit",callback:qq.bind(this._options.callbacks.onSubmit,this,e,r),onSuccess:qq.bind(this._onSubmitCallbackSuccess,this,e,r),onFailure:qq.bind(this._fileOrBlobRejected,this,e,r),identifier:e})},_uploadFile:function(e){this._handler.upload(e)||this._uploadData.setStatus(e,qq.status.QUEUED)},_uploadStoredFiles:function(){for(var e,t,n=this;this._storedIds.length;)e=this._storedIds.shift(),this._uploadFile(e);t=this.getUploads({status:qq.status.SUBMITTING}).length,t&&(qq.log("Still waiting for "+t+" files to clear submit queue. Will re-parse stored IDs array shortly."),setTimeout(function(){n._uploadStoredFiles()},1e3))},_validateFileOrBlobData:function(e,t){var n=this,r=function(){return e.file instanceof qq.BlobProxy?e.file.referenceBlob:e.file}(),s=t.name,i=t.size,l=this._getButtonId(e.file),a=this._getValidationBase(l),c=new qq.Promise;return c.then(function(){},function(){n._fileOrBlobRejected(e.id,s)}),qq.isFileOrInput(r)&&!this._isAllowedExtension(a.allowedExtensions,s)?(this._itemError("typeError",s,r),c.failure()):!this._options.validation.allowEmpty&&i===0?(this._itemError("emptyError",s,r),c.failure()):i>0&&a.sizeLimit&&i>a.sizeLimit?(this._itemError("sizeError",s,r),c.failure()):i>0&&i<a.minSizeLimit?(this._itemError("minSizeError",s,r),c.failure()):(qq.ImageValidation&&qq.supportedFeatures.imagePreviews&&qq.isFile(r)?new qq.ImageValidation(r,qq.bind(n.log,n)).validate(a.image).then(c.success,function(d){n._itemError(d+"ImageError",s,r),c.failure()}):c.success(),c)},_wrapCallbacks:function(){var e,t,n;e=this,t=function(r,s,i){var l;try{return s.apply(e,i)}catch(a){l=a.message||a.toString(),e.log("Caught exception in '"+r+"' callback - "+l,"error")}};for(n in this._options.callbacks)(function(){var r,s;r=n,s=e._options.callbacks[r],e._options.callbacks[r]=function(){return t(r,s,arguments)}})()}}}(),function(){qq.FineUploaderBasic=function(e){var t=this;this._options={debug:!1,button:null,multiple:!0,maxConnections:3,disableCancelForFormUploads:!1,autoUpload:!0,warnBeforeUnload:!0,request:{customHeaders:{},endpoint:"/server/upload",filenameParam:"qqfilename",forceMultipart:!0,inputName:"qqfile",method:"POST",omitDefaultParams:!1,params:{},paramsInBody:!0,requireSuccessJson:!0,totalFileSizeName:"qqtotalfilesize",uuidName:"qquuid"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,itemLimit:0,stopOnFirstInvalidFile:!0,acceptFiles:null,image:{maxHeight:0,maxWidth:0,minHeight:0,minWidth:0},allowEmpty:!1},callbacks:{onSubmit:function(n,r){},onSubmitted:function(n,r){},onComplete:function(n,r,s,i){},onAllComplete:function(n,r){},onCancel:function(n,r){},onUpload:function(n,r){},onUploadChunk:function(n,r,s){},onUploadChunkSuccess:function(n,r,s,i){},onResume:function(n,r,s,i){},onProgress:function(n,r,s,i){},onTotalProgress:function(n,r){},onError:function(n,r,s,i){},onAutoRetry:function(n,r,s){},onManualRetry:function(n,r){},onValidateBatch:function(n){},onValidate:function(n){},onSubmitDelete:function(n){},onDelete:function(n){},onDeleteComplete:function(n,r,s){},onPasteReceived:function(n){},onStatusChange:function(n,r,s){},onSessionRequestComplete:function(n,r,s){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",tooManyItemsError:"Too many items ({netItems}) would be uploaded.  Item limit is {itemLimit}.",maxHeightImageError:"Image is too tall.",maxWidthImageError:"Image is too wide.",minHeightImageError:"Image is not tall enough.",minWidthImageError:"Image is not wide enough.",retryFailTooManyItems:"Retry failed - you have reached your file limit.",onLeave:"The files are being uploaded, if you leave now the upload will be canceled.",unsupportedBrowserIos8Safari:"Unrecoverable error - this browser does not permit file uploading of any kind due to serious bugs in iOS8 Safari.  Please use iOS8 Chrome until Apple fixes these issues."},retry:{enableAuto:!1,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"},classes:{buttonHover:"qq-upload-button-hover",buttonFocus:"qq-upload-button-focus"},chunking:{enabled:!1,concurrent:{enabled:!1},mandatory:!1,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalFileSize:"qqtotalfilesize",totalParts:"qqtotalparts"},partSize:function(n){return 2e6},success:{endpoint:null,headers:function(n){return null},jsonPayload:!1,method:"POST",params:function(n){return null},resetOnStatus:[]}},resume:{enabled:!1,recordsExpireIn:7,paramNames:{resuming:"qqresume"},customKeys:function(n){return[]}},formatFileName:function(n){return n},text:{defaultResponseError:"Upload failure reason unknown",fileInputTitle:"file input",sizeSymbols:["kB","MB","GB","TB","PB","EB"]},deleteFile:{enabled:!1,method:"DELETE",endpoint:"/server/upload",customHeaders:{},params:{}},cors:{expected:!1,sendCredentials:!1,allowXdr:!1},blobs:{defaultName:"misc_data"},paste:{targetElement:null,defaultName:"pasted_image"},camera:{ios:!1,button:null},extraButtons:[],session:{endpoint:null,params:{},customHeaders:{},refreshOnReset:!0},form:{element:"qq-form",autoUpload:!1,interceptSubmit:!0},scaling:{customResizer:null,sendOriginal:!0,orient:!0,defaultType:null,defaultQuality:80,failureText:"Failed to scale",includeExif:!1,sizes:[]},workarounds:{iosEmptyVideos:!0,ios8SafariUploads:!0,ios8BrowserCrash:!1}},qq.extend(this._options,e,!0),this._buttons=[],this._extraButtonSpecs={},this._buttonIdsForFileIds=[],this._wrapCallbacks(),this._disposeSupport=new qq.DisposeSupport,this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._thumbnailUrls=[],this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData=this._createUploadDataTracker(),this._initFormSupportAndParams(),this._customHeadersStore=this._createStore(this._options.request.customHeaders),this._deleteFileCustomHeadersStore=this._createStore(this._options.deleteFile.customHeaders),this._deleteFileParamsStore=this._createStore(this._options.deleteFile.params),this._endpointStore=this._createStore(this._options.request.endpoint),this._deleteFileEndpointStore=this._createStore(this._options.deleteFile.endpoint),this._handler=this._createUploadHandler(),this._deleteHandler=qq.DeleteFileAjaxRequester&&this._createDeleteHandler(),this._options.button&&(this._defaultButtonId=this._createUploadButton({element:this._options.button,title:this._options.text.fileInputTitle}).getButtonId()),this._generateExtraButtonSpecs(),this._handleCameraAccess(),this._options.paste.targetElement&&(qq.PasteSupport?this._pasteHandler=this._createPasteHandler():this.log("Paste support module not found","error")),this._options.warnBeforeUnload&&this._preventLeaveInProgress(),this._imageGenerator=qq.ImageGenerator&&new qq.ImageGenerator(qq.bind(this.log,this)),this._refreshSessionData(),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[],this._scaler=qq.Scaler&&new qq.Scaler(this._options.scaling,qq.bind(this.log,this))||{},this._scaler.enabled&&(this._customNewFileHandler=qq.bind(this._scaler.handleNewFile,this._scaler)),qq.TotalProgress&&qq.supportedFeatures.progressBar&&(this._totalProgress=new qq.TotalProgress(qq.bind(this._onTotalProgress,this),function(n){var r=t._uploadData.retrieve({id:n});return r&&r.size||0})),this._currentItemLimit=this._options.validation.itemLimit,this._customResumeDataStore=this._createStore()},qq.FineUploaderBasic.prototype=qq.basePublicApi,qq.extend(qq.FineUploaderBasic.prototype,qq.basePrivateApi)}(),qq.AjaxRequester=function(e){var t,n,r=[],s={},i={acceptHeader:null,validMethods:["PATCH","POST","PUT"],method:"POST",contentType:"application/x-www-form-urlencoded",maxConnections:3,customHeaders:{},endpointStore:{},paramsStore:{},mandatedParams:{},allowXRequestedWithAndCacheControl:!0,successfulResponseCodes:{DELETE:[200,202,204],PATCH:[200,201,202,203,204],POST:[200,201,202,203,204],PUT:[200,201,202,203,204],GET:[200]},cors:{expected:!1,sendCredentials:!1},log:function(b,x){},onSend:function(b){},onComplete:function(b,x,w){},onProgress:null};if(qq.extend(i,e),t=i.log,qq.indexOf(i.validMethods,i.method)<0)throw new Error("'"+i.method+"' is not a supported method for this type of request!");function l(){return qq.indexOf(["GET","POST","HEAD"],i.method)>=0}function a(b){var x=!1;return qq.each(x,function(w,E){if(qq.indexOf(["Accept","Accept-Language","Content-Language","Content-Type"],E)<0)return x=!0,!1}),x}function c(b){return i.cors.expected&&b.withCredentials===void 0}function d(){var b;return(window.XMLHttpRequest||window.ActiveXObject)&&(b=qq.createXhrInstance(),b.withCredentials===void 0&&(b=new XDomainRequest,b.onload=function(){},b.onerror=function(){},b.ontimeout=function(){},b.onprogress=function(){})),b}function p(b,x){var w=s[b]&&s[b].xhr;return w||(x?w=x:i.cors.expected?w=d():w=qq.createXhrInstance(),s[b].xhr=w),w}function S(b){var x=qq.indexOf(r,b),w=i.maxConnections,E;delete s[b],r.splice(x,1),r.length>=w&&x<w&&(E=r[w-1],u(E))}function q(b,x){var w=p(b),E=i.method,F=x===!0;S(b),F?t(E+" request for "+b+" has failed","error"):!c(w)&&!y(w.status)&&(F=!0,t(E+" request for "+b+" has failed - response code "+w.status,"error")),i.onComplete(b,w,F)}function o(b){var x=s[b].additionalParams,w=i.mandatedParams,E;return i.paramsStore.get&&(E=i.paramsStore.get(b)),x&&qq.each(x,function(F,P){E=E||{},E[F]=P}),w&&qq.each(w,function(F,P){E=E||{},E[F]=P}),E}function u(b,x){var w=p(b,x),E=i.method,F=o(b),P=s[b].payload,R;return i.onSend(b),R=h(b,F,s[b].additionalQueryParams),c(w)?(w.onload=v(b),w.onerror=f(b)):w.onreadystatechange=_(b),m(b),w.open(E,R,!0),i.cors.expected&&i.cors.sendCredentials&&!c(w)&&(w.withCredentials=!0),g(b),t("Sending "+E+" request for "+b),P?w.send(P):n||!F?w.send():F&&i.contentType&&i.contentType.toLowerCase().indexOf("application/x-www-form-urlencoded")>=0?w.send(qq.obj2url(F,"")):F&&i.contentType&&i.contentType.toLowerCase().indexOf("application/json")>=0?w.send(JSON.stringify(F)):w.send(F),w}function h(b,x,w){var E=i.endpointStore.get(b),F=s[b].addToPath;return F!=null&&(E+="/"+F),n&&x&&(E=qq.obj2url(x,E)),w&&(E=qq.obj2url(w,E)),E}function _(b){return function(){p(b).readyState===4&&q(b)}}function m(b){var x=i.onProgress;x&&(p(b).upload.onprogress=function(w){w.lengthComputable&&x(b,w.loaded,w.total)})}function v(b){return function(){q(b)}}function f(b){return function(){q(b,!0)}}function g(b){var x=p(b),w=i.customHeaders,E=s[b].additionalHeaders||{},F=i.method,P={};c(x)||(i.acceptHeader&&x.setRequestHeader("Accept",i.acceptHeader),i.allowXRequestedWithAndCacheControl&&(!i.cors.expected||!l()||a())&&(x.setRequestHeader("X-Requested-With","XMLHttpRequest"),x.setRequestHeader("Cache-Control","no-cache")),i.contentType&&(F==="POST"||F==="PUT")&&x.setRequestHeader("Content-Type",i.contentType),qq.extend(P,qq.isFunction(w)?w(b):w),qq.extend(P,E),qq.each(P,function(R,I){x.setRequestHeader(R,I)}))}function y(b){return qq.indexOf(i.successfulResponseCodes[i.method],b)>=0}function C(b,x,w,E,F,P,R){s[b]={addToPath:w,additionalParams:E,additionalQueryParams:F,additionalHeaders:P,payload:R};var I=r.push(b);if(I<=i.maxConnections)return u(b,x)}n=i.method==="GET"||i.method==="DELETE",qq.extend(this,{initTransport:function(b){var x,w,E,F,P,R;return{withPath:function(I){return x=I,this},withParams:function(I){return w=I,this},withQueryParams:function(I){return R=I,this},withHeaders:function(I){return E=I,this},withPayload:function(I){return F=I,this},withCacheBuster:function(){return P=!0,this},send:function(I){return P&&qq.indexOf(["GET","DELETE"],i.method)>=0&&(w.qqtimestamp=new Date().getTime()),C(b,I,x,w,R,E,F)}}},canceled:function(b){S(b)}})},qq.UploadHandler=function(e){var t=e.proxy,n={},r=t.onCancel,s=t.getName;qq.extend(this,{add:function(i,l){n[i]=l,n[i].temp={}},cancel:function(i){var l=this,a=new qq.Promise,c=r(i,s(i),a);c.then(function(){l.isValid(i)&&(n[i].canceled=!0,l.expunge(i)),a.success()})},expunge:function(i){delete n[i]},getThirdPartyFileId:function(i){return n[i].key},isValid:function(i){return n[i]!==void 0},reset:function(){n={}},_getFileState:function(i){return n[i]},_setThirdPartyFileId:function(i,l){n[i].key=l},_wasCanceled:function(i){return!!n[i].canceled}})},qq.UploadHandlerController=function(e,t){var n=this,r=!1,s=!1,i,l,a,c={paramsStore:{},maxConnections:3,chunking:{enabled:!1,multiple:{enabled:!1}},log:function(o,u){},onProgress:function(o,u,h,_){},onComplete:function(o,u,h,_){},onCancel:function(o,u){},onUploadPrep:function(o){},onUpload:function(o,u){},onUploadChunk:function(o,u,h){},onUploadChunkSuccess:function(o,u,h,_){},onAutoRetry:function(o,u,h,_){},onResume:function(o,u,h,_){},onUuidChanged:function(o,u){},getName:function(o){},setSize:function(o,u){},isQueued:function(o){},getIdsInProxyGroup:function(o){},getIdsInBatch:function(o){},isInProgress:function(o){}},d={done:function(o,u,h,_){var m=a._getChunkData(o,u);a._getFileState(o).attemptingResume=!1,delete a._getFileState(o).temp.chunkProgress[u],a._getFileState(o).loaded+=m.size,c.onUploadChunkSuccess(o,a._getChunkDataForCallback(m),h,_)},finalize:function(o){var u=c.getSize(o),h=c.getName(o);l("All chunks have been uploaded for "+o+" - finalizing...."),a.finalizeChunks(o).then(function(_,m){l("Finalize successful for "+o);var v=q.normalizeResponse(_,!0);c.onProgress(o,h,u,u),a._maybeDeletePersistedChunkData(o),q.cleanup(o,v,m)},function(_,m){var v=q.normalizeResponse(_,!1);l("Problem finalizing chunks for file ID "+o+" - "+v.error,"error"),(v.reset||m&&c.chunking.success.resetOnStatus.indexOf(m.status)>=0)&&d.reset(o),c.onAutoRetry(o,h,v,m)||q.cleanup(o,v,m)})},handleFailure:function(o,u,h,_){var m=c.getName(u);l("Chunked upload request failed for "+u+", chunk "+o),a.clearCachedChunk(u,o);var v=q.normalizeResponse(h,!1),f;if(v.reset)d.reset(u);else{var g=a._getFileState(u).chunking.inProgress;f=g?qq.indexOf(g,o):-1,f>=0&&(a._getFileState(u).chunking.inProgress.splice(f,1),a._getFileState(u).chunking.remaining.unshift(o))}a._getFileState(u).temp.ignoreFailure||(s&&(a._getFileState(u).temp.ignoreFailure=!0,l(qq.format("Going to attempt to abort these chunks: {}. These are currently in-progress: {}.",JSON.stringify(Object.keys(a._getXhrs(u))),JSON.stringify(a._getFileState(u).chunking.inProgress))),qq.each(a._getXhrs(u),function(y,C){l(qq.format("Attempting to abort file {}.{}. XHR readyState {}. ",u,y,C.readyState)),C.abort(),C._cancelled=!0}),a.moveInProgressToRemaining(u),p.free(u,!0)),c.onAutoRetry(u,m,v,_)||q.cleanup(u,v,_))},hasMoreParts:function(o){return!!a._getFileState(o).chunking.remaining.length},nextPart:function(o){var u=a._getFileState(o).chunking.remaining.shift();return u>=a._getTotalChunks(o)&&(u=null),u},reset:function(o){l("Server or callback has ordered chunking effort to be restarted on next attempt for item ID "+o,"error"),a._maybeDeletePersistedChunkData(o),a.reevaluateChunking(o),a._getFileState(o).loaded=0,a._getFileState(o).attemptingResume=!1},sendNext:function(o){var u=c.getSize(o),h=c.getName(o),_=d.nextPart(o),m=a._getChunkData(o,_),v=a._getFileState(o),f=v.attemptingResume,g=v.chunking.inProgress||[];if(v.loaded==null&&(v.loaded=0),f&&c.onResume(o,h,m,v.customResumeData)===!1&&(d.reset(o),_=d.nextPart(o),m=a._getChunkData(o,_),f=!1),_==null&&g.length===0)d.finalize(o);else{g.push(_),a._getFileState(o).chunking.inProgress=g,s&&p.open(o,_),s&&p.available()&&a._getFileState(o).chunking.remaining.length&&d.sendNext(o),m.blob.size===0&&(l(qq.format("Chunk {} for file {} will not be uploaded, zero sized chunk.",_,o),"error"),d.handleFailure(_,o,"File is no longer available",null));var y=c.onUploadChunk(o,h,a._getChunkDataForCallback(m));y.then(function(C){if(!c.isInProgress(o))l(qq.format("Not sending chunked upload request for item {}.{} - no longer in progress.",o,_));else{l(qq.format("Sending chunked upload request for item {}.{}, bytes {}-{} of {}.",o,_,m.start+1,m.end,u));var b={chunkIdx:_,id:o,overrides:C,resuming:f};a.uploadChunk(b).then(function(w,E){l("Chunked upload request succeeded for "+o+", chunk "+_),a.clearCachedChunk(o,_);var F=a._getFileState(o).chunking.inProgress||[],P=q.normalizeResponse(w,!0),R=qq.indexOf(F,_);l(qq.format("Chunk {} for file {} uploaded successfully.",_,o)),d.done(o,_,P,E),R>=0&&F.splice(R,1),a._maybePersistChunkedState(o),!d.hasMoreParts(o)&&F.length===0?d.finalize(o):d.hasMoreParts(o)?d.sendNext(o):l(qq.format("File ID {} has no more chunks to send and these chunk indexes are still marked as in-progress: {}",o,JSON.stringify(F)))},function(w,E){d.handleFailure(_,o,w,E)}).done(function(){a.clearXhr(o,_)})}},function(C){d.handleFailure(_,o,C,null)})}}},p={_open:[],_openChunks:{},_waiting:[],available:function(){var o=c.maxConnections,u=0,h=0;return qq.each(p._openChunks,function(_,m){u++,h+=m.length}),o-(p._open.length-u+h)},free:function(o,u){var h=!u,_=qq.indexOf(p._waiting,o),m=qq.indexOf(p._open,o),v;delete p._openChunks[o],q.getProxyOrBlob(o)instanceof qq.BlobProxy&&(l("Generated blob upload has ended for "+o+", disposing generated blob."),delete a._getFileState(o).file),_>=0?p._waiting.splice(_,1):h&&m>=0&&(p._open.splice(m,1),v=p._waiting.shift(),v>=0&&(p._open.push(v),q.start(v)))},getWaitingOrConnected:function(){var o=[];return qq.each(p._openChunks,function(u,h){h&&h.length&&o.push(parseInt(u))}),qq.each(p._open,function(u,h){p._openChunks[h]||o.push(parseInt(h))}),o=o.concat(p._waiting),o},isUsingConnection:function(o){return qq.indexOf(p._open,o)>=0},open:function(o,u){return u==null&&p._waiting.push(o),p.available()?(u==null?(p._waiting.pop(),p._open.push(o)):function(){var h=p._openChunks[o]||[];h.push(u),p._openChunks[o]=h}(),!0):!1},reset:function(){p._waiting=[],p._open=[]}},S={send:function(o,u){var h=a._getFileState(o);if(!h){l("Ignoring send request as this upload may have been cancelled, File ID "+o,"warn");return}h.loaded=0,l("Sending simple upload request for "+o),a.uploadFile(o).then(function(_,m){l("Simple upload request succeeded for "+o);var v=q.normalizeResponse(_,!0),f=c.getSize(o);c.onProgress(o,u,f,f),q.maybeNewUuid(o,v),q.cleanup(o,v,m)},function(_,m){l("Simple upload request failed for "+o);var v=q.normalizeResponse(_,!1);c.onAutoRetry(o,u,v,m)||q.cleanup(o,v,m)})}},q={cancel:function(o){l("Cancelling "+o),c.paramsStore.remove(o),p.free(o)},cleanup:function(o,u,h){var _=c.getName(o);c.onComplete(o,_,u,h),a._getFileState(o)&&a._clearXhrs&&a._clearXhrs(o),p.free(o)},getProxyOrBlob:function(o){return a.getProxy&&a.getProxy(o)||a.getFile&&a.getFile(o)},initHandler:function(){var o=t?qq[t]:qq.traditional,u=qq.supportedFeatures.ajaxUploading?"Xhr":"Form";a=new o[u+"UploadHandler"](c,{getCustomResumeData:c.getCustomResumeData,getDataByUuid:c.getDataByUuid,getName:c.getName,getSize:c.getSize,getUuid:c.getUuid,log:l,onCancel:c.onCancel,onProgress:c.onProgress,onUuidChanged:c.onUuidChanged,onFinalizing:function(h){c.setStatus(h,qq.status.UPLOAD_FINALIZING)}}),a._removeExpiredChunkingRecords&&a._removeExpiredChunkingRecords()},isDeferredEligibleForUpload:function(o){return c.isQueued(o)},maybeDefer:function(o,u){if(u&&!a.getFile(o)&&u instanceof qq.BlobProxy)c.onUploadPrep(o),l("Attempting to generate a blob on-demand for "+o),u.create().then(function(h){l("Generated an on-demand blob for "+o),a.updateBlob(o,h),c.setSize(o,h.size),a.reevaluateChunking(o),q.maybeSendDeferredFiles(o)},function(h){var _={};h&&(_.error=h),l(qq.format("Failed to generate blob for ID {}.  Error message: {}.",o,h),"error"),c.onComplete(o,c.getName(o),qq.extend(_,i),null),q.maybeSendDeferredFiles(o),p.free(o)});else return q.maybeSendDeferredFiles(o);return!1},maybeSendDeferredFiles:function(o){var u=c.getIdsInProxyGroup(o),h=!1;return u&&u.length?(l("Maybe ready to upload proxy group file "+o),qq.each(u,function(_,m){if(q.isDeferredEligibleForUpload(m)&&a.getFile(m))h=m===o,q.now(m);else if(q.isDeferredEligibleForUpload(m))return!1})):(h=!0,q.now(o)),h},maybeNewUuid:function(o,u){u.newUuid!==void 0&&c.onUuidChanged(o,u.newUuid)},normalizeResponse:function(o,u){var h=o;return qq.isObject(o)||(h={},qq.isString(o)&&!u&&(h.error=o)),h.success=u,h},now:function(o){var u=c.getName(o);if(!n.isValid(o))throw new qq.Error(o+" is not a valid file ID to upload!");c.onUpload(o,u).then(function(h){h&&h.pause?(c.setStatus(o,qq.status.PAUSED),a.pause(o),p.free(o)):r&&a._shouldChunkThisFile(o)?d.sendNext(o):S.send(o,u)},function(h){if(h=h||{},l(o+" upload start aborted due to rejected onUpload Promise - details: "+h,"error"),!c.onAutoRetry(o,u,h.responseJSON||{})){var _=q.normalizeResponse(h.responseJSON,!1);q.cleanup(o,_)}})},start:function(o){var u=q.getProxyOrBlob(o);return u?q.maybeDefer(o,u):(q.now(o),!0)}};qq.extend(this,{add:function(o,u){a.add.apply(this,arguments)},upload:function(o){return p.open(o)?q.start(o):!1},retry:function(o){return s&&(a._getFileState(o).temp.ignoreFailure=!1),p.isUsingConnection(o)?q.start(o):n.upload(o)},cancel:function(o){var u=a.cancel(o);qq.isGenericPromise(u)?u.then(function(){q.cancel(o)}):u!==!1&&q.cancel(o)},cancelAll:function(){var o=p.getWaitingOrConnected(),u;if(o.length)for(u=o.length-1;u>=0;u--)n.cancel(o[u]);p.reset()},getFile:function(o){return a.getProxy&&a.getProxy(o)?a.getProxy(o).referenceBlob:a.getFile&&a.getFile(o)},isProxied:function(o){return!!(a.getProxy&&a.getProxy(o))},getInput:function(o){if(a.getInput)return a.getInput(o)},reset:function(){l("Resetting upload handler"),n.cancelAll(),p.reset(),a.reset()},expunge:function(o){if(n.isValid(o))return a.expunge(o)},isValid:function(o){return a.isValid(o)},hasResumeRecord:function(o){var u=a.isValid(o)&&a._getLocalStorageId&&a._getLocalStorageId(o);return u?!!localStorage.getItem(u):!1},getResumableFilesData:function(){return a.getResumableFilesData?a.getResumableFilesData():[]},getThirdPartyFileId:function(o){if(n.isValid(o))return a.getThirdPartyFileId(o)},pause:function(o){return n.isResumable(o)&&a.pause&&n.isValid(o)&&a.pause(o)?(p.free(o),a.moveInProgressToRemaining(o),!0):!1},isAttemptingResume:function(o){return!!a.isAttemptingResume&&a.isAttemptingResume(o)},isResumable:function(o){return!!a.isResumable&&a.isResumable(o)}}),qq.extend(c,e),l=c.log,r=c.chunking.enabled&&qq.supportedFeatures.chunking,s=r&&c.chunking.concurrent.enabled,i=function(){var o={};return o[c.preventRetryParam]=!0,o}(),q.initHandler()},qq.WindowReceiveMessage=function(e){var t={log:function(r,s){}},n={};qq.extend(t,e),qq.extend(this,{receiveMessage:function(r,s){var i=function(l){s(l.data)};window.postMessage?n[r]=qq(window).attach("message",i):log("iframe message passing not supported in this browser!","error")},stopReceivingMessages:function(r){if(window.postMessage){var s=n[r];s&&s()}}})},qq.FormUploadHandler=function(e){var t=e.options,n=this,r=e.proxy,s=qq.getUniqueId(),i={},l={},a={},c=t.isCors,d=t.inputName,p=r.getUuid,S=r.log,q=new qq.WindowReceiveMessage({log:S});function o(m){delete l[m],c&&(clearTimeout(a[m]),delete a[m],q.stopReceivingMessages(m));var v=document.getElementById(n._getIframeName(m));v&&(v.setAttribute("src","javascript:false;"),qq(v).remove())}function u(m){return m.split("_")[0]}function h(m){var v=qq.toElement("<iframe src='javascript:false;' name='"+m+"' />");return v.setAttribute("id",m),v.style.display="none",document.body.appendChild(v),v}function _(m,v){var f=m.id,g=u(f),y=p(g);i[y]=v,l[g]=qq(m).attach("load",function(){n.getInput(g)&&(S("Received iframe load event for CORS upload request (iframe name "+f+")"),a[f]=setTimeout(function(){var C="No valid message received from loaded iframe for iframe name "+f;S(C,"error"),v({error:C})},1e3))}),q.receiveMessage(f,function(C){S("Received the following window message: '"+C+"'"),u(f);var b=n._parseJsonResponse(C),x=b.uuid,w;x&&i[x]?(S("Handling response for iframe name "+f),clearTimeout(a[f]),delete a[f],n._detachLoadEvent(f),w=i[x],delete i[x],q.stopReceivingMessages(f),w(b)):x||S("'"+C+"' does not contain a UUID - ignoring.")})}qq.extend(this,new qq.UploadHandler(e)),qq.override(this,function(m){return{add:function(v,f){m.add(v,{input:f}),f.setAttribute("name",d),f.parentNode&&qq(f).remove()},expunge:function(v){o(v),m.expunge(v)},isValid:function(v){return m.isValid(v)&&n._getFileState(v).input!==void 0}}}),qq.extend(this,{getInput:function(m){return n._getFileState(m).input},_attachLoadEvent:function(m,v){var f;c?_(m,v):l[m.id]=qq(m).attach("load",function(){if(S("Received response for "+m.id),!!m.parentNode){try{if(m.contentDocument&&m.contentDocument.body&&m.contentDocument.body.innerHTML=="false")return}catch(g){S("Error when attempting to access iframe during handling of upload response ("+g.message+")","error"),f={success:!1}}v(f)}})},_createIframe:function(m){var v=n._getIframeName(m);return h(v)},_detachLoadEvent:function(m){l[m]!==void 0&&(l[m](),delete l[m])},_getIframeName:function(m){return m+"_"+s},_initFormForUpload:function(m){var v=m.method,f=m.endpoint,g=m.params,y=m.paramsInBody,C=m.targetName,b=qq.toElement("<form method='"+v+"' enctype='multipart/form-data'></form>"),x=f;return y?qq.obj2Inputs(g,b):x=qq.obj2url(g,f),b.setAttribute("action",x),b.setAttribute("target",C),b.style.display="none",document.body.appendChild(b),b},_parseJsonResponse:function(m){var v={};try{v=qq.parseJson(m)}catch(f){S("Error when attempting to parse iframe upload response ("+f.message+")","error")}return v}})},qq.XhrUploadHandler=function(e){var t=this,n=e.options.namespace,r=e.proxy,s=e.options.chunking,i=function(f){var g=t._getFileState(f);if(g.chunkSize)return g.chunkSize;var y=s.partSize;return qq.isFunction(y)&&(y=y(f,p(f))),g.chunkSize=y,y},l=e.options.resume,a=s&&e.options.chunking.enabled&&qq.supportedFeatures.chunking,c=l&&e.options.resume.enabled&&a&&qq.supportedFeatures.resume,d=r.getName,p=r.getSize,S=r.getUuid,q=r.getEndpoint,o=r.getDataByUuid,u=r.onUuidChanged,h=r.onProgress,_=r.log,m=r.getCustomResumeData;function v(f){qq.each(t._getXhrs(f),function(g,y){var C=t._getAjaxRequester(f,g);y.onreadystatechange=null,y.upload.onprogress=null,y.abort(),C&&C.canceled&&C.canceled(f)})}qq.extend(this,new qq.UploadHandler(e)),qq.override(this,function(f){return{add:function(g,y){if(qq.isFile(y)||qq.isBlob(y))f.add(g,{file:y});else if(y instanceof qq.BlobProxy)f.add(g,{proxy:y});else throw new Error("Passed obj is not a File, Blob, or proxy");t._initTempState(g),c&&t._maybePrepareForResume(g)},expunge:function(g){v(g),t._maybeDeletePersistedChunkData(g),t._clearXhrs(g),f.expunge(g)}}}),qq.extend(this,{clearCachedChunk:function(f,g){var y=t._getFileState(f);y&&delete y.temp.cachedChunks[g]},clearXhr:function(f,g){var y=t._getFileState(f).temp;y.xhrs&&delete y.xhrs[g],y.ajaxRequesters&&delete y.ajaxRequesters[g]},finalizeChunks:function(f,g){var y=t._getTotalChunks(f)-1,C=t._getXhr(f,y);return g?new qq.Promise().success(g(C),C):new qq.Promise().success({},C)},getFile:function(f){return t.isValid(f)&&t._getFileState(f).file},getProxy:function(f){return t.isValid(f)&&t._getFileState(f).proxy},getResumableFilesData:function(){var f=[];return t._iterateResumeRecords(function(g,y){t.moveInProgressToRemaining(null,y.chunking.inProgress,y.chunking.remaining);var C={name:y.name,remaining:y.chunking.remaining,size:y.size,uuid:y.uuid};y.key&&(C.key=y.key),y.customResumeData&&(C.customResumeData=y.customResumeData),f.push(C)}),f},isAttemptingResume:function(f){return t._getFileState(f).attemptingResume},isResumable:function(f){return!!s&&t.isValid(f)&&!t._getFileState(f).notResumable},moveInProgressToRemaining:function(f,g,y){var C=t._getFileState(f)||{},b=C.chunking||{},x=g||b.inProgress,w=y||b.remaining;x&&(_(qq.format("Moving these chunks from in-progress {}, to remaining.",JSON.stringify(x))),x.reverse(),qq.each(x,function(E,F){w.unshift(F)}),x.length=0)},pause:function(f){if(t.isValid(f))return _(qq.format("Aborting XHR upload for {} '{}' due to pause instruction.",f,d(f))),t._getFileState(f).paused=!0,v(f),!0},reevaluateChunking:function(f){if(s&&t.isValid(f)){var g=t._getFileState(f),y,C;if(delete g.chunking,g.chunking={},y=t._getTotalChunks(f),y>1||s.mandatory){for(g.chunking.enabled=!0,g.chunking.parts=y,g.chunking.remaining=[],C=0;C<y;C++)g.chunking.remaining.push(C);t._initTempState(f)}else g.chunking.enabled=!1}},updateBlob:function(f,g){t.isValid(f)&&(t._getFileState(f).file=g)},_clearXhrs:function(f){var g=t._getFileState(f).temp;qq.each(g.ajaxRequesters,function(y){delete g.ajaxRequesters[y]}),qq.each(g.xhrs,function(y){delete g.xhrs[y]})},_createXhr:function(f,g){return t._registerXhr(f,g,qq.createXhrInstance())},_getAjaxRequester:function(f,g){var y=g??-1;return t._getFileState(f).temp.ajaxRequesters[y]},_getChunkData:function(f,g){var y=i(f),C=p(f),b=t.getFile(f),x=y*g,w=x+y>=C?C:x+y,E=t._getTotalChunks(f),F=this._getFileState(f).temp.cachedChunks,P=F[g]||qq.sliceBlob(b,x,w);return F[g]=P,{part:g,start:x,end:w,count:E,blob:P,size:w-x}},_getChunkDataForCallback:function(f){return{partIndex:f.part,startByte:f.start+1,endByte:f.end,totalParts:f.count}},_getLocalStorageId:function(f){var g="5.0",y=d(f),C=p(f),b=i(f),x=q(f),w=l.customKeys(f),E=qq.format("qq{}resume{}-{}-{}-{}-{}",n,g,y,C,b,x);return w.forEach(function(F){E+="-"+F}),E},_getMimeType:function(f){return t.getFile(f).type},_getPersistableData:function(f){return t._getFileState(f).chunking},_getTotalChunks:function(f){if(s){var g=p(f),y=i(f);return Math.ceil(g/y)}},_getXhr:function(f,g){var y=g??-1;return t._getFileState(f).temp.xhrs[y]},_getXhrs:function(f){return t._getFileState(f).temp.xhrs},_iterateResumeRecords:function(f){c&&qq.each(localStorage,function(g,y){if(g.indexOf(qq.format("qq{}resume",n))===0){var C=JSON.parse(y);f(g,C)}})},_initTempState:function(f){t._getFileState(f).temp={ajaxRequesters:{},chunkProgress:{},xhrs:{},cachedChunks:{}}},_markNotResumable:function(f){t._getFileState(f).notResumable=!0},_maybeDeletePersistedChunkData:function(f){var g;return c&&t.isResumable(f)&&(g=t._getLocalStorageId(f),g&&localStorage.getItem(g))?(localStorage.removeItem(g),!0):!1},_maybePrepareForResume:function(f){var g=t._getFileState(f),y,C;c&&g.key===void 0&&(y=t._getLocalStorageId(f),C=localStorage.getItem(y),C&&(C=JSON.parse(C),o(C.uuid)?t._markNotResumable(f):(_(qq.format("Identified file with ID {} and name of {} as resumable.",f,d(f))),u(f,C.uuid),g.key=C.key,g.chunking=C.chunking,g.loaded=C.loaded,g.customResumeData=C.customResumeData,g.attemptingResume=!0,t.moveInProgressToRemaining(f))))},_maybePersistChunkedState:function(f){var g=t._getFileState(f),y,C;if(c&&t.isResumable(f)){var b=m(f);y=t._getLocalStorageId(f),C={name:d(f),size:p(f),uuid:S(f),key:g.key,chunking:g.chunking,loaded:g.loaded,lastUpdated:Date.now()},b&&(C.customResumeData=b);try{localStorage.setItem(y,JSON.stringify(C))}catch(x){_(qq.format("Unable to save resume data for '{}' due to error: '{}'.",f,x.toString()),"warn")}}},_registerProgressHandler:function(f,g,y){var C=t._getXhr(f,g),b=d(f),x={simple:function(w,E){var F=p(f);w===E?h(f,b,F,F):h(f,b,w>=F?F-1:w,F)},chunked:function(w,E){var F=t._getFileState(f).temp.chunkProgress,P=t._getFileState(f).loaded,R=w,I=E,A=p(f),D=R-(I-y),U=P;F[g]=D,qq.each(F,function(T,k){U+=k}),h(f,b,U,A)}};C.upload.onprogress=function(w){if(w.lengthComputable){var E=y==null?"simple":"chunked";x[E](w.loaded,w.total)}}},_registerXhr:function(f,g,y,C){var b=g??-1,x=t._getFileState(f).temp;return x.xhrs=x.xhrs||{},x.ajaxRequesters=x.ajaxRequesters||{},x.xhrs[b]=y,C&&(x.ajaxRequesters[b]=C),y},_removeExpiredChunkingRecords:function(){var f=l.recordsExpireIn;t._iterateResumeRecords(function(g,y){var C=new Date(y.lastUpdated);C.setDate(C.getDate()+f),C.getTime()<=Date.now()&&(_("Removing expired resume record with key "+g),localStorage.removeItem(g))})},_shouldChunkThisFile:function(f){var g=t._getFileState(f);if(g)return g.chunking||t.reevaluateChunking(f),g.chunking.enabled}})},qq.DeleteFileAjaxRequester=function(e){var t,n={method:"DELETE",uuidParamName:"qquuid",endpointStore:{},maxConnections:3,customHeaders:function(s){return{}},paramsStore:{},cors:{expected:!1,sendCredentials:!1},log:function(s,i){},onDelete:function(s){},onDeleteComplete:function(s,i,l){}};qq.extend(n,e);function r(){return n.method.toUpperCase()==="POST"?{_method:"DELETE"}:{}}t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:["POST","DELETE"],method:n.method,endpointStore:n.endpointStore,paramsStore:n.paramsStore,mandatedParams:r(),maxConnections:n.maxConnections,customHeaders:function(s){return n.customHeaders.get(s)},log:n.log,onSend:n.onDelete,onComplete:n.onDeleteComplete,cors:n.cors})),qq.extend(this,{sendDelete:function(s,i,l){var a=l||{};n.log("Submitting delete file request for "+s),n.method==="DELETE"?t.initTransport(s).withPath(i).withParams(a).send():(a[n.uuidParamName]=i,t.initTransport(s).withParams(a).send())}})},function(){function e(c){var d=c.naturalWidth,p=c.naturalHeight,S=document.createElement("canvas"),q;return d*p>1024*1024?(S.width=S.height=1,q=S.getContext("2d"),q.drawImage(c,-d+1,0),q.getImageData(0,0,1,1).data[3]===0):!1}function t(c,d,p){var S=document.createElement("canvas"),q=0,o=p,u=p,h,_,m,v;for(S.width=1,S.height=p,h=S.getContext("2d"),h.drawImage(c,0,0),_=h.getImageData(0,0,1,p).data;u>q;)m=_[(u-1)*4+3],m===0?o=u:q=u,u=o+q>>1;return v=u/p,v===0?1:v}function n(c,d,p,S){var q=document.createElement("canvas"),o=p.mime||"image/jpeg",u=new qq.Promise;return s(c,d,q,p,S).then(function(){u.success(q.toDataURL(o,p.quality||.8))}),u}function r(c){var d=5241e3;if(!qq.ios())throw new qq.Error("Downsampled dimensions can only be reliably calculated for iOS!");if(c.origHeight*c.origWidth>d)return{newHeight:Math.round(Math.sqrt(d*(c.origHeight/c.origWidth))),newWidth:Math.round(Math.sqrt(d*(c.origWidth/c.origHeight)))}}function s(c,d,p,S,q){var o=c.naturalWidth,u=c.naturalHeight,h=S.width,_=S.height,m=p.getContext("2d"),v=new qq.Promise,f;return m.save(),S.resize?i({blob:d,canvas:p,image:c,imageHeight:u,imageWidth:o,orientation:S.orientation,resize:S.resize,targetHeight:_,targetWidth:h}):(qq.supportedFeatures.unlimitedScaledImageSize||(f=r({origWidth:h,origHeight:_}),f&&(qq.log(qq.format("Had to reduce dimensions due to device limitations from {}w / {}h to {}w / {}h",h,_,f.newWidth,f.newHeight),"warn"),h=f.newWidth,_=f.newHeight)),l(p,h,_,S.orientation),qq.ios()?function(){e(c)&&(o/=2,u/=2);var g=1024,y=document.createElement("canvas"),C=q?t(c,o,u):1,b=Math.ceil(g*h/o),x=Math.ceil(g*_/u/C),w=0,E=0,F,P,R;for(y.width=y.height=g,F=y.getContext("2d");w<u;){for(P=0,R=0;P<o;)F.clearRect(0,0,g,g),F.drawImage(c,-P,-w),m.drawImage(y,0,0,g,g,R,E,b,x),P+=g,R+=b;w+=g,E+=x}m.restore(),y=F=null}():m.drawImage(c,0,0,h,_),p.qqImageRendered&&p.qqImageRendered(),v.success(),v)}function i(c){var d=c.blob,p=c.image,S=c.imageHeight,q=c.imageWidth,o=c.orientation,u=new qq.Promise,h=c.resize,_=document.createElement("canvas"),m=_.getContext("2d"),v=c.canvas,f=c.targetHeight,g=c.targetWidth;return l(_,q,S,o),v.height=f,v.width=g,m.drawImage(p,0,0),h({blob:d,height:f,image:p,sourceCanvas:_,targetCanvas:v,width:g}).then(function(){v.qqImageRendered&&v.qqImageRendered(),u.success()},u.failure),u}function l(c,d,p,S){switch(S){case 5:case 6:case 7:case 8:c.width=p,c.height=d;break;default:c.width=d,c.height=p}var q=c.getContext("2d");switch(S){case 2:q.translate(d,0),q.scale(-1,1);break;case 3:q.translate(d,p),q.rotate(Math.PI);break;case 4:q.translate(0,p),q.scale(1,-1);break;case 5:q.rotate(.5*Math.PI),q.scale(1,-1);break;case 6:q.rotate(.5*Math.PI),q.translate(0,-p);break;case 7:q.rotate(.5*Math.PI),q.translate(d,-p),q.scale(-1,1);break;case 8:q.rotate(-.5*Math.PI),q.translate(-d,0);break}}function a(c,d){var p=this;window.Blob&&c instanceof Blob&&function(){var S=new Image,q=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;if(!q)throw Error("No createObjectURL function found to create blob url");S.src=q.createObjectURL(c),p.blob=c,c=S}(),!c.naturalWidth&&!c.naturalHeight&&(c.onload=function(){var S=p.imageLoadListeners;S&&(p.imageLoadListeners=null,setTimeout(function(){for(var q=0,o=S.length;q<o;q++)S[q]()},0))},c.onerror=d,this.imageLoadListeners=[]),this.srcImage=c}a.prototype.render=function(c,d){d=d||{};var p=this,S=this.srcImage.naturalWidth,q=this.srcImage.naturalHeight,o=d.width,u=d.height,h=d.maxWidth,_=d.maxHeight,m=!this.blob||this.blob.type==="image/jpeg",v=c.tagName.toLowerCase(),f;if(this.imageLoadListeners){this.imageLoadListeners.push(function(){p.render(c,d)});return}o&&!u?u=q*o/S<<0:u&&!o?o=S*u/q<<0:(o=S,u=q),h&&o>h&&(o=h,u=q*o/S<<0),_&&u>_&&(u=_,o=S*u/q<<0),f={width:o,height:u},qq.each(d,function(g,y){f[g]=y}),v==="img"?function(){var g=c.src;n(p.srcImage,p.blob,f,m).then(function(y){c.src=y,g===c.src&&c.onload()})}():v==="canvas"&&s(this.srcImage,this.blob,c,f,m),typeof this.onrender=="function"&&this.onrender(c)},qq.MegaPixImage=a}(),qq.ImageGenerator=function(e){function t(u){return u.tagName.toLowerCase()==="img"}function n(u){return u.tagName.toLowerCase()==="canvas"}function r(){return new Image().crossOrigin!==void 0}function s(){var u=document.createElement("canvas");return u.getContext&&u.getContext("2d")}function i(u){var h=u.split("/"),_=h[h.length-1].split("?")[0],m=qq.getExtension(_);switch(m=m&&m.toLowerCase(),m){case"jpeg":case"jpg":return"image/jpeg";case"png":return"image/png";case"bmp":return"image/bmp";case"gif":return"image/gif";case"tiff":case"tif":return"image/tiff"}}function l(u){var h=document.createElement("a"),_,m,v;return h.href=u,_=h.protocol,v=h.port,m=h.hostname,_.toLowerCase()!==window.location.protocol.toLowerCase()||m.toLowerCase()!==window.location.hostname.toLowerCase()||v!==window.location.port&&!qq.ie()}function a(u,h){u.onload=function(){u.onload=null,u.onerror=null,h.success(u)},u.onerror=function(){u.onload=null,u.onerror=null,e("Problem drawing thumbnail!","error"),h.failure(u,"Problem drawing thumbnail!")}}function c(u,h){u.qqImageRendered=function(){h.success(u)}}function d(u,h){var _=t(u)||n(u);return t(u)?a(u,h):n(u)?c(u,h):(h.failure(u),e(qq.format("Element container of type {} is not supported!",u.tagName),"error")),_}function p(u,h,_){var m=new qq.Promise,v=new qq.Identify(u,e),f=_.maxSize,g=_.orient==null?!0:_.orient,y=function(){h.onerror=null,h.onload=null,e("Could not render preview, file may be too large!","error"),m.failure(h,"Browser cannot render image!")};return v.isPreviewable().then(function(C){var b={parse:function(){return new qq.Promise().success()}},x=g?new qq.Exif(u,e):b,w=new qq.MegaPixImage(u,y);d(h,m)&&x.parse().then(function(E){var F=E&&E.Orientation;w.render(h,{maxWidth:f,maxHeight:f,orientation:F,mime:C,resize:_.customResizeFunction})},function(E){e(qq.format("EXIF data could not be parsed ({}).  Assuming orientation = 1.",E)),w.render(h,{maxWidth:f,maxHeight:f,mime:C,resize:_.customResizeFunction})})},function(){e("Not previewable"),m.failure(h,"Not previewable")}),m}function S(u,h,_,m,v){var f=new Image,g=new qq.Promise;d(f,g),l(u)&&(f.crossOrigin="anonymous"),f.src=u,g.then(function(){d(h,_);var C=new qq.MegaPixImage(f);C.render(h,{maxWidth:m,maxHeight:m,mime:i(u),resize:v})},_.failure)}function q(u,h,_,m){d(h,_),qq(h).css({maxWidth:m+"px",maxHeight:m+"px"}),h.src=u}function o(u,h,_){var m=new qq.Promise,v=_.scale,f=v?_.maxSize:null;return v&&t(h)?s()?l(u)&&!r()?q(u,h,m,f):S(u,h,m,f):q(u,h,m,f):n(h)?S(u,h,m,f):d(h,m)&&(h.src=u),m}qq.extend(this,{generate:function(u,h,_){return qq.isString(u)?(e("Attempting to update thumbnail based on server response."),o(u,h,_||{})):(e("Attempting to draw client-side image preview."),p(u,h,_||{}))}}),this._testing={},this._testing.isImg=t,this._testing.isCanvas=n,this._testing.isCrossOrigin=l,this._testing.determineMimeOfFileName=i},qq.Exif=function(e,t){var n=[274],r={274:{name:"Orientation",bytes:2}};function s(q){for(var o=0,u=0;q.length>0;)o+=parseInt(q.substring(0,2),16)*Math.pow(2,u),q=q.substring(2,q.length),u+=8;return o}function i(q,o){var u=q,h=o;return u===void 0&&(u=2,h=new qq.Promise),qq.readBlobToHex(e,u,4).then(function(_){var m=/^ffe([0-9])/.exec(_),v;m?m[1]!=="1"?(v=parseInt(_.slice(4,8),16),i(u+v+2,h)):h.success(u):h.failure("No EXIF header to be found!")}),h}function l(){var q=new qq.Promise;return qq.readBlobToHex(e,0,6).then(function(o){o.indexOf("ffd8")!==0?q.failure("Not a valid JPEG!"):i().then(function(u){q.success(u)},function(u){q.failure(u)})}),q}function a(q){var o=new qq.Promise;return qq.readBlobToHex(e,q+10,2).then(function(u){o.success(u==="4949")}),o}function c(q,o){var u=new qq.Promise;return qq.readBlobToHex(e,q+18,2).then(function(h){if(o)return u.success(s(h));u.success(parseInt(h,16))}),u}function d(q,o){var u=q+20,h=o*12;return qq.readBlobToHex(e,u,h)}function p(q){for(var o=[],u=0;u+24<=q.length;)o.push(q.slice(u,u+24)),u+=24;return o}function S(q,o){var u=16,h=qq.extend([],n),_={};return qq.each(o,function(m,v){var f=v.slice(0,4),g=q?s(f):parseInt(f,16),y=h.indexOf(g),C,b,x;if(y>=0&&(b=r[g].name,x=r[g].bytes,C=v.slice(u,u+x*2),_[b]=q?s(C):parseInt(C,16),h.splice(y,1)),h.length===0)return!1}),_}qq.extend(this,{parse:function(){var q=new qq.Promise,o=function(u){t(qq.format("EXIF header parse failed: '{}' ",u)),q.failure(u)};return l().then(function(u){t(qq.format("Moving forward with EXIF header parsing for '{}'",e.name===void 0?"blob":e.name)),a(u).then(function(h){t(qq.format("EXIF Byte order is {} endian",h?"little":"big")),c(u,h).then(function(_){t(qq.format("Found {} APP1 directory entries",_)),d(u,_).then(function(m){var v=p(m),f=S(h,v);t("Successfully parsed some EXIF tags"),q.success(f)},o)},o)},o)},o),q}}),this._testing={},this._testing.parseLittleEndian=s},qq.Identify=function(e,t){function n(r,s){var i=!1,l=[].concat(r);return qq.each(l,function(a,c){if(s.indexOf(c)===0)return i=!0,!1}),i}qq.extend(this,{isPreviewable:function(){var r=this,s=new qq.Promise,i=!1,l=e.name===void 0?"blob":e.name;return t(qq.format("Attempting to determine if {} can be rendered in this browser",l)),t("First pass: check type attribute of blob object."),this.isPreviewableSync()?(t("Second pass: check for magic bytes in file header."),qq.readBlobToHex(e,0,4).then(function(a){qq.each(r.PREVIEWABLE_MIME_TYPES,function(c,d){if(n(d,a))return(c!=="image/tiff"||qq.supportedFeatures.tiffPreviews)&&(i=!0,s.success(c)),!1}),t(qq.format("'{}' is {} able to be rendered in this browser",l,i?"":"NOT")),i||s.failure()},function(){t("Error reading file w/ name '"+l+"'.  Not able to be rendered in this browser."),s.failure()})):s.failure(),s},isPreviewableSync:function(){var r=e.type,s=qq.indexOf(Object.keys(this.PREVIEWABLE_MIME_TYPES),r)>=0,i=!1,l=e.name===void 0?"blob":e.name;return s&&(r==="image/tiff"?i=qq.supportedFeatures.tiffPreviews:i=!0),!i&&t(l+" is not previewable in this browser per the blob's type attr"),i}})},qq.Identify.prototype.PREVIEWABLE_MIME_TYPES={"image/jpeg":"ffd8ff","image/gif":"474946","image/png":"89504e","image/bmp":"424d","image/tiff":["49492a00","4d4d002a"]},qq.ImageValidation=function(e,t){function n(i){var l=!1;return qq.each(i,function(a,c){if(c>0)return l=!0,!1}),l}function r(){var i=new qq.Promise;return new qq.Identify(e,t).isPreviewable().then(function(){var l=new Image,a=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;a?(l.onerror=function(){t("Cannot determine dimensions for image.  May be too large.","error"),i.failure()},l.onload=function(){i.success({width:this.width,height:this.height})},l.src=a.createObjectURL(e)):(t("No createObjectURL function available to generate image URL!","error"),i.failure())},i.failure),i}function s(i,l){var a;return qq.each(i,function(c,d){if(d>0){var p=/(max|min)(Width|Height)/.exec(c),S=p[2].charAt(0).toLowerCase()+p[2].slice(1),q=l[S];switch(p[1]){case"min":if(q<d)return a=c,!1;break;case"max":if(q>d)return a=c,!1;break}}}),a}this.validate=function(i){var l=new qq.Promise;return t("Attempting to validate image."),n(i)?r().then(function(a){var c=s(i,a);c?l.failure(c):l.success()},l.success):l.success(),l}},qq.Session=function(e){var t={endpoint:null,params:{},customHeaders:{},cors:{},addFileRecord:function(s){},log:function(s,i){}};qq.extend(t,e,!0);function n(s){if(qq.isArray(s))return!0;t.log("Session response is not an array.","error")}function r(s,i,l,a){var c=!1;i=i&&n(s),i&&qq.each(s,function(d,p){if(p.uuid==null)c=!0,t.log(qq.format("Session response item {} did not include a valid UUID - ignoring.",d),"error");else if(p.name==null)c=!0,t.log(qq.format("Session response item {} did not include a valid name - ignoring.",d),"error");else try{return t.addFileRecord(p),!0}catch(S){c=!0,t.log(S.message,"error")}return!1}),a[i&&!c?"success":"failure"](s,l)}this.refresh=function(){var s=new qq.Promise,i=function(c,d,p){r(c,d,p,s)},l=qq.extend({},t),a=new qq.SessionAjaxRequester(qq.extend(l,{onComplete:i}));return a.queryServer(),s}},qq.SessionAjaxRequester=function(e){var t,n={endpoint:null,customHeaders:{},params:{},cors:{expected:!1,sendCredentials:!1},onComplete:function(s,i,l){},log:function(s,i){}};qq.extend(n,e);function r(s,i,l){var a=null;if(i.responseText!=null)try{a=qq.parseJson(i.responseText)}catch(c){n.log("Problem parsing session response: "+c.message,"error"),l=!0}n.onComplete(a,!l,i)}t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:["GET"],method:"GET",endpointStore:{get:function(){return n.endpoint}},customHeaders:n.customHeaders,log:n.log,onComplete:r,cors:n.cors})),qq.extend(this,{queryServer:function(){var s=qq.extend({},n.params);n.log("Session query request."),t.initTransport("sessionRefresh").withParams(s).withCacheBuster().send()}})},qq.Scaler=function(e,t){var n=e.customResizer,r=e.sendOriginal,s=e.orient,i=e.defaultType,l=e.defaultQuality/100,a=e.failureText,c=e.includeExif,d=this._getSortedSizes(e.sizes);qq.extend(this,{enabled:qq.supportedFeatures.scaling&&d.length>0,getFileRecords:function(p,S,q){var o=this,u=[],h=q.blob?q.blob:q,_=new qq.Identify(h,t);return _.isPreviewableSync()?(qq.each(d,function(m,v){var f=o._determineOutputType({defaultType:i,requestedType:v.type,refType:h.type});u.push({uuid:qq.getUniqueId(),name:o._getName(S,{name:v.name,type:f,refType:h.type}),blob:new qq.BlobProxy(h,qq.bind(o._generateScaledImage,o,{customResizeFunction:n,maxSize:v.maxSize,orient:s,type:f,quality:l,failedText:a,includeExif:c,log:t}))})}),u.push({uuid:p,name:S,size:h.size,blob:r?h:null})):u.push({uuid:p,name:S,size:h.size,blob:h}),u},handleNewFile:function(p,S,q,o,u,h,_,m){var v=this;p.qqButtonId||p.blob&&p.blob.qqButtonId;var f=[],g=null,y=m.addFileToHandler,C=m.uploadData,b=m.paramsStore,x=qq.getUniqueId();qq.each(v.getFileRecords(q,S,p),function(w,E){var F=E.size,P;E.blob instanceof qq.BlobProxy&&(F=-1),P=C.addFile({uuid:E.uuid,name:E.name,size:F,batchId:h,proxyGroupId:x}),E.blob instanceof qq.BlobProxy?f.push(P):g=P,E.blob?(y(P,E.blob),u.push({id:P,file:E.blob})):C.setStatus(P,qq.status.REJECTED)}),g!==null&&(qq.each(f,function(w,E){var F={qqparentuuid:C.retrieve({id:g}).uuid,qqparentsize:C.retrieve({id:g}).size};F[_]=C.retrieve({id:E}).uuid,C.setParentId(E,g),b.addReadOnly(E,F)}),f.length&&function(){var w={};w[_]=C.retrieve({id:g}).uuid,b.addReadOnly(g,w)}())}})},qq.extend(qq.Scaler.prototype,{scaleImage:function(e,t,n){if(!qq.supportedFeatures.scaling)throw new qq.Error("Scaling is not supported in this browser!");var r=new qq.Promise,s=n.log,i=n.getFile(e),l=n.uploadData.retrieve({id:e}),a=l&&l.name,c=l&&l.uuid,d={customResizer:t.customResizer,sendOriginal:!1,orient:t.orient,defaultType:t.type||null,defaultQuality:t.quality,failedToScaleText:"Unable to scale",sizes:[{name:"",maxSize:t.maxSize}]},p=new qq.Scaler(d,s);return!qq.Scaler||!qq.supportedFeatures.imagePreviews||!i?(r.failure(),s("Could not generate requested scaled image for "+e+".  Scaling is either not possible in this browser, or the file could not be located.","error")):qq.bind(function(){var S=p.getFileRecords(c,a,i)[0];S&&S.blob instanceof qq.BlobProxy?S.blob.create().then(r.success,r.failure):(s(e+" is not a scalable image!","error"),r.failure())},this)(),r},_determineOutputType:function(e){var t=e.requestedType,n=e.defaultType,r=e.refType;return!n&&!t?r!=="image/jpeg"?"image/png":r:t&&qq.indexOf(Object.keys(qq.Identify.prototype.PREVIEWABLE_MIME_TYPES),t)>=0?t==="image/tiff"?qq.supportedFeatures.tiffPreviews?t:n:t:n},_getName:function(e,t){var n=e.lastIndexOf("."),r=t.type||"image/png",s=t.refType,i="",l=qq.getExtension(e),a="";return t.name&&t.name.trim().length&&(a=" ("+t.name+")"),n>=0?(i=e.substr(0,n),s!==r&&(l=r.split("/")[1]),i+=a+"."+l):i=e+a,i},_getSortedSizes:function(e){return e=qq.extend([],e),e.sort(function(t,n){return t.maxSize>n.maxSize?1:t.maxSize<n.maxSize?-1:0})},_generateScaledImage:function(e,t){var n=this,r=e.customResizeFunction,s=e.log,i=e.maxSize,l=e.orient,a=e.type,c=e.quality,d=e.failedText,p=e.includeExif&&t.type==="image/jpeg"&&a==="image/jpeg",S=new qq.Promise,q=new qq.ImageGenerator(s),o=document.createElement("canvas");return s("Attempting to generate scaled version for "+t.name),q.generate(t,o,{maxSize:i,orient:l,customResizeFunction:r}).then(function(){var u=o.toDataURL(a,c),h=function(){s("Success generating scaled version for "+t.name);var _=qq.dataUriToBlob(u);S.success(_)};p?n._insertExifHeader(t,u,s).then(function(_){u=_,h()},function(){s("Problem inserting EXIF header into scaled image.  Using scaled image w/out EXIF data.","error"),h()}):h()},function(){s("Failed attempt to generate scaled version for "+t.name,"error"),S.failure(d)}),S},_insertExifHeader:function(e,t,n){var r=new FileReader,s=new qq.Promise,i="";return r.onload=function(){i=r.result,s.success(qq.ExifRestorer.restore(i,t))},r.onerror=function(){n("Problem reading "+e.name+" during attempt to transfer EXIF data to scaled version.","error"),s.failure()},r.readAsDataURL(e),s},_dataUriToBlob:function(e){var t,n,r,s;return e.split(",")[0].indexOf("base64")>=0?t=atob(e.split(",")[1]):t=decodeURI(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(t.length),s=new Uint8Array(r),qq.each(t,function(i,l){s[i]=l.charCodeAt(0)}),this._createBlob(r,n)},_createBlob:function(e,t){var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,r=n&&new n;return r?(r.append(e),r.getBlob(t)):new Blob([e],{type:t})}}),qq.ExifRestorer=function(){var e={};return e.KEY_STR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e.encode64=function(t){var n="",r,s,i="",l,a,c,d="",p=0;do r=t[p++],s=t[p++],i=t[p++],l=r>>2,a=(r&3)<<4|s>>4,c=(s&15)<<2|i>>6,d=i&63,isNaN(s)?c=d=64:isNaN(i)&&(d=64),n=n+this.KEY_STR.charAt(l)+this.KEY_STR.charAt(a)+this.KEY_STR.charAt(c)+this.KEY_STR.charAt(d),r=s=i="",l=a=c=d="";while(p<t.length);return n},e.restore=function(t,n){var r="data:image/jpeg;base64,";if(!t.match(r))return n;var s=this.decode64(t.replace(r,"")),i=this.slice2Segments(s),l=this.exifManipulation(n,i);return r+this.encode64(l)},e.exifManipulation=function(t,n){var r=this.getExifArray(n),s=this.insertExif(t,r),i=new Uint8Array(s);return i},e.getExifArray=function(t){for(var n,r=0;r<t.length;r++)if(n=t[r],n[0]==255&n[1]==225)return n;return[]},e.insertExif=function(t,n){var r=t.replace("data:image/jpeg;base64,",""),s=this.decode64(r),i=s.indexOf(255,3),l=s.slice(0,i),a=s.slice(i),c=l;return c=c.concat(n),c=c.concat(a),c},e.slice2Segments=function(t){for(var n=0,r=[];!(t[n]==255&t[n+1]==218);){if(t[n]==255&t[n+1]==216)n+=2;else{var s=t[n+2]*256+t[n+3],i=n+s+2,l=t.slice(n,i);r.push(l),n=i}if(n>t.length)break}return r},e.decode64=function(t){var n,r,s="",i,l,a,c="",d=0,p=[],S=/[^A-Za-z0-9\+\/\=]/g;if(S.exec(t))throw new Error("There were invalid base64 characters in the input text.  Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='");t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do i=this.KEY_STR.indexOf(t.charAt(d++)),l=this.KEY_STR.indexOf(t.charAt(d++)),a=this.KEY_STR.indexOf(t.charAt(d++)),c=this.KEY_STR.indexOf(t.charAt(d++)),n=i<<2|l>>4,r=(l&15)<<4|a>>2,s=(a&3)<<6|c,p.push(n),a!=64&&p.push(r),c!=64&&p.push(s),n=r=s="",i=l=a=c="";while(d<t.length);return p},e}(),qq.TotalProgress=function(e,t){var n={},r=0,s=0,i=-1,l=-1,a=function(o,u){(o!==i||u!==l)&&e(o,u),i=o,l=u},c=function(o,u){var h=!0;return qq.each(o,function(_,m){if(qq.indexOf(u,m)>=0)return h=!1,!1}),h},d=function(o){q(o,-1,-1),delete n[o]},p=function(o,u,h){(u.length===0||c(u,h))&&(a(s,s),this.reset())},S=function(o){var u=t(o);u>0&&(q(o,0,u),n[o]={loaded:0,total:u})},q=function(o,u,h){var _=n[o]?n[o].loaded:0,m=n[o]?n[o].total:0;u===-1&&h===-1?(r-=_,s-=m):(u&&(r+=u-_),h&&(s+=h-m)),a(r,s)};qq.extend(this,{onAllComplete:p,onStatusChange:function(o,u,h){h===qq.status.CANCELED||h===qq.status.REJECTED?d(o):h===qq.status.SUBMITTING&&S(o)},onIndividualProgress:function(o,u,h){q(o,u,h),n[o]={loaded:u,total:h}},onNewSize:function(o){S(o)},reset:function(){n={},r=0,s=0}})},qq.PasteSupport=function(e){var t,n;t={targetElement:null,callbacks:{log:function(l,a){},pasteReceived:function(l){}}};function r(l){return l.type&&l.type.indexOf("image/")===0}function s(){n=qq(t.targetElement).attach("paste",function(l){var a=l.clipboardData;a&&qq.each(a.items,function(c,d){if(r(d)){var p=d.getAsFile();t.callbacks.pasteReceived(p)}})})}function i(){n&&n()}qq.extend(t,e),s(),qq.extend(this,{reset:function(){i()}})},qq.FormSupport=function(e,t,n){var r=this,s=e.interceptSubmit,i=e.element,l=e.autoUpload;qq.extend(this,{newEndpoint:null,newAutoUpload:l,attachedToForm:!1,getFormInputsAsObject:function(){return i==null?null:r._form2Obj(i)}});function a(S){S.getAttribute("action")&&(r.newEndpoint=S.getAttribute("action"))}function c(S,q){if(S.checkValidity&&!S.checkValidity())n("Form did not pass validation checks - will not upload.","error"),q();else return!0}function d(S){var q=S.submit;qq(S).attach("submit",function(o){o=o||window.event,o.preventDefault?o.preventDefault():o.returnValue=!1,c(S,q)&&t()}),S.submit=function(){c(S,q)&&t()}}function p(S){return S&&(qq.isString(S)&&(S=document.getElementById(S)),S&&(n("Attaching to form element."),a(S),s&&d(S))),S}i=p(i),this.attachedToForm=!!i},qq.extend(qq.FormSupport.prototype,{_form2Obj:function(e){var t={},n=function(l){var a=["button","image","reset","submit"];return qq.indexOf(a,l.toLowerCase())<0},r=function(l){return qq.indexOf(["checkbox","radio"],l.toLowerCase())>=0},s=function(l){return r(l.type)&&!l.checked?!0:l.disabled&&l.type.toLowerCase()!=="hidden"},i=function(l){var a=null;return qq.each(qq(l).children(),function(c,d){if(d.tagName.toLowerCase()==="option"&&d.selected)return a=d.value,!1}),a};return qq.each(e.elements,function(l,a){if((qq.isInput(a,!0)||a.tagName.toLowerCase()==="textarea")&&n(a.type)&&!s(a))t[a.name]=a.value;else if(a.tagName.toLowerCase()==="select"&&!s(a)){var c=i(a);c!==null&&(t[a.name]=c)}}),t}}),qq.azure=qq.azure||{},qq.azure.util=qq.azure.util||function(){return{AZURE_PARAM_PREFIX:"x-ms-meta-",_paramNameMatchesAzureParameter:function(e){switch(e){case"Cache-Control":case"Content-Disposition":case"Content-Encoding":case"Content-MD5":case"x-ms-blob-content-encoding":case"x-ms-blob-content-disposition":case"x-ms-blob-content-md5":case"x-ms-blob-cache-control":return!0;default:return!1}},_getPrefixedParamName:function(e){return qq.azure.util._paramNameMatchesAzureParameter(e)?e:qq.azure.util.AZURE_PARAM_PREFIX+e},getParamsAsHeaders:function(e){var t={};return qq.each(e,function(n,r){var s=qq.azure.util._getPrefixedParamName(n),i=null;qq.isFunction(r)?i=String(r()):qq.isObject(r)?qq.extend(t,qq.azure.util.getParamsAsHeaders(r)):i=String(r),i!==null&&(qq.azure.util._paramNameMatchesAzureParameter(n)?t[s]=i:t[s]=encodeURIComponent(i))}),t},parseAzureError:function(e,t){var n=new DOMParser,r=n.parseFromString(e,"application/xml"),s=r.getElementsByTagName("Error")[0],i={},l,a;if(t("Received error response: "+e,"error"),s)return a=s.getElementsByTagName("Message")[0],a&&(i.message=a.textContent),l=s.getElementsByTagName("Code")[0],l&&(i.code=l.textContent),t("Parsed Azure error: "+JSON.stringify(i),"error"),i}}}(),function(){qq.nonTraditionalBasePublicApi={setUploadSuccessParams:function(e,t){this._uploadSuccessParamsStore.set(e,t)},setUploadSuccessEndpoint:function(e,t){this._uploadSuccessEndpointStore.set(e,t)}},qq.nonTraditionalBasePrivateApi={_onComplete:function(e,t,n,r){var s=!!n.success,i=this,l=arguments,a=this._uploadSuccessEndpointStore.get(e),c=this._options.uploadSuccess.customHeaders,d=this._options.uploadSuccess.method,p=this._options.cors,S=new qq.Promise,q=this._uploadSuccessParamsStore.get(e),o=this._paramsStore.get(e),u=function(v){delete i._failedSuccessRequestCallbacks[e],qq.extend(n,v),qq.FineUploaderBasic.prototype._onComplete.apply(i,l),S.success(v)},h=function(v){var f=_;qq.extend(n,v),n&&n.reset&&(f=null),f?i._failedSuccessRequestCallbacks[e]=f:delete i._failedSuccessRequestCallbacks[e],i._onAutoRetry(e,t,n,r,f)||(qq.FineUploaderBasic.prototype._onComplete.apply(i,l),S.failure(v))},_,m;return s&&a?(m=new qq.UploadSuccessAjaxRequester({endpoint:a,method:d,customHeaders:c,cors:p,log:qq.bind(this.log,this)}),qq.extend(q,i._getEndpointSpecificParams(e,n,r),!0),o&&qq.extend(q,o,!0),_=qq.bind(function(){m.sendSuccessRequest(e,q).then(u,h)},i),_(),S):qq.FineUploaderBasic.prototype._onComplete.apply(this,arguments)},_manualRetry:function(e){var t=this._failedSuccessRequestCallbacks[e];return qq.FineUploaderBasic.prototype._manualRetry.call(this,e,t)}}}(),function(){qq.azure.FineUploaderBasic=function(e){if(!qq.supportedFeatures.ajaxUploading)throw new qq.Error("Uploading directly to Azure is not possible in this browser.");var t={signature:{endpoint:null,customHeaders:{}},blobProperties:{name:"uuid"},uploadSuccess:{endpoint:null,method:"POST",params:{},customHeaders:{}},chunking:{partSize:4e6,minFileSize:4000001}};qq.extend(t,e,!0),qq.FineUploaderBasic.call(this,t),this._uploadSuccessParamsStore=this._createStore(this._options.uploadSuccess.params),this._uploadSuccessEndpointStore=this._createStore(this._options.uploadSuccess.endpoint),this._failedSuccessRequestCallbacks={},this._cannedBlobNames={}},qq.extend(qq.azure.FineUploaderBasic.prototype,qq.basePublicApi),qq.extend(qq.azure.FineUploaderBasic.prototype,qq.basePrivateApi),qq.extend(qq.azure.FineUploaderBasic.prototype,qq.nonTraditionalBasePublicApi),qq.extend(qq.azure.FineUploaderBasic.prototype,qq.nonTraditionalBasePrivateApi),qq.extend(qq.azure.FineUploaderBasic.prototype,{getBlobName:function(e){return this._cannedBlobNames[e]==null?this._handler.getThirdPartyFileId(e):this._cannedBlobNames[e]},_getEndpointSpecificParams:function(e){return{blob:this.getBlobName(e),uuid:this.getUuid(e),name:this.getName(e),container:this._endpointStore.get(e)}},_createUploadHandler:function(){return qq.FineUploaderBasic.prototype._createUploadHandler.call(this,{signature:this._options.signature,onGetBlobName:qq.bind(this._determineBlobName,this),deleteBlob:qq.bind(this._deleteBlob,this,!0)},"azure")},_determineBlobName:function(e){var t=this._options.blobProperties.name,n=this.getUuid(e),r=this.getName(e),s=qq.getExtension(r),i=n;if(qq.isString(t))switch(t){case"uuid":return s!==void 0&&(i+="."+s),new qq.Promise().success(i);case"filename":return new qq.Promise().success(r);default:return new qq.Promise.failure("Invalid blobName option value - "+t)}else return t.call(this,e)},_addCannedFile:function(e){var t;if(e.blobName==null)throw new qq.Error("Did not find blob name property in server session response.  This is required!");return t=qq.FineUploaderBasic.prototype._addCannedFile.apply(this,arguments),this._cannedBlobNames[t]=e.blobName,t},_deleteBlob:function(e,t){var n=this,r={},s={get:function(p){return n._endpointStore.get(p)+"/"+n.getBlobName(p)}},i={get:function(p){return r[p]}},l=function(p,S){r[p]=S,c.send(p)},a=function(p,S,q){e?(n.log("Will cancel upload, but cannot remove uncommitted parts from Azure due to issue retrieving SAS","error"),qq.FineUploaderBasic.prototype._onCancel.call(n,p,n.getName(p))):(n._onDeleteComplete(p,q,!0),n._options.callbacks.onDeleteComplete(p,q,!0))},c=new qq.azure.DeleteBlob({endpointStore:i,log:qq.bind(n.log,n),onDelete:function(p){n._onDelete(p),n._options.callbacks.onDelete(p)},onDeleteComplete:function(p,S,q){delete r[p],q&&(e?n.log("Will cancel upload, but failed to remove uncommitted parts from Azure.","error"):qq.azure.util.parseAzureError(S.responseText,qq.bind(n.log,n))),e?(qq.FineUploaderBasic.prototype._onCancel.call(n,p,n.getName(p)),n.log("Deleted uncommitted blob chunks for "+p)):(n._onDeleteComplete(p,S,q),n._options.callbacks.onDeleteComplete(p,S,q))}}),d=new qq.azure.GetSas({cors:this._options.cors,customHeaders:this._options.signature.customHeaders,endpointStore:{get:function(){return n._options.signature.endpoint}},restRequestVerb:c.method,log:qq.bind(n.log,n)});d.request(t,s.get(t)).then(qq.bind(l,n,t),qq.bind(a,n,t))},_createDeleteHandler:function(){var e=this;return{sendDelete:function(t,n){e._deleteBlob(!1,t)}}}})}(),qq.azure.XhrUploadHandler=function(e,t){var n=this,r=t.log,s=e.cors,i=e.endpointStore,l=e.paramsStore,a=e.signature,c=e.filenameParam,d=e.chunking.minFileSize,p=e.deleteBlob,S=e.onGetBlobName,q=t.getName,o=t.getSize,u=function(g){var y=l.get(g);return y[c]=q(g),y},h={putBlob:new qq.azure.PutBlob({getBlobMetadata:u,log:r}),putBlock:new qq.azure.PutBlock({log:r}),putBlockList:new qq.azure.PutBlockList({getBlobMetadata:u,log:r}),getSasForPutBlobOrBlock:new qq.azure.GetSas({cors:s,customHeaders:a.customHeaders,endpointStore:{get:function(){return a.endpoint}},log:r,restRequestVerb:"PUT"})};function _(g){var y=new qq.Promise;return v(g).then(function(C){var b=n._getMimeType(g),x=n._getPersistableData(g).blockIdEntries;h.putBlockList.send(g,C,x,b,function(w){n._registerXhr(g,null,w,h.putBlockList)}).then(function(w){r("Success combining chunks for id "+g),y.success({},w)},function(w){r("Attempt to combine chunks failed for id "+g,"error"),f(w,y)})},y.failure),y}function m(g){var y=i.get(g),C=new qq.Promise,b=function(w){n._setThirdPartyFileId(g,w),C.success(y+"/"+w)},x=function(w){C.failure(w)};return S(g).then(b,x),C}function v(g,y){var C=y==null?g:g+"."+y,b=new qq.Promise,x=function(P){r("GET SAS request succeeded."),b.success(P)},w=function(P,R){r("GET SAS request failed: "+P,"error"),b.failure({error:"Problem communicating with local server"},R)},E=function(P){h.getSasForPutBlobOrBlock.request(C,P).then(x,w)},F=function(P){r(qq.format("Failed to determine blob name for ID {} - {}",g,P),"error"),b.failure({error:P})};return m(g).then(E,F),b}function f(g,y){var C=qq.azure.util.parseAzureError(g.responseText,r),b="Problem sending file to Azure";y.failure({error:b,azureError:C&&C.message,reset:g.status===403})}qq.extend(this,{uploadChunk:function(g){var y=g.chunkIdx,C=g.id,b=new qq.Promise;return v(C,y).then(function(x){var w=n._createXhr(C,y),E=n._getChunkData(C,y);n._registerProgressHandler(C,y,E.size),n._registerXhr(C,y,w,h.putBlock),h.putBlock.upload(C+"."+y,w,x,y,E.blob).then(function(F){n._getPersistableData(C).blockIdEntries||(n._getPersistableData(C).blockIdEntries=[]),n._getPersistableData(C).blockIdEntries.push(F),r("Put Block call succeeded for "+C),b.success({},w)},function(){r(qq.format("Put Block call failed for ID {} on part {}",C,y),"error"),f(w,b)})},b.failure),b},uploadFile:function(g){var y=new qq.Promise,C=n.getFile(g);return v(g).then(function(b){var x=n._createXhr(g);n._registerProgressHandler(g),h.putBlob.upload(g,x,b,C).then(function(){r("Put Blob call succeeded for "+g),y.success({},x)},function(){r("Put Blob call failed for "+g,"error"),f(x,y)})},y.failure),y}}),qq.extend(this,new qq.XhrUploadHandler({options:qq.extend({namespace:"azure"},e),proxy:qq.extend({getEndpoint:e.endpointStore.get},t)})),qq.override(this,function(g){return{expunge:function(y){var C=n._wasCanceled(y),b=n._getPersistableData(y),x=b&&b.blockIdEntries||[];C&&x.length>0&&p(y),g.expunge(y)},finalizeChunks:function(y){return _(y)},_shouldChunkThisFile:function(y){var C=g._shouldChunkThisFile(y);return C&&o(y)>=d}}})},qq.azure.GetSas=function(e){var t,n={cors:{expected:!1,sendCredentials:!1},customHeaders:{},restRequestVerb:"PUT",endpointStore:null,log:function(i,l){}},r={};qq.extend(n,e);function s(i,l,a){var c=r[i];a?c.failure("Received response code "+l.status,l):l.responseText.length?c.success(l.responseText):c.failure("Empty response.",l),delete r[i]}t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:["GET"],method:"GET",successfulResponseCodes:{GET:[200]},contentType:null,customHeaders:n.customHeaders,endpointStore:n.endpointStore,cors:n.cors,log:n.log,onComplete:s})),qq.extend(this,{request:function(i,l){var a=new qq.Promise,c=n.restRequestVerb;return n.log(qq.format("Submitting GET SAS request for a {} REST request related to file ID {}.",c,i)),r[i]=a,t.initTransport(i).withParams({bloburi:l,_method:c}).withCacheBuster().send(),a}})},qq.UploadSuccessAjaxRequester=function(e){var t,n=[],r={method:"POST",endpoint:null,maxConnections:3,customHeaders:{},paramsStore:{},cors:{expected:!1,sendCredentials:!1},log:function(i,l){}};qq.extend(r,e);function s(i,l,a){var c=n[i],d=l.responseText,p={success:!0},S={success:!1},q;delete n[i],r.log(qq.format("Received the following response body to an upload success request for id {}: {}",i,d));try{q=qq.parseJson(d),a||q&&(q.error||q.success===!1)?(r.log("Upload success request was rejected by the server.","error"),c.failure(qq.extend(q,S))):(r.log("Upload success was acknowledged by the server."),c.success(qq.extend(q,p)))}catch{a?(r.log(qq.format("Your server indicated failure in its upload success request response for id {}!",i),"error"),c.failure(S)):(r.log("Upload success was acknowledged by the server."),c.success(p))}}t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",method:r.method,endpointStore:{get:function(){return r.endpoint}},paramsStore:r.paramsStore,maxConnections:r.maxConnections,customHeaders:r.customHeaders,log:r.log,onComplete:s,cors:r.cors})),qq.extend(this,{sendSuccessRequest:function(i,l){var a=new qq.Promise;return r.log("Submitting upload success request/notification for "+i),t.initTransport(i).withParams(l).send(),n[i]=a,a}})},qq.azure.DeleteBlob=function(e){var t,n="DELETE",r={endpointStore:{},onDelete:function(s){},onDeleteComplete:function(s,i,l){},log:function(s,i){}};qq.extend(r,e),t=qq.extend(this,new qq.AjaxRequester({validMethods:[n],method:n,successfulResponseCodes:function(){var s={};return s[n]=[202],s}(),contentType:null,endpointStore:r.endpointStore,allowXRequestedWithAndCacheControl:!1,cors:{expected:!0},log:r.log,onSend:r.onDelete,onComplete:r.onDeleteComplete})),qq.extend(this,{method:n,send:function(s){return r.log("Submitting Delete Blob request for "+s),t.initTransport(s).send()}})},qq.azure.PutBlob=function(e){var t,n="PUT",r={getBlobMetadata:function(a){},log:function(a,c){}},s={},i={},l={get:function(a){return s[a]}};qq.extend(r,e),t=qq.extend(this,new qq.AjaxRequester({validMethods:[n],method:n,successfulResponseCodes:function(){var a={};return a[n]=[201],a}(),contentType:null,customHeaders:function(a){var c=r.getBlobMetadata(a),d=qq.azure.util.getParamsAsHeaders(c);return d["x-ms-blob-type"]="BlockBlob",d},endpointStore:l,allowXRequestedWithAndCacheControl:!1,cors:{expected:!0},log:r.log,onComplete:function(a,c,d){var p=i[a];delete s[a],delete i[a],d?p.failure():p.success()}})),qq.extend(this,{method:n,upload:function(a,c,d,p){var S=new qq.Promise;return r.log("Submitting Put Blob request for "+a),i[a]=S,s[a]=d,t.initTransport(a).withPayload(p).withHeaders({"Content-Type":p.type}).send(c),S}})},qq.azure.PutBlock=function(e){var t,n="PUT",r={},s={},i={log:function(d,p){}},l={},a={get:function(d){return l[d]}};qq.extend(i,e),t=qq.extend(this,new qq.AjaxRequester({validMethods:[n],method:n,successfulResponseCodes:function(){var d={};return d[n]=[201],d}(),contentType:null,endpointStore:a,allowXRequestedWithAndCacheControl:!1,cors:{expected:!0},log:i.log,onComplete:function(d,p,S){var q=s[d],o=r[d];delete l[d],delete s[d],delete r[d],S?q.failure():q.success(o)}}));function c(d){var p=5,S=new Array(p+1).join("0"),q=(S+d).slice(-p);return btoa(q)}qq.extend(this,{method:n,upload:function(d,p,S,q,o){var u=new qq.Promise,h=c(q);return s[d]=u,i.log(qq.format("Submitting Put Block request for {} = part {}",d,q)),l[d]=qq.format("{}&comp=block&blockid={}",S,encodeURIComponent(h)),r[d]={part:q,id:h},t.initTransport(d).withPayload(o).send(p),u}})},qq.azure.PutBlockList=function(e){var t,n="PUT",r={},s={getBlobMetadata:function(c){},log:function(c,d){}},i={},l={get:function(c){return i[c]}};qq.extend(s,e),t=qq.extend(this,new qq.AjaxRequester({validMethods:[n],method:n,successfulResponseCodes:function(){var c={};return c[n]=[201],c}(),customHeaders:function(c){var d=s.getBlobMetadata(c);return qq.azure.util.getParamsAsHeaders(d)},contentType:"text/plain",endpointStore:l,allowXRequestedWithAndCacheControl:!1,cors:{expected:!0},log:s.log,onSend:function(){},onComplete:function(c,d,p){var S=r[c];delete i[c],delete r[c],p?S.failure(d):S.success(d)}}));function a(c){var d=document.implementation.createDocument(null,"BlockList",null);return c.sort(function(p,S){return p.part-S.part}),qq.each(c,function(p,S){var q=d.createElement("Latest"),o=d.createTextNode(S.id);q.appendChild(o),qq(d).children()[0].appendChild(q)}),new XMLSerializer().serializeToString(d)}qq.extend(this,{method:n,send:function(c,d,p,S,q){var o=new qq.Promise,u=a(p),h;return r[c]=o,s.log(qq.format("Submitting Put Block List request for {}",c)),i[c]=qq.format("{}&comp=blocklist",d),h=t.initTransport(c).withPayload(u).withHeaders({"x-ms-blob-content-type":S}).send(),q(h),o}})}})(window)})(azure_fineUploader_core);var azure_fineUploader_coreExports=azure_fineUploader_core.exports,azure=azure_fineUploader_coreExports,fineUploader_core={exports:{}};(function(module){(function(global){var qq=function(e){return{hide:function(){return e.style.display="none",this},attach:function(t,n){return e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n),function(){qq(e).detach(t,n)}},detach:function(t,n){return e.removeEventListener?e.removeEventListener(t,n,!1):e.attachEvent&&e.detachEvent("on"+t,n),this},contains:function(t){return t?e===t?!0:e.contains?e.contains(t):!!(t.compareDocumentPosition(e)&8):!1},insertBefore:function(t){return t.parentNode.insertBefore(e,t),this},remove:function(){return e.parentNode.removeChild(e),this},css:function(t){if(e.style==null)throw new qq.Error("Can't apply style to node as it is not on the HTMLElement prototype chain!");return t.opacity!=null&&typeof e.style.opacity!="string"&&typeof e.filters<"u"&&(t.filter="alpha(opacity="+Math.round(100*t.opacity)+")"),qq.extend(e.style,t),this},hasClass:function(t,n){var r=new RegExp("(^| )"+t+"( |$)");return r.test(e.className)||!!(n&&r.test(e.parentNode.className))},addClass:function(t){return qq(e).hasClass(t)||(e.className+=" "+t),this},removeClass:function(t){var n=new RegExp("(^| )"+t+"( |$)");return e.className=e.className.replace(n," ").replace(/^\s+|\s+$/g,""),this},getByClass:function(t,n){var r,s=[];return n&&e.querySelector?e.querySelector("."+t):e.querySelectorAll?e.querySelectorAll("."+t):(r=e.getElementsByTagName("*"),qq.each(r,function(i,l){qq(l).hasClass(t)&&s.push(l)}),n?s[0]:s)},getFirstByClass:function(t){return qq(e).getByClass(t,!0)},children:function(){for(var t=[],n=e.firstChild;n;)n.nodeType===1&&t.push(n),n=n.nextSibling;return t},setText:function(t){return e.innerText=t,e.textContent=t,this},clearText:function(){return qq(e).setText("")},hasAttribute:function(t){var n;return e.hasAttribute?e.hasAttribute(t)?/^false$/i.exec(e.getAttribute(t))==null:!1:(n=e[t],n===void 0?!1:/^false$/i.exec(n)==null)}}};(function(){qq.canvasToBlob=function(e,t,n){return qq.dataUriToBlob(e.toDataURL(t,n))},qq.dataUriToBlob=function(e){var t,n,r=function(l,a){var c=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,d=c&&new c;return d?(d.append(l),d.getBlob(a)):new Blob([l],{type:a})},s,i;return e.split(",")[0].indexOf("base64")>=0?n=atob(e.split(",")[1]):n=decodeURI(e.split(",")[1]),i=e.split(",")[0].split(":")[1].split(";")[0],t=new ArrayBuffer(n.length),s=new Uint8Array(t),qq.each(n,function(l,a){s[l]=a.charCodeAt(0)}),r(t,i)},qq.log=function(e,t){window.console&&(!t||t==="info"?window.console.log(e):window.console[t]?window.console[t](e):window.console.log("<"+t+"> "+e))},qq.isObject=function(e){return e&&!e.nodeType&&Object.prototype.toString.call(e)==="[object Object]"},qq.isFunction=function(e){return typeof e=="function"},qq.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"||e&&window.ArrayBuffer&&e.buffer&&e.buffer.constructor===ArrayBuffer},qq.isItemList=function(e){return Object.prototype.toString.call(e)==="[object DataTransferItemList]"},qq.isNodeList=function(e){return Object.prototype.toString.call(e)==="[object NodeList]"||e.item&&e.namedItem},qq.isString=function(e){return Object.prototype.toString.call(e)==="[object String]"},qq.trimStr=function(e){return String.prototype.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},qq.format=function(e){var t=Array.prototype.slice.call(arguments,1),n=e,r=n.indexOf("{}");return qq.each(t,function(s,i){var l=n.substring(0,r),a=n.substring(r+2);if(n=l+i+a,r=n.indexOf("{}",r+i.length),r<0)return!1}),n},qq.isFile=function(e){return window.File&&Object.prototype.toString.call(e)==="[object File]"},qq.isFileList=function(e){return window.FileList&&Object.prototype.toString.call(e)==="[object FileList]"},qq.isFileOrInput=function(e){return qq.isFile(e)||qq.isInput(e)},qq.isInput=function(e,t){var n=function(r){var s=r.toLowerCase();return t?s!=="file":s==="file"};return!!(window.HTMLInputElement&&Object.prototype.toString.call(e)==="[object HTMLInputElement]"&&e.type&&n(e.type)||e.tagName&&e.tagName.toLowerCase()==="input"&&e.type&&n(e.type))},qq.isBlob=function(e){if(window.Blob&&Object.prototype.toString.call(e)==="[object Blob]")return!0},qq.isXhrUploadSupported=function(){var e=document.createElement("input");return e.type="file",e.multiple!==void 0&&typeof File<"u"&&typeof FormData<"u"&&typeof qq.createXhrInstance().upload<"u"},qq.createXhrInstance=function(){if(window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch{return qq.log("Neither XHR or ActiveX are supported!","error"),null}},qq.isFolderDropSupported=function(e){return e.items&&e.items.length>0&&e.items[0].webkitGetAsEntry},qq.isFileChunkingSupported=function(){return!qq.androidStock()&&qq.isXhrUploadSupported()&&(File.prototype.slice!==void 0||File.prototype.webkitSlice!==void 0||File.prototype.mozSlice!==void 0)},qq.sliceBlob=function(e,t,n){var r=e.slice||e.mozSlice||e.webkitSlice;return r.call(e,t,n)},qq.arrayBufferToHex=function(e){var t="",n=new Uint8Array(e);return qq.each(n,function(r,s){var i=s.toString(16);i.length<2&&(i="0"+i),t+=i}),t},qq.readBlobToHex=function(e,t,n){var r=qq.sliceBlob(e,t,t+n),s=new FileReader,i=new qq.Promise;return s.onload=function(){i.success(qq.arrayBufferToHex(s.result))},s.onerror=i.failure,s.readAsArrayBuffer(r),i},qq.extend=function(e,t,n){return qq.each(t,function(r,s){n&&qq.isObject(s)?(e[r]===void 0&&(e[r]={}),qq.extend(e[r],s,!0)):e[r]=s}),e},qq.override=function(e,t){var n={},r=t(n);return qq.each(r,function(s,i){e[s]!==void 0&&(n[s]=e[s]),e[s]=i}),e},qq.indexOf=function(e,t,n){if(e.indexOf)return e.indexOf(t,n);n=n||0;var r=e.length;for(n<0&&(n+=r);n<r;n+=1)if(e.hasOwnProperty(n)&&e[n]===t)return n;return-1},qq.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)})},qq.ie=function(){return navigator.userAgent.indexOf("MSIE")!==-1||navigator.userAgent.indexOf("Trident")!==-1},qq.ie7=function(){return navigator.userAgent.indexOf("MSIE 7")!==-1},qq.ie8=function(){return navigator.userAgent.indexOf("MSIE 8")!==-1},qq.ie10=function(){return navigator.userAgent.indexOf("MSIE 10")!==-1},qq.ie11=function(){return qq.ie()&&navigator.userAgent.indexOf("rv:11")!==-1},qq.edge=function(){return navigator.userAgent.indexOf("Edge")>=0},qq.safari=function(){return navigator.vendor!==void 0&&navigator.vendor.indexOf("Apple")!==-1},qq.chrome=function(){return navigator.vendor!==void 0&&navigator.vendor.indexOf("Google")!==-1},qq.opera=function(){return navigator.vendor!==void 0&&navigator.vendor.indexOf("Opera")!==-1},qq.firefox=function(){return!qq.edge()&&!qq.ie11()&&navigator.userAgent.indexOf("Mozilla")!==-1&&navigator.vendor!==void 0&&navigator.vendor===""},qq.windows=function(){return navigator.platform==="Win32"},qq.android=function(){return navigator.userAgent.toLowerCase().indexOf("android")!==-1},qq.androidStock=function(){return qq.android()&&navigator.userAgent.toLowerCase().indexOf("chrome")<0},qq.ios6=function(){return qq.ios()&&navigator.userAgent.indexOf(" OS 6_")!==-1},qq.ios7=function(){return qq.ios()&&navigator.userAgent.indexOf(" OS 7_")!==-1},qq.ios8=function(){return qq.ios()&&navigator.userAgent.indexOf(" OS 8_")!==-1},qq.ios800=function(){return qq.ios()&&navigator.userAgent.indexOf(" OS 8_0 ")!==-1},qq.ios=function(){return navigator.userAgent.indexOf("iPad")!==-1||navigator.userAgent.indexOf("iPod")!==-1||navigator.userAgent.indexOf("iPhone")!==-1},qq.iosChrome=function(){return qq.ios()&&navigator.userAgent.indexOf("CriOS")!==-1},qq.iosSafari=function(){return qq.ios()&&!qq.iosChrome()&&navigator.userAgent.indexOf("Safari")!==-1},qq.iosSafariWebView=function(){return qq.ios()&&!qq.iosChrome()&&!qq.iosSafari()},qq.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},qq.toElement=function(){var e=document.createElement("div");return function(t){e.innerHTML=t;var n=e.firstChild;return e.removeChild(n),n}}(),qq.each=function(e,t){var n,r;if(e){if(window.Storage&&e.constructor===window.Storage)for(n=0;n<e.length&&(r=t(e.key(n),e.getItem(e.key(n))),r!==!1);n++);else if(qq.isArray(e)||qq.isItemList(e)||qq.isNodeList(e))for(n=0;n<e.length&&(r=t(n,e[n]),r!==!1);n++);else if(qq.isString(e))for(n=0;n<e.length&&(r=t(n,e.charAt(n)),r!==!1);n++);else for(n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&(r=t(n,e[n]),r===!1))break}},qq.bind=function(e,t){if(qq.isFunction(e)){var n=Array.prototype.slice.call(arguments,2);return function(){var r=qq.extend([],n);return arguments.length&&(r=r.concat(Array.prototype.slice.call(arguments))),e.apply(t,r)}}throw new Error("first parameter must be a function!")},qq.obj2url=function(e,t,n){var r=[],s="&",i=function(l,a){var c=t?/\[\]$/.test(t)?t:t+"["+a+"]":a;c!=="undefined"&&a!=="undefined"&&r.push(typeof l=="object"?qq.obj2url(l,c,!0):Object.prototype.toString.call(l)==="[object Function]"?encodeURIComponent(c)+"="+encodeURIComponent(l()):encodeURIComponent(c)+"="+encodeURIComponent(l))};return!n&&t?(s=/\?/.test(t)?/\?$/.test(t)?"":"&":"?",r.push(t),r.push(qq.obj2url(e))):Object.prototype.toString.call(e)==="[object Array]"&&typeof e<"u"?qq.each(e,function(l,a){i(a,l)}):typeof e<"u"&&e!==null&&typeof e=="object"?qq.each(e,function(l,a){i(a,l)}):r.push(encodeURIComponent(t)+"="+encodeURIComponent(e)),t?r.join(s):r.join(s).replace(/^&/,"").replace(/%20/g,"+")},qq.obj2FormData=function(e,t,n){return t||(t=new FormData),qq.each(e,function(r,s){r=n?n+"["+r+"]":r,qq.isObject(s)?qq.obj2FormData(s,t,r):qq.isFunction(s)?t.append(r,s()):t.append(r,s)}),t},qq.obj2Inputs=function(e,t){var n;return t||(t=document.createElement("form")),qq.obj2FormData(e,{append:function(r,s){n=document.createElement("input"),n.setAttribute("name",r),n.setAttribute("value",s),t.appendChild(n)}}),t},qq.parseJson=function(json){return window.JSON&&qq.isFunction(JSON.parse)?JSON.parse(json):eval("("+json+")")},qq.getExtension=function(e){var t=e.lastIndexOf(".")+1;if(t>0)return e.substr(t,e.length-t)},qq.getFilename=function(e){return qq.isInput(e)?e.value.replace(/.*(\/|\\)/,""):qq.isFile(e)&&e.fileName!==null&&e.fileName!==void 0?e.fileName:e.name},qq.DisposeSupport=function(){var e=[];return{dispose:function(){var t;do t=e.shift(),t&&t();while(t)},attach:function(){var t=arguments;this.addDisposer(qq(t[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(t){e.push(t)}}}})(),function(){module.exports?module.exports=qq:global.qq=qq}(),function(){qq.Error=function(e){this.message="[Fine Uploader "+qq.version+"] "+e},qq.Error.prototype=new Error}(),qq.version="5.16.2",qq.supportedFeatures=function(){var e,t,n,r,s,i,l,a,c,d,p,S,q,o,u;function h(){var b=!0,x;try{x=document.createElement("input"),x.type="file",qq(x).hide(),x.disabled&&(b=!1)}catch{b=!1}return b}function _(){return(qq.chrome()||qq.opera())&&navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/)!==void 0}function m(){if(window.XMLHttpRequest){var b=qq.createXhrInstance();return b.withCredentials!==void 0}return!1}function v(){return window.XDomainRequest!==void 0}function f(){return m()?!0:v()}function g(){return document.createElement("input").webkitdirectory!==void 0}function y(){try{return!!window.localStorage&&qq.isFunction(window.localStorage.setItem)}catch{return!1}}function C(){var b=document.createElement("span");return("draggable"in b||"ondragstart"in b&&"ondrop"in b)&&!qq.android()&&!qq.ios()}return e=h(),r=e&&qq.isXhrUploadSupported(),t=r&&!qq.androidStock(),n=r&&C(),s=n&&function(){var b=document.createElement("input");return b.type="file","webkitdirectory"in(b||document.querySelectorAll("input[type=file]")[0])}(),i=r&&qq.isFileChunkingSupported(),l=r&&i&&y(),a=r&&_(),c=e&&(window.postMessage!==void 0||r),p=m(),d=v(),S=f(),q=g(),o=r&&window.FileReader!==void 0,u=function(){return r?!qq.androidStock()&&!qq.iosChrome():!1}(),{ajaxUploading:r,blobUploading:t,canDetermineSize:r,chunking:i,deleteFileCors:S,deleteFileCorsXdr:d,deleteFileCorsXhr:p,dialogElement:!!window.HTMLDialogElement,fileDrop:n,folderDrop:s,folderSelection:q,imagePreviews:o,imageValidation:o,itemSizeValidation:r,pause:i,progressBar:u,resume:l,scaling:o&&t,tiffPreviews:qq.safari(),unlimitedScaledImageSize:!qq.ios(),uploading:e,uploadCors:c,uploadCustomHeaders:r,uploadNonMultipart:r,uploadViaPaste:a}}(),qq.isGenericPromise=function(e){return!!(e&&e.then&&qq.isFunction(e.then))},qq.Promise=function(){var e,t,n=[],r=[],s=[],i=0;qq.extend(this,{then:function(l,a){return i===0?(l&&n.push(l),a&&r.push(a)):i===-1?a&&a.apply(null,t):l&&l.apply(null,e),this},done:function(l){return i===0?s.push(l):l.apply(null,t===void 0?e:t),this},success:function(){return i=1,e=arguments,n.length&&qq.each(n,function(l,a){a.apply(null,e)}),s.length&&qq.each(s,function(l,a){a.apply(null,e)}),this},failure:function(){return i=-1,t=arguments,r.length&&qq.each(r,function(l,a){a.apply(null,t)}),s.length&&qq.each(s,function(l,a){a.apply(null,t)}),this}})},qq.BlobProxy=function(e,t){qq.extend(this,{referenceBlob:e,create:function(){return t(e)}})},qq.UploadButton=function(e){var t=this,n=new qq.DisposeSupport,r={acceptFiles:null,element:null,focusClass:"qq-upload-button-focus",folders:!1,hoverClass:"qq-upload-button-hover",ios8BrowserCrashWorkaround:!1,multiple:!1,name:"qqfile",onChange:function(a){},title:null},s,i;qq.extend(r,e),i=qq.getUniqueId();function l(){var a=document.createElement("input");return a.setAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME,i),a.setAttribute("title",r.title),t.setMultiple(r.multiple,a),r.folders&&qq.supportedFeatures.folderSelection&&a.setAttribute("webkitdirectory",""),r.acceptFiles&&a.setAttribute("accept",r.acceptFiles),a.setAttribute("type","file"),a.setAttribute("name",r.name),qq(a).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:qq.ie()&&!qq.ie8()?"3500px":"118px",margin:0,padding:0,cursor:"pointer",opacity:0}),!qq.ie7()&&qq(a).css({height:"100%"}),r.element.appendChild(a),n.attach(a,"change",function(){r.onChange(a)}),n.attach(a,"mouseover",function(){qq(r.element).addClass(r.hoverClass)}),n.attach(a,"mouseout",function(){qq(r.element).removeClass(r.hoverClass)}),n.attach(a,"focus",function(){qq(r.element).addClass(r.focusClass)}),n.attach(a,"blur",function(){qq(r.element).removeClass(r.focusClass)}),a}qq(r.element).css({position:"relative",overflow:"hidden",direction:"ltr"}),qq.extend(this,{getInput:function(){return s},getButtonId:function(){return i},setMultiple:function(a,c){var d=c||this.getInput();r.ios8BrowserCrashWorkaround&&qq.ios8()&&(qq.iosChrome()||qq.iosSafariWebView())||a?d.setAttribute("multiple",""):d.removeAttribute("multiple")},setAcceptFiles:function(a){a!==r.acceptFiles&&s.setAttribute("accept",a)},reset:function(){s.parentNode&&qq(s).remove(),qq(r.element).removeClass(r.focusClass),s=null,s=l()}}),s=l()},qq.UploadButton.BUTTON_ID_ATTR_NAME="qq-button-id",qq.UploadData=function(e){var t=[],n={},r={},s={},i={};function l(d){if(qq.isArray(d)){var p=[];return qq.each(d,function(S,q){p.push(t[q])}),p}return t[d]}function a(d){if(qq.isArray(d)){var p=[];return qq.each(d,function(S,q){p.push(t[n[q]])}),p}return t[n[d]]}function c(d){var p=[],S=[].concat(d);return qq.each(S,function(q,o){var u=r[o];u!==void 0&&qq.each(u,function(h,_){p.push(t[_])})}),p}qq.extend(this,{addFile:function(d){var p=d.status||qq.status.SUBMITTING,S=t.push({name:d.name,originalName:d.name,uuid:d.uuid,size:d.size==null?-1:d.size,status:p,file:d.file})-1;return d.batchId&&(t[S].batchId=d.batchId,i[d.batchId]===void 0&&(i[d.batchId]=[]),i[d.batchId].push(S)),d.proxyGroupId&&(t[S].proxyGroupId=d.proxyGroupId,s[d.proxyGroupId]===void 0&&(s[d.proxyGroupId]=[]),s[d.proxyGroupId].push(S)),t[S].id=S,n[d.uuid]=S,r[p]===void 0&&(r[p]=[]),r[p].push(S),d.onBeforeStatusChange&&d.onBeforeStatusChange(S),e.onStatusChange(S,null,p),S},retrieve:function(d){if(qq.isObject(d)&&t.length){if(d.id!==void 0)return l(d.id);if(d.uuid!==void 0)return a(d.uuid);if(d.status)return c(d.status)}else return qq.extend([],t,!0)},removeFileRef:function(d){var p=l(d);p&&delete p.file},reset:function(){t=[],n={},r={},i={}},setStatus:function(d,p){var S=t[d].status,q=qq.indexOf(r[S],d);r[S].splice(q,1),t[d].status=p,r[p]===void 0&&(r[p]=[]),r[p].push(d),e.onStatusChange(d,S,p)},uuidChanged:function(d,p){var S=t[d].uuid;t[d].uuid=p,n[p]=d,delete n[S]},updateName:function(d,p){t[d].name=p},updateSize:function(d,p){t[d].size=p},setParentId:function(d,p){t[d].parentId=p},getIdsInProxyGroup:function(d){var p=t[d].proxyGroupId;return p?s[p]:[]},getIdsInBatch:function(d){var p=t[d].batchId;return i[p]}})},qq.status={SUBMITTING:"submitting",SUBMITTED:"submitted",REJECTED:"rejected",QUEUED:"queued",CANCELED:"canceled",PAUSED:"paused",UPLOADING:"uploading",UPLOAD_FINALIZING:"upload finalizing",UPLOAD_RETRYING:"retrying upload",UPLOAD_SUCCESSFUL:"upload successful",UPLOAD_FAILED:"upload failed",DELETE_FAILED:"delete failed",DELETING:"deleting",DELETED:"deleted"},function(){qq.basePublicApi={addBlobs:function(e,t,n){this.addFiles(e,t,n)},addInitialFiles:function(e){var t=this;qq.each(e,function(n,r){t._addCannedFile(r)})},addFiles:function(e,t,n){this._maybeHandleIos8SafariWorkaround();var r=this._storedIds.length===0?qq.getUniqueId():this._currentBatchId,s=qq.bind(function(q){this._handleNewFile({blob:q,name:this._options.blobs.defaultName},r,S)},this),i=qq.bind(function(q){this._handleNewFile(q,r,S)},this),l=qq.bind(function(q){var o=qq.canvasToBlob(q);this._handleNewFile({blob:o,name:this._options.blobs.defaultName+".png"},r,S)},this),a=qq.bind(function(q){var o=q.quality&&q.quality/100,u=qq.canvasToBlob(q.canvas,q.type,o);this._handleNewFile({blob:u,name:q.name},r,S)},this),c=qq.bind(function(q){if(qq.isInput(q)&&qq.supportedFeatures.ajaxUploading){var o=Array.prototype.slice.call(q.files),u=this;qq.each(o,function(h,_){u._handleNewFile(_,r,S)})}else this._handleNewFile(q,r,S)},this),d=function(){qq.isFileList(e)&&(e=Array.prototype.slice.call(e)),e=[].concat(e)},p=this,S=[];this._currentBatchId=r,e&&(d(),qq.each(e,function(q,o){qq.isFileOrInput(o)?c(o):qq.isBlob(o)?s(o):qq.isObject(o)?o.blob&&o.name?i(o):o.canvas&&o.name&&a(o):o.tagName&&o.tagName.toLowerCase()==="canvas"?l(o):p.log(o+" is not a valid file container!  Ignoring!","warn")}),this.log("Received "+S.length+" files."),this._prepareItemsForUpload(S,t,n))},cancel:function(e){var t=this._uploadData.retrieve({id:e});t&&t.status===qq.status.UPLOAD_FINALIZING?this.log(qq.format("Ignoring cancel for file ID {} ({}).  Finalizing upload.",e,this.getName(e)),"error"):this._handler.cancel(e)},cancelAll:function(){var e=[],t=this;qq.extend(e,this._storedIds),qq.each(e,function(n,r){t.cancel(r)}),this._handler.cancelAll()},clearStoredFiles:function(){this._storedIds=[]},continueUpload:function(e){var t=this._uploadData.retrieve({id:e});return!qq.supportedFeatures.pause||!this._options.chunking.enabled?!1:t.status===qq.status.PAUSED?(this.log(qq.format("Paused file ID {} ({}) will be continued.  Not paused.",e,this.getName(e))),this._uploadFile(e),!0):(this.log(qq.format("Ignoring continue for file ID {} ({}).  Not paused.",e,this.getName(e)),"error"),!1)},deleteFile:function(e){return this._onSubmitDelete(e)},doesExist:function(e){return this._handler.isValid(e)},drawThumbnail:function(e,t,n,r,s){var i=new qq.Promise,l,a;return this._imageGenerator?(l=this._thumbnailUrls[e],a={customResizeFunction:s,maxSize:n>0?n:null,scale:n>0},!r&&qq.supportedFeatures.imagePreviews&&(l=this.getFile(e)),l==null?i.failure({container:t,error:"File or URL not found."}):this._imageGenerator.generate(l,t,a).then(function(d){i.success(d)},function(d,p){i.failure({container:d,error:p||"Problem generating thumbnail"})})):i.failure({container:t,error:"Missing image generator module"}),i},getButton:function(e){return this._getButton(this._buttonIdsForFileIds[e])},getEndpoint:function(e){return this._endpointStore.get(e)},getFile:function(e){var t=this._handler.getFile(e),n;return t||(n=this._uploadData.retrieve({id:e}),n&&(t=n.file)),t||null},getInProgress:function(){return this._uploadData.retrieve({status:[qq.status.UPLOADING,qq.status.UPLOAD_RETRYING,qq.status.QUEUED]}).length},getName:function(e){return this._uploadData.retrieve({id:e}).name},getParentId:function(e){var t=this.getUploads({id:e}),n=null;return t&&t.parentId!==void 0&&(n=t.parentId),n},getResumableFilesData:function(){return this._handler.getResumableFilesData()},getSize:function(e){return this._uploadData.retrieve({id:e}).size},getNetUploads:function(){return this._netUploaded},getRemainingAllowedItems:function(){var e=this._currentItemLimit;return e>0?e-this._netUploadedOrQueued:null},getUploads:function(e){return this._uploadData.retrieve(e)},getUuid:function(e){return this._uploadData.retrieve({id:e}).uuid},isResumable:function(e){return this._handler.hasResumeRecord(e)},log:function(e,t){this._options.debug&&(!t||t==="info")?qq.log("[Fine Uploader "+qq.version+"] "+e):t&&t!=="info"&&qq.log("[Fine Uploader "+qq.version+"] "+e,t)},pauseUpload:function(e){var t=this._uploadData.retrieve({id:e});if(!qq.supportedFeatures.pause||!this._options.chunking.enabled)return!1;if(qq.indexOf([qq.status.UPLOADING,qq.status.UPLOAD_RETRYING],t.status)>=0){if(this._handler.pause(e))return this._uploadData.setStatus(e,qq.status.PAUSED),!0;this.log(qq.format("Unable to pause file ID {} ({}).",e,this.getName(e)),"error")}else this.log(qq.format("Ignoring pause for file ID {} ({}).  Not in progress.",e,this.getName(e)),"error");return!1},removeFileRef:function(e){this._handler.expunge(e),this._uploadData.removeFileRef(e)},reset:function(){this.log("Resetting uploader..."),this._handler.reset(),this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._thumbnailUrls=[],qq.each(this._buttons,function(e,t){t.reset()}),this._paramsStore.reset(),this._endpointStore.reset(),this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData.reset(),this._buttonIdsForFileIds=[],this._pasteHandler&&this._pasteHandler.reset(),this._options.session.refreshOnReset&&this._refreshSessionData(),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[],this._totalProgress&&this._totalProgress.reset(),this._customResumeDataStore.reset()},retry:function(e){return this._manualRetry(e)},scaleImage:function(e,t){var n=this;return qq.Scaler.prototype.scaleImage(e,t,{log:qq.bind(n.log,n),getFile:qq.bind(n.getFile,n),uploadData:n._uploadData})},setCustomHeaders:function(e,t){this._customHeadersStore.set(e,t)},setCustomResumeData:function(e,t){this._customResumeDataStore.set(t,e)},setDeleteFileCustomHeaders:function(e,t){this._deleteFileCustomHeadersStore.set(e,t)},setDeleteFileEndpoint:function(e,t){this._deleteFileEndpointStore.set(e,t)},setDeleteFileParams:function(e,t){this._deleteFileParamsStore.set(e,t)},setEndpoint:function(e,t){this._endpointStore.set(e,t)},setForm:function(e){this._updateFormSupportAndParams(e)},setItemLimit:function(e){this._currentItemLimit=e},setName:function(e,t){this._uploadData.updateName(e,t)},setParams:function(e,t){this._paramsStore.set(e,t)},setUuid:function(e,t){return this._uploadData.uuidChanged(e,t)},setStatus:function(e,t){var n=this.getUploads({id:e});if(!n)throw new qq.Error(e+" is not a valid file ID.");switch(t){case qq.status.DELETED:this._onDeleteComplete(e,null,!1);break;case qq.status.DELETE_FAILED:this._onDeleteComplete(e,null,!0);break;default:var r="Method setStatus called on '"+name+"' not implemented yet for "+t;throw this.log(r),new qq.Error(r)}},uploadStoredFiles:function(){this._storedIds.length===0?this._itemError("noFilesError"):this._uploadStoredFiles()}},qq.basePrivateApi={_addCannedFile:function(e){var t=this;return this._uploadData.addFile({uuid:e.uuid,name:e.name,size:e.size,status:qq.status.UPLOAD_SUCCESSFUL,onBeforeStatusChange:function(n){e.deleteFileEndpoint&&t.setDeleteFileEndpoint(e.deleteFileEndpoint,n),e.deleteFileParams&&t.setDeleteFileParams(e.deleteFileParams,n),e.thumbnailUrl&&(t._thumbnailUrls[n]=e.thumbnailUrl),t._netUploaded++,t._netUploadedOrQueued++}})},_annotateWithButtonId:function(e,t){qq.isFile(e)&&(e.qqButtonId=this._getButtonId(t))},_batchError:function(e){this._options.callbacks.onError(null,null,e,void 0)},_createDeleteHandler:function(){var e=this;return new qq.DeleteFileAjaxRequester({method:this._options.deleteFile.method.toUpperCase(),maxConnections:this._options.maxConnections,uuidParamName:this._options.request.uuidName,customHeaders:this._deleteFileCustomHeadersStore,paramsStore:this._deleteFileParamsStore,endpointStore:this._deleteFileEndpointStore,cors:this._options.cors,log:qq.bind(e.log,e),onDelete:function(t){e._onDelete(t),e._options.callbacks.onDelete(t)},onDeleteComplete:function(t,n,r){e._onDeleteComplete(t,n,r),e._options.callbacks.onDeleteComplete(t,n,r)}})},_createPasteHandler:function(){var e=this;return new qq.PasteSupport({targetElement:this._options.paste.targetElement,callbacks:{log:qq.bind(e.log,e),pasteReceived:function(t){e._handleCheckedCallback({name:"onPasteReceived",callback:qq.bind(e._options.callbacks.onPasteReceived,e,t),onSuccess:qq.bind(e._handlePasteSuccess,e,t),identifier:"pasted image"})}}})},_createStore:function(e,t){var n={},r=e,s={},i=t,l=function(d){return qq.isObject(d)?qq.extend({},d):d},a=function(){return qq.isFunction(i)?i():i},c=function(d,p){i&&qq.isObject(p)&&qq.extend(p,a()),s[d]&&qq.extend(p,s[d])};return{set:function(d,p){p==null?(n={},r=l(d)):n[p]=l(d)},get:function(d){var p;return d!=null&&n[d]?p=n[d]:p=l(r),c(d,p),l(p)},addReadOnly:function(d,p){qq.isObject(n)&&(d===null?qq.isFunction(p)?i=p:(i=i||{},qq.extend(i,p)):(s[d]=s[d]||{},qq.extend(s[d],p)))},remove:function(d){return delete n[d]},reset:function(){n={},s={},r=e}}},_createUploadDataTracker:function(){var e=this;return new qq.UploadData({getName:function(t){return e.getName(t)},getUuid:function(t){return e.getUuid(t)},getSize:function(t){return e.getSize(t)},onStatusChange:function(t,n,r){e._onUploadStatusChange(t,n,r),e._options.callbacks.onStatusChange(t,n,r),e._maybeAllComplete(t,r),e._totalProgress&&setTimeout(function(){e._totalProgress.onStatusChange(t,n,r)},0)}})},_createUploadButton:function(e){var t=this,n=e.accept||this._options.validation.acceptFiles,r=e.allowedExtensions||this._options.validation.allowedExtensions,s;function i(){return qq.supportedFeatures.ajaxUploading?t._options.workarounds.iosEmptyVideos&&qq.ios()&&!qq.ios6()&&t._isAllowedExtension(r,".mov")?!1:e.multiple===void 0?t._options.multiple:e.multiple:!1}return s=new qq.UploadButton({acceptFiles:n,element:e.element,focusClass:this._options.classes.buttonFocus,folders:e.folders,hoverClass:this._options.classes.buttonHover,ios8BrowserCrashWorkaround:this._options.workarounds.ios8BrowserCrash,multiple:i(),name:this._options.request.inputName,onChange:function(l){t._onInputChange(l)},title:e.title==null?this._options.text.fileInputTitle:e.title}),this._disposeSupport.addDisposer(function(){s.dispose()}),t._buttons.push(s),s},_createUploadHandler:function(e,t){var n=this,r={},s={debug:this._options.debug,maxConnections:this._options.maxConnections,cors:this._options.cors,paramsStore:this._paramsStore,endpointStore:this._endpointStore,chunking:this._options.chunking,resume:this._options.resume,blobs:this._options.blobs,log:qq.bind(n.log,n),preventRetryParam:this._options.retry.preventRetryResponseProperty,onProgress:function(i,l,a,c){a<0||c<0||(r[i]?(r[i].loaded!==a||r[i].total!==c)&&(n._onProgress(i,l,a,c),n._options.callbacks.onProgress(i,l,a,c)):(n._onProgress(i,l,a,c),n._options.callbacks.onProgress(i,l,a,c)),r[i]={loaded:a,total:c})},onComplete:function(i,l,a,c){delete r[i];var d=n.getUploads({id:i}).status,p;d===qq.status.UPLOAD_SUCCESSFUL||d===qq.status.UPLOAD_FAILED||(p=n._onComplete(i,l,a,c),p instanceof qq.Promise?p.done(function(){n._options.callbacks.onComplete(i,l,a,c)}):n._options.callbacks.onComplete(i,l,a,c))},onCancel:function(i,l,a){var c=new qq.Promise;return n._handleCheckedCallback({name:"onCancel",callback:qq.bind(n._options.callbacks.onCancel,n,i,l),onFailure:c.failure,onSuccess:function(){a.then(function(){n._onCancel(i,l)}),c.success()},identifier:i}),c},onUploadPrep:qq.bind(this._onUploadPrep,this),onUpload:function(i,l){n._onUpload(i,l);var a=n._options.callbacks.onUpload(i,l);return qq.isGenericPromise(a)?(n.log(qq.format("onUpload for {} returned a Promise - waiting for resolution.",i)),a):new qq.Promise().success()},onUploadChunk:function(i,l,a){n._onUploadChunk(i,a);var c=n._options.callbacks.onUploadChunk(i,l,a);return qq.isGenericPromise(c)?(n.log(qq.format("onUploadChunk for {}.{} returned a Promise - waiting for resolution.",i,a.partIndex)),c):new qq.Promise().success()},onUploadChunkSuccess:function(i,l,a,c){n._onUploadChunkSuccess(i,l),n._options.callbacks.onUploadChunkSuccess.apply(n,arguments)},onResume:function(i,l,a,c){return n._options.callbacks.onResume(i,l,a,c)},onAutoRetry:function(i,l,a,c){return n._onAutoRetry.apply(n,arguments)},onUuidChanged:function(i,l){n.log("Server requested UUID change from '"+n.getUuid(i)+"' to '"+l+"'"),n.setUuid(i,l)},getName:qq.bind(n.getName,n),getUuid:qq.bind(n.getUuid,n),getSize:qq.bind(n.getSize,n),setSize:qq.bind(n._setSize,n),getDataByUuid:function(i){return n.getUploads({uuid:i})},isQueued:function(i){var l=n.getUploads({id:i}).status;return l===qq.status.QUEUED||l===qq.status.SUBMITTED||l===qq.status.UPLOAD_RETRYING||l===qq.status.PAUSED},getIdsInProxyGroup:n._uploadData.getIdsInProxyGroup,getIdsInBatch:n._uploadData.getIdsInBatch,isInProgress:function(i){return n.getUploads({id:i}).status===qq.status.UPLOADING},getCustomResumeData:qq.bind(n._getCustomResumeData,n),setStatus:function(i,l){n._uploadData.setStatus(i,l)}};return qq.each(this._options.request,function(i,l){s[i]=l}),s.customHeaders=this._customHeadersStore,e&&qq.each(e,function(i,l){s[i]=l}),new qq.UploadHandlerController(s,t)},_fileOrBlobRejected:function(e){this._netUploadedOrQueued--,this._uploadData.setStatus(e,qq.status.REJECTED)},_formatSize:function(e){if(e===0)return e+this._options.text.sizeSymbols[0];var t=-1;do e=e/1e3,t++;while(e>999);return Math.max(e,.1).toFixed(1)+this._options.text.sizeSymbols[t]},_generateExtraButtonSpecs:function(){var e=this;this._extraButtonSpecs={},qq.each(this._options.extraButtons,function(t,n){var r=n.multiple,s=qq.extend({},e._options.validation,!0),i=qq.extend({},n);r===void 0&&(r=e._options.multiple),i.validation&&qq.extend(s,n.validation,!0),qq.extend(i,{multiple:r,validation:s},!0),e._initExtraButton(i)})},_getButton:function(e){var t=this._extraButtonSpecs[e];if(t)return t.element;if(e===this._defaultButtonId)return this._options.button},_getButtonId:function(e){var t,n,r=e;if(r instanceof qq.BlobProxy&&(r=r.referenceBlob),r&&!qq.isBlob(r)){if(qq.isFile(r))return r.qqButtonId;if(r.tagName.toLowerCase()==="input"&&r.type.toLowerCase()==="file")return r.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME);if(t=r.getElementsByTagName("input"),qq.each(t,function(s,i){if(i.getAttribute("type")==="file")return n=i,!1}),n)return n.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME)}},_getCustomResumeData:function(e){return this._customResumeDataStore.get(e)},_getNotFinished:function(){return this._uploadData.retrieve({status:[qq.status.UPLOADING,qq.status.UPLOAD_RETRYING,qq.status.QUEUED,qq.status.SUBMITTING,qq.status.SUBMITTED,qq.status.PAUSED]}).length},_getValidationBase:function(e){var t=this._extraButtonSpecs[e];return t?t.validation:this._options.validation},_getValidationDescriptor:function(e){return e.file instanceof qq.BlobProxy?{name:qq.getFilename(e.file.referenceBlob),size:e.file.referenceBlob.size}:{name:this.getUploads({id:e.id}).name,size:this.getUploads({id:e.id}).size}},_getValidationDescriptors:function(e){var t=this,n=[];return qq.each(e,function(r,s){n.push(t._getValidationDescriptor(s))}),n},_handleCameraAccess:function(){if(this._options.camera.ios&&qq.ios()){var e="image/*;capture=camera",t=this._options.camera.button,n=t?this._getButtonId(t):this._defaultButtonId,r=this._options;n&&n!==this._defaultButtonId&&(r=this._extraButtonSpecs[n]),r.multiple=!1,r.validation.acceptFiles===null?r.validation.acceptFiles=e:r.validation.acceptFiles+=","+e,qq.each(this._buttons,function(s,i){if(i.getButtonId()===n)return i.setMultiple(r.multiple),i.setAcceptFiles(r.acceptFiles),!1})}},_handleCheckedCallback:function(e){var t=this,n=e.callback();return qq.isGenericPromise(n)?(this.log(e.name+" - waiting for "+e.name+" promise to be fulfilled for "+e.identifier),n.then(function(r){t.log(e.name+" promise success for "+e.identifier),e.onSuccess(r)},function(){e.onFailure?(t.log(e.name+" promise failure for "+e.identifier),e.onFailure()):t.log(e.name+" promise failure for "+e.identifier)})):(n!==!1?e.onSuccess(n):e.onFailure?(this.log(e.name+" - return value was 'false' for "+e.identifier+".  Invoking failure callback."),e.onFailure()):this.log(e.name+" - return value was 'false' for "+e.identifier+".  Will not proceed."),n)},_handleNewFile:function(e,t,n){var r=this,s=qq.getUniqueId(),i=-1,l=qq.getFilename(e),a=e.blob||e,c=this._customNewFileHandler?this._customNewFileHandler:qq.bind(r._handleNewFileGeneric,r);!qq.isInput(a)&&a.size>=0&&(i=a.size),c(a,l,s,i,n,t,this._options.request.uuidName,{uploadData:r._uploadData,paramsStore:r._paramsStore,addFileToHandler:function(d,p){r._handler.add(d,p),r._netUploadedOrQueued++,r._trackButton(d)}})},_handleNewFileGeneric:function(e,t,n,r,s,i){var l=this._uploadData.addFile({uuid:n,name:t,size:r,batchId:i,file:e});this._handler.add(l,e),this._trackButton(l),this._netUploadedOrQueued++,s.push({id:l,file:e})},_handlePasteSuccess:function(e,t){var n=e.type.split("/")[1],r=t;r==null&&(r=this._options.paste.defaultName),r+="."+n,this.addFiles({name:r,blob:e})},_handleDeleteSuccess:function(e){if(this.getUploads({id:e}).status!==qq.status.DELETED){var t=this.getName(e);this._netUploadedOrQueued--,this._netUploaded--,this._handler.expunge(e),this._uploadData.setStatus(e,qq.status.DELETED),this.log("Delete request for '"+t+"' has succeeded.")}},_handleDeleteFailed:function(e,t){var n=this.getName(e);this._uploadData.setStatus(e,qq.status.DELETE_FAILED),this.log("Delete request for '"+n+"' has failed.","error"),!t||t.withCredentials===void 0?this._options.callbacks.onError(e,n,"Delete request failed",t):this._options.callbacks.onError(e,n,"Delete request failed with response code "+t.status,t)},_initExtraButton:function(e){var t=this._createUploadButton({accept:e.validation.acceptFiles,allowedExtensions:e.validation.allowedExtensions,element:e.element,folders:e.folders,multiple:e.multiple,title:e.fileInputTitle});this._extraButtonSpecs[t.getButtonId()]=e},_initFormSupportAndParams:function(){this._formSupport=qq.FormSupport&&new qq.FormSupport(this._options.form,qq.bind(this.uploadStoredFiles,this),qq.bind(this.log,this)),this._formSupport&&this._formSupport.attachedToForm?(this._paramsStore=this._createStore(this._options.request.params,this._formSupport.getFormInputsAsObject),this._options.autoUpload=this._formSupport.newAutoUpload,this._formSupport.newEndpoint&&(this._options.request.endpoint=this._formSupport.newEndpoint)):this._paramsStore=this._createStore(this._options.request.params)},_isDeletePossible:function(){return!qq.DeleteFileAjaxRequester||!this._options.deleteFile.enabled?!1:this._options.cors.expected?!!(qq.supportedFeatures.deleteFileCorsXhr||qq.supportedFeatures.deleteFileCorsXdr&&this._options.cors.allowXdr):!0},_isAllowedExtension:function(e,t){var n=!1;return e.length?(qq.each(e,function(r,s){if(qq.isString(s)){var i=new RegExp("\\."+s+"$","i");if(t.match(i)!=null)return n=!0,!1}}),n):!0},_itemError:function(e,t,n){var r=this._options.messages[e],s=[],i=[].concat(t),l=i[0],a=this._getButtonId(n),c=this._getValidationBase(a),d,p;function S(q,o){r=r.replace(q,o)}return qq.each(c.allowedExtensions,function(q,o){qq.isString(o)&&s.push(o)}),d=s.join(", ").toLowerCase(),S("{file}",this._options.formatFileName(l)),S("{extensions}",d),S("{sizeLimit}",this._formatSize(c.sizeLimit)),S("{minSizeLimit}",this._formatSize(c.minSizeLimit)),p=r.match(/(\{\w+\})/g),p!==null&&qq.each(p,function(q,o){S(o,i[q])}),this._options.callbacks.onError(null,l,r,void 0),r},_manualRetry:function(e,t){if(this._onBeforeManualRetry(e))return this._netUploadedOrQueued++,this._uploadData.setStatus(e,qq.status.UPLOAD_RETRYING),t?t(e):this._handler.retry(e),!0},_maybeAllComplete:function(e,t){var n=this,r=this._getNotFinished();t===qq.status.UPLOAD_SUCCESSFUL?this._succeededSinceLastAllComplete.push(e):t===qq.status.UPLOAD_FAILED&&this._failedSinceLastAllComplete.push(e),r===0&&(this._succeededSinceLastAllComplete.length||this._failedSinceLastAllComplete.length)&&setTimeout(function(){n._onAllComplete(n._succeededSinceLastAllComplete,n._failedSinceLastAllComplete)},0)},_maybeHandleIos8SafariWorkaround:function(){var e=this;if(this._options.workarounds.ios8SafariUploads&&qq.ios800()&&qq.iosSafari())throw setTimeout(function(){window.alert(e._options.messages.unsupportedBrowserIos8Safari)},0),new qq.Error(this._options.messages.unsupportedBrowserIos8Safari)},_maybeParseAndSendUploadError:function(e,t,n,r){if(!n.success)if(r&&r.status!==200&&!n.error)this._options.callbacks.onError(e,t,"XHR returned response code "+r.status,r);else{var s=n.error?n.error:this._options.text.defaultResponseError;this._options.callbacks.onError(e,t,s,r)}},_maybeProcessNextItemAfterOnValidateCallback:function(e,t,n,r,s){var i=this;if(t.length>n){if(e||!this._options.validation.stopOnFirstInvalidFile)setTimeout(function(){var l=i._getValidationDescriptor(t[n]),a=i._getButtonId(t[n].file),c=i._getButton(a);i._handleCheckedCallback({name:"onValidate",callback:qq.bind(i._options.callbacks.onValidate,i,l,c),onSuccess:qq.bind(i._onValidateCallbackSuccess,i,t,n,r,s),onFailure:qq.bind(i._onValidateCallbackFailure,i,t,n,r,s),identifier:"Item '"+l.name+"', size: "+l.size})},0);else if(!e)for(;n<t.length;n++)i._fileOrBlobRejected(t[n].id)}},_onAllComplete:function(e,t){this._totalProgress&&this._totalProgress.onAllComplete(e,t,this._preventRetries),this._options.callbacks.onAllComplete(qq.extend([],e),qq.extend([],t)),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[]},_onAutoRetry:function(e,t,n,r,s){var i=this;if(i._preventRetries[e]=n[i._options.retry.preventRetryResponseProperty],i._shouldAutoRetry(e)){var l=i._options.retry.autoAttemptDelay*1e3;return i._maybeParseAndSendUploadError.apply(i,arguments),i._options.callbacks.onAutoRetry(e,t,i._autoRetries[e]),i._onBeforeAutoRetry(e,t),i._uploadData.setStatus(e,qq.status.UPLOAD_RETRYING),i._retryTimeouts[e]=setTimeout(function(){i.log("Starting retry for "+t+"..."),s?s(e):i._handler.retry(e)},l),!0}},_onBeforeAutoRetry:function(e,t){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+t+"...")},_onBeforeManualRetry:function(e){var t=this._currentItemLimit,n;return this._preventRetries[e]?(this.log("Retries are forbidden for id "+e,"warn"),!1):this._handler.isValid(e)?(n=this.getName(e),this._options.callbacks.onManualRetry(e,n)===!1?!1:t>0&&this._netUploadedOrQueued+1>t?(this._itemError("retryFailTooManyItems"),!1):(this.log("Retrying upload for '"+n+"' (id: "+e+")..."),!0)):(this.log("'"+e+"' is not a valid file ID","error"),!1)},_onCancel:function(e,t){this._netUploadedOrQueued--,clearTimeout(this._retryTimeouts[e]);var n=qq.indexOf(this._storedIds,e);!this._options.autoUpload&&n>=0&&this._storedIds.splice(n,1),this._uploadData.setStatus(e,qq.status.CANCELED)},_onComplete:function(e,t,n,r){return n.success?(n.thumbnailUrl&&(this._thumbnailUrls[e]=n.thumbnailUrl),this._netUploaded++,this._uploadData.setStatus(e,qq.status.UPLOAD_SUCCESSFUL)):(this._netUploadedOrQueued--,this._uploadData.setStatus(e,qq.status.UPLOAD_FAILED),n[this._options.retry.preventRetryResponseProperty]===!0&&(this._preventRetries[e]=!0)),this._maybeParseAndSendUploadError(e,t,n,r),!!n.success},_onDelete:function(e){this._uploadData.setStatus(e,qq.status.DELETING)},_onDeleteComplete:function(e,t,n){this.getName(e),n?this._handleDeleteFailed(e,t):this._handleDeleteSuccess(e)},_onInputChange:function(e){var t;if(qq.supportedFeatures.ajaxUploading){for(t=0;t<e.files.length;t++)this._annotateWithButtonId(e.files[t],e);this.addFiles(e.files)}else e.value.length>0&&this.addFiles(e);qq.each(this._buttons,function(n,r){r.reset()})},_onProgress:function(e,t,n,r){this._totalProgress&&this._totalProgress.onIndividualProgress(e,n,r)},_onSubmit:function(e,t){},_onSubmitCallbackSuccess:function(e,t){this._onSubmit.apply(this,arguments),this._uploadData.setStatus(e,qq.status.SUBMITTED),this._onSubmitted.apply(this,arguments),this._options.autoUpload?(this._options.callbacks.onSubmitted.apply(this,arguments),this._uploadFile(e)):(this._storeForLater(e),this._options.callbacks.onSubmitted.apply(this,arguments))},_onSubmitDelete:function(e,t,n){var r=this.getUuid(e),s;return t&&(s=qq.bind(t,this,e,r,n)),this._isDeletePossible()?(this._handleCheckedCallback({name:"onSubmitDelete",callback:qq.bind(this._options.callbacks.onSubmitDelete,this,e),onSuccess:s||qq.bind(this._deleteHandler.sendDelete,this,e,r,n),identifier:e}),!0):(this.log("Delete request ignored for ID "+e+", delete feature is disabled or request not possible due to CORS on a user agent that does not support pre-flighting.","warn"),!1)},_onSubmitted:function(e){},_onTotalProgress:function(e,t){this._options.callbacks.onTotalProgress(e,t)},_onUploadPrep:function(e){},_onUpload:function(e,t){this._uploadData.setStatus(e,qq.status.UPLOADING)},_onUploadChunk:function(e,t){},_onUploadChunkSuccess:function(e,t){!this._preventRetries[e]&&this._options.retry.enableAuto&&(this._autoRetries[e]=0)},_onUploadStatusChange:function(e,t,n){n===qq.status.PAUSED&&clearTimeout(this._retryTimeouts[e])},_onValidateBatchCallbackFailure:function(e){var t=this;qq.each(e,function(n,r){t._fileOrBlobRejected(r.id)})},_onValidateBatchCallbackSuccess:function(e,t,n,r,s){var i,l=this._currentItemLimit,a=this._netUploadedOrQueued;l===0||a<=l?t.length>0?this._handleCheckedCallback({name:"onValidate",callback:qq.bind(this._options.callbacks.onValidate,this,e[0],s),onSuccess:qq.bind(this._onValidateCallbackSuccess,this,t,0,n,r),onFailure:qq.bind(this._onValidateCallbackFailure,this,t,0,n,r),identifier:"Item '"+t[0].file.name+"', size: "+t[0].file.size}):this._itemError("noFilesError"):(this._onValidateBatchCallbackFailure(t),i=this._options.messages.tooManyItemsError.replace(/\{netItems\}/g,a).replace(/\{itemLimit\}/g,l),this._batchError(i))},_onValidateCallbackFailure:function(e,t,n,r){var s=t+1;this._fileOrBlobRejected(e[t].id,e[t].file.name),this._maybeProcessNextItemAfterOnValidateCallback(!1,e,s,n,r)},_onValidateCallbackSuccess:function(e,t,n,r){var s=this,i=t+1,l=this._getValidationDescriptor(e[t]);this._validateFileOrBlobData(e[t],l).then(function(){s._upload(e[t].id,n,r),s._maybeProcessNextItemAfterOnValidateCallback(!0,e,i,n,r)},function(){s._maybeProcessNextItemAfterOnValidateCallback(!1,e,i,n,r)})},_prepareItemsForUpload:function(e,t,n){if(e.length===0){this._itemError("noFilesError");return}var r=this._getValidationDescriptors(e),s=this._getButtonId(e[0].file),i=this._getButton(s);this._handleCheckedCallback({name:"onValidateBatch",callback:qq.bind(this._options.callbacks.onValidateBatch,this,r,i),onSuccess:qq.bind(this._onValidateBatchCallbackSuccess,this,r,e,t,n,i),onFailure:qq.bind(this._onValidateBatchCallbackFailure,this,e),identifier:"batch validation"})},_preventLeaveInProgress:function(){var e=this;this._disposeSupport.attach(window,"beforeunload",function(t){if(e.getInProgress())return t=t||window.event,t.returnValue=e._options.messages.onLeave,e._options.messages.onLeave})},_refreshSessionData:function(){var e=this,t=this._options.session;qq.Session&&this._options.session.endpoint!=null&&(this._session||(qq.extend(t,{cors:this._options.cors}),t.log=qq.bind(this.log,this),t.addFileRecord=qq.bind(this._addCannedFile,this),this._session=new qq.Session(t)),setTimeout(function(){e._session.refresh().then(function(n,r){e._sessionRequestComplete(),e._options.callbacks.onSessionRequestComplete(n,!0,r)},function(n,r){e._options.callbacks.onSessionRequestComplete(n,!1,r)})},0))},_sessionRequestComplete:function(){},_setSize:function(e,t){this._uploadData.updateSize(e,t),this._totalProgress&&this._totalProgress.onNewSize(e)},_shouldAutoRetry:function(e){var t=this._uploadData.retrieve({id:e});return!this._preventRetries[e]&&this._options.retry.enableAuto&&t.status!==qq.status.PAUSED&&(this._autoRetries[e]===void 0&&(this._autoRetries[e]=0),this._autoRetries[e]<this._options.retry.maxAutoAttempts)?(this._autoRetries[e]+=1,!0):!1},_storeForLater:function(e){this._storedIds.push(e)},_trackButton:function(e){var t;qq.supportedFeatures.ajaxUploading?t=this._handler.getFile(e).qqButtonId:t=this._getButtonId(this._handler.getInput(e)),t&&(this._buttonIdsForFileIds[e]=t)},_updateFormSupportAndParams:function(e){this._options.form.element=e,this._formSupport=qq.FormSupport&&new qq.FormSupport(this._options.form,qq.bind(this.uploadStoredFiles,this),qq.bind(this.log,this)),this._formSupport&&this._formSupport.attachedToForm&&(this._paramsStore.addReadOnly(null,this._formSupport.getFormInputsAsObject),this._options.autoUpload=this._formSupport.newAutoUpload,this._formSupport.newEndpoint&&this.setEndpoint(this._formSupport.newEndpoint))},_upload:function(e,t,n){var r=this.getName(e);t&&this.setParams(t,e),n&&this.setEndpoint(n,e),this._handleCheckedCallback({name:"onSubmit",callback:qq.bind(this._options.callbacks.onSubmit,this,e,r),onSuccess:qq.bind(this._onSubmitCallbackSuccess,this,e,r),onFailure:qq.bind(this._fileOrBlobRejected,this,e,r),identifier:e})},_uploadFile:function(e){this._handler.upload(e)||this._uploadData.setStatus(e,qq.status.QUEUED)},_uploadStoredFiles:function(){for(var e,t,n=this;this._storedIds.length;)e=this._storedIds.shift(),this._uploadFile(e);t=this.getUploads({status:qq.status.SUBMITTING}).length,t&&(qq.log("Still waiting for "+t+" files to clear submit queue. Will re-parse stored IDs array shortly."),setTimeout(function(){n._uploadStoredFiles()},1e3))},_validateFileOrBlobData:function(e,t){var n=this,r=function(){return e.file instanceof qq.BlobProxy?e.file.referenceBlob:e.file}(),s=t.name,i=t.size,l=this._getButtonId(e.file),a=this._getValidationBase(l),c=new qq.Promise;return c.then(function(){},function(){n._fileOrBlobRejected(e.id,s)}),qq.isFileOrInput(r)&&!this._isAllowedExtension(a.allowedExtensions,s)?(this._itemError("typeError",s,r),c.failure()):!this._options.validation.allowEmpty&&i===0?(this._itemError("emptyError",s,r),c.failure()):i>0&&a.sizeLimit&&i>a.sizeLimit?(this._itemError("sizeError",s,r),c.failure()):i>0&&i<a.minSizeLimit?(this._itemError("minSizeError",s,r),c.failure()):(qq.ImageValidation&&qq.supportedFeatures.imagePreviews&&qq.isFile(r)?new qq.ImageValidation(r,qq.bind(n.log,n)).validate(a.image).then(c.success,function(d){n._itemError(d+"ImageError",s,r),c.failure()}):c.success(),c)},_wrapCallbacks:function(){var e,t,n;e=this,t=function(r,s,i){var l;try{return s.apply(e,i)}catch(a){l=a.message||a.toString(),e.log("Caught exception in '"+r+"' callback - "+l,"error")}};for(n in this._options.callbacks)(function(){var r,s;r=n,s=e._options.callbacks[r],e._options.callbacks[r]=function(){return t(r,s,arguments)}})()}}}(),function(){qq.FineUploaderBasic=function(e){var t=this;this._options={debug:!1,button:null,multiple:!0,maxConnections:3,disableCancelForFormUploads:!1,autoUpload:!0,warnBeforeUnload:!0,request:{customHeaders:{},endpoint:"/server/upload",filenameParam:"qqfilename",forceMultipart:!0,inputName:"qqfile",method:"POST",omitDefaultParams:!1,params:{},paramsInBody:!0,requireSuccessJson:!0,totalFileSizeName:"qqtotalfilesize",uuidName:"qquuid"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,itemLimit:0,stopOnFirstInvalidFile:!0,acceptFiles:null,image:{maxHeight:0,maxWidth:0,minHeight:0,minWidth:0},allowEmpty:!1},callbacks:{onSubmit:function(n,r){},onSubmitted:function(n,r){},onComplete:function(n,r,s,i){},onAllComplete:function(n,r){},onCancel:function(n,r){},onUpload:function(n,r){},onUploadChunk:function(n,r,s){},onUploadChunkSuccess:function(n,r,s,i){},onResume:function(n,r,s,i){},onProgress:function(n,r,s,i){},onTotalProgress:function(n,r){},onError:function(n,r,s,i){},onAutoRetry:function(n,r,s){},onManualRetry:function(n,r){},onValidateBatch:function(n){},onValidate:function(n){},onSubmitDelete:function(n){},onDelete:function(n){},onDeleteComplete:function(n,r,s){},onPasteReceived:function(n){},onStatusChange:function(n,r,s){},onSessionRequestComplete:function(n,r,s){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",tooManyItemsError:"Too many items ({netItems}) would be uploaded.  Item limit is {itemLimit}.",maxHeightImageError:"Image is too tall.",maxWidthImageError:"Image is too wide.",minHeightImageError:"Image is not tall enough.",minWidthImageError:"Image is not wide enough.",retryFailTooManyItems:"Retry failed - you have reached your file limit.",onLeave:"The files are being uploaded, if you leave now the upload will be canceled.",unsupportedBrowserIos8Safari:"Unrecoverable error - this browser does not permit file uploading of any kind due to serious bugs in iOS8 Safari.  Please use iOS8 Chrome until Apple fixes these issues."},retry:{enableAuto:!1,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"},classes:{buttonHover:"qq-upload-button-hover",buttonFocus:"qq-upload-button-focus"},chunking:{enabled:!1,concurrent:{enabled:!1},mandatory:!1,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalFileSize:"qqtotalfilesize",totalParts:"qqtotalparts"},partSize:function(n){return 2e6},success:{endpoint:null,headers:function(n){return null},jsonPayload:!1,method:"POST",params:function(n){return null},resetOnStatus:[]}},resume:{enabled:!1,recordsExpireIn:7,paramNames:{resuming:"qqresume"},customKeys:function(n){return[]}},formatFileName:function(n){return n},text:{defaultResponseError:"Upload failure reason unknown",fileInputTitle:"file input",sizeSymbols:["kB","MB","GB","TB","PB","EB"]},deleteFile:{enabled:!1,method:"DELETE",endpoint:"/server/upload",customHeaders:{},params:{}},cors:{expected:!1,sendCredentials:!1,allowXdr:!1},blobs:{defaultName:"misc_data"},paste:{targetElement:null,defaultName:"pasted_image"},camera:{ios:!1,button:null},extraButtons:[],session:{endpoint:null,params:{},customHeaders:{},refreshOnReset:!0},form:{element:"qq-form",autoUpload:!1,interceptSubmit:!0},scaling:{customResizer:null,sendOriginal:!0,orient:!0,defaultType:null,defaultQuality:80,failureText:"Failed to scale",includeExif:!1,sizes:[]},workarounds:{iosEmptyVideos:!0,ios8SafariUploads:!0,ios8BrowserCrash:!1}},qq.extend(this._options,e,!0),this._buttons=[],this._extraButtonSpecs={},this._buttonIdsForFileIds=[],this._wrapCallbacks(),this._disposeSupport=new qq.DisposeSupport,this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._thumbnailUrls=[],this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData=this._createUploadDataTracker(),this._initFormSupportAndParams(),this._customHeadersStore=this._createStore(this._options.request.customHeaders),this._deleteFileCustomHeadersStore=this._createStore(this._options.deleteFile.customHeaders),this._deleteFileParamsStore=this._createStore(this._options.deleteFile.params),this._endpointStore=this._createStore(this._options.request.endpoint),this._deleteFileEndpointStore=this._createStore(this._options.deleteFile.endpoint),this._handler=this._createUploadHandler(),this._deleteHandler=qq.DeleteFileAjaxRequester&&this._createDeleteHandler(),this._options.button&&(this._defaultButtonId=this._createUploadButton({element:this._options.button,title:this._options.text.fileInputTitle}).getButtonId()),this._generateExtraButtonSpecs(),this._handleCameraAccess(),this._options.paste.targetElement&&(qq.PasteSupport?this._pasteHandler=this._createPasteHandler():this.log("Paste support module not found","error")),this._options.warnBeforeUnload&&this._preventLeaveInProgress(),this._imageGenerator=qq.ImageGenerator&&new qq.ImageGenerator(qq.bind(this.log,this)),this._refreshSessionData(),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[],this._scaler=qq.Scaler&&new qq.Scaler(this._options.scaling,qq.bind(this.log,this))||{},this._scaler.enabled&&(this._customNewFileHandler=qq.bind(this._scaler.handleNewFile,this._scaler)),qq.TotalProgress&&qq.supportedFeatures.progressBar&&(this._totalProgress=new qq.TotalProgress(qq.bind(this._onTotalProgress,this),function(n){var r=t._uploadData.retrieve({id:n});return r&&r.size||0})),this._currentItemLimit=this._options.validation.itemLimit,this._customResumeDataStore=this._createStore()},qq.FineUploaderBasic.prototype=qq.basePublicApi,qq.extend(qq.FineUploaderBasic.prototype,qq.basePrivateApi)}(),qq.AjaxRequester=function(e){var t,n,r=[],s={},i={acceptHeader:null,validMethods:["PATCH","POST","PUT"],method:"POST",contentType:"application/x-www-form-urlencoded",maxConnections:3,customHeaders:{},endpointStore:{},paramsStore:{},mandatedParams:{},allowXRequestedWithAndCacheControl:!0,successfulResponseCodes:{DELETE:[200,202,204],PATCH:[200,201,202,203,204],POST:[200,201,202,203,204],PUT:[200,201,202,203,204],GET:[200]},cors:{expected:!1,sendCredentials:!1},log:function(b,x){},onSend:function(b){},onComplete:function(b,x,w){},onProgress:null};if(qq.extend(i,e),t=i.log,qq.indexOf(i.validMethods,i.method)<0)throw new Error("'"+i.method+"' is not a supported method for this type of request!");function l(){return qq.indexOf(["GET","POST","HEAD"],i.method)>=0}function a(b){var x=!1;return qq.each(x,function(w,E){if(qq.indexOf(["Accept","Accept-Language","Content-Language","Content-Type"],E)<0)return x=!0,!1}),x}function c(b){return i.cors.expected&&b.withCredentials===void 0}function d(){var b;return(window.XMLHttpRequest||window.ActiveXObject)&&(b=qq.createXhrInstance(),b.withCredentials===void 0&&(b=new XDomainRequest,b.onload=function(){},b.onerror=function(){},b.ontimeout=function(){},b.onprogress=function(){})),b}function p(b,x){var w=s[b]&&s[b].xhr;return w||(x?w=x:i.cors.expected?w=d():w=qq.createXhrInstance(),s[b].xhr=w),w}function S(b){var x=qq.indexOf(r,b),w=i.maxConnections,E;delete s[b],r.splice(x,1),r.length>=w&&x<w&&(E=r[w-1],u(E))}function q(b,x){var w=p(b),E=i.method,F=x===!0;S(b),F?t(E+" request for "+b+" has failed","error"):!c(w)&&!y(w.status)&&(F=!0,t(E+" request for "+b+" has failed - response code "+w.status,"error")),i.onComplete(b,w,F)}function o(b){var x=s[b].additionalParams,w=i.mandatedParams,E;return i.paramsStore.get&&(E=i.paramsStore.get(b)),x&&qq.each(x,function(F,P){E=E||{},E[F]=P}),w&&qq.each(w,function(F,P){E=E||{},E[F]=P}),E}function u(b,x){var w=p(b,x),E=i.method,F=o(b),P=s[b].payload,R;return i.onSend(b),R=h(b,F,s[b].additionalQueryParams),c(w)?(w.onload=v(b),w.onerror=f(b)):w.onreadystatechange=_(b),m(b),w.open(E,R,!0),i.cors.expected&&i.cors.sendCredentials&&!c(w)&&(w.withCredentials=!0),g(b),t("Sending "+E+" request for "+b),P?w.send(P):n||!F?w.send():F&&i.contentType&&i.contentType.toLowerCase().indexOf("application/x-www-form-urlencoded")>=0?w.send(qq.obj2url(F,"")):F&&i.contentType&&i.contentType.toLowerCase().indexOf("application/json")>=0?w.send(JSON.stringify(F)):w.send(F),w}function h(b,x,w){var E=i.endpointStore.get(b),F=s[b].addToPath;return F!=null&&(E+="/"+F),n&&x&&(E=qq.obj2url(x,E)),w&&(E=qq.obj2url(w,E)),E}function _(b){return function(){p(b).readyState===4&&q(b)}}function m(b){var x=i.onProgress;x&&(p(b).upload.onprogress=function(w){w.lengthComputable&&x(b,w.loaded,w.total)})}function v(b){return function(){q(b)}}function f(b){return function(){q(b,!0)}}function g(b){var x=p(b),w=i.customHeaders,E=s[b].additionalHeaders||{},F=i.method,P={};c(x)||(i.acceptHeader&&x.setRequestHeader("Accept",i.acceptHeader),i.allowXRequestedWithAndCacheControl&&(!i.cors.expected||!l()||a())&&(x.setRequestHeader("X-Requested-With","XMLHttpRequest"),x.setRequestHeader("Cache-Control","no-cache")),i.contentType&&(F==="POST"||F==="PUT")&&x.setRequestHeader("Content-Type",i.contentType),qq.extend(P,qq.isFunction(w)?w(b):w),qq.extend(P,E),qq.each(P,function(R,I){x.setRequestHeader(R,I)}))}function y(b){return qq.indexOf(i.successfulResponseCodes[i.method],b)>=0}function C(b,x,w,E,F,P,R){s[b]={addToPath:w,additionalParams:E,additionalQueryParams:F,additionalHeaders:P,payload:R};var I=r.push(b);if(I<=i.maxConnections)return u(b,x)}n=i.method==="GET"||i.method==="DELETE",qq.extend(this,{initTransport:function(b){var x,w,E,F,P,R;return{withPath:function(I){return x=I,this},withParams:function(I){return w=I,this},withQueryParams:function(I){return R=I,this},withHeaders:function(I){return E=I,this},withPayload:function(I){return F=I,this},withCacheBuster:function(){return P=!0,this},send:function(I){return P&&qq.indexOf(["GET","DELETE"],i.method)>=0&&(w.qqtimestamp=new Date().getTime()),C(b,I,x,w,R,E,F)}}},canceled:function(b){S(b)}})},qq.UploadHandler=function(e){var t=e.proxy,n={},r=t.onCancel,s=t.getName;qq.extend(this,{add:function(i,l){n[i]=l,n[i].temp={}},cancel:function(i){var l=this,a=new qq.Promise,c=r(i,s(i),a);c.then(function(){l.isValid(i)&&(n[i].canceled=!0,l.expunge(i)),a.success()})},expunge:function(i){delete n[i]},getThirdPartyFileId:function(i){return n[i].key},isValid:function(i){return n[i]!==void 0},reset:function(){n={}},_getFileState:function(i){return n[i]},_setThirdPartyFileId:function(i,l){n[i].key=l},_wasCanceled:function(i){return!!n[i].canceled}})},qq.UploadHandlerController=function(e,t){var n=this,r=!1,s=!1,i,l,a,c={paramsStore:{},maxConnections:3,chunking:{enabled:!1,multiple:{enabled:!1}},log:function(o,u){},onProgress:function(o,u,h,_){},onComplete:function(o,u,h,_){},onCancel:function(o,u){},onUploadPrep:function(o){},onUpload:function(o,u){},onUploadChunk:function(o,u,h){},onUploadChunkSuccess:function(o,u,h,_){},onAutoRetry:function(o,u,h,_){},onResume:function(o,u,h,_){},onUuidChanged:function(o,u){},getName:function(o){},setSize:function(o,u){},isQueued:function(o){},getIdsInProxyGroup:function(o){},getIdsInBatch:function(o){},isInProgress:function(o){}},d={done:function(o,u,h,_){var m=a._getChunkData(o,u);a._getFileState(o).attemptingResume=!1,delete a._getFileState(o).temp.chunkProgress[u],a._getFileState(o).loaded+=m.size,c.onUploadChunkSuccess(o,a._getChunkDataForCallback(m),h,_)},finalize:function(o){var u=c.getSize(o),h=c.getName(o);l("All chunks have been uploaded for "+o+" - finalizing...."),a.finalizeChunks(o).then(function(_,m){l("Finalize successful for "+o);var v=q.normalizeResponse(_,!0);c.onProgress(o,h,u,u),a._maybeDeletePersistedChunkData(o),q.cleanup(o,v,m)},function(_,m){var v=q.normalizeResponse(_,!1);l("Problem finalizing chunks for file ID "+o+" - "+v.error,"error"),(v.reset||m&&c.chunking.success.resetOnStatus.indexOf(m.status)>=0)&&d.reset(o),c.onAutoRetry(o,h,v,m)||q.cleanup(o,v,m)})},handleFailure:function(o,u,h,_){var m=c.getName(u);l("Chunked upload request failed for "+u+", chunk "+o),a.clearCachedChunk(u,o);var v=q.normalizeResponse(h,!1),f;if(v.reset)d.reset(u);else{var g=a._getFileState(u).chunking.inProgress;f=g?qq.indexOf(g,o):-1,f>=0&&(a._getFileState(u).chunking.inProgress.splice(f,1),a._getFileState(u).chunking.remaining.unshift(o))}a._getFileState(u).temp.ignoreFailure||(s&&(a._getFileState(u).temp.ignoreFailure=!0,l(qq.format("Going to attempt to abort these chunks: {}. These are currently in-progress: {}.",JSON.stringify(Object.keys(a._getXhrs(u))),JSON.stringify(a._getFileState(u).chunking.inProgress))),qq.each(a._getXhrs(u),function(y,C){l(qq.format("Attempting to abort file {}.{}. XHR readyState {}. ",u,y,C.readyState)),C.abort(),C._cancelled=!0}),a.moveInProgressToRemaining(u),p.free(u,!0)),c.onAutoRetry(u,m,v,_)||q.cleanup(u,v,_))},hasMoreParts:function(o){return!!a._getFileState(o).chunking.remaining.length},nextPart:function(o){var u=a._getFileState(o).chunking.remaining.shift();return u>=a._getTotalChunks(o)&&(u=null),u},reset:function(o){l("Server or callback has ordered chunking effort to be restarted on next attempt for item ID "+o,"error"),a._maybeDeletePersistedChunkData(o),a.reevaluateChunking(o),a._getFileState(o).loaded=0,a._getFileState(o).attemptingResume=!1},sendNext:function(o){var u=c.getSize(o),h=c.getName(o),_=d.nextPart(o),m=a._getChunkData(o,_),v=a._getFileState(o),f=v.attemptingResume,g=v.chunking.inProgress||[];if(v.loaded==null&&(v.loaded=0),f&&c.onResume(o,h,m,v.customResumeData)===!1&&(d.reset(o),_=d.nextPart(o),m=a._getChunkData(o,_),f=!1),_==null&&g.length===0)d.finalize(o);else{g.push(_),a._getFileState(o).chunking.inProgress=g,s&&p.open(o,_),s&&p.available()&&a._getFileState(o).chunking.remaining.length&&d.sendNext(o),m.blob.size===0&&(l(qq.format("Chunk {} for file {} will not be uploaded, zero sized chunk.",_,o),"error"),d.handleFailure(_,o,"File is no longer available",null));var y=c.onUploadChunk(o,h,a._getChunkDataForCallback(m));y.then(function(C){if(!c.isInProgress(o))l(qq.format("Not sending chunked upload request for item {}.{} - no longer in progress.",o,_));else{l(qq.format("Sending chunked upload request for item {}.{}, bytes {}-{} of {}.",o,_,m.start+1,m.end,u));var b={chunkIdx:_,id:o,overrides:C,resuming:f};a.uploadChunk(b).then(function(w,E){l("Chunked upload request succeeded for "+o+", chunk "+_),a.clearCachedChunk(o,_);var F=a._getFileState(o).chunking.inProgress||[],P=q.normalizeResponse(w,!0),R=qq.indexOf(F,_);l(qq.format("Chunk {} for file {} uploaded successfully.",_,o)),d.done(o,_,P,E),R>=0&&F.splice(R,1),a._maybePersistChunkedState(o),!d.hasMoreParts(o)&&F.length===0?d.finalize(o):d.hasMoreParts(o)?d.sendNext(o):l(qq.format("File ID {} has no more chunks to send and these chunk indexes are still marked as in-progress: {}",o,JSON.stringify(F)))},function(w,E){d.handleFailure(_,o,w,E)}).done(function(){a.clearXhr(o,_)})}},function(C){d.handleFailure(_,o,C,null)})}}},p={_open:[],_openChunks:{},_waiting:[],available:function(){var o=c.maxConnections,u=0,h=0;return qq.each(p._openChunks,function(_,m){u++,h+=m.length}),o-(p._open.length-u+h)},free:function(o,u){var h=!u,_=qq.indexOf(p._waiting,o),m=qq.indexOf(p._open,o),v;delete p._openChunks[o],q.getProxyOrBlob(o)instanceof qq.BlobProxy&&(l("Generated blob upload has ended for "+o+", disposing generated blob."),delete a._getFileState(o).file),_>=0?p._waiting.splice(_,1):h&&m>=0&&(p._open.splice(m,1),v=p._waiting.shift(),v>=0&&(p._open.push(v),q.start(v)))},getWaitingOrConnected:function(){var o=[];return qq.each(p._openChunks,function(u,h){h&&h.length&&o.push(parseInt(u))}),qq.each(p._open,function(u,h){p._openChunks[h]||o.push(parseInt(h))}),o=o.concat(p._waiting),o},isUsingConnection:function(o){return qq.indexOf(p._open,o)>=0},open:function(o,u){return u==null&&p._waiting.push(o),p.available()?(u==null?(p._waiting.pop(),p._open.push(o)):function(){var h=p._openChunks[o]||[];h.push(u),p._openChunks[o]=h}(),!0):!1},reset:function(){p._waiting=[],p._open=[]}},S={send:function(o,u){var h=a._getFileState(o);if(!h){l("Ignoring send request as this upload may have been cancelled, File ID "+o,"warn");return}h.loaded=0,l("Sending simple upload request for "+o),a.uploadFile(o).then(function(_,m){l("Simple upload request succeeded for "+o);var v=q.normalizeResponse(_,!0),f=c.getSize(o);c.onProgress(o,u,f,f),q.maybeNewUuid(o,v),q.cleanup(o,v,m)},function(_,m){l("Simple upload request failed for "+o);var v=q.normalizeResponse(_,!1);c.onAutoRetry(o,u,v,m)||q.cleanup(o,v,m)})}},q={cancel:function(o){l("Cancelling "+o),c.paramsStore.remove(o),p.free(o)},cleanup:function(o,u,h){var _=c.getName(o);c.onComplete(o,_,u,h),a._getFileState(o)&&a._clearXhrs&&a._clearXhrs(o),p.free(o)},getProxyOrBlob:function(o){return a.getProxy&&a.getProxy(o)||a.getFile&&a.getFile(o)},initHandler:function(){var o=t?qq[t]:qq.traditional,u=qq.supportedFeatures.ajaxUploading?"Xhr":"Form";a=new o[u+"UploadHandler"](c,{getCustomResumeData:c.getCustomResumeData,getDataByUuid:c.getDataByUuid,getName:c.getName,getSize:c.getSize,getUuid:c.getUuid,log:l,onCancel:c.onCancel,onProgress:c.onProgress,onUuidChanged:c.onUuidChanged,onFinalizing:function(h){c.setStatus(h,qq.status.UPLOAD_FINALIZING)}}),a._removeExpiredChunkingRecords&&a._removeExpiredChunkingRecords()},isDeferredEligibleForUpload:function(o){return c.isQueued(o)},maybeDefer:function(o,u){if(u&&!a.getFile(o)&&u instanceof qq.BlobProxy)c.onUploadPrep(o),l("Attempting to generate a blob on-demand for "+o),u.create().then(function(h){l("Generated an on-demand blob for "+o),a.updateBlob(o,h),c.setSize(o,h.size),a.reevaluateChunking(o),q.maybeSendDeferredFiles(o)},function(h){var _={};h&&(_.error=h),l(qq.format("Failed to generate blob for ID {}.  Error message: {}.",o,h),"error"),c.onComplete(o,c.getName(o),qq.extend(_,i),null),q.maybeSendDeferredFiles(o),p.free(o)});else return q.maybeSendDeferredFiles(o);return!1},maybeSendDeferredFiles:function(o){var u=c.getIdsInProxyGroup(o),h=!1;return u&&u.length?(l("Maybe ready to upload proxy group file "+o),qq.each(u,function(_,m){if(q.isDeferredEligibleForUpload(m)&&a.getFile(m))h=m===o,q.now(m);else if(q.isDeferredEligibleForUpload(m))return!1})):(h=!0,q.now(o)),h},maybeNewUuid:function(o,u){u.newUuid!==void 0&&c.onUuidChanged(o,u.newUuid)},normalizeResponse:function(o,u){var h=o;return qq.isObject(o)||(h={},qq.isString(o)&&!u&&(h.error=o)),h.success=u,h},now:function(o){var u=c.getName(o);if(!n.isValid(o))throw new qq.Error(o+" is not a valid file ID to upload!");c.onUpload(o,u).then(function(h){h&&h.pause?(c.setStatus(o,qq.status.PAUSED),a.pause(o),p.free(o)):r&&a._shouldChunkThisFile(o)?d.sendNext(o):S.send(o,u)},function(h){if(h=h||{},l(o+" upload start aborted due to rejected onUpload Promise - details: "+h,"error"),!c.onAutoRetry(o,u,h.responseJSON||{})){var _=q.normalizeResponse(h.responseJSON,!1);q.cleanup(o,_)}})},start:function(o){var u=q.getProxyOrBlob(o);return u?q.maybeDefer(o,u):(q.now(o),!0)}};qq.extend(this,{add:function(o,u){a.add.apply(this,arguments)},upload:function(o){return p.open(o)?q.start(o):!1},retry:function(o){return s&&(a._getFileState(o).temp.ignoreFailure=!1),p.isUsingConnection(o)?q.start(o):n.upload(o)},cancel:function(o){var u=a.cancel(o);qq.isGenericPromise(u)?u.then(function(){q.cancel(o)}):u!==!1&&q.cancel(o)},cancelAll:function(){var o=p.getWaitingOrConnected(),u;if(o.length)for(u=o.length-1;u>=0;u--)n.cancel(o[u]);p.reset()},getFile:function(o){return a.getProxy&&a.getProxy(o)?a.getProxy(o).referenceBlob:a.getFile&&a.getFile(o)},isProxied:function(o){return!!(a.getProxy&&a.getProxy(o))},getInput:function(o){if(a.getInput)return a.getInput(o)},reset:function(){l("Resetting upload handler"),n.cancelAll(),p.reset(),a.reset()},expunge:function(o){if(n.isValid(o))return a.expunge(o)},isValid:function(o){return a.isValid(o)},hasResumeRecord:function(o){var u=a.isValid(o)&&a._getLocalStorageId&&a._getLocalStorageId(o);return u?!!localStorage.getItem(u):!1},getResumableFilesData:function(){return a.getResumableFilesData?a.getResumableFilesData():[]},getThirdPartyFileId:function(o){if(n.isValid(o))return a.getThirdPartyFileId(o)},pause:function(o){return n.isResumable(o)&&a.pause&&n.isValid(o)&&a.pause(o)?(p.free(o),a.moveInProgressToRemaining(o),!0):!1},isAttemptingResume:function(o){return!!a.isAttemptingResume&&a.isAttemptingResume(o)},isResumable:function(o){return!!a.isResumable&&a.isResumable(o)}}),qq.extend(c,e),l=c.log,r=c.chunking.enabled&&qq.supportedFeatures.chunking,s=r&&c.chunking.concurrent.enabled,i=function(){var o={};return o[c.preventRetryParam]=!0,o}(),q.initHandler()},qq.WindowReceiveMessage=function(e){var t={log:function(r,s){}},n={};qq.extend(t,e),qq.extend(this,{receiveMessage:function(r,s){var i=function(l){s(l.data)};window.postMessage?n[r]=qq(window).attach("message",i):log("iframe message passing not supported in this browser!","error")},stopReceivingMessages:function(r){if(window.postMessage){var s=n[r];s&&s()}}})},qq.FormUploadHandler=function(e){var t=e.options,n=this,r=e.proxy,s=qq.getUniqueId(),i={},l={},a={},c=t.isCors,d=t.inputName,p=r.getUuid,S=r.log,q=new qq.WindowReceiveMessage({log:S});function o(m){delete l[m],c&&(clearTimeout(a[m]),delete a[m],q.stopReceivingMessages(m));var v=document.getElementById(n._getIframeName(m));v&&(v.setAttribute("src","javascript:false;"),qq(v).remove())}function u(m){return m.split("_")[0]}function h(m){var v=qq.toElement("<iframe src='javascript:false;' name='"+m+"' />");return v.setAttribute("id",m),v.style.display="none",document.body.appendChild(v),v}function _(m,v){var f=m.id,g=u(f),y=p(g);i[y]=v,l[g]=qq(m).attach("load",function(){n.getInput(g)&&(S("Received iframe load event for CORS upload request (iframe name "+f+")"),a[f]=setTimeout(function(){var C="No valid message received from loaded iframe for iframe name "+f;S(C,"error"),v({error:C})},1e3))}),q.receiveMessage(f,function(C){S("Received the following window message: '"+C+"'"),u(f);var b=n._parseJsonResponse(C),x=b.uuid,w;x&&i[x]?(S("Handling response for iframe name "+f),clearTimeout(a[f]),delete a[f],n._detachLoadEvent(f),w=i[x],delete i[x],q.stopReceivingMessages(f),w(b)):x||S("'"+C+"' does not contain a UUID - ignoring.")})}qq.extend(this,new qq.UploadHandler(e)),qq.override(this,function(m){return{add:function(v,f){m.add(v,{input:f}),f.setAttribute("name",d),f.parentNode&&qq(f).remove()},expunge:function(v){o(v),m.expunge(v)},isValid:function(v){return m.isValid(v)&&n._getFileState(v).input!==void 0}}}),qq.extend(this,{getInput:function(m){return n._getFileState(m).input},_attachLoadEvent:function(m,v){var f;c?_(m,v):l[m.id]=qq(m).attach("load",function(){if(S("Received response for "+m.id),!!m.parentNode){try{if(m.contentDocument&&m.contentDocument.body&&m.contentDocument.body.innerHTML=="false")return}catch(g){S("Error when attempting to access iframe during handling of upload response ("+g.message+")","error"),f={success:!1}}v(f)}})},_createIframe:function(m){var v=n._getIframeName(m);return h(v)},_detachLoadEvent:function(m){l[m]!==void 0&&(l[m](),delete l[m])},_getIframeName:function(m){return m+"_"+s},_initFormForUpload:function(m){var v=m.method,f=m.endpoint,g=m.params,y=m.paramsInBody,C=m.targetName,b=qq.toElement("<form method='"+v+"' enctype='multipart/form-data'></form>"),x=f;return y?qq.obj2Inputs(g,b):x=qq.obj2url(g,f),b.setAttribute("action",x),b.setAttribute("target",C),b.style.display="none",document.body.appendChild(b),b},_parseJsonResponse:function(m){var v={};try{v=qq.parseJson(m)}catch(f){S("Error when attempting to parse iframe upload response ("+f.message+")","error")}return v}})},qq.XhrUploadHandler=function(e){var t=this,n=e.options.namespace,r=e.proxy,s=e.options.chunking,i=function(f){var g=t._getFileState(f);if(g.chunkSize)return g.chunkSize;var y=s.partSize;return qq.isFunction(y)&&(y=y(f,p(f))),g.chunkSize=y,y},l=e.options.resume,a=s&&e.options.chunking.enabled&&qq.supportedFeatures.chunking,c=l&&e.options.resume.enabled&&a&&qq.supportedFeatures.resume,d=r.getName,p=r.getSize,S=r.getUuid,q=r.getEndpoint,o=r.getDataByUuid,u=r.onUuidChanged,h=r.onProgress,_=r.log,m=r.getCustomResumeData;function v(f){qq.each(t._getXhrs(f),function(g,y){var C=t._getAjaxRequester(f,g);y.onreadystatechange=null,y.upload.onprogress=null,y.abort(),C&&C.canceled&&C.canceled(f)})}qq.extend(this,new qq.UploadHandler(e)),qq.override(this,function(f){return{add:function(g,y){if(qq.isFile(y)||qq.isBlob(y))f.add(g,{file:y});else if(y instanceof qq.BlobProxy)f.add(g,{proxy:y});else throw new Error("Passed obj is not a File, Blob, or proxy");t._initTempState(g),c&&t._maybePrepareForResume(g)},expunge:function(g){v(g),t._maybeDeletePersistedChunkData(g),t._clearXhrs(g),f.expunge(g)}}}),qq.extend(this,{clearCachedChunk:function(f,g){var y=t._getFileState(f);y&&delete y.temp.cachedChunks[g]},clearXhr:function(f,g){var y=t._getFileState(f).temp;y.xhrs&&delete y.xhrs[g],y.ajaxRequesters&&delete y.ajaxRequesters[g]},finalizeChunks:function(f,g){var y=t._getTotalChunks(f)-1,C=t._getXhr(f,y);return g?new qq.Promise().success(g(C),C):new qq.Promise().success({},C)},getFile:function(f){return t.isValid(f)&&t._getFileState(f).file},getProxy:function(f){return t.isValid(f)&&t._getFileState(f).proxy},getResumableFilesData:function(){var f=[];return t._iterateResumeRecords(function(g,y){t.moveInProgressToRemaining(null,y.chunking.inProgress,y.chunking.remaining);var C={name:y.name,remaining:y.chunking.remaining,size:y.size,uuid:y.uuid};y.key&&(C.key=y.key),y.customResumeData&&(C.customResumeData=y.customResumeData),f.push(C)}),f},isAttemptingResume:function(f){return t._getFileState(f).attemptingResume},isResumable:function(f){return!!s&&t.isValid(f)&&!t._getFileState(f).notResumable},moveInProgressToRemaining:function(f,g,y){var C=t._getFileState(f)||{},b=C.chunking||{},x=g||b.inProgress,w=y||b.remaining;x&&(_(qq.format("Moving these chunks from in-progress {}, to remaining.",JSON.stringify(x))),x.reverse(),qq.each(x,function(E,F){w.unshift(F)}),x.length=0)},pause:function(f){if(t.isValid(f))return _(qq.format("Aborting XHR upload for {} '{}' due to pause instruction.",f,d(f))),t._getFileState(f).paused=!0,v(f),!0},reevaluateChunking:function(f){if(s&&t.isValid(f)){var g=t._getFileState(f),y,C;if(delete g.chunking,g.chunking={},y=t._getTotalChunks(f),y>1||s.mandatory){for(g.chunking.enabled=!0,g.chunking.parts=y,g.chunking.remaining=[],C=0;C<y;C++)g.chunking.remaining.push(C);t._initTempState(f)}else g.chunking.enabled=!1}},updateBlob:function(f,g){t.isValid(f)&&(t._getFileState(f).file=g)},_clearXhrs:function(f){var g=t._getFileState(f).temp;qq.each(g.ajaxRequesters,function(y){delete g.ajaxRequesters[y]}),qq.each(g.xhrs,function(y){delete g.xhrs[y]})},_createXhr:function(f,g){return t._registerXhr(f,g,qq.createXhrInstance())},_getAjaxRequester:function(f,g){var y=g??-1;return t._getFileState(f).temp.ajaxRequesters[y]},_getChunkData:function(f,g){var y=i(f),C=p(f),b=t.getFile(f),x=y*g,w=x+y>=C?C:x+y,E=t._getTotalChunks(f),F=this._getFileState(f).temp.cachedChunks,P=F[g]||qq.sliceBlob(b,x,w);return F[g]=P,{part:g,start:x,end:w,count:E,blob:P,size:w-x}},_getChunkDataForCallback:function(f){return{partIndex:f.part,startByte:f.start+1,endByte:f.end,totalParts:f.count}},_getLocalStorageId:function(f){var g="5.0",y=d(f),C=p(f),b=i(f),x=q(f),w=l.customKeys(f),E=qq.format("qq{}resume{}-{}-{}-{}-{}",n,g,y,C,b,x);return w.forEach(function(F){E+="-"+F}),E},_getMimeType:function(f){return t.getFile(f).type},_getPersistableData:function(f){return t._getFileState(f).chunking},_getTotalChunks:function(f){if(s){var g=p(f),y=i(f);return Math.ceil(g/y)}},_getXhr:function(f,g){var y=g??-1;return t._getFileState(f).temp.xhrs[y]},_getXhrs:function(f){return t._getFileState(f).temp.xhrs},_iterateResumeRecords:function(f){c&&qq.each(localStorage,function(g,y){if(g.indexOf(qq.format("qq{}resume",n))===0){var C=JSON.parse(y);f(g,C)}})},_initTempState:function(f){t._getFileState(f).temp={ajaxRequesters:{},chunkProgress:{},xhrs:{},cachedChunks:{}}},_markNotResumable:function(f){t._getFileState(f).notResumable=!0},_maybeDeletePersistedChunkData:function(f){var g;return c&&t.isResumable(f)&&(g=t._getLocalStorageId(f),g&&localStorage.getItem(g))?(localStorage.removeItem(g),!0):!1},_maybePrepareForResume:function(f){var g=t._getFileState(f),y,C;c&&g.key===void 0&&(y=t._getLocalStorageId(f),C=localStorage.getItem(y),C&&(C=JSON.parse(C),o(C.uuid)?t._markNotResumable(f):(_(qq.format("Identified file with ID {} and name of {} as resumable.",f,d(f))),u(f,C.uuid),g.key=C.key,g.chunking=C.chunking,g.loaded=C.loaded,g.customResumeData=C.customResumeData,g.attemptingResume=!0,t.moveInProgressToRemaining(f))))},_maybePersistChunkedState:function(f){var g=t._getFileState(f),y,C;if(c&&t.isResumable(f)){var b=m(f);y=t._getLocalStorageId(f),C={name:d(f),size:p(f),uuid:S(f),key:g.key,chunking:g.chunking,loaded:g.loaded,lastUpdated:Date.now()},b&&(C.customResumeData=b);try{localStorage.setItem(y,JSON.stringify(C))}catch(x){_(qq.format("Unable to save resume data for '{}' due to error: '{}'.",f,x.toString()),"warn")}}},_registerProgressHandler:function(f,g,y){var C=t._getXhr(f,g),b=d(f),x={simple:function(w,E){var F=p(f);w===E?h(f,b,F,F):h(f,b,w>=F?F-1:w,F)},chunked:function(w,E){var F=t._getFileState(f).temp.chunkProgress,P=t._getFileState(f).loaded,R=w,I=E,A=p(f),D=R-(I-y),U=P;F[g]=D,qq.each(F,function(T,k){U+=k}),h(f,b,U,A)}};C.upload.onprogress=function(w){if(w.lengthComputable){var E=y==null?"simple":"chunked";x[E](w.loaded,w.total)}}},_registerXhr:function(f,g,y,C){var b=g??-1,x=t._getFileState(f).temp;return x.xhrs=x.xhrs||{},x.ajaxRequesters=x.ajaxRequesters||{},x.xhrs[b]=y,C&&(x.ajaxRequesters[b]=C),y},_removeExpiredChunkingRecords:function(){var f=l.recordsExpireIn;t._iterateResumeRecords(function(g,y){var C=new Date(y.lastUpdated);C.setDate(C.getDate()+f),C.getTime()<=Date.now()&&(_("Removing expired resume record with key "+g),localStorage.removeItem(g))})},_shouldChunkThisFile:function(f){var g=t._getFileState(f);if(g)return g.chunking||t.reevaluateChunking(f),g.chunking.enabled}})},qq.DeleteFileAjaxRequester=function(e){var t,n={method:"DELETE",uuidParamName:"qquuid",endpointStore:{},maxConnections:3,customHeaders:function(s){return{}},paramsStore:{},cors:{expected:!1,sendCredentials:!1},log:function(s,i){},onDelete:function(s){},onDeleteComplete:function(s,i,l){}};qq.extend(n,e);function r(){return n.method.toUpperCase()==="POST"?{_method:"DELETE"}:{}}t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:["POST","DELETE"],method:n.method,endpointStore:n.endpointStore,paramsStore:n.paramsStore,mandatedParams:r(),maxConnections:n.maxConnections,customHeaders:function(s){return n.customHeaders.get(s)},log:n.log,onSend:n.onDelete,onComplete:n.onDeleteComplete,cors:n.cors})),qq.extend(this,{sendDelete:function(s,i,l){var a=l||{};n.log("Submitting delete file request for "+s),n.method==="DELETE"?t.initTransport(s).withPath(i).withParams(a).send():(a[n.uuidParamName]=i,t.initTransport(s).withParams(a).send())}})},function(){function e(c){var d=c.naturalWidth,p=c.naturalHeight,S=document.createElement("canvas"),q;return d*p>1024*1024?(S.width=S.height=1,q=S.getContext("2d"),q.drawImage(c,-d+1,0),q.getImageData(0,0,1,1).data[3]===0):!1}function t(c,d,p){var S=document.createElement("canvas"),q=0,o=p,u=p,h,_,m,v;for(S.width=1,S.height=p,h=S.getContext("2d"),h.drawImage(c,0,0),_=h.getImageData(0,0,1,p).data;u>q;)m=_[(u-1)*4+3],m===0?o=u:q=u,u=o+q>>1;return v=u/p,v===0?1:v}function n(c,d,p,S){var q=document.createElement("canvas"),o=p.mime||"image/jpeg",u=new qq.Promise;return s(c,d,q,p,S).then(function(){u.success(q.toDataURL(o,p.quality||.8))}),u}function r(c){var d=5241e3;if(!qq.ios())throw new qq.Error("Downsampled dimensions can only be reliably calculated for iOS!");if(c.origHeight*c.origWidth>d)return{newHeight:Math.round(Math.sqrt(d*(c.origHeight/c.origWidth))),newWidth:Math.round(Math.sqrt(d*(c.origWidth/c.origHeight)))}}function s(c,d,p,S,q){var o=c.naturalWidth,u=c.naturalHeight,h=S.width,_=S.height,m=p.getContext("2d"),v=new qq.Promise,f;return m.save(),S.resize?i({blob:d,canvas:p,image:c,imageHeight:u,imageWidth:o,orientation:S.orientation,resize:S.resize,targetHeight:_,targetWidth:h}):(qq.supportedFeatures.unlimitedScaledImageSize||(f=r({origWidth:h,origHeight:_}),f&&(qq.log(qq.format("Had to reduce dimensions due to device limitations from {}w / {}h to {}w / {}h",h,_,f.newWidth,f.newHeight),"warn"),h=f.newWidth,_=f.newHeight)),l(p,h,_,S.orientation),qq.ios()?function(){e(c)&&(o/=2,u/=2);var g=1024,y=document.createElement("canvas"),C=q?t(c,o,u):1,b=Math.ceil(g*h/o),x=Math.ceil(g*_/u/C),w=0,E=0,F,P,R;for(y.width=y.height=g,F=y.getContext("2d");w<u;){for(P=0,R=0;P<o;)F.clearRect(0,0,g,g),F.drawImage(c,-P,-w),m.drawImage(y,0,0,g,g,R,E,b,x),P+=g,R+=b;w+=g,E+=x}m.restore(),y=F=null}():m.drawImage(c,0,0,h,_),p.qqImageRendered&&p.qqImageRendered(),v.success(),v)}function i(c){var d=c.blob,p=c.image,S=c.imageHeight,q=c.imageWidth,o=c.orientation,u=new qq.Promise,h=c.resize,_=document.createElement("canvas"),m=_.getContext("2d"),v=c.canvas,f=c.targetHeight,g=c.targetWidth;return l(_,q,S,o),v.height=f,v.width=g,m.drawImage(p,0,0),h({blob:d,height:f,image:p,sourceCanvas:_,targetCanvas:v,width:g}).then(function(){v.qqImageRendered&&v.qqImageRendered(),u.success()},u.failure),u}function l(c,d,p,S){switch(S){case 5:case 6:case 7:case 8:c.width=p,c.height=d;break;default:c.width=d,c.height=p}var q=c.getContext("2d");switch(S){case 2:q.translate(d,0),q.scale(-1,1);break;case 3:q.translate(d,p),q.rotate(Math.PI);break;case 4:q.translate(0,p),q.scale(1,-1);break;case 5:q.rotate(.5*Math.PI),q.scale(1,-1);break;case 6:q.rotate(.5*Math.PI),q.translate(0,-p);break;case 7:q.rotate(.5*Math.PI),q.translate(d,-p),q.scale(-1,1);break;case 8:q.rotate(-.5*Math.PI),q.translate(-d,0);break}}function a(c,d){var p=this;window.Blob&&c instanceof Blob&&function(){var S=new Image,q=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;if(!q)throw Error("No createObjectURL function found to create blob url");S.src=q.createObjectURL(c),p.blob=c,c=S}(),!c.naturalWidth&&!c.naturalHeight&&(c.onload=function(){var S=p.imageLoadListeners;S&&(p.imageLoadListeners=null,setTimeout(function(){for(var q=0,o=S.length;q<o;q++)S[q]()},0))},c.onerror=d,this.imageLoadListeners=[]),this.srcImage=c}a.prototype.render=function(c,d){d=d||{};var p=this,S=this.srcImage.naturalWidth,q=this.srcImage.naturalHeight,o=d.width,u=d.height,h=d.maxWidth,_=d.maxHeight,m=!this.blob||this.blob.type==="image/jpeg",v=c.tagName.toLowerCase(),f;if(this.imageLoadListeners){this.imageLoadListeners.push(function(){p.render(c,d)});return}o&&!u?u=q*o/S<<0:u&&!o?o=S*u/q<<0:(o=S,u=q),h&&o>h&&(o=h,u=q*o/S<<0),_&&u>_&&(u=_,o=S*u/q<<0),f={width:o,height:u},qq.each(d,function(g,y){f[g]=y}),v==="img"?function(){var g=c.src;n(p.srcImage,p.blob,f,m).then(function(y){c.src=y,g===c.src&&c.onload()})}():v==="canvas"&&s(this.srcImage,this.blob,c,f,m),typeof this.onrender=="function"&&this.onrender(c)},qq.MegaPixImage=a}(),qq.ImageGenerator=function(e){function t(u){return u.tagName.toLowerCase()==="img"}function n(u){return u.tagName.toLowerCase()==="canvas"}function r(){return new Image().crossOrigin!==void 0}function s(){var u=document.createElement("canvas");return u.getContext&&u.getContext("2d")}function i(u){var h=u.split("/"),_=h[h.length-1].split("?")[0],m=qq.getExtension(_);switch(m=m&&m.toLowerCase(),m){case"jpeg":case"jpg":return"image/jpeg";case"png":return"image/png";case"bmp":return"image/bmp";case"gif":return"image/gif";case"tiff":case"tif":return"image/tiff"}}function l(u){var h=document.createElement("a"),_,m,v;return h.href=u,_=h.protocol,v=h.port,m=h.hostname,_.toLowerCase()!==window.location.protocol.toLowerCase()||m.toLowerCase()!==window.location.hostname.toLowerCase()||v!==window.location.port&&!qq.ie()}function a(u,h){u.onload=function(){u.onload=null,u.onerror=null,h.success(u)},u.onerror=function(){u.onload=null,u.onerror=null,e("Problem drawing thumbnail!","error"),h.failure(u,"Problem drawing thumbnail!")}}function c(u,h){u.qqImageRendered=function(){h.success(u)}}function d(u,h){var _=t(u)||n(u);return t(u)?a(u,h):n(u)?c(u,h):(h.failure(u),e(qq.format("Element container of type {} is not supported!",u.tagName),"error")),_}function p(u,h,_){var m=new qq.Promise,v=new qq.Identify(u,e),f=_.maxSize,g=_.orient==null?!0:_.orient,y=function(){h.onerror=null,h.onload=null,e("Could not render preview, file may be too large!","error"),m.failure(h,"Browser cannot render image!")};return v.isPreviewable().then(function(C){var b={parse:function(){return new qq.Promise().success()}},x=g?new qq.Exif(u,e):b,w=new qq.MegaPixImage(u,y);d(h,m)&&x.parse().then(function(E){var F=E&&E.Orientation;w.render(h,{maxWidth:f,maxHeight:f,orientation:F,mime:C,resize:_.customResizeFunction})},function(E){e(qq.format("EXIF data could not be parsed ({}).  Assuming orientation = 1.",E)),w.render(h,{maxWidth:f,maxHeight:f,mime:C,resize:_.customResizeFunction})})},function(){e("Not previewable"),m.failure(h,"Not previewable")}),m}function S(u,h,_,m,v){var f=new Image,g=new qq.Promise;d(f,g),l(u)&&(f.crossOrigin="anonymous"),f.src=u,g.then(function(){d(h,_);var C=new qq.MegaPixImage(f);C.render(h,{maxWidth:m,maxHeight:m,mime:i(u),resize:v})},_.failure)}function q(u,h,_,m){d(h,_),qq(h).css({maxWidth:m+"px",maxHeight:m+"px"}),h.src=u}function o(u,h,_){var m=new qq.Promise,v=_.scale,f=v?_.maxSize:null;return v&&t(h)?s()?l(u)&&!r()?q(u,h,m,f):S(u,h,m,f):q(u,h,m,f):n(h)?S(u,h,m,f):d(h,m)&&(h.src=u),m}qq.extend(this,{generate:function(u,h,_){return qq.isString(u)?(e("Attempting to update thumbnail based on server response."),o(u,h,_||{})):(e("Attempting to draw client-side image preview."),p(u,h,_||{}))}}),this._testing={},this._testing.isImg=t,this._testing.isCanvas=n,this._testing.isCrossOrigin=l,this._testing.determineMimeOfFileName=i},qq.Exif=function(e,t){var n=[274],r={274:{name:"Orientation",bytes:2}};function s(q){for(var o=0,u=0;q.length>0;)o+=parseInt(q.substring(0,2),16)*Math.pow(2,u),q=q.substring(2,q.length),u+=8;return o}function i(q,o){var u=q,h=o;return u===void 0&&(u=2,h=new qq.Promise),qq.readBlobToHex(e,u,4).then(function(_){var m=/^ffe([0-9])/.exec(_),v;m?m[1]!=="1"?(v=parseInt(_.slice(4,8),16),i(u+v+2,h)):h.success(u):h.failure("No EXIF header to be found!")}),h}function l(){var q=new qq.Promise;return qq.readBlobToHex(e,0,6).then(function(o){o.indexOf("ffd8")!==0?q.failure("Not a valid JPEG!"):i().then(function(u){q.success(u)},function(u){q.failure(u)})}),q}function a(q){var o=new qq.Promise;return qq.readBlobToHex(e,q+10,2).then(function(u){o.success(u==="4949")}),o}function c(q,o){var u=new qq.Promise;return qq.readBlobToHex(e,q+18,2).then(function(h){if(o)return u.success(s(h));u.success(parseInt(h,16))}),u}function d(q,o){var u=q+20,h=o*12;return qq.readBlobToHex(e,u,h)}function p(q){for(var o=[],u=0;u+24<=q.length;)o.push(q.slice(u,u+24)),u+=24;return o}function S(q,o){var u=16,h=qq.extend([],n),_={};return qq.each(o,function(m,v){var f=v.slice(0,4),g=q?s(f):parseInt(f,16),y=h.indexOf(g),C,b,x;if(y>=0&&(b=r[g].name,x=r[g].bytes,C=v.slice(u,u+x*2),_[b]=q?s(C):parseInt(C,16),h.splice(y,1)),h.length===0)return!1}),_}qq.extend(this,{parse:function(){var q=new qq.Promise,o=function(u){t(qq.format("EXIF header parse failed: '{}' ",u)),q.failure(u)};return l().then(function(u){t(qq.format("Moving forward with EXIF header parsing for '{}'",e.name===void 0?"blob":e.name)),a(u).then(function(h){t(qq.format("EXIF Byte order is {} endian",h?"little":"big")),c(u,h).then(function(_){t(qq.format("Found {} APP1 directory entries",_)),d(u,_).then(function(m){var v=p(m),f=S(h,v);t("Successfully parsed some EXIF tags"),q.success(f)},o)},o)},o)},o),q}}),this._testing={},this._testing.parseLittleEndian=s},qq.Identify=function(e,t){function n(r,s){var i=!1,l=[].concat(r);return qq.each(l,function(a,c){if(s.indexOf(c)===0)return i=!0,!1}),i}qq.extend(this,{isPreviewable:function(){var r=this,s=new qq.Promise,i=!1,l=e.name===void 0?"blob":e.name;return t(qq.format("Attempting to determine if {} can be rendered in this browser",l)),t("First pass: check type attribute of blob object."),this.isPreviewableSync()?(t("Second pass: check for magic bytes in file header."),qq.readBlobToHex(e,0,4).then(function(a){qq.each(r.PREVIEWABLE_MIME_TYPES,function(c,d){if(n(d,a))return(c!=="image/tiff"||qq.supportedFeatures.tiffPreviews)&&(i=!0,s.success(c)),!1}),t(qq.format("'{}' is {} able to be rendered in this browser",l,i?"":"NOT")),i||s.failure()},function(){t("Error reading file w/ name '"+l+"'.  Not able to be rendered in this browser."),s.failure()})):s.failure(),s},isPreviewableSync:function(){var r=e.type,s=qq.indexOf(Object.keys(this.PREVIEWABLE_MIME_TYPES),r)>=0,i=!1,l=e.name===void 0?"blob":e.name;return s&&(r==="image/tiff"?i=qq.supportedFeatures.tiffPreviews:i=!0),!i&&t(l+" is not previewable in this browser per the blob's type attr"),i}})},qq.Identify.prototype.PREVIEWABLE_MIME_TYPES={"image/jpeg":"ffd8ff","image/gif":"474946","image/png":"89504e","image/bmp":"424d","image/tiff":["49492a00","4d4d002a"]},qq.ImageValidation=function(e,t){function n(i){var l=!1;return qq.each(i,function(a,c){if(c>0)return l=!0,!1}),l}function r(){var i=new qq.Promise;return new qq.Identify(e,t).isPreviewable().then(function(){var l=new Image,a=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;a?(l.onerror=function(){t("Cannot determine dimensions for image.  May be too large.","error"),i.failure()},l.onload=function(){i.success({width:this.width,height:this.height})},l.src=a.createObjectURL(e)):(t("No createObjectURL function available to generate image URL!","error"),i.failure())},i.failure),i}function s(i,l){var a;return qq.each(i,function(c,d){if(d>0){var p=/(max|min)(Width|Height)/.exec(c),S=p[2].charAt(0).toLowerCase()+p[2].slice(1),q=l[S];switch(p[1]){case"min":if(q<d)return a=c,!1;break;case"max":if(q>d)return a=c,!1;break}}}),a}this.validate=function(i){var l=new qq.Promise;return t("Attempting to validate image."),n(i)?r().then(function(a){var c=s(i,a);c?l.failure(c):l.success()},l.success):l.success(),l}},qq.Session=function(e){var t={endpoint:null,params:{},customHeaders:{},cors:{},addFileRecord:function(s){},log:function(s,i){}};qq.extend(t,e,!0);function n(s){if(qq.isArray(s))return!0;t.log("Session response is not an array.","error")}function r(s,i,l,a){var c=!1;i=i&&n(s),i&&qq.each(s,function(d,p){if(p.uuid==null)c=!0,t.log(qq.format("Session response item {} did not include a valid UUID - ignoring.",d),"error");else if(p.name==null)c=!0,t.log(qq.format("Session response item {} did not include a valid name - ignoring.",d),"error");else try{return t.addFileRecord(p),!0}catch(S){c=!0,t.log(S.message,"error")}return!1}),a[i&&!c?"success":"failure"](s,l)}this.refresh=function(){var s=new qq.Promise,i=function(c,d,p){r(c,d,p,s)},l=qq.extend({},t),a=new qq.SessionAjaxRequester(qq.extend(l,{onComplete:i}));return a.queryServer(),s}},qq.SessionAjaxRequester=function(e){var t,n={endpoint:null,customHeaders:{},params:{},cors:{expected:!1,sendCredentials:!1},onComplete:function(s,i,l){},log:function(s,i){}};qq.extend(n,e);function r(s,i,l){var a=null;if(i.responseText!=null)try{a=qq.parseJson(i.responseText)}catch(c){n.log("Problem parsing session response: "+c.message,"error"),l=!0}n.onComplete(a,!l,i)}t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:["GET"],method:"GET",endpointStore:{get:function(){return n.endpoint}},customHeaders:n.customHeaders,log:n.log,onComplete:r,cors:n.cors})),qq.extend(this,{queryServer:function(){var s=qq.extend({},n.params);n.log("Session query request."),t.initTransport("sessionRefresh").withParams(s).withCacheBuster().send()}})},qq.Scaler=function(e,t){var n=e.customResizer,r=e.sendOriginal,s=e.orient,i=e.defaultType,l=e.defaultQuality/100,a=e.failureText,c=e.includeExif,d=this._getSortedSizes(e.sizes);qq.extend(this,{enabled:qq.supportedFeatures.scaling&&d.length>0,getFileRecords:function(p,S,q){var o=this,u=[],h=q.blob?q.blob:q,_=new qq.Identify(h,t);return _.isPreviewableSync()?(qq.each(d,function(m,v){var f=o._determineOutputType({defaultType:i,requestedType:v.type,refType:h.type});u.push({uuid:qq.getUniqueId(),name:o._getName(S,{name:v.name,type:f,refType:h.type}),blob:new qq.BlobProxy(h,qq.bind(o._generateScaledImage,o,{customResizeFunction:n,maxSize:v.maxSize,orient:s,type:f,quality:l,failedText:a,includeExif:c,log:t}))})}),u.push({uuid:p,name:S,size:h.size,blob:r?h:null})):u.push({uuid:p,name:S,size:h.size,blob:h}),u},handleNewFile:function(p,S,q,o,u,h,_,m){var v=this;p.qqButtonId||p.blob&&p.blob.qqButtonId;var f=[],g=null,y=m.addFileToHandler,C=m.uploadData,b=m.paramsStore,x=qq.getUniqueId();qq.each(v.getFileRecords(q,S,p),function(w,E){var F=E.size,P;E.blob instanceof qq.BlobProxy&&(F=-1),P=C.addFile({uuid:E.uuid,name:E.name,size:F,batchId:h,proxyGroupId:x}),E.blob instanceof qq.BlobProxy?f.push(P):g=P,E.blob?(y(P,E.blob),u.push({id:P,file:E.blob})):C.setStatus(P,qq.status.REJECTED)}),g!==null&&(qq.each(f,function(w,E){var F={qqparentuuid:C.retrieve({id:g}).uuid,qqparentsize:C.retrieve({id:g}).size};F[_]=C.retrieve({id:E}).uuid,C.setParentId(E,g),b.addReadOnly(E,F)}),f.length&&function(){var w={};w[_]=C.retrieve({id:g}).uuid,b.addReadOnly(g,w)}())}})},qq.extend(qq.Scaler.prototype,{scaleImage:function(e,t,n){if(!qq.supportedFeatures.scaling)throw new qq.Error("Scaling is not supported in this browser!");var r=new qq.Promise,s=n.log,i=n.getFile(e),l=n.uploadData.retrieve({id:e}),a=l&&l.name,c=l&&l.uuid,d={customResizer:t.customResizer,sendOriginal:!1,orient:t.orient,defaultType:t.type||null,defaultQuality:t.quality,failedToScaleText:"Unable to scale",sizes:[{name:"",maxSize:t.maxSize}]},p=new qq.Scaler(d,s);return!qq.Scaler||!qq.supportedFeatures.imagePreviews||!i?(r.failure(),s("Could not generate requested scaled image for "+e+".  Scaling is either not possible in this browser, or the file could not be located.","error")):qq.bind(function(){var S=p.getFileRecords(c,a,i)[0];S&&S.blob instanceof qq.BlobProxy?S.blob.create().then(r.success,r.failure):(s(e+" is not a scalable image!","error"),r.failure())},this)(),r},_determineOutputType:function(e){var t=e.requestedType,n=e.defaultType,r=e.refType;return!n&&!t?r!=="image/jpeg"?"image/png":r:t&&qq.indexOf(Object.keys(qq.Identify.prototype.PREVIEWABLE_MIME_TYPES),t)>=0?t==="image/tiff"?qq.supportedFeatures.tiffPreviews?t:n:t:n},_getName:function(e,t){var n=e.lastIndexOf("."),r=t.type||"image/png",s=t.refType,i="",l=qq.getExtension(e),a="";return t.name&&t.name.trim().length&&(a=" ("+t.name+")"),n>=0?(i=e.substr(0,n),s!==r&&(l=r.split("/")[1]),i+=a+"."+l):i=e+a,i},_getSortedSizes:function(e){return e=qq.extend([],e),e.sort(function(t,n){return t.maxSize>n.maxSize?1:t.maxSize<n.maxSize?-1:0})},_generateScaledImage:function(e,t){var n=this,r=e.customResizeFunction,s=e.log,i=e.maxSize,l=e.orient,a=e.type,c=e.quality,d=e.failedText,p=e.includeExif&&t.type==="image/jpeg"&&a==="image/jpeg",S=new qq.Promise,q=new qq.ImageGenerator(s),o=document.createElement("canvas");return s("Attempting to generate scaled version for "+t.name),q.generate(t,o,{maxSize:i,orient:l,customResizeFunction:r}).then(function(){var u=o.toDataURL(a,c),h=function(){s("Success generating scaled version for "+t.name);var _=qq.dataUriToBlob(u);S.success(_)};p?n._insertExifHeader(t,u,s).then(function(_){u=_,h()},function(){s("Problem inserting EXIF header into scaled image.  Using scaled image w/out EXIF data.","error"),h()}):h()},function(){s("Failed attempt to generate scaled version for "+t.name,"error"),S.failure(d)}),S},_insertExifHeader:function(e,t,n){var r=new FileReader,s=new qq.Promise,i="";return r.onload=function(){i=r.result,s.success(qq.ExifRestorer.restore(i,t))},r.onerror=function(){n("Problem reading "+e.name+" during attempt to transfer EXIF data to scaled version.","error"),s.failure()},r.readAsDataURL(e),s},_dataUriToBlob:function(e){var t,n,r,s;return e.split(",")[0].indexOf("base64")>=0?t=atob(e.split(",")[1]):t=decodeURI(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(t.length),s=new Uint8Array(r),qq.each(t,function(i,l){s[i]=l.charCodeAt(0)}),this._createBlob(r,n)},_createBlob:function(e,t){var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,r=n&&new n;return r?(r.append(e),r.getBlob(t)):new Blob([e],{type:t})}}),qq.ExifRestorer=function(){var e={};return e.KEY_STR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e.encode64=function(t){var n="",r,s,i="",l,a,c,d="",p=0;do r=t[p++],s=t[p++],i=t[p++],l=r>>2,a=(r&3)<<4|s>>4,c=(s&15)<<2|i>>6,d=i&63,isNaN(s)?c=d=64:isNaN(i)&&(d=64),n=n+this.KEY_STR.charAt(l)+this.KEY_STR.charAt(a)+this.KEY_STR.charAt(c)+this.KEY_STR.charAt(d),r=s=i="",l=a=c=d="";while(p<t.length);return n},e.restore=function(t,n){var r="data:image/jpeg;base64,";if(!t.match(r))return n;var s=this.decode64(t.replace(r,"")),i=this.slice2Segments(s),l=this.exifManipulation(n,i);return r+this.encode64(l)},e.exifManipulation=function(t,n){var r=this.getExifArray(n),s=this.insertExif(t,r),i=new Uint8Array(s);return i},e.getExifArray=function(t){for(var n,r=0;r<t.length;r++)if(n=t[r],n[0]==255&n[1]==225)return n;return[]},e.insertExif=function(t,n){var r=t.replace("data:image/jpeg;base64,",""),s=this.decode64(r),i=s.indexOf(255,3),l=s.slice(0,i),a=s.slice(i),c=l;return c=c.concat(n),c=c.concat(a),c},e.slice2Segments=function(t){for(var n=0,r=[];!(t[n]==255&t[n+1]==218);){if(t[n]==255&t[n+1]==216)n+=2;else{var s=t[n+2]*256+t[n+3],i=n+s+2,l=t.slice(n,i);r.push(l),n=i}if(n>t.length)break}return r},e.decode64=function(t){var n,r,s="",i,l,a,c="",d=0,p=[],S=/[^A-Za-z0-9\+\/\=]/g;if(S.exec(t))throw new Error("There were invalid base64 characters in the input text.  Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='");t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do i=this.KEY_STR.indexOf(t.charAt(d++)),l=this.KEY_STR.indexOf(t.charAt(d++)),a=this.KEY_STR.indexOf(t.charAt(d++)),c=this.KEY_STR.indexOf(t.charAt(d++)),n=i<<2|l>>4,r=(l&15)<<4|a>>2,s=(a&3)<<6|c,p.push(n),a!=64&&p.push(r),c!=64&&p.push(s),n=r=s="",i=l=a=c="";while(d<t.length);return p},e}(),qq.TotalProgress=function(e,t){var n={},r=0,s=0,i=-1,l=-1,a=function(o,u){(o!==i||u!==l)&&e(o,u),i=o,l=u},c=function(o,u){var h=!0;return qq.each(o,function(_,m){if(qq.indexOf(u,m)>=0)return h=!1,!1}),h},d=function(o){q(o,-1,-1),delete n[o]},p=function(o,u,h){(u.length===0||c(u,h))&&(a(s,s),this.reset())},S=function(o){var u=t(o);u>0&&(q(o,0,u),n[o]={loaded:0,total:u})},q=function(o,u,h){var _=n[o]?n[o].loaded:0,m=n[o]?n[o].total:0;u===-1&&h===-1?(r-=_,s-=m):(u&&(r+=u-_),h&&(s+=h-m)),a(r,s)};qq.extend(this,{onAllComplete:p,onStatusChange:function(o,u,h){h===qq.status.CANCELED||h===qq.status.REJECTED?d(o):h===qq.status.SUBMITTING&&S(o)},onIndividualProgress:function(o,u,h){q(o,u,h),n[o]={loaded:u,total:h}},onNewSize:function(o){S(o)},reset:function(){n={},r=0,s=0}})},qq.PasteSupport=function(e){var t,n;t={targetElement:null,callbacks:{log:function(l,a){},pasteReceived:function(l){}}};function r(l){return l.type&&l.type.indexOf("image/")===0}function s(){n=qq(t.targetElement).attach("paste",function(l){var a=l.clipboardData;a&&qq.each(a.items,function(c,d){if(r(d)){var p=d.getAsFile();t.callbacks.pasteReceived(p)}})})}function i(){n&&n()}qq.extend(t,e),s(),qq.extend(this,{reset:function(){i()}})},qq.FormSupport=function(e,t,n){var r=this,s=e.interceptSubmit,i=e.element,l=e.autoUpload;qq.extend(this,{newEndpoint:null,newAutoUpload:l,attachedToForm:!1,getFormInputsAsObject:function(){return i==null?null:r._form2Obj(i)}});function a(S){S.getAttribute("action")&&(r.newEndpoint=S.getAttribute("action"))}function c(S,q){if(S.checkValidity&&!S.checkValidity())n("Form did not pass validation checks - will not upload.","error"),q();else return!0}function d(S){var q=S.submit;qq(S).attach("submit",function(o){o=o||window.event,o.preventDefault?o.preventDefault():o.returnValue=!1,c(S,q)&&t()}),S.submit=function(){c(S,q)&&t()}}function p(S){return S&&(qq.isString(S)&&(S=document.getElementById(S)),S&&(n("Attaching to form element."),a(S),s&&d(S))),S}i=p(i),this.attachedToForm=!!i},qq.extend(qq.FormSupport.prototype,{_form2Obj:function(e){var t={},n=function(l){var a=["button","image","reset","submit"];return qq.indexOf(a,l.toLowerCase())<0},r=function(l){return qq.indexOf(["checkbox","radio"],l.toLowerCase())>=0},s=function(l){return r(l.type)&&!l.checked?!0:l.disabled&&l.type.toLowerCase()!=="hidden"},i=function(l){var a=null;return qq.each(qq(l).children(),function(c,d){if(d.tagName.toLowerCase()==="option"&&d.selected)return a=d.value,!1}),a};return qq.each(e.elements,function(l,a){if((qq.isInput(a,!0)||a.tagName.toLowerCase()==="textarea")&&n(a.type)&&!s(a))t[a.name]=a.value;else if(a.tagName.toLowerCase()==="select"&&!s(a)){var c=i(a);c!==null&&(t[a.name]=c)}}),t}}),qq.traditional=qq.traditional||{},qq.traditional.FormUploadHandler=function(e,t){var n=this,r=t.getName,s=t.getUuid,i=t.log;function l(c,d){var p,S,q;try{S=d.contentDocument||d.contentWindow.document,q=S.body.innerHTML,i("converting iframe's innerHTML to JSON"),i("innerHTML = "+q),q&&q.match(/^<pre/i)&&(q=S.body.firstChild.firstChild.nodeValue),p=n._parseJsonResponse(q)}catch(o){i("Error when attempting to parse form upload response ("+o.message+")","error"),p={success:!1}}return p}function a(c,d){var p=e.paramsStore.get(c),S=e.method.toLowerCase()==="get"?"GET":"POST",q=e.endpointStore.get(c),o=r(c);return p[e.uuidName]=s(c),p[e.filenameParam]=o,n._initFormForUpload({method:S,endpoint:q,params:p,paramsInBody:e.paramsInBody,targetName:d.name})}this.uploadFile=function(c){var d=n.getInput(c),p=n._createIframe(c),S=new qq.Promise,q;return q=a(c,p),q.appendChild(d),n._attachLoadEvent(p,function(o){i("iframe loaded");var u=o||l(c,p);n._detachLoadEvent(c),e.cors.expected||qq(p).remove(),u.success?S.success(u):S.failure(u)}),i("Sending upload request for "+c),q.submit(),qq(q).remove(),S},qq.extend(this,new qq.FormUploadHandler({options:{isCors:e.cors.expected,inputName:e.inputName},proxy:{onCancel:e.onCancel,getName:r,getUuid:s,log:i}}))},qq.traditional=qq.traditional||{},qq.traditional.XhrUploadHandler=function(e,t){var n=this,r=t.getName,s=t.getSize,i=t.getUuid,l=t.log,a=e.forceMultipart||e.paramsInBody,c=function(v,f,g){var y=s(v),C=r(v);e.omitDefaultParams||(f[e.chunking.paramNames.partIndex]=g.part,f[e.chunking.paramNames.partByteOffset]=g.start,f[e.chunking.paramNames.chunkSize]=g.size,f[e.chunking.paramNames.totalParts]=g.count,f[e.totalFileSizeName]=y),a&&!e.omitDefaultParams&&(f[e.filenameParam]=C)},d=new qq.traditional.AllChunksDoneAjaxRequester({cors:e.cors,endpoint:e.chunking.success.endpoint,headers:e.chunking.success.headers,jsonPayload:e.chunking.success.jsonPayload,log:l,method:e.chunking.success.method,params:e.chunking.success.params}),p=function(v,f){var g=new qq.Promise;return f.onreadystatechange=function(){if(f.readyState===4){var y=o(v,f);y.success?g.success(y.response,f):g.failure(y.response,f)}},g},S=function(v){var f=e.paramsStore.get(v),g=r(v),y=s(v);return f[e.uuidName]=i(v),f[e.filenameParam]=g,f[e.totalFileSizeName]=y,f[e.chunking.paramNames.totalParts]=n._getTotalChunks(v),f},q=function(v,f){return qq.indexOf([200,201,202,203,204],v.status)<0||e.requireSuccessJson&&!f.success||f.reset},o=function(v,f){var g;return l("xhr - server response received for "+v),l("responseText = "+f.responseText),g=u(!0,f),{success:!q(f,g),response:g}},u=function(v,f){var g={};try{l(qq.format("Received response status {} with body: {}",f.status,f.responseText)),g=qq.parseJson(f.responseText)}catch(y){v&&e.requireSuccessJson&&l("Error when attempting to parse xhr response text ("+y.message+")","error")}return g},h=function(v){var f=new qq.Promise;return d.complete(v,n._createXhr(v),S(v),e.customHeaders.get(v)).then(function(g){f.success(u(!1,g),g)},function(g){f.failure(u(!1,g),g)}),f},_=function(v){var f=v.fileOrBlob,g=v.id,y=v.xhr,C=v.xhrOverrides||{},b=v.customParams||{},x=v.params||{},w=C.params||{},E,F=a?new FormData:null,P=C.method||e.method,R=C.endpoint||e.endpointStore.get(g),I=r(g),A=s(g);return e.omitDefaultParams?(E=qq.extend({},b),qq.extend(E,w)):(E=qq.extend({},b),qq.extend(E,w),qq.extend(E,x),E[e.uuidName]=i(g),E[e.filenameParam]=I,a?E[e.totalFileSizeName]=A:e.paramsInBody||(E[e.inputName]=I)),e.paramsInBody||(R=qq.obj2url(E,R)),y.open(P,R,!0),e.cors.expected&&e.cors.sendCredentials&&(y.withCredentials=!0),a?(e.paramsInBody&&qq.obj2FormData(E,F),F.append(e.inputName,f),F):f},m=function(v){var f=v.headerOverrides,g=v.id,y=v.xhr;if(f)qq.each(f,function(x,w){y.setRequestHeader(x,w)});else{var C=e.customHeaders.get(g),b=n.getFile(g);y.setRequestHeader("Accept","application/json"),y.setRequestHeader("X-Requested-With","XMLHttpRequest"),y.setRequestHeader("Cache-Control","no-cache"),a||(y.setRequestHeader("Content-Type","application/octet-stream"),y.setRequestHeader("X-Mime-Type",b.type)),qq.each(C,function(x,w){y.setRequestHeader(x,w)})}};qq.extend(this,{uploadChunk:function(v){var f=v.id,g=v.chunkIdx,y=v.overrides||{},C=v.resuming,b=n._getChunkData(f,g),x=n._createXhr(f,g),w,E,F,P={};return w=p(f,x),n._registerProgressHandler(f,g,b.size),F=e.paramsStore.get(f),c(f,P,b),C&&(P[e.resume.paramNames.resuming]=!0),E=_({fileOrBlob:b.blob,id:f,customParams:F,params:P,xhr:x,xhrOverrides:y}),m({headerOverrides:y.headers,id:f,xhr:x}),x.send(E),w},uploadFile:function(v){var f=n.getFile(v),g,y,C,b;return y=n._createXhr(v),n._registerProgressHandler(v),g=p(v,y),C=e.paramsStore.get(v),b=_({fileOrBlob:f,id:v,customParams:C,xhr:y}),m({id:v,xhr:y}),y.send(b),g}}),qq.extend(this,new qq.XhrUploadHandler({options:qq.extend({namespace:"traditional"},e),proxy:qq.extend({getEndpoint:e.endpointStore.get},t)})),qq.override(this,function(v){return{finalizeChunks:function(f){return t.onFinalizing(f),e.chunking.success.endpoint?h(f):v.finalizeChunks(f,qq.bind(u,this,!0))}}})},qq.traditional.AllChunksDoneAjaxRequester=function(e){var t,n={cors:{allowXdr:!1,expected:!1,sendCredentials:!1},endpoint:null,log:function(i,l){},method:"POST"},r={},s={get:function(i){return qq.isFunction(n.endpoint)?n.endpoint(i):n.endpoint}};qq.extend(n,e),t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",contentType:n.jsonPayload?"application/json":"application/x-www-form-urlencoded",validMethods:[n.method],method:n.method,endpointStore:s,allowXRequestedWithAndCacheControl:!1,cors:n.cors,log:n.log,onComplete:function(i,l,a){var c=r[i];delete r[i],a?c.failure(l):c.success(l)}})),qq.extend(this,{complete:function(i,l,a,c){var d=new qq.Promise;return n.log("Submitting All Chunks Done request for "+i),r[i]=d,t.initTransport(i).withParams(n.params(i)||a).withHeaders(n.headers(i)||c).send(l),d}})}})(window)})(fineUploader_core);var fineUploader_coreExports=fineUploader_core.exports,core=fineUploader_coreExports;export{azure as a,core as c,qq as q,s3 as s};
//# sourceMappingURL=fine-uploader.C_FDpdrq.js.map
